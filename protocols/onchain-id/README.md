# ONCHAINID: –ø—Ä–æ—Ç–æ–∫–æ–ª onchain-–∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–µ–π (ERC-734 / ERC-735)

**–ê–≤—Ç–æ—Ä:** [–ê–ª–µ–∫—Å–µ–π –ö—É—Ü–µ–Ω–∫–æ](https://github.com/bimkon144) üë®‚Äçüíª

## 1. –í–≤–µ–¥–µ–Ω–∏–µ

ONCHAINID - —ç—Ç–æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ [ERC-734](https://github.com/ethereum/EIPs/issues/734) (Key Manager) –∏ [ERC-735](https://github.com/ethereum/EIPs/issues/735) (Claim Manager) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—è–º–∏ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ–¥–Ω–æ–º—É –∫–æ—à–µ–ª—å–∫—É, ONCHAINID –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å, —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π:
- —Å–≤—è–∑—ã–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∫–æ—à–µ–ª—å–∫–æ–≤ —Å –æ–¥–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å—é,
- —Ö—Ä–∞–Ω–∏—Ç –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏ (claims) –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤,
- –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–ª—é—á–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ (purposes),
- –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª–Ω—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –æ—Ç –∏–º–µ–Ω–∏ identity —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º execute/approve.

![alt text](./images/models.png)
–ú–æ—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞: –≤ –º–∏—Ä–µ RWA, security tokens –∏ permissioned DeFi –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –∏–º–µ—Ç—å –∫–æ—à–µ–ª—ë–∫.

–†–µ–≥—É–ª—è—Ç–æ—Ä—ã —Ç—Ä–µ–±—É—é—Ç:
- KYC/AML –ø—Ä–æ–≤–µ—Ä–∫–∏,
- –∫–æ–Ω—Ç—Ä–æ–ª—å —é—Ä–∏—Å–¥–∏–∫—Ü–∏–π –∏ —Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤,
- –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–∫—Ç–∏–≤–∞–º –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ –∫–ª—é—á–µ–π,
- –æ—Ç–∑—ã–≤ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

ONCHAINID —Ä–µ—à–∞–µ—Ç —ç—Ç–∏ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ onchain –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –æ—Ç–æ–∑–≤–∞–Ω—ã –±–µ–∑ —É—á–∞—Å—Ç–∏—è —Å–∞–º–æ–≥–æ –¥–µ—Ä–∂–∞—Ç–µ–ª—è identity. –ü—Ä–∏ —ç—Ç–æ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–∞—Å–ø–æ—Ä—Ç, –∞–¥—Ä–µ—Å) –æ—Å—Ç–∞—é—Ç—Å—è –æ—Ñ—á–µ–π–Ω —É KYC –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ - onchain —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

**–°–≤—è–∑—å —Å ERC-3643 (T-REX):**

–ü—Ä–æ—Ç–æ–∫–æ–ª –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –±—ã–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∫–∞–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç [ERC-3643 (T-REX)](https://eips.ethereum.org/EIPS/eip-3643) –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥—Ö–æ–¥–∞ **permissioned**: –∫–æ–≥–¥–∞ –∏–Ω–≤–µ—Å—Ç–æ—Ä —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ security token –±–µ–∑ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π. –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —Ç–æ–∫–µ–Ω–∞, –∏ —Ä–µ–≥—É–ª—è—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∞—É–¥–∏—Ä–æ–≤–∞—Ç—å compliance —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π –±–ª–æ–∫—á–µ–π–Ω.

ONCHAINID –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥–ª—è –ª—é–±—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è onchain identity —Å –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏: permissioned DeFi, DAO —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º.

–í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ –º—ã —Å–º–æ—Ç—Ä–∏–º –Ω–∞ ONCHAINID –∫–∞–∫ –Ω–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª:
- –∫–∞–∫–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤ –Ω–µ–≥–æ –≤—Ö–æ–¥—è—Ç –∏ –∫–∞–∫ –æ–Ω–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç,
- –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–ª—é—á–∏ (ERC-734),
- –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç claims –∏ –∏—Ö –ø—Ä–æ–≤–µ—Ä–∫–∞ (ERC-735),
- –∫–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∞–ø–≥—Ä–µ–π–¥—ã —á–µ—Ä–µ–∑ ImplementationAuthority,
- –∫–∞–∫ Factory –∏ Gateway –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ CREATE2,

---

## 2. –¢–µ—Ä–º–∏–Ω—ã

**Identity (ONCHAINID / Identity contract)** - —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã ERC-734 (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏) –∏ ERC-735 (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ claims). –Ø–≤–ª—è–µ—Ç—Å—è "—Ü–∏—Ñ—Ä–æ–≤—ã–º –ø–∞—Å–ø–æ—Ä—Ç–æ–º" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ.

**ERC-734 (Key Manager)** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏ –≤ identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ. –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å –∫–ª—é—á–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ purposes –∏ –∏—Å–ø–æ–ª–Ω—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º approve/execute.

**ERC-735 (Claim Manager)** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è claims –≤ identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É claim –∏ –º–µ—Ç–æ–¥—ã –¥–ª—è –∏—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —É–¥–∞–ª–µ–Ω–∏—è.

**Key (–∫–ª—é—á)** - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞–¥—Ä–µ—Å–∞ –≤ identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ. –û–±—ã—á–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ `keccak256(abi.encode(address))`. –ö–∞–∂–¥—ã–π –∫–ª—é—á –∏–º–µ–µ—Ç purpose (–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ) –∏ keyType (—Ç–∏–ø –ø–æ–¥–ø–∏—Å–∏).

**Claim (–∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è)** - —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ –≤–ª–∞–¥–µ–ª—å—Ü–µ identity, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–µ Claim Issuer. –ù–∞–ø—Ä–∏–º–µ—Ä: "KYC –ø—Ä–æ–π–¥–µ–Ω", "—Å—Ç—Ä–∞–Ω–∞ —Ä–µ–∑–∏–¥–µ–Ω—Ç—Å—Ç–≤–∞: –°–®–ê", "–∞–∫–∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–≤–µ—Å—Ç–æ—Ä". –•—Ä–∞–Ω–∏—Ç—Å—è onchain –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å topic, scheme, issuer, signature, data –∏ uri.

**Claim Topic** - —Ç–∏–ø claim, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –∫–∞–∫ `uint256` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 = KYC, 2 = AML, 3 = COUNTRY). –≠–∫–æ—Å–∏—Å—Ç–µ–º–∞ –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞–µ—Ç—Å—è –æ–± –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ topic ID.

**Claim Issuer** - –∫–æ–Ω—Ç—Ä–∞–∫—Ç-–ø—Ä–æ–≤–∞–π–¥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π:
- –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç claims –¥–ª—è identity,
- –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–µ–π,
- –≤–µ–¥—ë—Ç —Ä–µ–µ—Å—Ç—Ä –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö claims (revocation registry).

Claim Issuer —Å–∞–º —è–≤–ª—è–µ—Ç—Å—è Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–æ–ª–∏ "—É–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞".

**Execute / Approve** - –º–µ—Ö–∞–Ω–∏–∑–º ERC-734 –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –æ—Ç –∏–º–µ–Ω–∏ identity. –õ—é–±–æ–π –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å execution request —á–µ—Ä–µ–∑ `execute()`, –Ω–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è `approve()` –æ—Ç –∫–ª—é—á–∞ —Å –Ω—É–∂–Ω—ã–º purpose.

---

## 3. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ONCHAINID

ONCHAINID —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–∞–±–æ—Ä–∞ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

![alt text](./images/common-arch.png)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:**

**User Identity (Proxy + Implementation)** - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç, —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π:

**Identity Proxy** (–¥–µ–ø–ª–æ–∏—Ç—Å—è —á–µ—Ä–µ–∑ Factory):
- –•—Ä–∞–Ω–∏—Ç storage: keys (–∫–ª—é—á–∏ —Å purposes), claims (–∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏), executions (–∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∏–ª–∏ –≤–Ω—É—Ä–µ–Ω–Ω–µ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞),
- –î–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –≤—ã–∑–æ–≤—ã –≤ Implementation —á–µ—Ä–µ–∑ delegatecall,
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∞–¥—Ä–µ—Å Implementation –∏–∑ ImplementationAuthority,

**Identity Implementation** (–æ–±—â–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö Identity):
- –°–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É: addKey, removeKey, addClaim, removeClaim, execute, approve,
- Stateless –∫–æ–Ω—Ç—Ä–∞–∫—Ç - –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ storage –∏–∑ Proxy —á–µ—Ä–µ–∑ delegatecall,
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω —á–µ—Ä–µ–∑ ImplementationAuthority –¥–ª—è –≤—Å–µ—Ö Proxy –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

**Claim Issuer** - –æ–±—ã—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç (–¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é, –±–µ–∑ –ø—Ä–æ–∫—Å–∏):
- –í—ã—Å—Ç—É–ø–∞–µ—Ç –∫–∞–∫ —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–∏–π —Ü–µ–Ω—Ç—Ä –¥–ª—è –≤—ã–¥–∞—á–∏ claims,
- –ò–º–µ–µ—Ç –∫–ª—é—á–∏ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ claims,
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥ `isClaimValid()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ claims,
- –í–µ–¥—ë—Ç —Ä–µ–µ—Å—Ç—Ä –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–µ–π (`revokedClaims` mapping),
- –ú–æ–∂–µ—Ç –æ—Ç–∑—ã–≤–∞—Ç—å claims —á–µ—Ä–µ–∑ `revokeClaimBySignature()`.

**ImplementationAuthority** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–æ–π:
- –•—Ä–∞–Ω–∏—Ç –∞–¥—Ä–µ—Å —Ç–µ–∫—É—â–µ–π Implementation –¥–ª—è Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤,
- –ú–µ—Ç–æ–¥ `getImplementation()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–¥—Ä–µ—Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏,
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å Implementation –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π –¥–ª—è –≤—Å–µ—Ö Proxy,

**IdFactory** - —Ñ–∞–±—Ä–∏–∫–∞ –¥–ª—è –¥–µ–ø–ª–æ—è Identity Proxy:
- –°–æ–∑–¥–∞—ë—Ç Identity Proxy —á–µ—Ä–µ–∑ CREATE2 (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞),
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç Proxy: —Å–≤—è–∑—ã–≤–∞–µ—Ç —Å ImplementationAuthority, –¥–æ–±–∞–≤–ª—è–µ—Ç management key –≤–ª–∞–¥–µ–ª—å—Ü—É,
- –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è salt (identity theft protection),
- –•—Ä–∞–Ω–∏—Ç mapping –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö salt.

**Gateway** - –ø—É–±–ª–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¥–µ–ø–ª–æ—è:
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –¥–µ–ø–ª–æ–∏—Ç—å identity —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ (–Ω–µ —Ç–æ–ª—å–∫–æ owner Factory),
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç salt = keccak256(wallet) –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤,
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ salt —Å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –æ—Ç trusted deployer,
- –í—ã–∑—ã–≤–∞–µ—Ç IdFactory –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Proxy.

### 3.1. –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∏ —Ä–æ–ª–∏

ONCHAINID –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–π (key-based) –≤–Ω—É—Ç—Ä–∏ Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∏ Ownable –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

---

**–†–æ–ª–∏ –≤ Identity**

Identity —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–ª—é—á–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ purposes.

**MANAGEMENT key (purpose 1)** - –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä `onlyManager` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `keyHasPurpose(keccak256(abi.encode(msg.sender)), 1)`:
- `addKey(key, purpose, keyType)` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π (–ª—é–±—ã—Ö purposes)
- `removeKey(key, purpose)` - —É–¥–∞–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π
- `approve(executionId, bool)` - –æ–¥–æ–±—Ä–µ–Ω–∏–µ execution requests –Ω–∞ **—Å–∞–º—É identity** (–∫–æ–≥–¥–∞ `to == address(this)`)
- `execute()` –º–µ—Ö–∞–Ω–∏–∑–º —Å–æ–∑–¥–∞–Ω–∏—è execution requests.
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏–º–µ–µ—Ç **–ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** –Ω–∞–¥ identity

**ACTION key (purpose 2)** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `keyHasPurpose(keccak256(abi.encode(msg.sender)), 2)`:
- `approve(executionId, bool)` - –æ–¥–æ–±—Ä–µ–Ω–∏–µ execution requests –Ω–∞ **–≤–Ω–µ—à–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã** (–∫–æ–≥–¥–∞ `to != address(this)`)
- `execute()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä—è–µ—Ç execution –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, –µ—Å–ª–∏ sender –∏–º–µ–µ—Ç ACTION key
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–µ—Ä–µ–≤–æ–¥—ã, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å DeFi)
- **–ù–µ –º–æ–∂–µ—Ç** —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª—é—á–∞–º–∏ –∏–ª–∏ claims
- **–ù–µ –º–æ–∂–µ—Ç** –æ–¥–æ–±—Ä–∏—Ç—å execution –Ω–∞ —Å–∞–º—É identity (–∑–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏)

**CLAIM signer key (purpose 3)** - –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä `onlyClaimKey` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `keyHasPurpose(keccak256(abi.encode(msg.sender)), 3)`:
- `addClaim(...)` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ Claims
- `removeClaim(claimId)` - —É–¥–∞–ª–µ–Ω–∏–µ claims
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å claims, –Ω–æ **–Ω–µ –º–æ–∂–µ—Ç** —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª—é—á–∞–º–∏

**ENCRYPTION key (purpose 4)** - –∫–ª—é—á–∏ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:
- –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, RSA, ECIES)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ claims (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∑–∞–ø–∏—Å–∏)
- –û—Ñ—á–µ–π–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –∫–ª—é—á–∏ –¥–ª—è:
  - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ `claim.data` –∏–ª–∏ `claim.uri`
  - –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ claims
  - –û–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
>**–í–∞–∂–Ω–æ:** ENCRYPTION key –Ω–µ –¥–∞—ë—Ç –Ω–∏–∫–∞–∫–∏—Ö –ø—Ä–∞–≤ –≤ —Å–∞–º–æ–º Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ - —ç—Ç–æ —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º

**–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–∞–≤:**

| Target –∫–æ–Ω—Ç—Ä–∞–∫—Ç | MANAGEMENT key | ACTION key | CLAIM key | –õ—é–±–æ–π –∞–¥—Ä–µ—Å |
|----------------|----------------|------------|-----------|-------------|
| **Identity itself** (addKey, removeKey) | ‚úÖ –ú–æ–∂–µ—Ç approve | ‚ùå –ù–µ –º–æ–∂–µ—Ç approve | ‚ùå –ù–µ –º–æ–∂–µ—Ç approve | ‚ùå –ù–µ –º–æ–∂–µ—Ç approve |
| **–í–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç** (transfer, swap) | ‚úÖ –ú–æ–∂–µ—Ç approve | ‚úÖ –ú–æ–∂–µ—Ç approve | ‚ùå –ù–µ –º–æ–∂–µ—Ç approve | ‚ùå –ù–µ –º–æ–∂–µ—Ç approve |
| **Execute (—Å–æ–∑–¥–∞–Ω–∏–µ request)** | ‚úÖ + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π approve | ‚úÖ + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π approve –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö | ‚ùå | ‚úÖ–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ request |

---

**–†–æ–ª–∏ –≤ Claim Issuer**

Claim Issuer - —ç—Ç–æ —Ç–æ—Ç –∂–µ Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç (–æ–Ω –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç –Ω–µ–≥–æ, –Ω–æ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º), –Ω–æ –≤ —Ä–æ–ª–∏ —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ç–µ –∂–µ purposes:

**MANAGEMENT key (purpose 1)** –≤ Claim Issuer:
- `revokeClaim(claimId, identity)` - –æ—Ç–∑—ã–≤ claim –ø–æ ID
- `revokeClaimBySignature(signature)` - –æ—Ç–∑—ã–≤ claim –ø–æ –ø–æ–¥–ø–∏—Å–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏ Claim Issuer
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ claims —Å–∞–º–æ–≥–æ Claim Issuer

**CLAIM signer key (purpose 3)** –≤ Claim Issuer:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–ø–æ–¥–ø–∏—Å–∏ claims –æ—Ñ—á–µ–π–Ω**
- –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ `isClaimValid()` Claim Issuer –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–æ–¥–ø–∏—Å—å —Å–¥–µ–ª–∞–Ω–∞ –∫–ª—é—á–æ–º —Å **purpose 3** (CLAIM signer)
- –ï—Å–ª–∏ –∫–ª—é—á —É–¥–∞–ª—ë–Ω –∏–∑ Claim Issuer, –≤—Å–µ –µ–≥–æ –ø–æ–¥–ø–∏—Å–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏

---

**–†–æ–ª–∏ –≤ ImplementationAuthority**

**Owner (Ownable)** - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å:
- `updateImplementation(address)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ implementation –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–∫—Å–∏
- `transferOwnership(address)` - –ø–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è

---

**–†–æ–ª–∏ –≤ IdFactory**

**Owner (Ownable)**:
- `setImplementationAuthority(address)` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ authority –¥–ª—è –Ω–æ–≤—ã—Ö identity
- `transferOwnership(address)` - –ø–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è

---

**–†–æ–ª–∏ –≤ Gateway**

**Owner (Ownable)**:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ trusted deployers (–∫—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ø–ª–æ–∏—Ç—å —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ salt)
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ Factory address
- –ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è

**–õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** (public):
- `deployIdentity(wallet)` - –¥–µ–ø–ª–æ–π —Å auto-generated salt = keccak256(wallet)
- `deployIdentityWithSalt(wallet, salt, signature)` - –¥–µ–ø–ª–æ–π —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º salt (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å trusted deployer)

### 3.2. –ö–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç

**–í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ –Ω–∞ Identity:**

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –µ—Å–ª–∏ –ø–æ–π—Ç–∏ –ø–æ —Å—Ö–µ–º–µ, —Å —É—á—ë—Ç–æ–º —Ç–æ–≥–æ, —á—Ç–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤—Å–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã, —Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —ç—Ç–æ —Ç–∞–∫:

1. User –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ –Ω–∞ –∞–¥—Ä–µ—Å–µ Identity Proxy (–Ω–∞–ø—Ä–∏–º–µ—Ä, `addKey()`)
2. Proxy –≤—ã–∑—ã–≤–∞–µ—Ç `ImplementationAuthority.getImplementation()`
3. Authority –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–¥—Ä–µ—Å Identity Implementation
4. Proxy –¥–µ–ª–∞–µ—Ç delegatecall –≤ Implementation –∏ Implementation –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É, –∏—Å–ø–æ–ª—å–∑—É—è storage –∏–∑ Proxy

### 3.3. –î–µ–ø–ª–æ–π –∏ –µ–≥–æ –≤–∏–¥—ã

**–î–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫ –¥–µ–ø–ª–æ—é Identity:**

–ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–µ–ø–ª–æ–π –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Å–∞–º–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ Gateway, –ª–∏–±–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —Å backend —á–µ—Ä–µ–∑ Factory. –ö–∞–∂–¥—ã–π –ø–æ–¥—Ö–æ–¥ –∏–º–µ–µ—Ç —Å–≤–æ–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

**–î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Factory (backend/owner –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç):**

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ salt**: Backend –º–æ–∂–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç—Ä–æ–≥—É—é –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∞–¥—Ä–µ—Å–æ–≤ (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∞–¥—Ä–µ—Å–∞ –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ç—è—Ö),
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: Backend –º–æ–∂–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç identity,
- **UX –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –Ω–µ –Ω—É–∂–Ω–æ –ø–ª–∞—Ç–∏—Ç—å –≥–∞–∑ –∏ –ø–æ–Ω–∏–º–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è,
- **Batch –æ–ø–µ—Ä–∞—Ü–∏–∏**: Backend –º–æ–∂–µ—Ç –¥–µ–ø–ª–æ–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ identity –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—ç–∫–æ–Ω–æ–º–∏—è –≥–∞–∑–∞),
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å KYC**: –ú–æ–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å identity —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è KYC –æ—Ñ—á–µ–π–Ω,
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**: Backend –∑–∞—Ä–∞–Ω–µ–µ –∑–Ω–∞–µ—Ç –∞–¥—Ä–µ—Å identity –∏ –º–æ–∂–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å claims –¥–æ –¥–µ–ø–ª–æ—è.

–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è**: –¢–æ–ª—å–∫–æ owner Factory –º–æ–∂–µ—Ç –¥–µ–ø–ª–æ–∏—Ç—å (single point of failure),
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç backend**: –ï—Å–ª–∏ backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å identity,
- **–ó–∞—Ç—Ä–∞—Ç—ã –¥–ª—è —ç–º–∏—Ç–µ–Ω—Ç–∞**: Backend –ø–ª–∞—Ç–∏—Ç –≥–∞–∑ –∑–∞ –≤—Å–µ –¥–µ–ø–ª–æ–∏.

**–î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Gateway (—Å–∞–º–∏ –∏–ª–∏ —á–µ—Ä–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è):**

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- **–î–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è**: –õ—é–±–æ–π –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å identity –±–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è owner
- **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ backend,
- **Self-custody**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –ø–ª–∞—Ç–∏—Ç –≥–∞–∑ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è,
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: Salt –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏–∑ –∞–¥—Ä–µ—Å–∞ –∫–æ—à–µ–ª—å–∫–∞ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å identity –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ç–∏ —Å —Ç–µ–º –∂–µ –∞–¥—Ä–µ—Å–æ–º,
- **–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø**: –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ adoption (–ª—é–±–æ–π –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å).

–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–ª–∞—Ç–∏—Ç –≥–∞–∑**: –ë–∞—Ä—å–µ—Ä –≤—Ö–æ–¥–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –ù—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏ –∏–º–µ—Ç—å –Ω–∞—Ç–∏–≤–∫—É –¥–ª—è –≥–∞–∑–∞,
- **–ú–µ–Ω—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è**: –ù–µ–ª—å–∑—è –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å, –∫—Ç–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å identity (–µ—Å–ª–∏ public mode)

**–°–æ–∑–¥–∞–Ω–∏–µ identity –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:**

```mermaid
%%{init: {
  "theme": "base",
  "themeVariables": {
    "background": "#ffffff",
    "primaryColor": "#ffffff",
    "secondaryColor": "#ffffff",
    "tertiaryColor": "#ffffff",
    "primaryBorderColor": "#000000",
    "lineColor": "#000000",
    "textColor": "#000000",
    "primaryTextColor": "#000000",
    "fontFamily": "Caveat, ui-sans-serif, system-ui"
  },
  "flowchart": { "curve": "basis" }
}}%%

flowchart TB

classDef card fill:transparent,stroke:#000000,color:#000000,stroke-width:2px,rx:14,ry:14;
classDef proxy fill:transparent,stroke:#000000,color:#000000,stroke-width:3px,rx:14,ry:14;
linkStyle default stroke:#000000,stroke-width:2px;

User[üë§ User]:::card
G[üåê Gateway]:::card
F[üè≠ IdFactory]:::card
P[üî∑ Identity Proxy]:::proxy
IA[üìã ImplementationAuthority]:::card
I[üì¶ Implementation]:::card

Step1[1. deployIdentity]:::card
Step2[2. Generate salt]:::card
Step3[3. createIdentity]:::card
Step4[4. Check salt]:::card
Step5[5. Deploy Proxy<br/>CREATE2]:::card
Step6[6. Initialize]:::card
Step6a[6a. Save Authority<br/>address]:::card
Step6b[6b. Call initwallet<br/>via delegatecall]:::card
Step6c[6c. Add wallet<br/>MANAGEMENT key]:::card
Step7[7. Save salt]:::card
Step8[8. Return address]:::card

User --> Step1
Step1 --> G
G --> Step2
Step2 --> Step3
Step3 --> F
F --> Step4
Step4 --> Step5
Step5 --> P
P --> Step6
Step6 --> Step6a
Step6a --> IA
Step6a --> Step6b
Step6b --> I
P -.->|delegatecall| I
Step6b --> Step6c
Step6c --> P
F --> Step7
Step7 --> Step8
Step8 --> User
```

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç `Gateway.deployIdentity(wallet)`
2. Gateway –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `salt = keccak256(wallet)` (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
3. Gateway –≤—ã–∑—ã–≤–∞–µ—Ç `IdFactory.createIdentity(wallet, salt)`
4. Factory –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: salt –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ä–∞–Ω–µ–µ
5. Factory –¥–µ–ø–ª–æ–∏—Ç Identity Proxy —á–µ—Ä–µ–∑ CREATE2 —Å —ç—Ç–∏–º salt
6. Proxy –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞–¥—Ä–µ—Å ImplementationAuthority –≤ storage,
   - –í—ã–∑—ã–≤–∞–µ—Ç Implementation.init(wallet) —á–µ—Ä–µ–∑ delegatecall,
   - –î–æ–±–∞–≤–ª—è–µ—Ç wallet –∫–∞–∫ MANAGEMENT key (purpose 1)
7. Factory —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `salt` –≤ mapping
8. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∞–¥—Ä–µ—Å —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ Identity Proxy

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å–æ–∑–¥–∞–Ω (—á–µ—Ä–µ–∑ Factory –∏–ª–∏ Gateway), —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º —è–≤–ª—è–µ—Ç—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ claims - –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–π –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤. Claims –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ identity –ø—Ä–æ—à–ª–∞ KYC, –∏–º–µ–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é —é—Ä–∏—Å–¥–∏–∫—Ü–∏—é, —Å—Ç–∞—Ç—É—Å –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞ –∏ —Ç.–¥.

### 3.4. –†–∞–±–æ—Ç–∞ —Å Claim

–ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è claim –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ claim –∏ –ø–æ–ª–∏—Ç–∏–∫–∏ Claim Issuer.

**–°—Ü–µ–Ω–∞—Ä–∏–π A: –ò–Ω–≤–µ—Å—Ç–æ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç claim —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ**

–≠—Ç–æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ Claim Issuer –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç claim –æ—Ñ—á–µ–π–Ω –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –ø–æ–¥–ø–∏—Å—å –∏–Ω–≤–µ—Å—Ç–æ—Ä—É (—á–µ—Ä–µ–∑ email, API, UI –∏ —Ç.–¥.). –ò–Ω–≤–µ—Å—Ç–æ—Ä –∑–∞—Ç–µ–º —Å–∞–º –¥–æ–±–∞–≤–ª—è–µ—Ç claim –≤ —Å–≤–æ–π Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç.

**–ö—Ç–æ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å:** –í–ª–∞–¥–µ–ª–µ—Ü Identity (—á–µ—Ä–µ–∑ purpose 3 –∏–ª–∏ 1)

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–û—Ñ—á–µ–π–Ω —ç—Ç–∞–ø:** Claim Issuer (–Ω–∞–ø—Ä–∏–º–µ—Ä, KYC –ø—Ä–æ–≤–∞–π–¥–µ—Ä) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞ –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç claim:
   ```solidity
   bytes32 dataHash = keccak256(abi.encode(identityAddress, topic, data));
   bytes memory signature = claimIssuerKey.sign(dataHash);
   ```
   –ü–æ–¥–ø–∏—Å—å –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∏–Ω–≤–µ—Å—Ç–æ—Ä—É –æ—Ñ—á–µ–π–Ω.

2. **Onchain —ç—Ç–∞–ø:** –ò–Ω–≤–µ—Å—Ç–æ—Ä (—á–µ—Ä–µ–∑ –∫–æ—à–µ–ª—ë–∫ —Å CLAIM key, purpose 3) –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–∞ [Identity](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/Identity.sol#L342):
   ```solidity
   identity.addClaim(topic, scheme, issuerAddress, signature, data, uri);
   ```

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∫–∞ claim –Ω–∞ [ClaimIssuer](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/ClaimIssuer.sol#L46):
   - –í—ã–∑—ã–≤–∞–µ—Ç `claimIssuer.isClaimValid(identity, topic, signature, data)`
   - Claim Issuer –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
     - –ü–æ–¥–ø–∏—Å—å –≤–∞–ª–∏–¥–Ω–∞ –∏ —Å–¥–µ–ª–∞–Ω–∞ –∫–ª—é—á–æ–º —Å purpose 3 (CLAIM signer) –≤ Claim Issuer –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ
     - –ü–æ–¥–ø–∏—Å—å –Ω–µ –æ—Ç–æ–∑–≤–∞–Ω–∞: `!revokedClaims[signature]`
   - –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—à–ª–∞, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç claim
   - Emit —Å–æ–±—ã—Ç–∏—è `ClaimAdded`

```mermaid
%%{init: {
  "theme": "base",
  "themeVariables": {
    "background": "#ffffff",
    "primaryColor": "#ffffff",
    "secondaryColor": "#ffffff",
    "tertiaryColor": "#ffffff",
    "primaryBorderColor": "#000000",
    "lineColor": "#000000",
    "textColor": "#000000",
    "primaryTextColor": "#000000",
    "fontFamily": "Caveat, ui-sans-serif, system-ui"
  },
  "flowchart": { "curve": "basis" }
}}%%

flowchart LR

classDef card fill:transparent,stroke:#000000,color:#000000,stroke-width:2px,rx:14,ry:14;
classDef proxy fill:transparent,stroke:#000000,color:#000000,stroke-width:3px,rx:14,ry:14;
linkStyle default stroke:#000000,stroke-width:2px;

CI[üìú Claim Issuer]:::card
Investor[üë§ Investor<br/>CLAIM key]:::card
ID[üî∑ Identity]:::proxy

Step1[1. Offchain<br/>Sign claim]:::card
Step2[2. Send signature<br/>to investor]:::card
Step3[3. addClaim]:::card
Step4[4. isClaimValid]:::card

CI --> Step1
Step1 --> Step2
Step2 --> Investor
Investor --> Step3
Step3 --> ID
ID --> Step4
Step4 --> CI
```

**–°—Ü–µ–Ω–∞—Ä–∏–π B: Claim Issuer –¥–æ–±–∞–≤–ª—è–µ—Ç claim —á–µ—Ä–µ–∑ execute/approve**

–≠—Ç–æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ Claim Issuer —Ö–æ—á–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏ —Å–∞–º –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ claim onchain. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –∑–∞ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º Identity (—á–µ—Ä–µ–∑ approve).

**–ö—Ç–æ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å:** Claim Issuer –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç, –Ω–æ –≤–ª–∞–¥–µ–ª–µ—Ü Identity –¥–æ–ª–∂–µ–Ω –æ–¥–æ–±—Ä–∏—Ç—å (—á–µ—Ä–µ–∑ MANAGEMENT key)

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **Claim Issuer –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç:** Claim Issuer [–≤—ã–∑—ã–≤–∞–µ—Ç](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/Identity.sol#L79):
   ```solidity
   identity.execute(
       address(identity),  // target = —Å–∞–º–∞ identity
       0,                   // value = 0
       abi.encodeWithSignature(
           "addClaim(uint256,uint256,address,bytes,bytes,string)",
           topic, scheme, issuerAddress, signature, data, uri
       )
   );
   ```
   –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç execution request –≤ Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ.

2. **–í–ª–∞–¥–µ–ª–µ—Ü Identity –æ–¥–æ–±—Ä—è–µ—Ç:** –í–ª–∞–¥–µ–ª–µ—Ü (—á–µ—Ä–µ–∑ MANAGEMENT key) –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ [–æ–¥–æ–±—Ä—è–µ—Ç](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/Identity.sol#L220):
   ```solidity
   identity.approve(executionId, true);
   ```
   Identity –≤—ã–ø–æ–ª–Ω—è–µ—Ç `addClaim()` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç claim.

```mermaid
%%{init: {
  "theme": "base",
  "themeVariables": {
    "background": "#ffffff",
    "primaryColor": "#ffffff",
    "secondaryColor": "#ffffff",
    "tertiaryColor": "#ffffff",
    "primaryBorderColor": "#000000",
    "lineColor": "#000000",
    "textColor": "#000000",
    "primaryTextColor": "#000000",
    "fontFamily": "Caveat, ui-sans-serif, system-ui"
  },
  "flowchart": { "curve": "basis" }
}}%%

flowchart LR

classDef card fill:transparent,stroke:#000000,color:#000000,stroke-width:2px,rx:14,ry:14;
classDef proxy fill:transparent,stroke:#000000,color:#000000,stroke-width:3px,rx:14,ry:14;
linkStyle default stroke:#000000,stroke-width:2px;

CI[üìú Claim Issuer]:::card
Step1[1. execute<br/>addClaim]:::card
ID[üî∑ Identity]:::proxy
Step2[2. Execution<br/>request created]:::card
Owner[üë§ Owner<br/>MANAGEMENT key]:::card
Step3[3. approve]:::card
Step4[4. Execute<br/>addClaim]:::card
Step5[5. isClaimValid]:::card

CI --> Step1
Step1 --> ID
ID --> Step2
Step2 --> Owner
Owner --> Step3
Step3 --> ID
ID --> Step4
Step4 --> Step5
Step5 --> CI
```

**–°—Ü–µ–Ω–∞—Ä–∏–π C: Backend —É–ø—Ä–∞–≤–ª—è–µ—Ç identity –æ—Ç –∏–º–µ–Ω–∏ –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞**

–≠—Ç–æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö –∏ T-REX, –≥–¥–µ backend (—ç–º–∏—Ç–µ–Ω—Ç —Ç–æ–∫–µ–Ω–∞, –∫–∞—Å—Ç–æ–¥–∏–∞–Ω, –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞) –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è–µ—Ç identity –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞. Backend –¥–µ–ø–ª–æ–∏—Ç identity —Å MANAGEMENT keys –¥–ª—è —Å–µ–±—è, –∏ —Å–∞–º –¥–æ–±–∞–≤–ª—è–µ—Ç claims –±–µ–∑ —É—á–∞—Å—Ç–∏—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞.

**–ö—Ç–æ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å:** Backend (—á–µ—Ä–µ–∑ CLAIM key, –∫–æ—Ç–æ—Ä—ã–π backend –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–µ–±–µ —á–µ—Ä–µ–∑ MANAGEMENT key)

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **Backend –¥–µ–ø–ª–æ–∏—Ç identity —Å MANAGEMENT keys:** Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π [–º–µ—Ç–æ–¥](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/factory/IdFactory.sol#L82) Factory, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–æ–±–∞–≤–∏—Ç—å MANAGEMENT keys:
   ```solidity
   bytes32[] memory managementKeys = new bytes32[](2);
   managementKeys[0] = keccak256(abi.encode(backendWallet1));  // –ø–µ—Ä–≤—ã–π backend –∫–æ—à–µ–ª—ë–∫
   managementKeys[1] = keccak256(abi.encode(backendWallet2));  // –≤—Ç–æ—Ä–æ–π backend –∫–æ—à–µ–ª—ë–∫ (multisig)
   
   factory.createIdentityWithManagementKeys(
       investorWallet,        // –∞–¥—Ä–µ—Å –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞
       "investor-123-v1",     // custom salt
       managementKeys        // MANAGEMENT keys –¥–ª—è backend
   );
   ```
   
   –≠—Ç–æ—Ç –º–µ—Ç–æ–¥:
   - –î–µ–ø–ª–æ–∏—Ç Identity Proxy —á–µ—Ä–µ–∑ CREATE2
   - –°—Ä–∞–∑—É –¥–æ–±–∞–≤–ª—è–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–µ MANAGEMENT keys (backend –∫–æ—à–µ–ª—å–∫–∏)
   - –ù–µ –¥–æ–±–∞–≤–ª—è–µ—Ç `investorWallet` –∫–∞–∫ MANAGEMENT key (–∏–Ω–≤–µ—Å—Ç–æ—Ä –Ω–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å)
   - –°–≤—è–∑—ã–≤–∞–µ—Ç `investorWallet` —Å identity

2. **Backend –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–µ–±–µ CLAIM key:** Backend (—á–µ—Ä–µ–∑ MANAGEMENT key) [–¥–æ–±–∞–≤–ª—è–µ—Ç](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/Identity.sol#L181) CLAIM key –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è claims:
   ```solidity
   identity.addKey(
       keccak256(abi.encode(backendWallet)),
       3,  // CLAIM purpose
       1   // ECDSA
   );
   ```

3. **Backend –¥–æ–±–∞–≤–ª—è–µ—Ç claim:** Backend (—á–µ—Ä–µ–∑ —Å–≤–æ–π CLAIM key) [–≤—ã–∑—ã–≤–∞–µ—Ç](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/Identity.sol#L342) –Ω–∞–ø—Ä—è–º—É—é:
   ```solidity
   identity.addClaim(topic, scheme, issuerAddress, signature, data, uri);
   ```
   –ù–∏–∫–∞–∫–æ–≥–æ approve –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è - backend –∏–º–µ–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ CLAIM key.

```mermaid
%%{init: {
  "theme": "base",
  "themeVariables": {
    "background": "#ffffff",
    "primaryColor": "#ffffff",
    "secondaryColor": "#ffffff",
    "tertiaryColor": "#ffffff",
    "primaryBorderColor": "#000000",
    "lineColor": "#000000",
    "textColor": "#000000",
    "primaryTextColor": "#000000",
    "fontFamily": "Caveat, ui-sans-serif, system-ui"
  },
  "flowchart": { "curve": "basis" }
}}%%

flowchart TB

classDef card fill:transparent,stroke:#000000,color:#000000,stroke-width:2px,rx:14,ry:14;
classDef proxy fill:transparent,stroke:#000000,color:#000000,stroke-width:3px,rx:14,ry:14;
linkStyle default stroke:#000000,stroke-width:2px;

Backend[üíª Backend<br/>MANAGEMENT key]:::card
F[üè≠ Factory]:::card
ID[üî∑ Identity]:::proxy

Step1[1. Deploy identity<br/>with MANAGEMENT keys]:::card
Step2[2. Add CLAIM key]:::card
Step3[3. addClaim]:::card
Step4[4. Save claim]:::card

Backend --> Step1
Step1 --> F
F --> ID
Backend --> Step2
Step2 --> ID
Backend --> Step3
Step3 --> ID
ID --> Step4
```

**–ò–Ω–≤–µ—Å—Ç–æ—Ä –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç:** –ò–Ω–≤–µ—Å—Ç–æ—Ä –Ω–µ –∑–Ω–∞–µ—Ç –æ –ø—Ä–æ—Ü–µ—Å—Å–µ, –Ω–µ –ø–ª–∞—Ç–∏—Ç –≥–∞–∑, –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª—é—á–∞–º–∏. Backend –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç identity. –ò–Ω–≤–µ—Å—Ç–æ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π –∫–æ—à–µ–ª—ë–∫ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π (transfer —Ç–æ–∫–µ–Ω–æ–≤), –Ω–æ –Ω–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å identity (–¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å –∫–ª—é—á–∏, claims).

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
- **UX –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞:** –ò–Ω–≤–µ—Å—Ç–æ—Ä –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç, –≤—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** Backend –º–æ–∂–µ—Ç batch –¥–æ–±–∞–≤–ª—è—Ç—å claims –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å KYC:** Backend –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å claims –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ KYC –æ—Ñ—á–µ–π–Ω
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:** Backend –º–æ–∂–µ—Ç –ª–µ–≥–∫–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ –∫–ª—é—á–µ–π –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è:** –ò–Ω–≤–µ—Å—Ç–æ—Ä –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Å–≤–æ—é identity
- **–î–æ–≤–µ—Ä–∏–µ:** –ò–Ω–≤–µ—Å—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –¥–æ–≤–µ—Ä—è—Ç—å backend
- **–†–∏—Å–∫:** –ï—Å–ª–∏ backend —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å identity

**–ö–æ–≥–¥–∞ –∫–∞–∫–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

- **–°—Ü–µ–Ω–∞—Ä–∏–π A (–∏–Ω–≤–µ—Å—Ç–æ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç):** –î–ª—è self-sovereign identity, –∫–æ–≥–¥–∞ –∏–Ω–≤–µ—Å—Ç–æ—Ä —Ö–æ—á–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å. Claim Issuer –Ω–µ –ø–ª–∞—Ç–∏—Ç –≥–∞–∑. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è public DeFi, DAO, –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

- **–°—Ü–µ–Ω–∞—Ä–∏–π B (Claim Issuer –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç):** –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º, –∫–æ–≥–¥–∞ Claim Issuer —Ö–æ—á–µ—Ç "–ø—Ä–æ—Ç–æ–ª–∫–Ω—É—Ç—å" claim, –Ω–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –∑–∞ –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º. –¢—Ä–µ–±—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ Identity. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω—ã—Ö —Å–∏—Å—Ç–µ–º —Å —á–∞—Å—Ç–∏—á–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π.

- **–°—Ü–µ–Ω–∞—Ä–∏–π C (backend —É–ø—Ä–∞–≤–ª—è–µ—Ç):** –î–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π, T-REX —Ç–æ–∫–µ–Ω–æ–≤, –∫–∞—Å—Ç–æ–¥–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, –≥–¥–µ backend –¥–æ–ª–∂–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å compliance. –ò–Ω–≤–µ—Å—Ç–æ—Ä –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ identity. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è security tokens, RWA, institutional investors.

### 3.5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ (upgrade)

–û–¥–Ω–∏–º –∏–∑ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Proxy + ImplementationAuthority —è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª—è—Ç—å –ª–æ–≥–∏–∫—É –≤—Å–µ—Ö Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (Beacon pattern –ø–æ —Å—É—Ç–∏) –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Ö –∞–¥—Ä–µ—Å–æ–≤ –∏ storage.

```mermaid
%%{init: {
  "theme": "base",
  "themeVariables": {
    "background": "#ffffff",
    "primaryColor": "#ffffff",
    "secondaryColor": "#ffffff",
    "tertiaryColor": "#ffffff",
    "primaryBorderColor": "#000000",
    "lineColor": "#000000",
    "textColor": "#000000",
    "primaryTextColor": "#000000",
    "fontFamily": "Caveat, ui-sans-serif, system-ui"
  },
  "flowchart": { "curve": "basis" }
}}%%

flowchart TB

classDef card fill:transparent,stroke:#000000,color:#000000,stroke-width:2px,rx:14,ry:14;
classDef proxy fill:transparent,stroke:#000000,color:#000000,stroke-width:3px,rx:14,ry:14;
linkStyle default stroke:#000000,stroke-width:2px;

subgraph Before["Before Upgrade"]
direction TB
P1[üî∑ Identity Proxy<br/>storage: keys, claims]:::proxy
A1[üìã Implementation<br/>Authority]:::card
I1[üì¶ Implementation<br/>v1.0.0]:::card
P1 -->|getImplementation| A1
A1 -->|returns address| I1
P1 -.->|delegatecall| I1
end
style Before fill:none,stroke:#000000,stroke-width:2px,rx:18,ry:18;

subgraph Upgrade["Upgrade Process"]
direction TB
Owner[üë®‚Äçüíª Owner Authority]:::card
Deploy[1. Deploy new<br/>Implementation v1.1.0]:::card
Update[2. updateImplementation<br/>newAddress]:::card
A2[üìã Authority<br/>updated]:::card
Owner -->|deploys| Deploy
Deploy -->|calls| Update
Update -->|updates storage| A2
end
style Upgrade fill:none,stroke:#000000,stroke-width:2px,rx:18,ry:18;

subgraph After["After Upgrade"]
direction TB
P2[üî∑ Identity Proxy<br/>storage: keys, claims<br/>unchanged]:::proxy
A3[üìã Implementation<br/>Authority]:::card
I2[üì¶ Implementation<br/>v1.1.0]:::card
P2 -->|getImplementation| A3
A3 -->|returns new address| I2
P2 -.->|delegatecall| I2
end
style After fill:none,stroke:#000000,stroke-width:2px,rx:18,ry:18;

Before --> Upgrade
Upgrade --> After
```

**–ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

1. Owner ImplementationAuthority –¥–µ–ø–ª–æ–∏—Ç –Ω–æ–≤—ã–π Identity Implementation –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤, –Ω–æ–≤—ã–µ features, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏).

2. Owner –≤—ã–∑—ã–≤–∞–µ—Ç `Authority.updateImplementation(newImplementationAddress)` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏.

3. Authority –æ–±–Ω–æ–≤–ª—è–µ—Ç –∞–¥—Ä–µ—Å Implementation –≤ —Å–≤–æ—ë–º storage.

4. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—ã–∑–æ–≤–µ –ª—é–±–æ–≥–æ Identity Proxy:
   - Proxy.fallback() –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–∑–æ–≤
   - Proxy –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `getImplementation()` —É Authority
   - Authority –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–¥—Ä–µ—Å –Ω–æ–≤–æ–π Implementation
   - Proxy –¥–µ–ª–∞–µ—Ç delegatecall –≤ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É

5. –í—Å–µ Identity Proxy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É. Storage –æ—Å—Ç–∞—ë—Ç—Å—è –≤ Proxy (–Ω–µ –º–µ–Ω—è–µ—Ç—Å—è), –ø–æ—ç—Ç–æ–º—É –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (keys, claims, executions) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è.

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Implementation –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Å–µ Identity Proxy –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –≠—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏ - owner Authority –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—â–∏—â—ë–Ω (multisig, DAO, timelock).

---

## 4. –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –º–µ—Ö–∞–Ω–∏–∫ ONCHAINID

### 4.1. Key management

Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç [—Ö—Ä–∞–Ω–∏—Ç](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/storage/Storage.sol#L10) [–∫–ª—é—á–∏](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/storage/Structs.sol#L16) —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:

```solidity
struct Key {
    uint256[] purposes;  // –º–∞—Å—Å–∏–≤ purposes: [1] = MANAGEMENT, [2] = ACTION, [3] = CLAIM, [4] = ENCRYPTION
    uint256 keyType;     // 1 = ECDSA, 2 = RSA
    bytes32 key;         // keccak256(abi.encode(address))
}

mapping(bytes32 => Key) public keys;
mapping(uint256 => bytes32[]) public keysByPurpose;  // –º–∞—Å—Å–∏–≤ –∫–ª—é—á–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ purpose
```

**Flow –¥–∏–∞–≥—Ä–∞–º–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞:**

```mermaid
%%{init: {
  "theme": "base",
  "themeVariables": {
    "background": "#ffffff",
    "primaryColor": "#ffffff",
    "secondaryColor": "#ffffff",
    "tertiaryColor": "#ffffff",
    "primaryBorderColor": "#000000",
    "lineColor": "#000000",
    "textColor": "#000000",
    "primaryTextColor": "#000000",
    "fontFamily": "Caveat, ui-sans-serif, system-ui"
  },
  "flowchart": { "curve": "basis" }
}}%%

flowchart TB

classDef card fill:transparent,stroke:#000000,color:#000000,stroke-width:2px,rx:14,ry:14;
classDef decision fill:transparent,stroke:#000000,color:#000000,stroke-width:2px,rx:14,ry:14;
linkStyle default stroke:#000000,stroke-width:2px;

Start[addKey]:::card

Check1{Key<br/>exists?}:::decision

Check2{Purpose<br/>exists?}:::decision

Conflict[‚ùå Revert]:::card

AddPurpose[‚ûï Add purpose]:::card

CreateKey[üÜï New key]:::card

AddToPurpose[üìã keysByPurpose]:::card

Emit[üì¢ KeyAdded]:::card

Success[‚úÖ Success]:::card

Start --> Check1

Check1 -->|Yes| Check2
Check1 -->|No| CreateKey

Check2 -->|Yes| Conflict
Check2 -->|No| AddPurpose

AddPurpose --> AddToPurpose
CreateKey --> AddToPurpose

AddToPurpose --> Emit
Emit --> Success
```

**–ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏:**

**`addKey(bytes32 _key, uint256 _purpose, uint256 _type)`** - —Ç–æ–ª—å–∫–æ MANAGEMENT key:
- –ö–ª—é—á —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç purpose –≤ –º–∞—Å—Å–∏–≤
- –ù–æ–≤—ã–π –∫–ª—é—á: —Å–æ–∑–¥–∞—ë—Ç Key —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –û–±–Ω–æ–≤–ª—è–µ—Ç `keysByPurpose[_purpose]`

**`removeKey(bytes32 _key, uint256 _purpose)`** - —Ç–æ–ª—å–∫–æ MANAGEMENT key:
- –£–¥–∞–ª—è–µ—Ç –æ–¥–∏–Ω purpose –∏–∑ –º–∞—Å—Å–∏–≤–∞
- –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π purpose: —É–¥–∞–ª—è–µ—Ç –≤–µ—Å—å –∫–ª—é—á

**`keyHasPurpose(bytes32 _key, uint256 _purpose)`** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:
- MANAGEMENT key (purpose 1) –∏–º–µ–µ—Ç –≤—Å–µ –ø—Ä–∞–≤–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true –µ—Å–ª–∏ –∫–ª—é—á –∏–º–µ–µ—Ç –Ω—É–∂–Ω—ã–π purpose

**–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**

1. **–û–¥–∏–Ω –∫–ª—é—á = –Ω–µ—Å–∫–æ–ª—å–∫–æ purposes:** –ö–ª—é—á –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ purposes –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, MANAGEMENT + ACTION + CLAIM). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–¥–Ω–æ–º—É –∞–¥—Ä–µ—Å—É –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–æ–ª–∏.

2. **keysByPurpose –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** Mapping `keysByPurpose[purpose]` —Ö—Ä–∞–Ω–∏—Ç –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –∫–ª—é—á–µ–π —Å –¥–∞–Ω–Ω—ã–º purpose, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ `getKeysByPurpose(purpose)`.

3. **–§–æ—Ä–º–∞—Ç –∫–ª—é—á–∞:** –ö–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ `keccak256(abi.encode(address))`, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ `address`. –≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ERC-734, –≥–¥–µ –∫–ª—é—á –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ EOA –∞–¥—Ä–µ—Å–æ–º, –Ω–æ –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º –ø—É–±–ª–∏—á–Ω—ã–º –∫–ª—é—á–æ–º.

### 4.2. Execute / Approve: Account Abstraction –ø–æ ERC-734

ONCHAINID —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º "proposal + approval" –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –æ—Ç –∏–º–µ–Ω–∏ identity.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ execution:**

```solidity
struct Execution {
    address to;          // target contract
    uint256 value;       // ETH value
    bytes data;          // calldata
    bool approved;       // –æ–¥–æ–±—Ä–µ–Ω –ª–∏ execution
    bool executed;       // –≤—ã–ø–æ–ª–Ω–µ–Ω –ª–∏ execution
}

mapping(uint256 => Execution) public executions;
uint256 public executionNonce;
```

**Flow –¥–∏–∞–≥—Ä–∞–º–º–∞ Execute/Approve:**

```mermaid
%%{init: {
  "theme": "base",
  "themeVariables": {
    "background": "#ffffff",
    "primaryColor": "#ffffff",
    "secondaryColor": "#ffffff",
    "tertiaryColor": "#ffffff",
    "primaryBorderColor": "#000000",
    "lineColor": "#000000",
    "textColor": "#000000",
    "primaryTextColor": "#000000",
    "fontFamily": "Caveat, ui-sans-serif, system-ui"
  },
  "flowchart": { "curve": "basis" }
}}%%

flowchart TB

classDef card fill:transparent,stroke:#000000,color:#000000,stroke-width:2px,rx:14,ry:14;
classDef decision fill:transparent,stroke:#000000,color:#000000,stroke-width:2px,rx:14,ry:14;
linkStyle default stroke:#000000,stroke-width:2px;

Start[execute]:::card

Create[üìù Create request]:::card

Check1{MANAGEMENT<br/>key?}:::decision

AutoApprove1[‚úÖ Auto approve]:::card

Check2{ACTION key<br/>+ external?}:::decision

AutoApprove2[‚úÖ Auto approve]:::card

Pending[‚è≥ Pending]:::card

Execute[‚öôÔ∏è Execute call]:::card

Success[‚úÖ Success]:::card
Fail[‚ùå Failed]:::card

Start --> Create
Create --> Check1

Check1 -->|Yes| AutoApprove1
Check1 -->|No| Check2

Check2 -->|Yes| AutoApprove2
Check2 -->|No| Pending

AutoApprove1 --> Execute
AutoApprove2 --> Execute

Execute --> Success
Execute --> Fail
```

**–ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞:**

**`execute(address _to, uint256 _value, bytes memory _data)`** - –ø—É–±–ª–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–ª—é–±–æ–π –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å):
- –°–æ–∑–¥–∞—ë—Ç execution request —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ID
- MANAGEMENT key: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä—è–µ—Ç –ª—é–±–æ–π execution
- ACTION key: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã (target != identity)
- –û—Å—Ç–∞–ª—å–Ω—ã–µ: execution –æ—Å—Ç–∞—ë—Ç—Å—è –≤ pending

**`approve(uint256 _id, bool _approve)`** - –æ–¥–æ–±—Ä–µ–Ω–∏–µ execution:
- Target = identity: —Ç—Ä–µ–±—É–µ—Ç—Å—è MANAGEMENT key
- Target = external: —Ç—Ä–µ–±—É–µ—Ç—Å—è ACTION key
- –í—ã–ø–æ–ª–Ω—è–µ—Ç call –∏ emit —Å–æ–±—ã—Ç–∏—è (Executed / ExecutionFailed)

**–ü—Ä–∏–º–µ—Ä—ã:**

```solidity
// MANAGEMENT key –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä–∏—Ç—å –ª—é–±–æ–π execution
identity.execute(address(identity), 0, abi.encodeWithSignature("addKey(...)"));
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä–µ–Ω–æ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

// ACTION key –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
identity.execute(tokenAddress, 0, abi.encodeWithSignature("transfer(...)"));
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä–µ–Ω–æ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

// ACTION key –ù–ï –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä–∏—Ç—å execution –Ω–∞ identity
identity.execute(address(identity), 0, abi.encodeWithSignature("removeKey(...)"));
// Pending - —Ç—Ä–µ–±—É–µ—Ç—Å—è MANAGEMENT key –¥–ª—è approve
```

–ú–µ—Ö–∞–Ω–∏–∑–º execute/approve –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤  —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∫–æ—à–µ–ª—ë–∫ —Å account abstraction: –ª—é–±–æ–π –∞–¥—Ä–µ—Å –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ, –∞ –≤–ª–∞–¥–µ–ª—å—Ü—ã –∫–ª—é—á–µ–π –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É (–∫—Ç–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å request) –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (–∫—Ç–æ –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä–∏—Ç—å), —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —É–¥–æ–±—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

### 4.3. Claims: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç [Claim](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/storage/Structs.sol#L63) –∏ –≥–¥–µ –æ–Ω [—Ö—Ä–∞–Ω–∏—Ç—Å—è](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/storage/Storage.sol#L22) –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ `identity.sol` –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞:

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ Claim:**

```solidity
struct Claim {
    uint256 topic;      // —Ç–∏–ø claim (KYC, AML, COUNTRY, etc.)
    uint256 scheme;     // —Å—Ö–µ–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–∫–∞–∫ –ø—Ä–æ–≤–µ—Ä—è—Ç—å signature –∏ data)
    address issuer;     // –∞–¥—Ä–µ—Å Claim Issuer –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
    bytes signature;    // –ø–æ–¥–ø–∏—Å—å claim
    bytes data;         // –¥–∞–Ω–Ω—ã–µ (hash, encoded data, encrypted data)
    string uri;         // URI –Ω–∞ –æ—Ñ—á–µ–π–Ω –¥–∞–Ω–Ω—ã–µ (IPFS, HTTPS, Swarm)
}

mapping(bytes32 => Claim) public claims;
mapping(uint256 => bytes32[]) public claimsByTopic;
```

Claim ID [–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è](https://github.com/onchain-id/solidity/blob/a483cda6821e3883497972d36d0c4c1e1693e483/contracts/Identity.sol#L360) –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ:
```solidity
bytes32 claimId = keccak256(abi.encode(issuer, topic));
```
–û–¥–∏–Ω issuer –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω claim –Ω–∞ –∫–∞–∂–¥—ã–π topic. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π `addClaim` –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π claim.

**–ü–æ–ª–µ `topic` - —Ç–∏–ø claim:**

Topic –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é claim. –≠—Ç–æ `uint256`, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

- **1**: KYC (Know Your Customer) - –ø—Ä–æ–π–¥–µ–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏
- **2**: AML (Anti-Money Laundering) - –ø—Ä–æ–π–¥–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—Ç–º—ã–≤–∞–Ω–∏–µ –¥–µ–Ω–µ–≥
- **3**: COUNTRY - —Å—Ç—Ä–∞–Ω–∞ —Ä–µ–∑–∏–¥–µ–Ω—Ç—Å—Ç–≤–∞
- **4**: ACCREDITED - —Å—Ç–∞—Ç—É—Å –∞–∫–∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞
- **5**: INVESTOR_TYPE - —Ç–∏–ø –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞ (retail, professional, institutional)

–≠–∫–æ—Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å–≤–æ–∏ topic ID.

**–ü–æ–ª–µ `scheme` - —Å—Ö–µ–º–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

Scheme –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ –Ω—É–∂–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–ª—è `signature` –∏ `data`. –°–æ–≥–ª–∞—Å–Ω–æ ERC-735:

- **1**: ECDSA –ø–æ–¥–ø–∏—Å—å (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è) - –ø–æ–¥–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º ECDSA
- **2**: RSA –ø–æ–¥–ø–∏—Å—å - –ø–æ–¥–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º RSA
- **3**: Self-attested claim (—Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π) - claim –ø–æ–¥–ø–∏—Å–∞–Ω —Å–∞–º–∏–º identity owner
- **4**: Contract verification - –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

**–ù–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è scheme = 1 (ECDSA):**
```solidity
// Claim Issuer –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç claim ECDSA –∫–ª—é—á–æ–º
bytes32 dataHash = keccak256(abi.encode(identityAddress, topic, data));
bytes32 prefixedHash = keccak256(abi.encodePacked("\x19Ethereum Signed Message:\n32", dataHash));
bytes memory signature = sign(prefixedHash);  // ECDSA signature

// –ü—Ä–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ Claim Issuer.isClaimValid():
// - –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∞–¥—Ä–µ—Å –ø–æ–¥–ø–∏—Å–∞–Ω—Ç–∞ –∏–∑ signature (ecrecover)
// - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∞–¥—Ä–µ—Å –∏–º–µ–µ—Ç CLAIM key (purpose 3) –≤ Claim Issuer
```

Scheme –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å—Ö–µ–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- scheme = 10: off-chain –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ API
- scheme = 20: zero-knowledge proof –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- scheme = 30: multi-sig –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

**–§–æ—Ä–º–∞—Ç –ø–æ–¥–ø–∏—Å–∏ claim (signature):**
```solidity
bytes32 dataHash = keccak256(abi.encode(identityAddress, topic, data));
bytes32 prefixedHash = keccak256(abi.encodePacked("\x19Ethereum Signed Message:\n32", dataHash));
bytes memory signature = sign(prefixedHash);
```
–ü–æ–¥–ø–∏—Å—å –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π identity, –∞ –Ω–µ –∫ –∫–æ—à–µ–ª—å–∫—É.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π `data` –∏ `uri`:**
- `data`: —Ö—ç—à –¥–∞–Ω–Ω—ã—Ö, –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `uri`: IPFS —Ö—ç—à, HTTPS URL


**–ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞:**

**`addClaim(...)`** - —Ç–æ–ª—å–∫–æ CLAIM key (purpose 3):
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç claimId = keccak256(issuer, topic)
- –í—ã–∑—ã–≤–∞–µ—Ç `issuer.isClaimValid()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç claim –≤ mapping
- –û–±–Ω–æ–≤–ª—è–µ—Ç claimsByTopic

**`removeClaim(bytes32 claimId)`** - —Ç–æ–ª—å–∫–æ CLAIM key:
- –£–¥–∞–ª—è–µ—Ç claim –∏–∑ mapping
- –û–±–Ω–æ–≤–ª—è–µ—Ç claimsByTopic

**`isClaimValid(identity, topic, signature, data)`** - –≤ Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è):
- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∞–¥—Ä–µ—Å –ø–æ–¥–ø–∏—Å–∞–Ω—Ç–∞ –∏–∑ signature (ecrecover)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–æ–¥–ø–∏—Å–∞–Ω—Ç –∏–º–µ–µ—Ç CLAIM key (purpose 3) –≤ Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ
- **Self-attested claims**: –¥–ª—è claims, –≤—ã–¥–∞–Ω–Ω—ã—Ö —Å–∞–º–æ–π Identity (issuer == address(this)), –Ω–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –æ—Ç–∑—ã–≤–∞
- Claim –≤–∞–ª–∏–¥–µ–Ω –ø–æ–∫–∞ –ø–æ–¥–ø–∏—Å—å –≤–∞–ª–∏–¥–Ω–∞ –∏ claim —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ
- –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–∑—ã–≤ (–Ω–µ—Ç `revokedClaims` mapping –≤ –±–∞–∑–æ–≤–æ–º Identity)

**–ú–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤ Claim Issuer –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ (–¥–æ–ø–æ–ª–Ω—è—é—Ç –±–∞–∑–æ–≤—ã–π Identity):**

**`isClaimValid(identity, topic, signature, data)`** - –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤ Claim Issuer:
- –ù–∞—Å–ª–µ–¥—É–µ—Ç –ª–æ–≥–∏–∫—É –∏–∑ Identity (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∏ CLAIM key)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–∑—ã–≤ —á–µ—Ä–µ–∑ `isClaimRevoked(signature)`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–¥–ø–∏—Å—å –≤–∞–ª–∏–¥–Ω–∞ –∏ claim –Ω–µ –æ—Ç–æ–∑–≤–∞–Ω–∞

**`revokeClaimBySignature(signature)`** - —Ç–æ–ª—å–∫–æ MANAGEMENT key:
- –î–æ–±–∞–≤–ª—è–µ—Ç signature –≤ `revokedClaims` mapping
- –ü–æ—Å–ª–µ –æ—Ç–∑—ã–≤–∞ `isClaimValid()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç false

**`revokeClaim(claimId, identity)`** - —Ç–æ–ª—å–∫–æ MANAGEMENT key:
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –æ—Ç–∑—ã–≤–∞: –ø–æ–ª—É—á–∞–µ—Ç signature –∏–∑ claim —á–µ—Ä–µ–∑ `identity.getClaim(claimId)`
- –î–æ–±–∞–≤–ª—è–µ—Ç signature –≤ `revokedClaims` mapping
- –£–¥–æ–±–µ–Ω –∫–æ–≥–¥–∞ –∏–∑–≤–µ—Å—Ç–µ–Ω claimId, –∞ –Ω–µ signature –Ω–∞–ø—Ä—è–º—É—é

**`isClaimRevoked(signature)`**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –æ—Ç–æ–∑–≤–∞–Ω –ª–∏ claim –ø–æ signature
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true –µ—Å–ª–∏ signature –≤ `revokedClaims` mapping

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ claim –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ **Claim Issuer**, –∞ –Ω–µ —á–µ—Ä–µ–∑ —Å–∞–º—É Identity. Claim Issuer —Ö—Ä–∞–Ω–∏—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–µ–π (`revokedClaims`), —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏–Ω–≤–µ—Å—Ç–æ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –æ—Ç–∑—ã–≤, —É–¥–∞–ª–∏–≤ –∫–ª—é—á –∏–∑ —Å–≤–æ–µ–≥–æ Identity. –î–∞–∂–µ –µ—Å–ª–∏ claim —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Identity, –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º, –µ—Å–ª–∏ –æ—Ç–æ–∑–≤–∞–Ω –≤ Claim Issuer. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è compliance: Claim Issuer –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Å–≤–æ–∏—Ö claims –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥–µ–π—Å—Ç–≤–∏–π –≤–ª–∞–¥–µ–ª—å—Ü–∞ identity, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞–º –∏ KYC –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–æ–∫–µ–Ω–∞–º –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª –∏–ª–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ KYC.

## 5. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

ONCHAINID - —ç—Ç–æ onchain —Å–ª–æ–π –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –±–ª–æ–∫—á–µ–π–Ω –∞–¥—Ä–µ—Å–∞ –≤ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ identity –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ–º—ã–º–∏ claims. –ü—Ä–æ—Ç–æ–∫–æ–ª —Ä–µ—à–∞–µ—Ç –∫–ª—é—á–µ–≤—É—é –ø—Ä–æ–±–ª–µ–º—É permissioned —Å–∏—Å—Ç–µ–º: –∫–∞–∫ —Å–≤—è–∑–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ª–∏—á–Ω–æ—Å—Ç—å —Å onchain –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–¥ –µ–≥–æ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å—é –∏ –æ–±–µ—Å–ø–µ—á–∏–≤ compliance —Å —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ ONCHAINID —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ ERC-734 (Key Manager) –∏ ERC-735 (Claim Holder), –ø—Ä–∏ —ç—Ç–æ–º –≤–∞–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –æ–±–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–µ –±—ã–ª–∏ –¥–æ–≤–µ–¥–µ–Ω—ã –¥–æ —Å—Ç–∞—Ç—É—Å–∞ Final, –∞ –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ –∏—Ö —Ä–æ–ª—å –≤–æ –º–Ω–æ–≥–æ–º –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞ –±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏ (–≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, [LSP6 KeyManager](https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-6-KeyManager.md)). Identity —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –ø—Ä–æ–∫—Å–∏-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å –≤—ã–Ω–æ—Å–æ–º –ª–æ–≥–∏–∫–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é implementation. Identity –¥–µ–π—Å—Ç–≤—É–µ—Ç —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º execute/approve, —á—Ç–æ –¥–∞—ë—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π (MANAGEMENT, ACTION, CLAIM keys) –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å recovery –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ –∫–ª—é—á–µ–π. Claims –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –æ—Ñ—á–µ–π–Ω trusted issuers, –Ω–æ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ onchain Claim Issuer —Å revocation registry, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥–µ–π—Å—Ç–≤–∏–π –≤–ª–∞–¥–µ–ª—å—Ü–∞ identity.

ONCHAINID –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –∫–∞–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è T-REX (ERC-3643) - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ permissioned —Ç–æ–∫–µ–Ω–æ–≤. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–≤—è–∑–∞—Ç—å wallet –∏ ONCHAINID. –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –ø—Ä–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –æ–ø–∏—Å–∞–Ω–æ –≤ –º–æ–µ–π —Å—Ç–∞—Ç—å–µ –ø—Ä–æ T-REX.

–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –ø—Ä–æ—Ç–æ–∫–æ–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ –∞–∫—Ç–∏–≤–æ–≤ –Ω–∞ —Å—É–º–º—É –±–æ–ª–µ–µ $25 –º–ª—Ä–¥ –≤ —Ä–∞–º–∫–∞—Ö ERC-3643 —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã. [ERC-3643 Association](https://www.erc3643.org/members) –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–µ—Å—è—Ç–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –≤–∫–ª—é—á–∞—è –∫—Ä—É–ø–Ω—ã–µ –±–∞–Ω–∫–∏, –∞—É–¥–∏—Ç–æ—Ä—Å–∫–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ KYC –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤. [Tokeny](https://tokeny.com/) - –∫–æ–º–ø–∞–Ω–∏—è-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å UI –¥–ª—è –¥–µ–ø–ª–æ—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ERC-3643 —Ç–æ–∫–µ–Ω–∞–º–∏.

–ö–ª—é—á–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å—Ö–æ–∂–∏ —Å T-REX: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ–∫—Ä—É–≥ ImplementationAuthority owner, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –æ—Ñ—á–µ–π–Ω KYC –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤, —Ä–∏—Å–∫ —Å–ø–∞–º–∞ execution requests, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ UI –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏. –ü—Ä–∏ —ç—Ç–æ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –¥–∞—ë—Ç –≥–∏–±–∫–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∞ CREATE2 –¥–µ–ø–ª–æ–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫—Ä–æ—Å—Å-—á–µ–π–Ω –ø–æ—Ä—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å identity.

–í –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–º —Å–º—ã—Å–ª–µ ONCHAINID –¥–∞—ë—Ç –∑—Ä–µ–ª—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è onchain –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ –≤ permissioned —Å–∏—Å—Ç–µ–º–∞—Ö. –ü—Ä–æ—Ç–æ–∫–æ–ª —á—ë—Ç–∫–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç —É—Ä–æ–≤–Ω–∏: –∫–ª—é—á–∏, claims, issuer registry, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å compliance —Å–ª–æ–∏ –ø–æ–≤–µ—Ä—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö –±–ª–æ–∫—á–µ–π–Ω–æ–≤, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ª–æ–≥–∏–∫–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏, –Ω–æ –¥–æ–±–∞–≤–ª—è—è —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–º, –≥–¥–µ –æ–Ω–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã.

### –°—Å—ã–ª–∫–∏

- [ONCHAINID Documentation](https://docs.onchainid.com/)
- [onchain-id/solidity GitHub](https://github.com/onchain-id/solidity)
- [ERC-734: Key Manager](https://github.com/ethereum/EIPs/issues/734)
- [ERC-735: Claim Holder](https://github.com/ethereum/EIPs/issues/735)
- [ERC-3643 Association](https://www.erc3643.org/)
- [Tokeny Solutions](https://tokeny.com/)
