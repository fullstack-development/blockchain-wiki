# The Compound DeFi Protocol v3

**–ê–≤—Ç–æ—Ä:** [–ü–∞–≤–µ–ª –ù–∞–π–¥–∞–Ω–æ–≤](https://github.com/PavelNaydanov) üïµÔ∏è‚Äç‚ôÇÔ∏è

_–û–ø—Ä!_ **Compound v3** ‚Äî —ç—Ç–æ –≤—Å–µ –µ—â–µ ethereum –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –∑–∞–π–º–∞ –∞–∫—Ç–∏–≤–æ–≤ –ø–æ–¥ –ø—Ä–æ—Ü–µ–Ω—Ç—ã. –ê–∫—Ç–∏–≤—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∞—é—Ç —á–∞—Å—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –æ—Ç –∑–∞–µ–º—â–∏–∫–æ–≤.

–ü—Ä–æ—Ç–æ–∫–æ–ª –≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω –æ–ø—ã—Ç–æ–º [sushiSwap](https://www.rareskills.io/post/staking-algorithm) –∏ –∏—Ö —Å—Ç–µ–π–∫–∏–Ω–≥ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º. –í —ç—Ç–æ–º –∞–ª–≥–æ—Ä–∏—Ç–º–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º. –ë–æ–ª–µ–µ —Ç–æ–≥–æ, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è —Å—É–º–º–∞ –≤—Å–µ—Ö –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π, –≤ –∫–æ—Ç–æ—Ä–æ–π —É –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –¥–æ–ª—è. –î–æ–ª—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–±—â–µ–º –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∫ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—é —Ç–æ–∫–µ–Ω–∞. –í compound –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–¥–æ–±–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –ø–æ –∑–∞–π–º—É –∏ –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.

–¢–∞–º –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–Ω–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –Ω–∞ –±–∞–∑–µ –æ—Ä–∞–∫—É–ª–∞ –æ—Ç chainlink.

–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ —Ç—Ä–µ—Ç—å—è –≤–µ—Ä—Å–∏—è –±—ã–ª–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ —Ç–æ–ª—å–∫–æ –≤ —Å–µ—Ç–∏ Ethereum –∏ –¥–ª—è –∑–∞–π–º–∞ –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–∫—Ç–∏–≤ - USDC. –í –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç compound –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–ª–æ–∫—á–µ–π–Ω–æ–≤ –∏ —Ç—Ä–∏ –∞–∫—Ç–∏–≤–∞ –≤ —Å–µ—Ç–∏ Ethereum.

![](./images/compound-v3-markets.png)

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ç–æ –º–æ–∂–Ω–æ –ø—Ä—è–º–æ –≤ [–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏](https://app.compound.finance/markets). –ê–∫—Ç–∏–≤, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∑–∞–Ω–∏–º–∞—Ç—å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **–±–∞–∑–æ–≤—ã–º**. –ê –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–æ–∫—Ä—É–≥ –Ω–µ–≥–æ –≤—Å–µ —Ç–∞–∫–∂–µ **market** (—Ä—ã–Ω–æ–∫ –∏–ª–∏ –º–∞—Ä–∫–µ—Ç).

_–í–∞–∂–Ω–æ!_ Compound –ø—Ä–∏–¥—É–º–∞–ª –∫–æ–¥–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ "**Comet**" –¥–ª—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ —Å–≤–æ–µ–π —Ç—Ä–µ—Ç—å–µ–π –≤–µ—Ä—Å–∏–∏.

## –û—Ç–ª–∏—á–∏—è –æ—Ç compound-v2

–ù–∏–∂–µ —Ä–∞–∑–±–µ—Ä–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è –º–µ–∂–¥—É —Ç—Ä–µ—Ç—å–µ–π –∏ –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–µ–π.

**–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä—ã–Ω–æ–∫.** –í —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —Ä—ã–Ω–∫–∞ –º–æ–∂–Ω–æ –∑–∞–Ω–∏–º–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–∫—Ç–∏–≤ –∏ —ç—Ç–æ—Ç –∑–∞–µ–º –±—É–¥–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.

–≠—Ç–æ –ø–æ–∂–∞–ª—É–π –æ–¥–Ω–æ –∏–∑ —Å–∞–º—ã—Ö –≥–ª–∞–≤–Ω—ã—Ö –æ—Ç–ª–∏—á–∏–π. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ª–æ–≥ –¥–ª—è –∑–∞–π–º–∞ USDC —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º –º–∞—Ä–∫–µ—Ç–∞ –Ω–µ –±—É–¥–µ—Ç –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º –¥–ª—è –∑–∞–π–º–∞ –¥—Ä—É–≥–æ–≥–æ –∞–∫—Ç–∏–≤–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è —Ä—ã–Ω–∫–∞ ETH.

**–ó–∞–ª–æ–≥ –æ—Ç–¥–µ–ª–µ–Ω –æ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏**. –ê–∫—Ç–∏–≤, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–ª–æ–≥–∞ –¥–ª—è –∑–∞–π–º–∞, –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º. –¢–æ –µ—Å—Ç—å "–º—É—Ö–∏ –æ—Ç–¥–µ–ª—å–Ω–æ, –∫–æ—Ç–ª–µ—Ç—ã –æ—Ç–¥–µ–ª—å–Ω–æ". –î–ª—è –∑–∞–π–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (–∫—Ä–µ–¥–∏—Ç–æ—Ä–æ–º), –∑–∞–ª–æ–≥ –≤ —Ç–∞–∫–æ–º —Ä—ã–Ω–∫–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∏ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –∑–∞–π–º–µ.

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–π–º–∞ –∏ –ª–∏–º–∏—Ç –Ω–∞ —Å—É–º–º—É –∑–∞–ª–æ–≥–∞**. –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è `baseBorrowMin` –∏ `supplyCap`. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —Å–∞–º–∏–º –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º –≤ –º–æ–º–µ–Ω—Ç –¥–µ–ø–ª–æ—è.

–ü–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `baseBorrowMin` –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—Ä–∞—Ç—å –≤ –∑–∞–µ–º –º–∞–ª–µ–Ω—å–∫–∏–µ —Å—É–º–º—ã, –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã—Ö –æ–±—Ö–æ–¥—è—Ç—Å—è –¥–æ—Ä–æ–∂–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è.

–í—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä `supplyCap` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—â–µ–π —Å—É–º–º—ã –∑–∞–ª–æ–≥–∞ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∞–∫—Ç–∏–≤—É, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ. –Ø–≤–ª—è–µ—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–∏–≤–∞.

**BorrowRate –∏ supplyRate –±–æ–ª—å—à–µ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞**. –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (supply rate) –Ω–∞–ø—Ä—è–º—É—é –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (utilization rate) –∏ –±–æ–ª—å—à–µ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞–≤–∫—É –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è (borrow rate). –°—Ç–∞–≤–∫–∞ –ø–æ –∑–∞–π–º–∞–º (borrow rate) —Å–ª–µ–¥—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –∫—Ä–∏–≤–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –æ—Å–Ω–æ–≤—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∏–∑ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è](https://github.com/compound-finance/comet).

–í—Å–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ —á–µ—Ç—ã—Ä–µ –≥—Ä—É–ø–ø—ã:
![](./images/compound-v3-contract-group.png)

1. –ü–µ—Ä–≤–∞—è –≥—Ä—É–ø–ø–∞ - core –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç –±–∞–∑–æ–≤—É—é –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫—É
2. –í—Ç–æ—Ä–∞—è –≥—Ä—É–ø–ø–∞ - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è –Ω–∞ core –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö –∏–∑ –ø–µ—Ä–≤–æ–π –≥—Ä—É–ø–ø—ã
3. –¢—Ä–µ—Ç—å—è –≥—Ä—É–ø–ø–∞ - –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–µ –¥–µ–ø–ª–æ–π, –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏
4. –ß–µ—Ç–≤–µ—Ä—Ç–∞—è –≥—Ä—É–ø–ø–∞ - –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –æ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –¥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è

–í –∫–∞–∫–æ–º-—Ç–æ —Ä–æ–¥–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —Å—Ç–∞–ª–∞ –ø—Ä–æ—â–µ, –±–ª–∞–≥–æ–¥–∞—Ä—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ —Ä—ã–Ω–∫–∞ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞. –≠—Ç–æ —Å–ø–æ—Å–æ–±—Å—Ç–≤–æ–≤–∞–ª–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ–≥–æ –æ–¥–Ω–æ–≥–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ [Comet.sol](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol) –∏–∑ core –≥—Ä—É–ø–ø—ã. –°–∞–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–¥ –ø—Ä–æ–∫—Å–∏ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –ü–æ–ª—É—á–∞–µ—Ç—Å—è, —á—Ç–æ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –º–∞—Ä–∫–µ—Ç–æ–º –Ω—É–∂–µ–Ω –≤—Å–µ–≥–æ –æ–¥–∏–Ω —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞. –û—Ç —ç—Ç–æ–π —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –∏ –Ω–∞—á–Ω–µ–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è. –ù–∞ —Å—Ö–µ–º–µ –æ–Ω–∞ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∞ –∫—Ä–∞—Å–Ω—ã–º –∫—Ä—É–≥–æ–º.

![](./images/compound-v3-high-level-contracts-view.png)

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Ç–∏–ø–∏—á–Ω—ã–π –≤—ã–∑–æ–≤ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
1. –ü—Ä–æ–∫—Å–∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç [Comet.sol](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol)
2. –ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —Ç–æ –≤—ã–∑–æ–≤ –±—É–¥–µ—Ç –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω –≤ [CometExt.sol](https://github.com/compound-finance/comet/blob/main/contracts/CometExt.sol). –ß–∞—Å—Ç—å –Ω–∞–∏–º–µ–Ω–µ–µ –≤–∞–∂–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ —Ç—É–¥–∞, –¥–ª—è –æ–±—Ö–æ–¥–∞ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (24 Kb).
3. –ï—Å–ª–∏ –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, —Ç–æ –≤—ã–∑–æ–≤ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω –≤ —Ä–∞–º–∫–∞—Ö `Comet.sol`, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–æ—Ç–æ—Ä–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ —Ü–µ–ª–æ–º—É —Ä—è–¥—É —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤: [CometMainInterface](https://github.com/compound-finance/comet/blob/main/contracts/CometMainInterface.sol), [ComentCore](https://github.com/compound-finance/comet/blob/main/contracts/CometCore.sol), [ComentMath.sol](https://github.com/compound-finance/comet/blob/main/contracts/CometMath.sol), [CometStorage](https://github.com/compound-finance/comet/blob/main/contracts/CometStorage.sol), [CometConfiguration](https://github.com/compound-finance/comet/blob/main/contracts/CometConfiguration.sol).

–ö—Ä–∞—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–∏–º –∑–æ–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏–∑ core –≥—Ä—É–ø–ø—ã:
1. **Comet.sol**. –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç c –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–æ–π, —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∑–∞–π–º—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏.
2. **CometExt.sol**. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç. –ü–æ—è–≤–∏–ª—Å—è –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –ø–æ–º–µ—Å—Ç–∏–ª–∞—Å—å –≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞. –ö–æ–Ω—Ç—Ä–∞–∫—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º ERC-20: name, symbol, approve –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥—Ä—É–≥–∏–µ. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö "[The Fallback Extension Pattern](https://www.rareskills.io/post/fallback-extension-pattern)".
3. **CometCore.sol**. –ù–µ–±–æ–ª—å—à–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –¥–ª—è –∑–∞–π–º–æ–≤ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.
4. **CometStorage.sol**. –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ù–∏ –≤ –æ–¥–Ω–æ–º –¥—Ä—É–≥–æ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ–ª—å—à–µ –Ω–µ –æ–±—ä—è–≤–ª—è—é—Ç—Å—è.
5. **CometMath.sol**. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –Ω–µ—Å–ª–æ–∂–Ω—ã—Ö –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π. –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –∑–∞—â–∏—Ç—É –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è.
6. **CometConfiguration.sol**. –°–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `Comet.sol`.

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

–¶–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞–¥—Ä–µ—Å–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–∫—Å–∏ `Comet.sol`. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –ø—Ä–æ–∫—Å–∏ –Ω–∞—á–∞–ª —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –Ω–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç [Comet.sol](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L17) –∏–º–µ–µ—Ç –æ—á–µ–Ω—å –º–Ω–æ–≥–æ immutable –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

```solidity
contract Comet is CometMainInterface {
    /// @notice The admin of the protocol
    address public override immutable governor;

    /// @notice The account which may trigger pauses
    address public override immutable pauseGuardian;

    /// @notice The address of the base token contract
    address public override immutable baseToken;

    ...
}
```

–≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–∞–∑–Ω–æ—Ä–æ–¥–Ω—ã. –≠—Ç–æ –∏ –∞–¥—Ä–µ—Å `governor`, –∏ `supplyKink`, –∏ `decimals`, –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –í—Å–µ —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —è–≤–ª—è—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è `Comet.sol` –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ constructor –≤ –º–æ–º–µ–Ω—Ç –¥–µ–ø–ª–æ—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —è–≤–ª—è—é—Ç—Å—è —á–∞—Å—Ç—å—é –∫–æ–¥–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∏—Ö, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ø—Ä–æ–∫—Å–∏ —Ü–µ–ª–∏–∫–æ–º. –í –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –¥–µ–ª–∞—é—Ç —Ñ—É–Ω–∫—Ü–∏—é `setter()`, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å –ª—é–±—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É. –ù–∞–ø—Ä–∏–º–µ—Ä

```solidity
contract Comet {
  function setGovernor(address governor) external onlyOwner {
    _governor = governor;
    ...
  }
}
```

–í Compound v3 —Ç–∞–∫–æ–≥–æ –Ω–µ—Ç –∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å `governor` —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–º–µ–Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–∫—Å–∏. –í—ã–≥–ª—è–¥–∏—Ç –ø–æ–¥–æ–±–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

![](./images/compound-v3-upgrade.png)

**–®–∞–≥–∏ 1 –∏ 2.** –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ [ConfiguratorProxy.sol](https://github.com/compound-finance/comet/blob/main/contracts/ConfiguratorProxy.sol). –ü—Ä–æ–∫—Å–∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ –∫ —Å–≤–æ–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é [deploy()](https://github.com/compound-finance/comet/blob/main/contracts/Configurator.sol#L333) –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ `Configurator.sol`.

**–®–∞–≥ 3.** –ù–µ –±–µ–∑ —É—á–∞—Å—Ç–∏—è [—Ñ–∞–±—Ä–∏–∫–∏](https://github.com/compound-finance/comet/blob/main/contracts/CometFactory.sol#L8) –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ `Comet`. –ù–∞ —Å—Ö–µ–º–µ –Ω–æ–≤–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –≤—ã–¥–µ–ª–µ–Ω–∞ –∑–µ–ª–µ–Ω—ã–º —Ü–≤–µ—Ç–æ–º.

**–®–∞–≥–∏ 4, 5, 6.** –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ [CometProxyAdmin.sol](https://github.com/compound-finance/comet/blob/main/contracts/CometProxyAdmin.sol#L16) –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [upgradeAndCall()](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/4764ea50750d8bda9096e833706beba86918b163/contracts/proxy/transparent/ProxyAdmin.sol#L38) –∏ –∑–∞–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ CometProxy –Ω–∞ –Ω–æ–≤—ã–π.

_–í–∞–∂–Ω–æ!_ –ú–æ–∂–Ω–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏—Ç—å, –∫–∞–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ Comet –∏–∑–º–µ–Ω—è—é—Ç—Å—è, –≤ —Ä–∞–∑–¥–µ–ª–µ [Governance](https://compound.finance/governance/proposals).

## Principal Value and Present Value

–ß—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ –∏ —Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–¥, –ø–æ—Ö–æ–¥–∏—Ç—å –ø–æ –Ω–µ–º—É –Ω–∞–∑–∞–¥ –∏ –≤–ø–µ—Ä–µ–¥, —Å–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫ Compound —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –∑–∞–µ–º—â–∏–∫–∞–º –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.

–ó–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –¥–ª—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –æ—Ç–≤–µ—á–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è [baseSupplyIndex](https://github.com/compound-finance/comet/blob/main/contracts/CometStorage.sol#L50). –ú–æ–∂–Ω–æ —Ç—Ä–∞–∫—Ç–æ–≤–∞—Ç—å –µ–µ, –∫–∞–∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∫–∞–∫–æ–≥–æ-—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–∫–µ–Ω–∞ –∑–∞ –∫–∞–∫–æ–µ-—Ç–æ –≤—Ä–µ–º—è. –ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–∞–∫–∞—è-–Ω–∏–±—É–¥—å –æ–ø–µ—Ä–∞—Ü–∏—è (–∑–∞–µ–º, –¥–µ–ø–æ–∑–∏—Ç –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ) —ç—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–æ—à–µ–¥—à–µ–º—É –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–π —Å—Ç–∞–≤–∫–µ –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥.

–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ –º–µ—Å—Ç–æ, –≥–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π **baseSupplyIndex** —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è [accruedInterestIndices()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L403).

```solidity
function accruedInterestIndices(uint timeElapsed) internal view returns (uint64, uint64) {
    uint64 baseSupplyIndex_ = baseSupplyIndex;
    uint64 baseBorrowIndex_ = baseBorrowIndex;
    if (timeElapsed > 0) {
        uint utilization = getUtilization();
        uint supplyRate = getSupplyRate(utilization);
        uint borrowRate = getBorrowRate(utilization);
        // –ù–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç —Å–µ–π—á–∞—Å –≤–æ—Ç —ç—Ç–æ –º–µ—Å—Ç–æ
        baseSupplyIndex_ += safe64(mulFactor(baseSupplyIndex_, supplyRate * timeElapsed));
        baseBorrowIndex_ += safe64(mulFactor(baseBorrowIndex_, borrowRate * timeElapsed));
    }
    return (baseSupplyIndex_, baseBorrowIndex_);
}
```

–¢–µ–ø–µ—Ä—å, –∑–Ω–∞—è, —á—Ç–æ —Ç–∞–∫–æ–µ `baseSupplyIndex`, –º—ã –≥–æ—Ç–æ–≤—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∞–ª–∞–Ω—Å–µ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö. –ù–∞–∑—ã–≤–∞–µ—Ç—Å—è —ç—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ [UserBasic](https://github.com/compound-finance/comet/blob/main/contracts/CometStorage.sol#L29).

```solidity
struct UserBasic {
    int104 principal; // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    uint64 baseTrackingIndex; // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π –≤ —Ç–æ–∫–µ–Ω–µ COMP
    uint64 baseTrackingAccrued; // –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –≤ —Ç–æ–∫–µ–Ω–µ COMP
    uint16 assetsIn; // –ù–∞–±–æ—Ä –±–∏—Ç, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∞–∫—Ç–∏–≤, –≤–ª–æ–∂–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–ª–æ–≥–∞.
    uint8 _reserved; // –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
}
```

–û–¥–Ω–∞–∫–æ –ø–æ–ª–µ **principal** –Ω–µ —Ç–∞–∫–æ–µ –ø—Ä–æ—Å—Ç–æ–µ, –∫–∞–∫ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è. –í —Å–ª—É—á–∞–µ —Å –¥–µ–ø–æ–∑–∏—Ç–æ–º —ç—Ç–æ –ø–æ–ª–µ –±—É–¥–µ—Ç –¥–µ–ª–∏—Ç—å—Å—è –Ω–∞ **baseSupplyIndex**.

–ù–∞–ø—Ä–∏–º–µ—Ä:
> baseSupplyIndex —Ä–∞–≤–µ–Ω 5. –í–Ω–æ—Å–∏—Ç—å—Å—è 500 USDC. **principal** –±—É–¥–µ—Ç —Ä–∞–≤–µ–Ω 100.

–ï—Å–ª–∏ –≤—ã–≤–æ–¥–∏—Ç—å –∞–∫—Ç–∏–≤ –≤ —ç—Ç–æ—Ç –∂–µ –º–æ–º–µ–Ω—Ç, —Ç–æ principal –±—É–¥–µ—Ç —É–º–Ω–æ–∂–∞—Ç—å—Å—è –Ω–∞ baseSupplyIndex –∏ –º—ã –ø–æ–ª—É—á–∏–º —Ç–µ –∂–µ —Å–∞–º—ã–µ 500 USDC. –° —Ç–µ—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ baseSupplyIndex —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, —Ç–µ–º —Å–∞–º—ã–º —É–≤–µ–ª–∏—á–∏–≤–∞—è —Å—É–º–º—É, –∫–æ—Ç–æ—Ä—É—é —Å–º–æ–∂–µ—Ç —Å–Ω—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤.

_–í–∞–∂–Ω–æ!_ –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤–ª–æ–∂–µ–Ω–∏—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **"present value"** (500), –ø–æ–¥–µ–ª–µ–Ω–Ω—ã–π "present value" –Ω–∞ baseSupplyIndex –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **"principal value"** (100).

–ó–∞ –ø–µ—Ä–µ—Ö–æ–¥ —á–∏—Å–µ–ª –æ—Ç present –¥–æ principal –∏ –æ–±—Ä–∞—Ç–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏: [presentValue()](https://github.com/compound-finance/comet/blob/main/contracts/CometCore.sol#L79C14-L79C26) –∏ [principalValue()](https://github.com/compound-finance/comet/blob/main/contracts/CometCore.sol#L104).

–°–∏—Ç—É–∞—Ü–∏—è —Å —Ä–∞—Å—á–µ—Ç–∞–º–∏ –¥–ª—è –∑–∞–π–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏. –¢–æ–ª—å–∫–æ "principal value" —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∑–∞ –º–µ—Å—Ç–æ baseSupplyIndex –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **baseBorrowIndex**.

## Supply

–ü–µ—Ä–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ª—é–±—ã–º –ª–µ–Ω–¥–∏–Ω–≥ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∞. –í Compound v3 –∞–∫—Ç–∏–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –¥–ª—è —Ç—Ä–µ—Ö –≤–µ—â–µ–π: –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–ª–æ–≥–∞, –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–æ–≥–∞—à–µ–Ω–∏—è –∑–∞–π–º–∞.

![](./images/compound-v3-supply.png)

–ï—Å—Ç—å —Ç—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Å–ø–æ—Å–æ–±–∞ –ø–µ—Ä–µ–¥–∞—Ç—å –∞–∫—Ç–∏–≤ –ø—Ä–æ—Ç–æ–∫–æ–ª—É:
- **supply()**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞ –Ω–∞–ø—Ä—è–º—É—é –æ—Ç –∏–º–µ–Ω–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.
- **supplyTo()**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞ –æ—Ç –∏–º–µ–Ω–∏ –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ –Ω–∞ —Å—á–µ—Ç `to` –∞–¥—Ä–µ—Å–∞.
- **supplyFrom()**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞ —Å–æ —Å—á–µ—Ç–∞ `from` –æ—Ç –∏–º–µ–Ω–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä–æ–º—É –∞–¥—Ä–µ—Å `from` –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–ª –ø–æ–ª–Ω–æ–º–æ—á–∏—è.

–ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
1. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ([supply()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L835), [supplyTo()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L845C14-L845C22), [supplyFrom()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L856)) –≤—ã–∑–æ–≤ —É–π–¥–µ—Ç –≤ internal —Ñ—É–Ω–∫—Ü–∏—é [supplyInternal()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L864).
    ```solidity
    // operator - —ç—Ç–æ –≤—Å–µ–≥–¥–∞ msg.sender —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    function supplyInternal(address operator, address from, address dst, address asset, uint amount) internal nonReentrant {
      // –ü—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∞ –Ω–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
      if (isSupplyPaused()) revert Paused();

      // –ü—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –≤—ã–∑–æ–≤ –æ—Ç –∞–¥—Ä–µ—Å–∞ from –∏–ª–∏ –∏–ª–∏ –æ—Ç –∏–º–µ–Ω–∏, –∫–æ–º—É –∞–¥—Ä–µ—Å from –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–ª
      if (!hasPermission(from, operator)) revert Unauthorized();

      // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤ –±–∞–∑–æ–≤—ã–π, —Ç–æ —É—á–µ—Å—Ç—å –µ–≥–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏–ª–∏ –ø–æ–≥–∞—à–µ–Ω–∏—è –∑–∞–π–º–∞, –∏–Ω–∞—á–µ —É—á–µ—Å—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–ª–æ–≥–∞ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∑–∞–π–º–∞
      if (asset == baseToken) {
          if (amount == type(uint256).max) {
              amount = borrowBalanceOf(dst);
          }
          return supplyBase(from, dst, amount);
      } else {
          return supplyCollateral(from, dst, asset, safe128(amount));
      }
    }
    ```
2. `supplyBase()` –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
    ```solidity
    function supplyBase(address from, address dst, uint256 amount) internal {
        // –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
        amount = doTransferIn(baseToken, from, amount);

        // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
        accrueInternal();

        UserBasic memory dstUser = userBasic[dst];
        // –û—Å–Ω–æ–≤–Ω–∞—è —Å—É–º–º–∞ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–¥—Ä–µ—Å–æ–º dst
        int104 dstPrincipal = dstUser.principal;
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞
        int256 dstBalance = presentValue(dstPrincipal) + signed256(amount);
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –±–∞–ª–∞–Ω—Å –≤ –Ω–æ–≤—É—é —Å—É–º–º—É –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞
        int104 dstPrincipalNew = principalValue(dstBalance);

        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–π–¥–µ—Ç –Ω–∞ –ø–æ–≥–∞—à–µ–Ω–∏–µ –¥–æ–ª–≥–∞ –∏ –Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
        (uint104 repayAmount, uint104 supplyAmount) = repayAndSupplyAmount(dstPrincipal, dstPrincipalNew);

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—É–º–º—É –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏ –æ–±—â—É—é —Å—É–º–º—É –∑–∞–π–º–∞
        totalSupplyBase += supplyAmount;
        totalBorrowBase -= repayAmount;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ –ø–æ–∑–∏—Ü–∏–∏ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ
        updateBasePrincipal(dst, dstUser, dstPrincipalNew);

        emit Supply(from, dst, amount);

        if (supplyAmount > 0) {
            emit Transfer(address(0), dst, presentValueSupply(baseSupplyIndex, supplyAmount));
        }
    }
    ```
3. `supplyCollateral()` –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
    ```solidity
    function supplyCollateral(address from, address dst, address asset, uint128 amount) internal {
        // –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –∑–∞–ª–æ–≥–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
        amount = safe128(doTransferIn(asset, from, amount));

        AssetInfo memory assetInfo = getAssetInfoByAddress(asset);
        TotalsCollateral memory totals = totalsCollateral[asset];
        totals.totalSupplyAsset += amount;
        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ª–æ–≥–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
        if (totals.totalSupplyAsset > assetInfo.supplyCap) revert SupplyCapExceeded();

        uint128 dstCollateral = userCollateral[dst][asset].balance;
        uint128 dstCollateralNew = dstCollateral + amount;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–π —Å—É–º–º—ã –∑–∞–ª–æ–≥–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –∏ —Å—É–º–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
        totalsCollateral[asset] = totals;
        userCollateral[dst][asset].balance = dstCollateralNew;

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–µ—Ç–∫—É (–±–∏—Ç), —á—Ç–æ —ç—Ç–æ—Ç –∞–∫—Ç–∏–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–ª–æ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        updateAssetsIn(dst, assetInfo, dstCollateral, dstCollateralNew);

        emit SupplyCollateral(from, dst, asset, amount);
    }
    ```

    –ù–∞ —Å—Ö–µ–º–µ –º–æ–∂–Ω–æ –Ω–∞–≥–ª—è–¥–Ω–æ –∑–∞–∫—Ä–µ–ø–∏—Ç—å –≤ –≥–æ–ª–æ–≤–µ –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–∑–æ–≤–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞.

    ![](./images/compound-v3-supply-call-stack.png)

## Withdraw

–ò–∑—ä—è—Ç–∏–µ –∞–∫—Ç–∏–≤–æ–≤ –∏–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø–æ–¥–æ–±–Ω–æ–π —Å—Ö–µ–º–µ, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `supply()`.

![](./images/compound-v3-withdraw.png)

–î–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞ –∏–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–¥–Ω–æ–π –∏–∑ —Ç—Ä–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π:
- **withdraw()**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞ –Ω–∞–ø—Ä—è–º—É—é –æ—Ç –∏–º–µ–Ω–∏ –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ.
- **withdrawTo()**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞ –æ—Ç –∏–º–µ–Ω–∏ –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ –Ω–∞ –∞–¥—Ä–µ—Å `to`.
- **withdrawFrom()**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞ —Å –∞–¥—Ä–µ—Å–∞ `from` –æ—Ç –∏–º–µ–Ω–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä–æ–º—É –∞–¥—Ä–µ—Å `from` –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–ª –ø–æ–ª–Ω–æ–º–æ—á–∏—è.

–ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º –ø—Ä–æ—Ü–µ—Å—Å –∏–∑—ä—è—Ç–∏—è –∞–∫—Ç–∏–≤–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

1. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ([withdraw()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L1057), [withdrawTo()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L1067), [withdrawFrom()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L1078)) –≤—ã–∑–æ–≤ —É–π–¥–µ—Ç –≤ internal —Ñ—É–Ω–∫—Ü–∏—é[ withdrawInternal()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L1086).

    ```solidity
    function withdrawInternal(address operator, address src, address to, address asset, uint amount) internal nonReentrant {
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∞ –Ω–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
        if (isWithdrawPaused()) revert Paused();

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –≤—ã–∑–æ–≤ –æ—Ç –∞–¥—Ä–µ—Å–∞ src –∏–ª–∏ –∏–ª–∏ –æ—Ç –∏–º–µ–Ω–∏, –∫–æ–º—É –∞–¥—Ä–µ—Å src –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–ª
        if (!hasPermission(src, operator)) revert Unauthorized();

        // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤ –±–∞–∑–æ–≤—ã–π, —Ç–æ —É—á–µ—Å—Ç—å –µ–≥–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–∑—ä—è—Ç–∏—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, –∏–Ω–∞—á–µ —É—á–µ—Å—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–ª–æ–≥–∞ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∑–∞–π–º–∞.
        if (asset == baseToken) {
            if (amount == type(uint256).max) {
                amount = balanceOf(src);
            }
            return withdrawBase(src, to, amount);
        } else {
            return withdrawCollateral(src, to, asset, safe128(amount));
        }
    }
    ```
2. –ï—Å–ª–∏ –∞–∫—Ç–∏–≤ –±–∞–∑–æ–≤—ã–π, —Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É –Ω–∞—Å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–ª–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å, –µ—Å–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π, —Ç–æ –∑–∞–Ω–∏–º–∞–ª–∏.
    ```solidity
    function withdrawBase(address src, address to, uint256 amount) internal {
        // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
        accrueInternal();

        // –°—á–∏—Ç—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∞–¥—Ä–µ—Å—É src, —Å–æ —Å—á–µ—Ç–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –º—ã —Å–Ω–∏–º–∞–µ–º –∞–∫—Ç–∏–≤
        UserBasic memory srcUser = userBasic[src];
        int104 srcPrincipal = srcUser.principal;
        int256 srcBalance = presentValue(srcPrincipal) - signed256(amount);
        int104 srcPrincipalNew = principalValue(srcBalance);

        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—ã –¥–ª—è —Å–Ω—è—Ç–∏—è –∏ —Å—É–º–º—ã, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤ –∑–∞–π–º–µ
        (uint104 withdrawAmount, uint104 borrowAmount) = withdrawAndBorrowAmount(srcPrincipal, srcPrincipalNew);

        // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ–±—â—É—é —Å—É–º–º—É –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –ø–æ—Å–ª–µ —Å–Ω—è—Ç–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –æ–±—â—É—é —Å—É–º–º—É –∑–∞–Ω—è—Ç—ã—Ö –∞–∫—Ç–∏–≤–æ–≤
        totalSupplyBase -= withdrawAmount;
        totalBorrowBase += borrowAmount;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ –ø–æ–∑–∏—Ü–∏–∏ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ
        updateBasePrincipal(src, srcUser, srcPrincipalNew);

        if (srcBalance < 0) {
            if (uint256(-srcBalance) < baseBorrowMin) revert BorrowTooSmall();
            if (!isBorrowCollateralized(src)) revert NotCollateralized();
        }

        // –ü–µ—Ä–µ–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞
        doTransferOut(baseToken, to, amount);

        emit Withdraw(src, to, amount);

        if (withdrawAmount > 0) {
            emit Transfer(src, address(0), presentValueSupply(baseSupplyIndex, withdrawAmount));
        }
    }
    ```
3. –ï—Å–ª–∏ —Å–Ω–∏–º–∞–µ–º –∞–∫—Ç–∏–≤, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –∑–∞–ª–æ–≥–æ–≤—ã–º, —Ç–æ –≤—ã–∑–æ–≤ —É—Ö–æ–¥–∏—Ç –≤ `withdrawCollateral()`
    ```solidity
    function withdrawCollateral(address src, address to, address asset, uint128 amount) internal {
        uint128 srcCollateral = userCollateral[src][asset].balance;
        uint128 srcCollateralNew = srcCollateral - amount;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ª–æ–≥–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        totalsCollateral[asset].totalSupplyAsset -= amount;
        userCollateral[src][asset].balance = srcCollateralNew;

        AssetInfo memory assetInfo = getAssetInfoByAddress(asset);
        updateAssetsIn(src, assetInfo, srcCollateral, srcCollateralNew);

        // –ó–∞–ø—Ä–µ—â–∞–µ—Ç —Å–Ω–∏–º–∞—Ç—å –∞–∫—Ç–∏–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º
        if (!isBorrowCollateralized(src)) revert NotCollateralized();

        // –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –∞–∫—Ç–∏–≤–æ–≤ –¥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        doTransferOut(asset, to, amount);

        emit WithdrawCollateral(src, to, asset, amount);
    }
    ```

## Borrow

–ó–∞–π–º –∞–∫—Ç–∏–≤–∞ - —ç—Ç–æ –æ–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö –≥–ª–∞–≤–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∫ –ª—é–±–æ–≥–æ –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞. –†–∞–¥–∏ –Ω–µ–µ –º—ã —Ç—É—Ç —Å –≤–∞–º–∏ –∏ —Å–æ–±—Ä–∞–ª–∏—Å—å. –ó–∞–Ω—è—Ç—å –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ `Comet.sol` –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —Ä—ã–Ω–∫–∞.

–ü–µ—Ä–µ–¥ –∑–∞–π–º–æ–º, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω–æ —É—Å–ª–æ–≤–∏–µ - –≤–Ω–µ—Å—Ç–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ª–æ–≥–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞, —á—Ç–æ–±—ã –∑–∞–µ–º –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏ "—á—É—Ç—å –±–æ–ª—å—à–µ" –æ–±–µ—Å–ø–µ—á–µ–Ω. –î–ª—è —ç—Ç–æ–≥–æ, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `supply()`. –ï–µ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–ª–∏ –≤—ã—à–µ.

–ó–∞ —Å–∞–º –∑–∞–µ–º –æ—Ç–≤–µ—á–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è —Å–Ω—è—Ç–∏—è –∞–∫—Ç–∏–≤–∞ `withdraw()`. –ú—ã —É–∂–µ —Ä–∞–∑–±–∏—Ä–∞–ª–∏ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–∞ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã—à–µ. –ó–∞–Ω—è—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤, –ø–æ—ç—Ç–æ–º—É –ø–æ–≥—Ä—É–∑–∏–º—Å—è —á—É—Ç—å –≥–ª—É–±–∂–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é `withdrawBase()`. –ü–æ–¥—Å–≤–µ—Ç–∏–º, —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –Ω–∞—Å —É—á–∞—Å—Ç–∫–∏ –∫–æ–¥–∞.

```solidity
function withdrawBase(address src, address to, uint256 amount) internal {
    ...

    UserBasic memory srcUser = userBasic[src];
    int104 srcPrincipal = srcUser.principal;
    int256 srcBalance = presentValue(srcPrincipal) - signed256(amount);
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ–≤—É—é —Å—É–º–º—É –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞, –ø–æ—Å–ª–µ —Å–Ω—è—Ç–∏—è
    int104 srcPrincipalNew = principalValue(srcBalance);

    // –ó–¥–µ—Å—å –±—É–¥–µ–º —Ä–µ—à–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ —Å–Ω–∏–º–∞–µ—Ç, –∞ —Å–∫–æ–ª—å–∫–æ –æ–Ω –∑–∞–Ω–∏–º–∞–µ—Ç
    (uint104 withdrawAmount, uint104 borrowAmount) = withdrawAndBorrowAmount(srcPrincipal, srcPrincipalNew);

    ...
}
```

–ù–∞—Å –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `withdrawAndBorrowAmount()`, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—É–º–º—É –∑–∞–π–º–∞. –ü–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –≤ –Ω–µ–π –≤–Ω—É—Ç—Ä–∏.

```solidity
// oldPrincipal - —Å—Ç–∞—Ä—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞
// newPrincipal - –Ω–æ–≤—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è (–°—É–º–º–∞ –¥–ª—è —Å–Ω—è—Ç–∏—è –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ —Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, —Å—É–º–º–∞ –¥–ª—è –∑–∞–π–º–∞ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞)
function withdrawAndBorrowAmount(int104 oldPrincipal, int104 newPrincipal) internal pure returns (uint104, uint104) {
    // –ï—Å–ª–∏ –Ω–æ–≤–∞—è —Å—É–º–º–∞ –±–æ–ª—å—à–µ —Å—Ç–∞—Ä–æ–π, —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º—ã –∏ –Ω–µ —Å–Ω–∏–º–∞–ª–∏ –∞–∫—Ç–∏–≤—ã –∏ –Ω–µ –∑–∞–Ω–∏–º–∞–ª–∏, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ—Ç —Ç–∞–∫ –∏ —Ç–∞–∫–æ–≥–æ –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ
    if (newPrincipal > oldPrincipal) return (0, 0);

    // –ï—Å–ª–∏ –Ω–æ–≤–∞—è —Å—É–º–º–∞ –±–æ–ª—å—à–µ –Ω—É–ª—è –∏–ª–∏ —Ä–∞–≤–Ω–æ, —Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º—ã —Å–Ω–∏–º–∞–µ–º –∞–∫—Ç–∏–≤
    if (newPrincipal >= 0) {
        return (uint104(oldPrincipal - newPrincipal), 0);
        // –ï—Å–ª–∏ —Å—Ç–∞—Ä–∞—è —Å—É–º–º–∞ –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–∞ –Ω—É–ª—é, —Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º—ã —É–∂–µ –∑–∞–Ω–∏–º–∞–ª–∏ –∞–∫—Ç–∏–≤ –∏ –º—ã –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ –ø–µ—Ä–≤–æ–µ —É—Å–ª–æ–≤–∏–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–æ–≤–∞—è —Å—É–º–º–∞ —Ç–æ–∂–µ –º–µ–Ω—å—à–µ –Ω—É–ª—è, –∞ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∑–∞–Ω–∏–º–∞—Ç—å –∞–∫—Ç–∏–≤—ã
    } else if (oldPrincipal <= 0) {
        return (0, uint104(oldPrincipal - newPrincipal));
        // –ï—Å–ª–∏ –º—ã –Ω–µ –ø–æ–¥–æ—à–ª–∏ –ø–æ–¥ —É—Å–ª–æ–≤–∏—è –≤—ã—à–µ, —Ç–æ –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –Ω–∞–º –∑–Ω–∞—á–µ–Ω–∏—è
    } else {
        return (uint104(oldPrincipal), uint104(-newPrincipal));
    }
}
```

–ü–æ–ª—É—á–∞–µ—Ç—Å—è, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–π–º–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é –∏–º —Å—É–º–º—É –∞–∫—Ç–∏–≤–æ–≤ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `withdraw()`, –Ω–æ –µ—Å–ª–∏ —É –Ω–µ–≥–æ –±—ã–ª –¥–µ–ø–æ–∑–∏—Ç –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞, —Ç–æ –¥–æ–ª–≥ –µ–º—É –∑–∞–ø–∏—à–µ—Ç—Å—è –∑–∞ –≤—ã—á–µ—Ç–æ–º –¥–µ–ø–æ–∑–∏—Ç–∞. –¢–æ—á–Ω–µ–µ –æ–Ω –ø–æ–ª—É—á–∏—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é –∏–º —Å—É–º–º—É, –Ω–æ –±–æ–ª—å—à–µ —É –Ω–µ–≥–æ –Ω–µ –±—É–¥–µ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –≤ –±–∞–∑–æ–≤–æ–º –∞–∫—Ç–∏–≤–µ.

## Repay

–ü–æ–≥–∞—à–µ–Ω–∏–µ –∑–∞–π–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ñ—É–Ω–∫—Ü–∏–∏ `withdraw()` —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `supply()`. –ú—ã —Ç–æ–∂–µ –≤–∏–¥–µ–ª–∏ —Ç–∞–º —Ñ—É–Ω–∫—Ü–∏—é [supplyBase()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L872).

–ü—Ä–∞–∫—Ç–∏–∫–∞ - —ç—Ç–æ –æ–¥–∏–Ω –∏–∑ –ª—É—á—à–∏—Ö —Å–ø–æ—Å–æ–±–æ–≤ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞, –ø–æ—ç—Ç–æ–º—É –ø—Ä–µ–¥–ª–∞–≥–∞—é —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–≥–∞—à–µ–Ω–∏–µ –∑–∞–π–º–∞.

## Liquidation

–õ–∏–∫–≤–∏–¥–∞—Ü–∏—è –≤ Compound v3 –ø—Ä–æ—Å—Ç–∞—è –∑–∞ —Å—á–µ—Ç —Ç–æ–≥–æ, —á—Ç–æ –≤—Å–µ –∑–∞–π–º—ã —Å–¥–µ–ª–∞–Ω—ã –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ç–∞, –∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ `Comet.sol`. –†–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ —Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º –ø—Ä–æ–∫—Å–∏. –û–¥–Ω–∞–∫–æ –∑–¥–µ—Å—å –ø–æ—è–≤–ª—è–µ—Ç—Å—è –µ—â–µ –æ–¥–∏–Ω —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —É—á–∞—Å—Ç–Ω–∏–∫. –≠—Ç–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –æ—Ä–∞–∫—É–ª–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–æ–¥—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–ª–æ–≥–æ–≤—ã—Ö –∞–∫—Ç–∏–≤–æ–≤.

![](./images/compound-v3-liquidation.png)

–î–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ–≥–æ —Å –¥–≤—É–º—è —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
- **isLiqudatable()**. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∑–∞–ª–æ–≥–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, —Å—É–º–º–∏—Ä—É–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ–≥–æ –∑–∞–ª–æ–≥–∞, –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ –∫–∞–∂–¥–æ–º—É –∞–∫—Ç–∏–≤—É –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–∑ –æ—Ä–∞–∫—É–ª–∞
- **absorb()**. –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ª–∏–∫–≤–∏–¥–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∑–∞–µ–º—â–∏–∫–∞

–§—É–Ω–∫—Ü–∏—è [isLiquidatable()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L566) —Å—É–º–º–∏—Ä—É–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –≤ USD –ø–æ –∫–∞–∂–¥–æ–º—É –∞–∫—Ç–∏–≤—É, —É–º–Ω–æ–∂–∞—è –µ–≥–æ –Ω–∞ **liquidateCollateralFactor**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–∞–∫—É—é —á–∞—Å—Ç—å –∑–∞–ª–æ–≥–∞ –º–æ–∂–Ω–æ –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞—Ç—å.

```solidity
function isLiquidatable(address account) override public view returns (bool) {
    int104 principal = userBasic[account].principal;

    // –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –∑–∞–π–º–∞ –∏ –æ–Ω —Å—Ä–∞–∑—É –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–ª–µ–∂–∞—Ç—å –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
    if (principal >= 0) {
        return false;
    }

    uint16 assetsIn = userBasic[account].assetsIn;
    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –≤ USD, –µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–µ–º, —Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º
    int liquidity = signedMulPrice(
        presentValue(principal),
        getPrice(baseTokenPriceFeed),
        uint64(baseScale)
    );

    // –¶–∏–∫–ª –ø–æ –≤—Å–µ–º –¥–æ–ø—É—Å—Ç–∏–º—ã–º –∞–∫—Ç–∏–≤–∞–º
    for (uint8 i = 0; i < numAssets; ) {
        if (isInAsset(assetsIn, i)) {
            // –ï—Å–ª–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–∫—Ç–∏–≤–æ–≤, —Ç–æ –Ω–µ—Ç —Å–º—ã—Å–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤—ã
            // –¢–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
            if (liquidity >= 0) {
                return false;
            }

            AssetInfo memory asset = getAssetInfo(i);
            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∞–∫—Ç–∏–≤—É –≤ USD
            uint newAmount = mulPrice(
                userCollateral[account][asset.asset].balance,
                getPrice(asset.priceFeed),
                asset.scale
            );
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∞–∫—Ç–æ—Ä –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –ø–æ –∞–∫—Ç–∏–≤—É –∏ —Å—É–º–º–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å—é –ø–æ –¥—Ä—É–≥–∏–º –∞–∫—Ç–∏–≤–∞–º
            liquidity += signed256(mulFactor(
                newAmount,
                asset.liquidateCollateralFactor
            ));
        }
        unchecked { i++; }
    }

    return liquidity < 0;
}
```

–§—É–Ω–∫—Ü–∏—è `absorb(address absorber, address[] calldata accounts)` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:

- **absorber**. –ê–¥—Ä–µ—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∏—Ç –æ—á–∫–∏ –∑–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏—é
- **accounts**. –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–∑–∏—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–¥–ª–µ–∂–∞—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏

–ü–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π:
1. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `absorb()`
    ```solidity
    function absorb(address absorber, address[] calldata accounts) override external {
        // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ–±—ã –ø—Ä–æ—Ü–µ—Å—Å –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –Ω–µ –±—ã–ª –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
        if (isAbsorbPaused()) revert Paused();

        uint startGas = gasleft();

        // –ù–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç—ã
        accrueInternal();

        // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –ª–∏–∫–≤–∏–¥–∞—Ü–∏—è
        for (uint i = 0; i < accounts.length; ) {
            absorbInternal(absorber, accounts[i]);
            unchecked { i++; }
        }
        uint gasUsed = startGas - gasleft();

        // –ù–∞—á–∏—Å–ª—è—é—Ç—Å—è –æ—á–∫–∏ –∑–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏—é –Ω–∞ –±–∞–∑–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–≥–æ –≥–∞–∑–∞ –¥–ª—è –∏–∑ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
        LiquidatorPoints memory points = liquidatorPoints[absorber];
        points.numAbsorbs++;
        points.numAbsorbed += safe64(accounts.length);
        points.approxSpend += safe128(gasUsed * block.basefee);
        liquidatorPoints[absorber] = points;
    }
    ```
2. –î–∞–ª—å—à–µ –≤—ã–∑–æ–≤ —É—Ö–æ–¥–∏—Ç –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ñ—É–Ω–∫—Ü–∏—é `absorbInternal()`.
    ```solidity
    function absorbInternal(address absorber, address account) internal {
        // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
        if (!isLiquidatable(account)) revert NotLiquidatable();

        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∑–∞–π–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        UserBasic memory accountUser = userBasic[account];
        int104 oldPrincipal = accountUser.principal;
        int256 oldBalance = presentValue(oldPrincipal);
        uint16 assetsIn = accountUser.assetsIn;

        // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞
        uint256 basePrice = getPrice(baseTokenPriceFeed);

        // –ü–æ —Å—É—Ç–∏ deltaValue - —Å—É–º–º–∞ –≤ USD, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–∞
        uint256 deltaValue = 0;
        for (uint8 i = 0; i < numAssets; ) {
            if (isInAsset(assetsIn, i)) {
                AssetInfo memory assetInfo = getAssetInfo(i);
                address asset = assetInfo.asset;
                uint128 seizeAmount = userCollateral[account][asset].balance;
                userCollateral[account][asset].balance = 0;
                totalsCollateral[asset].totalSupplyAsset -= seizeAmount;

                uint256 value = mulPrice(seizeAmount, getPrice(assetInfo.priceFeed), assetInfo.scale);
                // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –∫ —Å—É–º–º–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ –∞–∫—Ç–∏–≤—É
                deltaValue += mulFactor(value, assetInfo.liquidationFactor);

                emit AbsorbCollateral(absorber, account, asset, seizeAmount, value);
            }
            unchecked { i++; }
        }

        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω
        uint256 deltaBalance = divPrice(deltaValue, basePrice, uint64(baseScale));
        // oldBalance - —á–∏—Å–ª–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ, —Ç–∞–∫ –∫–∞–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫–∞—è —Å—É–º–º–∞ –≤ –∑–∞–π–º–µ
        // –ü–æ—ç—Ç–æ–º—É –ø—Ä–∏–±–∞–≤–ª–µ–Ω–∏–µ deltaBalance –ª–∏–∫–≤–∏–¥–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏—é –Ω–∞ —ç—Ç—É —Å—É–º–º—É
        int256 newBalance = oldBalance + signed256(deltaBalance);
        if (newBalance < 0) {
            newBalance = 0;
        }

        // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ—Å—Ç–∞–≤—à—É—é—Å—è —Å—É–º–º—É –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤ –≤ –∑–∞–π–º–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        int104 newPrincipal = principalValue(newBalance);
        updateBasePrincipal(account, accountUser, newPrincipal);

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∞–∫—Ç–∏–≤–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∑–∞–ª–æ–≥–æ–º —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        userBasic[account].assetsIn = 0;

        (uint104 repayAmount, uint104 supplyAmount) = repayAndSupplyAmount(oldPrincipal, newPrincipal);

        // –ü—Ä–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ—Ç–∞–ª—ã –ø–æ –∑–∞–π–º–∞–º –∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
        totalSupplyBase += supplyAmount;
        totalBorrowBase -= repayAmount;

        uint256 basePaidOut = unsigned256(newBalance - oldBalance);
        uint256 valueOfBasePaidOut = mulPrice(basePaidOut, basePrice, uint64(baseScale));
        emit AbsorbDebt(absorber, account, basePaidOut, valueOfBasePaidOut);

        if (newPrincipal > 0) {
            emit Transfer(address(0), account, presentValueSupply(baseSupplyIndex, unsigned104(newPrincipal)));
        }
    }
    ```

–ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω –∞–¥—Ä–µ—Å –∏–∑ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç, —Ç–æ –≤—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–µ–Ω–∞.

–í–∞–∂–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –∑–¥–µ—Å—å –Ω–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ–π –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–∏–±–æ –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é, –ª–∏–±–æ –Ω–∏–∫–∞–∫. –í—Å–µ —á—Ç–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å. –ü–æ–ª—É—á–∞–µ—Ç—Å—è –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ç–∞–Ω–µ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.

–ê –µ—â–µ –±–æ–ª–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º –∫–∞–∂–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –ª–∏–∫–≤–∏–¥–∞—Ç–æ—Ä **–Ω–µ –ø–æ–ª—É—á–∏–ª** –Ω–∞–ø—Ä—è–º—É—é –Ω–∏—á–µ–≥–æ –∫—Ä–æ–º–µ –±–æ–Ω—É—Å–æ–≤. –ú—ã –Ω–µ –≤–∏–¥–µ–ª–∏ –Ω–∏ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `transfer()` –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–µ –≤—Å–µ–≥–æ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `absorb()`.

**–í —á–µ–º –∂–µ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è —Å—Ç–∏–º—É–ª –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –ª–∏–∫–≤–∏–¥–∞—Ç–æ—Ä—É –µ–≥–æ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é?** –û—Ç–≤–µ—Ç –ø—Ä–æ—Å—Ç, –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–∫—É–ø–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–ª–æ–≥–æ–≤—ã–µ –∞–∫—Ç–∏–≤—ã –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ —Å–∫–∏–¥–∫–æ–π. –î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π [buyCollateral()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L1247).

```solidity
function buyCollateral(address asset, uint minAmount, uint baseAmount, address recipient) override external nonReentrant {
    if (isBuyPaused()) revert Paused();

    // –†–µ–∑–µ—Ä–≤—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –±–µ—Ä–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
    int reserves = getReserves();
    // –ü—Ä–æ—Ç–æ–∫–æ–ª –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤—ã–∫—É–ø –∑–∞–ª–æ–≥–∞, –µ—Å–ª–∏ —Ä–µ–∑–µ—Ä–≤–æ–≤ –Ω–∞–∫–æ–ø–∏—Ç—å—Å—è –±–æ–ª—å—à–µ, —á–µ–º —Ü–µ–ª–µ–≤–∞—è –æ—Ç–º–µ—Ç–∫–∞
    if (reserves >= 0 && uint(reserves) >= targetReserves) revert NotForSale();

    // –°–ø–∏—Å—ã–≤–∞–µ—Ç —Å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤
    baseAmount = doTransferIn(baseToken, msg.sender, baseAmount);

    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∏—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª—å
    uint collateralAmount = quoteCollateral(asset, baseAmount);
    if (collateralAmount < minAmount) revert TooMuchSlippage();
    if (collateralAmount > getCollateralReserves(asset)) revert InsufficientReserves();

    // –û—Ç–ø—Ä–∞–≤–∏—Ç –∫—É–ø–ª–µ–Ω–Ω—ã–π –∞–∫—Ç–∏–≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é
    doTransferOut(asset, recipient, safe128(collateralAmount));

    emit BuyCollateral(msg.sender, asset, baseAmount, collateralAmount);
}
```

–°–∫–∏–¥–∫–∞ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ [quoteCollateral()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L1274).

–ü–æ–¥—ã—Ç–æ–∂–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –º–æ–∂–Ω–æ —Ç–µ–º, —á—Ç–æ –ø–æ –∏—Ç–æ–≥—É, –ª–∏–∫–≤–∏–¥–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å `absorb()` –∏ `buyCollateral()`.

Compound v3 –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –±–∞–∑–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ª–∏–∫–≤–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ [–±–æ—Ç–∞](https://github.com/compound-finance/comet/tree/main/contracts/liquidator).

## Interest Rates

–ü—Ä–æ—Ç–æ–∫–æ–ª –Ω–∞—á–∏—Å–ª—è–µ—Ç –¥–≤–∞ –≤–∏–¥–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤:

- **–ó–∞ –∑–∞–µ–º.** –ó–∞–µ–º—â–∏–∫ –ø–ª–∞—Ç–∏—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã –ø—Ä–æ—Ç–æ–∫–æ–ª—É –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞–π–º–∞.
- **–ó–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.** –ü—Ä–æ—Ç–æ–∫–æ–ª –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.
–ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Å —Ç–µ—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≥–æ–¥–æ–≤—ã–µ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ (APR).

![](./images/compound-v3-interest-rates-etherscan.png)

–ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—É—á–∏–º `borrowPerSecondInterestRateBase()` —Å etherscan. –ù–∞–º –≤–µ—Ä–Ω–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ `475646879`. –ö–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ? –í –≥–æ–¥—É, —Å–æ–≥–ª–∞—Å–Ω–æ Compound, —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è `31536000` —Å–µ–∫—É–Ω–¥. –¢–æ–≥–¥–∞ –∑–∞ –≥–æ–¥ –Ω–∞–∫–∞–ø–∞–µ—Ç 475646879 * 31536000 = 1.5e+16. —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è —ç—Ç–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ 1e18. –ò —Ç–æ–≥–æ, –ø–µ—Ä–µ–≤–æ–¥—è —ç—Ç–æ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç—ã, –º—ã –ø–æ–ª—É—á–∏–º 1.5% –¥–ª—è borrowInterestRate.

–í–∞–∂–Ω—ã–º –æ—Ç–ª–∏—á–∏–µ–º –æ—Ç –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ borrowRate —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ñ–æ—Ä–º—É–ª–µ –∫—Ä–∏–≤–æ–π –∏ –Ω–∏–∫–∞–∫ –Ω–µ —Å–≤—è–∑–∞–Ω —Å supplyRate. –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —ç—Ç–æ–≥–æ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –∑–∞ –º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä kink, –ø—Ä–æ—Ç–æ–∫–æ–ª –∏–º–µ–µ—Ç –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö [supplyKink](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L33C41-L33C42) –∏ [borrowKink](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L49).

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [getSupplyRate()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L449) –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ `Comet.sol`.

```solidity
// –¢–µ–∫—É—â–∏–π utilization –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤—ã–∑–≤–∞–≤ —Ñ—É–Ω–∫—Ü–∏—é getUtilization()
function getSupplyRate(uint utilization) override public view returns (uint64) {
    if (utilization <= supplyKink) {
        // interestRateBase + interestRateSlopeLow * utilization
        return safe64(supplyPerSecondInterestRateBase + mulFactor(supplyPerSecondInterestRateSlopeLow, utilization));
    } else {
        // interestRateBase + interestRateSlopeLow * kink + interestRateSlopeHigh * (utilization - kink)
        return safe64(supplyPerSecondInterestRateBase + mulFactor(supplyPerSecondInterestRateSlopeLow, supplyKink) + mulFactor(supplyPerSecondInterestRateSlopeHigh, (utilization - supplyKink)));
    }
}
```

–§—É–Ω–∫—Ü–∏—è [getUtilization()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L478) –ø—Ä–æ—Å—Ç–∞, –æ–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–∞ –≤ –∑–∞–π–º–µ –∫ –≤—Å–µ–º—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–º—É –∞–∫—Ç–∏–≤—É –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.

```solidity
function getUtilization() override public view returns (uint) {
    uint totalSupply_ = presentValueSupply(baseSupplyIndex, totalSupplyBase);
    uint totalBorrow_ = presentValueBorrow(baseBorrowIndex, totalBorrowBase);
    if (totalSupply_ == 0) {
        return 0;
    } else {
        return totalBorrow_ * FACTOR_SCALE / totalSupply_;
    }
}
```

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –∑–∞–π–º–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [getBorrowRate()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L464) –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ `Comet.sol`.

```solidity
// –¢–µ–∫—É—â–∏–π utilization –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤—ã–∑–≤–∞–≤ —Ñ—É–Ω–∫—Ü–∏—é getUtilization()
function getBorrowRate(uint utilization) override public view returns (uint64) {
    if (utilization <= borrowKink) {
        // interestRateBase + interestRateSlopeLow * utilization
        return safe64(borrowPerSecondInterestRateBase + mulFactor(borrowPerSecondInterestRateSlopeLow, utilization));
    } else {
        // interestRateBase + interestRateSlopeLow * kink + interestRateSlopeHigh * (utilization - kink)
        return safe64(borrowPerSecondInterestRateBase + mulFactor(borrowPerSecondInterestRateSlopeLow, borrowKink) + mulFactor(borrowPerSecondInterestRateSlopeHigh, (utilization - borrowKink)));
    }
}
```

## Rewards

–£—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–∞—é—Ç—Å—è —Ç–æ–∫–µ–Ω–∞–º–∏ COMP –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ Compound.

–ö–æ–Ω—Ç—Ä–∞–∫—Ç `Comet.sol` –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —É—á–∞—Å—Ç–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∂–∏–∑–Ω–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏ –∑–∞–π–º—ã), –Ω–æ –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º –≤—ã–¥–∞—á–∏ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç [CometRewards.sol](https://github.com/compound-finance/comet/blob/main/contracts/CometRewards.sol), –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç `Comet.sol` –∏ –≤—ã–ø—É—Å–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã COMP.

![](./images/compound-v3-claim-rewards.png)

–°–∫–æ—Ä–æ—Å—Ç—å, —Å –∫–æ—Ç–æ—Ä–æ–π –≤—ã–¥–∞—é—Ç—Å—è –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è, –æ–±—ä—è–≤–ª—è–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ `CometRewards.sol`, –∫–æ—Ç–æ—Ä—ã–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ [DAO](https://github.com/compound-finance/comet/blob/main/contracts/CometRewards.sol#L67).

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [getRewardOwed()](https://github.com/compound-finance/comet/blob/main/contracts/CometRewards.sol#L146). –≠—Ç–æ –Ω–µ view —Ñ—É–Ω–∫—Ü–∏—è, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∞ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É `Comet.sol`.

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–∞–µ—Ç—Å—è –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- [claim()](https://github.com/compound-finance/comet/blob/main/contracts/CometRewards.sol#L165)
- [claimTo()](https://github.com/compound-finance/comet/blob/main/contracts/CometRewards.sol#L175C14-L175C21)

–í —Ü–µ–ª–æ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É–±—Ä–∞–Ω—Å—Ç–≤–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ç–∞–∫–æ–µ –∂–µ –∫–∞–∫ –∏ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ `Comet.sol`.

![](./images/compound-v3-claim-rewards-call-stack.png)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [claim()](https://github.com/compound-finance/comet/blob/main/contracts/CometRewards.sol#L165C14-L165C19) –∏–ª–∏ [claimTo()](https://github.com/compound-finance/comet/blob/main/contracts/CometRewards.sol#L175) –Ω–∞ –≤—ã–±–æ—Ä, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤—ã–∑–æ–≤ —É—Ö–æ–¥–∏—Ç –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ñ—É–Ω–∫—Ü–∏—é [claimInternal()](https://github.com/compound-finance/comet/blob/main/contracts/CometRewards.sol#L184).

```solidity
function claimInternal(address comet, address src, address to, bool shouldAccrue) internal {
    // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å comet
    RewardConfig memory config = rewardConfig[comet];
    if (config.token == address(0)) revert NotSupported(comet);

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –∑–∞—Ä–∞–±–æ—Ç–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    if (shouldAccrue) {
        CometInterface(comet).accrueAccount(src);
    }

    uint claimed = rewardsClaimed[comet][src];
    uint accrued = getRewardAccrued(comet, src, config);

    if (accrued > claimed) {
        uint owed = accrued - claimed;
        // –§–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ, —Å–∫–æ–ª—å–∫–æ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è —É–∂–µ –≤—ã–ø–ª–∞—á–µ–Ω–æ
        rewardsClaimed[comet][src] = accrued;

        // –ü–µ—Ä–µ–≤–æ–¥ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        doTransferOut(config.token, to, owed);

        emit RewardClaimed(src, to, config.token, owed);
    }
}
```

–ö–æ–Ω—Ç—Ä–∞–∫—Ç `CometRewards.sol` –Ω–µ —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω COMP –Ω–∞ –≤—ã–∑–æ–≤ `claim()`, –ø–æ—ç—Ç–æ–º—É –∑–∞–¥–∞—á–∞ DAO –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–∞ COMP –Ω–∞ –±–∞–ª–∞–Ω—Å–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

_–í–∞–∂–Ω–æ!_ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–∞ COMP –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ, –ø–æ—ç—Ç–æ–º—É –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤—Å–µ–≥–¥–∞ —Ä–∞–∑–¥–∞–≤–∞—Ç—å –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –∑–∞ —É—á–∞—Å—Ç–∏–µ –≤ –∂–∏–∑–Ω–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

## cToken

–ú—ã –∏–∑—É—á–∏–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏ –∑–∞–π–º, –Ω–æ –Ω–∏–≥–¥–µ –Ω–µ —É–≤–∏–¥–µ–ª–∏ —Ç–∞–∫–æ–≥–æ –ø–æ–Ω—è—Ç–Ω–æ–≥–æ –∏ –ª–∞–º–ø–æ–≤–æ–≥–æ **cToken**, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ä–æ—à–æ –∑–Ω–∞–∫–æ–º –Ω–∞–º –ø–æ –≤—Ç–æ—Ä–æ–π –≤–µ—Ä—Å–∏–∏ compound. –ù–æ –≤–µ–¥—å —ç—Ç–æ—Ç —Ç–µ—Ä–º–∏–Ω  –º–æ–∂–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Compound. –ú—ã –≤–∏–¥–∏–º cUSDC —Å—Ä–µ–¥–∏ –∞–¥—Ä–µ—Å–æ–≤ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

![](./images/compound-v3-cusdc.png)

–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ cToken –Ω–∏–∫—É–¥–∞ –Ω–µ –¥–µ–ª—Å—è, –æ–Ω –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–ª—Å—è –ø–æ–¥ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç `Comet.sol`. –ï—Å–ª–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —ç—Ç–æ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç, —Ç–æ –º–æ–∂–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å —Ü–µ–ª—ã–π —Ä—è–¥ —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–∏—Å—É—â–∏—Ö ERC-20 —Ç–æ–∫–µ–Ω—É –∏ –æ—Ç–≤–µ—á–∞—é—â–∏—Ö –∑–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä:
- [transfer()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L933)
- [transferFrom()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L945)
- [transferAsset()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L956C14-L956C27)
- [transferAssetFrom()](https://github.com/compound-finance/comet/blob/main/contracts/Comet.sol#L967)

–ù—É –∞ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ ERC-20 –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ `Comet.sol` –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º [CometExt.sol](https://github.com/compound-finance/comet/blob/main/contracts/CometExt.sol). –≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏: name(), approve(), symbol() –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –ò–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –≤—ã–∑–æ–≤ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–∑–æ–≤ (delegateCall), etherscan –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ `Comet.sol`.

## –í—ã–≤–æ–¥

–ù–∞ –º–æ–π —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω—ã–π –≤–∑–≥–ª—è–¥, Compound v3 - —ç—Ç–æ —Å–∞–º–∞—è –ø—Ä–æ—Å—Ç–∞—è, —ç–ª–µ–≥–∞–Ω—Ç–Ω–∞—è –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞ —Å—Ä–µ–¥–∏ lending –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ —è –≤–∏–¥–µ–ª. –ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —á–∏—Ç–∞—Ç—å –∏ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –∫–æ–¥–µ Compound v3. –ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, —á—Ç–æ –≤—Å—è –ª–æ–≥–∏–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤ –æ–¥–Ω–æ–º –≥–ª–∞–≤–Ω–æ–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ —Å –ø–æ–Ω—è—Ç–Ω–æ–π —Ü–µ–ø–æ—á–∫–æ–π –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, –µ–¥–∏–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏ –≤—Ö–æ–¥–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è. –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –ø–µ—Ä–≤–∏—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–∏–¥ —ç—Å—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è! –°—á–∏—Ç–∞—é, —á—Ç–æ compound v3 –º–æ–∂–µ—Ç –ø—Ä–µ—Ç–µ–Ω–¥–æ–≤–∞—Ç—å –Ω–∞ —ç—Ç–∞–ª–æ–Ω —Å—Ä–µ–¥–∏ –ø–æ–¥–æ–±–Ω—ã—Ö –ª–µ–Ω–¥–∏–Ω–≥–æ–≤.

–û–¥–Ω–∞–∫–æ –Ω–µ —Å—Ç–æ–∏—Ç –∑–∞–±—ã–≤–∞—Ç—å –æ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö –≤ –≤–∏–¥–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Ä—ã–Ω–∫–æ–≤, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–æ–≤ –ø–æ-—Ä–∞–∑–Ω—ã–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º `Comet.sol`. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫–∏ –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –≤ —Å–ª—É—á–∞–µ –≤–∑–ª–æ–º–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞. –•–æ—Ç—å —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞—É–¥–∏—Ç—ã, –Ω–∏–∫—Ç–æ –æ—Ç —ç—Ç–æ–≥–æ –Ω–µ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω. –ë–æ–ª–µ–µ —Ç–æ–≥–æ, —Ç–∞–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º.

## Links

1. Github [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π](https://github.com/compound-finance/comet)
2. –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.compound.finance/)
3. [–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫](https://www.rareskills.io/post/aave-interest-rate-model)
4. [–ö–Ω–∏–≥–∞](https://www.rareskills.io/compound-v3-book) Compound V3 –æ—Ç RareSkills. –°—Ç–∞–ª–∞ –±–∞–∑–æ–π –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –±–æ–ª—å—à–µ, —Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å—é–¥–∞.