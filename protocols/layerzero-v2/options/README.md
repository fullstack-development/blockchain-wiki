# –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º LayerZero v2. –ß–∞—Å—Ç—å 3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (options), –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏, PreCrime

**–ê–≤—Ç–æ—Ä:** [–†–æ–º–∞–Ω –Ø—Ä–ª—ã–∫–æ–≤](https://github.com/rlkvrv) üßê  

–í –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –æ–ø—Ü–∏–∏, –∫–∞–∫–∏–µ –æ–Ω–∏ –±—ã–≤–∞—é—Ç –∏ –¥–ª—è —á–µ–≥–æ –Ω—É–∂–Ω—ã. –¢–∞–∫–∂–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å PreCrime.

## –ö–∞–∫–∏–µ –±—ã–≤–∞—é—Ç –æ–ø—Ü–∏–∏ –∏ –∫–∞–∫ –æ–Ω–∏ —É—Å—Ç—Ä–æ–µ–Ω—ã?  

–ü—Ä–æ—Ç–æ–∫–æ–ª LayerZero —Å–æ–¥–µ—Ä–∂–∏—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –û–¥–Ω–∞ –∏–∑ —Ç–∞–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π ‚Äî **options**.  

–ú—ã —É–∂–µ –Ω–µ–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `options` –≤ —Å–∞–º–æ–π –ø—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä —Ç–∞–∫:  

```solidity
uint128 GAS_LIMIT = 50000; // gasLimit –¥–ª—è Executor
uint128 MSG_VALUE = 0; // msg.value –¥–ª—è lzReceive() (wei)

bytes memory options = OptionsBuilder.newOptions().addExecutorLzReceiveOption(GAS_LIMIT, MSG_VALUE);
```

–ó–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ü–∏–π –æ—Ç–≤–µ—á–∞–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ [`OptionsBuilder`](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oapp-evm/contracts/oapp/libs/OptionsBuilder.sol).  –ü–µ—Ä–≤–æ–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç `OptionsBuilder`, —ç—Ç–æ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `newOptions`.


```solidity
function newOptions() internal pure returns (bytes memory) {
    return abi.encodePacked(TYPE_3);
}
```

–ö–æ–Ω—Ç—Ä–∞–∫—Ç `OFTCore` –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `OAppOptionsType3`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ **–≤—Å–µ –æ–ø—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–∏–ø–∞ `TYPE_3`** —á–µ—Ä–µ–∑ `_assertOptionsType3`.  

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, `OptionsBuilder::addExecutorLzReceiveOption` –∏–º–µ–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä `onlyType3`.  

–ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TYPE_1` –∏ `TYPE_2`? –≠—Ç–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏ –æ–ø—Ü–∏–π –∏–∑ LayerZero v1. –í LayerZero v2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `TYPE_3`, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –±–æ–ª–µ–µ –≥–∏–±–∫–∏–π –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.  

### –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞  

–û–ø—Ü–∏–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤:  
- `TYPE_1` ‚Äî —Å–æ–¥–µ—Ä–∂–∞–ª —Ç–æ–ª—å–∫–æ `gasLimit`.  
- `TYPE_2` ‚Äî –¥–æ–±–∞–≤–ª—è–ª –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ (`native drop`).  
- `TYPE_3` ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ü–∏–∏.  

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `TYPE_3` —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:  
- —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞,  
- ID –≤–æ—Ä–∫–µ—Ä–∞,  
- —Ä–∞–∑–º–µ—Ä–∞ –æ–ø—Ü–∏–π,  
- —Ç–∏–ø–∞ –æ–ø—Ü–∏–π,  
- —Å–∞–º–∏—Ö –æ–ø—Ü–∏–π.  

–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ç–∏–ø –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (`TYPE_3`):  

![option-type-3-1](./img/options-type-3-1.png)  

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —Å–∞–º–∏ –æ–ø—Ü–∏–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ `addExecutorLzReceiveOption` –¥–∞–Ω–Ω—ã–µ –∫–æ–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `ExecutorOptions`:  

```solidity
// OptionsBuilder library
function addExecutorLzReceiveOption(
    bytes memory _options,
    uint128 _gas,
    uint128 _value
) internal pure onlyType3(_options) returns (bytes memory) {
    bytes memory option = ExecutorOptions.encodeLzReceiveOption(_gas, _value);
    return addExecutorOption(_options, ExecutorOptions.OPTION_TYPE_LZRECEIVE, option);
}

// ---------------------------------------------------------

// ExecutorOptions library
function encodeLzReceiveOption(uint128 _gas, uint128 _value) internal pure returns (bytes memory) {
    return _value == 0 ? abi.encodePacked(_gas) : abi.encodePacked(_gas, _value);
}
```

–ó–¥–µ—Å—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è `GAS_LIMIT` –∏ `MSG_VALUE`:  

![options-type-3-5](./img/options-type-3-5.png)  

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è ID –≤–æ—Ä–∫–µ—Ä–∞, —Ä–∞–∑–º–µ—Ä –∏ —Ç–∏–ø –æ–ø—Ü–∏–∏:  

```solidity
function addExecutorOption(
    bytes memory _options,
    uint8 _optionType,
    bytes memory _option
) internal pure onlyType3(_options) returns (bytes memory) {
    return abi.encodePacked(
        _options,
        ExecutorOptions.WORKER_ID,
        _option.length.toUint16() + 1, // —Ä–∞–∑–º–µ—Ä –æ–ø—Ü–∏–∏ + 1 –±–∞–π—Ç –¥–ª—è —Ç–∏–ø–∞
        _optionType,
        _option
    );
}
```

–ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:  
- **Worker ID** (–Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –∏—Ö –≤—Å–µ–≥–æ –¥–≤–∞):
  - Executor (`id = 1`) ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–ø—Ü–∏–∏ —á–µ—Ä–µ–∑ [`ExecutorOptions`](https://github.com/LayerZero-Labs/LayerZero-v2/blob/main/packages/layerzero-v2/evm/messagelib/contracts/libs/ExecutorOptions.sol).  
  - DVN (`id = 2`) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [`DVNOptions`](https://github.com/LayerZero-Labs/LayerZero-v2/blob/main/packages/layerzero-v2/evm/messagelib/contracts/uln/libs/DVNOptions.sol).  
- **Option Type** (–ø–æ–∫–∞ –∏—Ö 5):  
  - `OPTION_TYPE_LZRECEIVE` = 1  
  - `OPTION_TYPE_NATIVE_DROP` = 2  
  - `OPTION_TYPE_LZCOMPOSE` = 3  
  - `OPTION_TYPE_ORDERED_EXECUTION` = 4  
  - `OPTION_TYPE_LZREAD` = 5  

–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `addExecutorLzReceiveOption`:  
- `worker id = 1` (Executor)  
- `option type = 1` (`OPTION_TYPE_LZRECEIVE`)  
- `option length = 17` (gasLimit = 16 –±–∞–π—Ç + 1 –±–∞–π—Ç type)  

–ï—Å–ª–∏ `value > 0`, –¥–ª–∏–Ω–∞ `option` –±—É–¥–µ—Ç –±–æ–ª—å—à–µ (`gasLimit 16 + value 16 + type 1 = 33 –±–∞–π—Ç–∞`). –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –Ω—É–ª–µ–≤–æ–π `value` –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è.
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –æ–ø—Ü–∏–π –±—É–¥–µ—Ç —Ç–∞–∫–æ–π:  

```bash
0003 01 0011 01 0000000000000000000000000000c350

opt.type | work.id | ex.opt.type.length | ex.opt.type |         option          |
uint16   | uint8   | uint16             | uint8       | uint128         | 0     |
3        | 1       | 17                 | 1           | 50000 (gasLimit)| value |
```

![options-type-3-2-4](./img/options-type-3-2-4.png)  
*–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ TYPE_3*  

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏—è –æ–ø—Ü–∏–π  

–î—Ä—É–≥–∏–µ –æ–ø—Ü–∏–∏ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ [`OptionsBuilder`](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oapp-evm/contracts/oapp/libs/OptionsBuilder.sol).  

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–∏–¥—ã –æ–ø—Ü–∏–π –≤ [Remix](https://remix.ethereum.org/#url=https://docs.layerzero.network/LayerZero/contracts/OptionsGenerator.sol&lang=en&optimize=false&runs=200&evmVersion=null&version=soljson-v0.8.26+commit.8a97fa7a.js).

#### –†–∞–±–æ—Ç–∞ —Å gasLimit  

–ü–∞—Ä–∞–º–µ—Ç—Ä `gasLimit` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞ –≥–∞–∑–∞ –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è. "–°—Ç–æ–∏–º–æ—Å—Ç—å" –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–∫–æ–¥–æ–≤ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –±–ª–æ–∫—á–µ–π–Ω–∞—Ö, –ø–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–π —Å–µ—Ç–∏.  

–£ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫—á–µ–π–Ω–∞ –µ—Å—Ç—å **–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –≥–∞–∑–∞** (`nativeCap`), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ —Å–µ—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è. –ü–æ–ª—É—á–∏—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ `Executor::dstConfig(dstEid)`, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É `DstConfig`:  

```solidity
struct DstConfig {
    uint64 baseGas;
    uint16 multiplierBps;
    uint128 floorMarginUSD;
    uint128 nativeCap;
}
```

- **`baseGas`** ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≥–∞–∑–∞ –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (`lzReceive`, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å—Ç–µ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏). –≠—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞ –¥–ª—è —Å–∞–º–æ–≥–æ –º–∞–ª–µ–Ω—å–∫–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.  
- **`multiplierBps`** ‚Äî –º–Ω–æ–∂–∏—Ç–µ–ª—å –≤ **–±–∞–∑–∏—Å–Ω—ã—Ö –ø—É–Ω–∫—Ç–∞—Ö** (1 bps = 0,01%). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥–∞–∑–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è.  
- **`floorMarginUSD`** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç–∞ –≤ USD –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ø–∞–º–∞ –∏ –ø–æ–∫—Ä—ã—Ç–∏—è –∑–∞—Ç—Ä–∞—Ç. –ï—Å–ª–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ USD –Ω–∏–∂–µ —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, –æ–Ω–∞ **—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `floorMarginUSD`**.  
- **`nativeCap`** ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –≥–∞–∑–∞, –∫–æ—Ç–æ—Ä—ã–π OApp –º–æ–∂–µ—Ç —É–∫–∞–∑–∞—Ç—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.  

–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ, –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É:  

```bash
npx hardhat lz:oapp:config:get:executor
```

#### Native drop  

`Native drop` ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–¥–∞—á–∞ **–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤** –≤ —Å–µ—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ `addExecutorLzReceiveOption` –≤—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä (`MSG_VALUE`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ.  

–ï—Å—Ç—å —Ç–∞–∫–∂–µ –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ–ø—Ü–∏—è `addExecutorNativeDropOption`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `amount` (—Å—É–º–º—É) –∏ `receiver` (–∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è) –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É–∫–∞–∑–∞–Ω–∏—è `gasLimit`:  

```solidity
function addExecutorNativeDropOption(
    bytes memory _options,
    uint128 _amount,
    bytes32 _receiver
) internal pure onlyType3(_options) returns (bytes memory) {
    bytes memory option = ExecutorOptions.encodeNativeDropOption(_amount, _receiver);
    return addExecutorOption(_options, ExecutorOptions.OPTION_TYPE_NATIVE_DROP, option);
}
```

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:* –†–∞–Ω–µ–µ –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ –±—ã–ª–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ native drop - 0.5 —Ç–æ–∫–µ–Ω–∞ –≤ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ —Å–µ—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä ETH, BNB –∏ —Ç.–¥.). –ë–æ–ª–µ–µ —Ç–æ–≥–æ, –±—ã–ª–æ –ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏–µ, —á—Ç–æ —á–µ–º –±–æ–ª—å—à–µ —Å—É–º–º–∞, —Ç–µ–º –±–æ–ª—å—à–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –ø–µ—Ä–µ–¥–∞—á—É. –°–µ–π—á–∞—Å –æ–± —ç—Ç–æ–º –Ω–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π, –Ω–æ –Ω—É–∂–Ω–æ –∏–º–µ—Ç—å –≤ –≤–∏–¥—É —á—Ç–æ —Ç–∞–∫–æ–≥–æ —Ä–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–æ–∂–µ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å.

## PreCrime  

–í –∏—Å—Ö–æ–¥–Ω–æ–π —Å–µ—Ç–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π:  
- `quote`  
- `msgInspector`  
- `enforcedOptions`  

–ù–æ –≤ **—Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è** –≤—Å–µ —Å–ª–æ–∂–Ω–µ–µ, —Ç–∞–∫ –∫–∞–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥—Ä—É–≥–æ–≥–æ –±–ª–æ–∫—á–µ–π–Ω–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ.  

–í –±–∞–∑–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ OFT-—Ç–æ–∫–µ–Ω–∞ –æ—Å—Ç–∞–ª—Å—è –æ–¥–∏–Ω —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∫–æ—Ç–æ—Ä—ã–π –º—ã –Ω–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏ ‚Äî [`OAppPreCrimeSimulator`](https://github.com/LayerZero-Labs/devtools/blob/05443835db976b7a528b883b19ddf02cb7f36d89/packages/oapp-evm/contracts/precrime/OAppPreCrimeSimulator.sol).  

–≠—Ç–æ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å [`PreCrime`](https://github.com/LayerZero-Labs/devtools/blob/05443835db976b7a528b883b19ddf02cb7f36d89/packages/oapp-evm/contracts/precrime/PreCrime.sol). –ú–æ–¥—É–ª—å `PreCrime` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–æ—Ñ—á–µ–π–Ω-—Å–∏–º—É–ª—è—Ü–∏–∏ `_lzReceive`**, –ø–æ –∑–∞–¥—É–º–∫–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ä–∞–∑—É —Å–æ –≤—Å–µ–º–∏ —Å–µ—Ç—è–º–∏ –≥–¥–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. 

–ü—Ä–∏ —ç—Ç–æ–º –≤—ã–∑–æ–≤ `OAppPreCrimeSimulator::lzReceiveAndRevert` **–≤—Å–µ–≥–¥–∞** –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è `revert`, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∏–º—É–ª—è—Ü–∏–∏ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –æ—à–∏–±–∫–∏ `SimulationResult`, –∫—É–¥–∞ –æ–Ω–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `PreCrime::buildSimulationResult`.  

–≠—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–ª–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –Ω–æ **–≥–ª–∞–≤–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å** PreCrime ‚Äî –µ–≥–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–µ–∫–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –¢–æ –µ—Å—Ç—å —É –Ω–µ–≥–æ –µ—Å—Ç—å –ø–æ–ª–Ω–æ–º–æ—á–∏—è –æ—Ç–º–µ–Ω—è—Ç—å —Ç—Ä–Ω–∞–∑–∞–∫—Ü–∏–∏ –µ—â–µ –Ω–∞ —ç—Ç–∞–ø–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ –∫–∞–Ω–∞–ª–µ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö.

–ë—ç–∫–µ–Ω–¥ –º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `PreCrime` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞. –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –æ–Ω–∞ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –≤ `MessagingChannel`, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø–æ–ø–∞–¥–µ—Ç –≤ Executor.

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ –∏—Ç–æ–≥—É —Ç—Ä–µ—Ö —Å—Ç–∞—Ç–µ–π —É –≤–∞—Å –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ —Å–ª–æ–∂–∏—Ç—å—Å—è –±–æ–ª–µ–µ –ø–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ OApp –≤ —Ü–µ–ª–æ–º –∏ OFT –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –∞ —Ç–∞–∫–∂–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –≥–∞–∑ –∏ –∫–∞–∫–∏–µ –≤—ã–±—Ä–∞—Ç—å –æ–ø—Ü–∏–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.

–í –ø—Ä–æ—Ç–æ–∫–æ–ª–µ LayerZero –µ—Å—Ç—å –µ—â–µ –º–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç–∞ —Å –∫–æ–º–∏—Å—Å–∏—è–º–∏ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–≤–æ–µ–≥–æ Executor, –æ—Ç–ø—Ä–∞–≤–∫–∞ `compose` —Å–æ–æ–±—â–µ–Ω–∏–π, lzRead –¥–ª—è –æ—Ñ—á–µ–π–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –¥—Ä—É–≥–æ–µ. –ü–æ—ç—Ç–æ–º—É –¥–∞–Ω–Ω–∞—è —Å–µ—Ä–∏—è —Å—Ç–∞—Ç–µ–π —è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ—á–∫–æ–π —Å—Ç–∞—Ä—Ç–∞, —á—Ç–æ–±—ã —Ö–æ—Ç—è –±—ã –Ω–µ–º–Ω–æ–≥–æ —Å–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥ –≤—Ö–æ–¥–∞ –≤ —Ä–∞–±–æ—Ç—É —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º. 

## –°—Å—ã–ª–∫–∏  
- [GitHub: LayerZero v2](https://github.com/LayerZero-Labs/LayerZero-v2)  
- [GitHub: LayerZero-Labs/devtools](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oft-evm/contracts)  
- [Docs: LayerZero v2](https://docs.layerzero.network/v2)  