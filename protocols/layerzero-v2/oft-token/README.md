# –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º LayerZero v2. –ß–∞—Å—Ç—å 2. OFT-—Ç–æ–∫–µ–Ω  

**–ê–≤—Ç–æ—Ä:** [–†–æ–º–∞–Ω –Ø—Ä–ª—ã–∫–æ–≤](https://github.com/rlkvrv) üßê  

–í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ —è –ø–æ–∫–∞–∂—É, –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –æ–º–Ω–∏—á–µ–π–Ω-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –±–∞–∑–µ LayerZero v2. –í –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–º–µ—Ä–∞ –º—ã –Ω–∞–ø–∏—à–µ–º OFT (Omnichain Fungible Token) —Ç–æ–∫–µ–Ω.  

–û–±–∑–æ—Ä –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∏ whitepaper —è —Å–¥–µ–ª–∞–ª –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç–∞—Ç—å–µ (—Ç–∞–º –∂–µ –æ–±—ä—è—Å–Ω—è–µ—Ç—Å—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –æ–º–Ω–∏—á–µ–π–Ω-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π). –ó–¥–µ—Å—å –º—ã —Å—Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –∫–æ–¥–µ. 

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:* —É LayerZero —Ö–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –ø–æ—ç—Ç–æ–º—É, —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è, —è –±—É–¥—É –∏–Ω–æ–≥–¥–∞ –æ—Ç—Å—ã–ª–∞—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è –∫ –Ω–µ–π. –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∏ –Ω–µ —Å–∞–º—ã–µ –æ—á–µ–≤–∏–¥–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã.  

–ó–∞–¥–∞—á–∞ —Å—Ç–∞—Ç—å–∏ ‚Äî –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å –≤–∞—Å —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ –∏ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–π OFT, —á—Ç–æ–±—ã –ø—Ä–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –≤—Å–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å LayerZero –∏ –ø–æ–Ω—è—Ç—å, –Ω–∞ —á—Ç–æ —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—â–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ.

–¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è:
- **–ò—Å—Ö–æ–¥–Ω–∞—è —Å–µ—Ç—å** - –±–ª–æ–∫—á–µ–π–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∏–π –¥–∞–Ω–Ω—ã–µ –≤ –¥—Ä—É–≥—É—é —Å–µ—Ç—å.  
- **–°–µ—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è** - –±–ª–æ–∫—á–µ–π–Ω, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–π —Å–µ—Ç–∏.
- **OApp** (Omnichain Application) - –æ–º–∏–Ω—á–µ–π–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∏–º–µ—é—â–µ–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.
- **OFT** (Omnichain Fungible Token) - –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã–π –æ–º–Ω–∏—á–µ–π–Ω —Ç–æ–∫–µ–Ω.
- **EID** - Endpoint ID. Endpoint - —ç—Ç–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∏ –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª—é–±–æ–π —Å–µ—Ç–∏.
- **ZRO** - utility-—Ç–æ–∫–µ–Ω –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã LayerZero, –∞ —Ç–∞–∫–∂–µ —Ç–æ–∫–µ–Ω –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è.
- **Executor** - –æ–Ω –∂–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø–æ –¥–æ—Å—Ç–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.

## OFT-—Ç–æ–∫–µ–Ω  

–í –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞—Ç—å–µ (—á–∞—Å—Ç—å 1) –º—ã —Å–æ–∑–¥–∞–ª–∏ –±–∞–∑–æ–≤–æ–µ –æ–º–Ω–∏—á–µ–π–Ω-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ú–∏–Ω—É—Å —ç—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—ã–ª –≤ —Ç–æ–º, —á—Ç–æ –æ–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ (–ø–æ—Ç–æ–º—É —á—Ç–æ `SourceOApp` –Ω–∞—Å–ª–µ–¥–æ–≤–∞–ª—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç `OAppSender`, –∞ `DestinationOApp` –æ—Ç `OAppReceiver`). –ö–æ–Ω–µ—á–Ω–æ –∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–µ–ª–∞—Ç—å —Ç–∞–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º–∏, —á—Ç–æ–±—ã –æ–Ω–∏ –º–æ–≥–ª–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å, –∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è. OApp-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª—é–±—É—é –ª–æ–≥–∏–∫—É –∏ –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.  

–û–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ‚Äî **OFT-—Ç–æ–∫–µ–Ω**. –ü—Ä–æ—Ç–æ–∫–æ–ª LayerZero —É–∂–µ –ø—Ä–æ–¥—É–º–∞–ª, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–∫–æ–π —Ç–æ–∫–µ–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç **OFT**. –≠—Ç–æ ERC20-—Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –ª—é–±–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –±–ª–æ–∫—á–µ–π–Ω–æ–≤. –ß—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –Ω–æ–≤—ã–π –±–ª–æ–∫—á–µ–π–Ω, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ –Ω–µ–º –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ OApp –∏ –ø—Ä–∏–≤—è–∑–∞—Ç—å –µ–≥–æ –∫ –æ—Å—Ç–∞–ª—å–Ω—ã–º.  

–í–æ–∑–Ω–∏–∫–∞–µ—Ç –ª–æ–≥–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å: —á–µ–º —ç—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –º–æ—Å—Ç–∞? –Ø —É–∂–µ –æ—Ç–≤–µ—á–∞–ª –Ω–∞ –Ω–µ–≥–æ –≤ –æ–±–∑–æ—Ä–Ω–æ–π —Å—Ç–∞—Ç—å–µ, –Ω–æ –µ—Å–ª–∏ –∫–æ—Ä–æ—Ç–∫–æ ‚Äî –≥–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ –≤ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–æ–≤.  

### –ü—Ä–∏–º–µ—Ä USDT0  

–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ OFT-—Ç–æ–∫–µ–Ω–∞ ‚Äî [USDT0](https://usdt0.to/). –≠—Ç–æ —Ö–æ—Ä–æ—à–æ –∑–Ω–∞–∫–æ–º—ã–π –≤—Å–µ–º Tether USD (USDT), –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–≤–æ–π —Ç–æ–∫–µ–Ω –Ω–∞ **OFT-—Ä–µ–ª—å—Å—ã**. –í–æ–∑–º–æ–∂–Ω–æ, –∫–æ–≥–¥–∞ –≤—ã —á–∏—Ç–∞–µ—Ç–µ —ç—Ç—É —Å—Ç–∞—Ç—å—é, —Ç–æ–∫–µ–Ω USDT —É–∂–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ USDT0 –≤–æ –≤—Å–µ—Ö —Å–µ—Ç—è—Ö, –∫—Ä–æ–º–µ Ethereum. –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–ª–æ–∫—á–µ–π–Ω–∞—Ö.  

–í —Å–ª—É—á–∞–µ —Å USDT0 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ **OFTAdapter** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –±–ª–æ–∫–∏—Ä—É–µ—Ç/—Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–æ–∫–µ–Ω –≤ –±–∞–∑–æ–≤–æ–π —Å–µ—Ç–∏, –∞ –≤–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫—á–µ–π–Ω–∞—Ö ‚Äî –º–∏–Ω—Ç–∏—Ç/—Å–∂–∏–≥–∞–µ—Ç. OFTAdapter –Ω–µ–æ–±—Ö–æ–¥–∏–º, –µ—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –æ–±—ã—á–Ω—ã–π ERC20-—Ç–æ–∫–µ–Ω, –Ω–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –µ–≥–æ –≤ OFT.  

![usdt0](./img/usdt0.png)  
*–ò—Å—Ç–æ—á–Ω–∏–∫: –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è USDT0*  

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —É –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ GitHub-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –Ω–æ –≤—Å–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã, –∏ –∫–æ–¥ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –±–ª–æ–∫—á–µ–π–Ω-—ç–∫—Å–ø–ª–æ—Ä–µ—Ä–∞—Ö (—Å—Å—ã–ª–∫–∏ [–∑–¥–µ—Å—å](https://docs.usdt0.to/technical-documentation/developer#id-3.-deployments)). –¢–∞–∫–∂–µ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø–æ –∞—É–¥–∏—Ç—É USDT0 ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –Ω–∏–º–∏ [—Ç—É—Ç](https://github.com/Everdawn-Labs/usdt0-audit-reports). –í –Ω–∏—Ö –º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.  

## –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è OFT-—Ç–æ–∫–µ–Ω–∞?  

–°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å OFT-—Ç–æ–∫–µ–Ω –¥–ª—è LayerZero ‚Äî [—Å–æ–∑–¥–∞—Ç—å](https://docs.layerzero.network/v2/developers/evm/oft/quickstart) –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–≤–æ–µ–π –º–∞—à–∏–Ω–µ —á–µ—Ä–µ–∑ npm. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É:  

```bash
npx create-lz-oapp@latest
```  

–ó–∞—Ç–µ–º –≤—ã–±–∏—Ä–∞–µ–º **OFT**.  

![create-lz-oapp](./img/create-lz-oapp.png)  

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –º—ã –ø–æ–ª—É—á–∏–º –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç —Å OFT-—Ç–æ–∫–µ–Ω–æ–º. –ü—Ä–∏—á–µ–º –æ–Ω **–∏–∑ –∫–æ—Ä–æ–±–∫–∏** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ Hardhat, —Ç–∞–∫ –∏ Foundry, —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ —É–¥–æ–±–Ω–æ. –û—Å—Ç–∞–Ω–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–µ–π–º–∏–Ω–≥, –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ç—è—Ö. –í –ø—Ä–æ–µ–∫—Ç–µ —É–∂–µ –µ—Å—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –¥–µ–ø–ª–æ—è, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≥–∞–∑–∞.  

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ OFT-—Ç–æ–∫–µ–Ω–∞  

–ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ OFT –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:  

![oapp-inherits-docs](./img/oapp-inherits-docs.png)  
*–ò—Å—Ç–æ—á–Ω–∏–∫: –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è LayerZero*  

–ù–æ –µ—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ OFT-—Ç–æ–∫–µ–Ω –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ, –æ–Ω –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —á—É—Ç—å –±–æ–ª—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ —è –Ω–∞–ø–∏—Å–∞–ª —Ç–æ–∫–µ–Ω [MetaLampOFTv1](./contracts/contracts/MetaLampOFTv1.sol). –ß–∏—Ç–∞—Ç—å —Å—Ö–µ–º—É **—Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö**.  

![oapp-inherits](./img/oapp-inherits.png)  
*–°—Ö–µ–º–∞ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è OFT-—Ç–æ–∫–µ–Ω–∞*  

–ó–¥–µ—Å—å –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –¥–≤–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ ‚Äî [OAppPreCrimeSimulator](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oapp-evm/contracts/precrime/OAppPreCrimeSimulator.sol) –∏ [OAppOptionsType3](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oapp-evm/contracts/oapp/libs/OAppOptionsType3.sol), –æ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º —á—É—Ç—å –ø–æ–∑–∂–µ. –¢–∞–∫–∂–µ –≤–∏–¥–Ω–æ, —á—Ç–æ [OApp](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oapp-evm/contracts/oapp/OApp.sol) –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç [OAppSender](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oapp-evm/contracts/oapp/OAppSender.sol) –∏ [OAppReceiver](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oapp-evm/contracts/oapp/OAppReceiver.sol) –∏ –º–æ–∂–µ—Ç –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å, —Ç–∞–∫ –∏ –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è. [OAppCore](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oapp-evm/contracts/oapp/OAppCore.sol) –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∞–¥—Ä–µ—Å–æ–≤ `endpoint`, `delegate` –∏ `peers`.  

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:* –µ—Å–ª–∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç, –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [–∑–¥–µ—Å—å](./contracts/contracts/MetaLampOFTv1.sol). –î–ª—è —ç—Ç–æ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `pnpm install` –≤ –ø–∞–ø–∫–µ `protocols/layerzero-v2/smart-contracts/contracts`.  

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∑–∞–≥–ª—è–Ω—É—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π [LayerZero-Labs/devtools](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oft-evm/contracts) ‚Äî —Ç–∞–º –µ—Å—Ç—å –≤—Å–µ –ø—Ä–∏–º–µ—Ä—ã.

## –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª OFT  

–¢–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π **ERC20 OFT-—Ç–æ–∫–µ–Ω**:  

```solidity
// SPDX-License-Identifier: UNLICENSED

pragma solidity ^0.8.22;

import { Ownable } from "@openzeppelin/contracts/access/Ownable.sol";
import { OFT } from "@layerzerolabs/oft-evm/contracts/OFT.sol";

contract MetaLampOFTv1 is OFT {
    constructor(
        string memory _name,
        string memory _symbol,
        address _lzEndpoint,
        address _delegate
    ) OFT(_name, _symbol, _lzEndpoint, _delegate) Ownable(_delegate) {}
}
```

- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `_name` –∏ `_symbol` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ, —Ç–∞–∫ –∫–∞–∫ –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π —Å–µ—Ç–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Ç–æ–∫–µ–Ω–∞ (OApp).  
- `_lzEndpoint` ‚Äî —ç—Ç–æ –∞–¥—Ä–µ—Å Endpoint –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π LayerZero. –¢–æ –µ—Å—Ç—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π, –∞ —Ç–∞–∫–∂–µ –æ–ø–ª–∞—Ç—ã –∫–æ–º–∏—Å—Å–∏–π. –î–ª—è –∫–∞–∂–¥–æ–π —Å–µ—Ç–∏ –æ–Ω —Å–≤–æ–π.
- `_delegate` ‚Äî –∞–¥—Ä–µ—Å –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ç–æ–∫–µ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π —Ç–∞–∫–∂–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ OApp.  

–í —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —Ç–æ–∫–µ–Ω–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª—é–±—É—é –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, **Permit**). –ù–æ –≤—Å–µ, —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –º–µ—Ö–∞–Ω–∏–∫–∏ OFT, —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ `OFT`.  

–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç –≤ **OFT**, ‚Äî `_debit` –∏ `_credit`. –û–Ω–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç –±–∞–∑–æ–≤—É—é –º–µ—Ö–∞–Ω–∏–∫—É **mint/burn**, –Ω–æ –∏—Ö –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ —Ç–æ–∫–µ–Ω–∞.  

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–π —Å–µ—Ç–∏ (`send`)  

–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ ‚Äî [`OFTCore::send`](https://github.com/LayerZero-Labs/devtools/blob/05443835db976b7a528b883b19ddf02cb7f36d89/packages/oft-evm/contracts/OFTCore.sol#L175). –ï—Å–ª–∏ –ø–æ–º–Ω–∏—Ç–µ, –≤ –ø—Ä–∏–º–µ—Ä–µ —Å Remix —É –Ω–∞—Å —É–∂–µ –±—ã–ª–∞ –ø–æ—Ö–æ–∂–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –Ω–æ —Ç–µ–ø–µ—Ä—å –æ–Ω–∞ —Å—Ç–∞–ª–∞ —Å–ª–æ–∂–Ω–µ–µ:  

```solidity
function send(
    SendParam calldata _sendParam, // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
    MessagingFee calldata _fee, // –ö–æ–º–∏—Å—Å–∏—è –Ω–∞ –æ–ø–ª–∞—Ç—É –≥–∞–∑–∞ –∏ —Å—Ç–µ–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    address _refundAddress // –ê–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Å–µ—Ç–∏
) external payable virtual returns (
    MessagingReceipt memory msgReceipt, // –û—Å–Ω–æ–≤–Ω–æ–π —á–µ–∫ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    OFTReceipt memory oftReceipt // –î–æ–ø –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –¥–ª—è OFT
) { ... }
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏: 

```solidity
struct SendParam {
    uint32 dstEid;        // ID —Ü–µ–ª–µ–≤–æ–π —Å–µ—Ç–∏ –≤ LayerZero (–Ω–∞–ø—Ä–∏–º–µ—Ä, 30101 - Ethereum, 30343 - TON).
    bytes32 to;           // –ê–¥—Ä–µ—Å OApp –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.
    uint256 amountLD;     // –°—É–º–º–∞ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞–∫–∞—Ö decimals.
    uint256 minAmountLD;  // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Å—É–º–º–∞ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö decimals (–Ω–∞–ø—Ä–∏–º–µ—Ä –ø–æ—Å–ª–µ —Å–ø–∏—Å–∞–Ω–∏—è –∫–æ–º–∏—Å—Å–∏–π).
    bytes extraOptions;   // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –≤—ã–∑—ã–≤–∞—é—â–µ–π —Å—Ç–æ—Ä–æ–Ω–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞, –∫–æ—Ç. –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É).
    bytes composeMsg;     // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π), –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä swap —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏).
    bytes oftCmd;         // –ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è OFT, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö.
}
```

–¢–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç MessagingReceipt:

```solidity
struct MessagingReceipt {
    bytes32 guid; // GUID –¥–ª—è –æ–Ω—á–µ–π–Ω –∏ –æ—Ñ—Ñ—á–µ–π–Ω –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è.
    uint64 nonce; // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π nonce –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–µ–º –≤ –∫–∞–Ω–∞–ª–µ.
    MessagingFee fee; // –ö–æ–º–∏—Å—Å–∏—è –Ω–∞ –≥–∞–∑ –∏ –æ–ø–ª–∞—Ç—É —Å—Ç–µ–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
}
```

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `send`  

–ï—Å–ª–∏ –Ω–µ —É–≥–ª—É–±–ª—è—Ç—å—Å—è –≤ –¥–µ—Ç–∞–ª–∏, —Ñ—É–Ω–∫—Ü–∏—è `send` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã—Ö —à–∞–≥–∞:  

1. **–í—ã–∑—ã–≤–∞–µ—Ç `_debit`** ‚Äî —Å–∂–∏–≥–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥—Ä—É–≥—É—é –ª–æ–≥–∏–∫—É –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ —Å–µ—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–ø–æ–∫–∞ –º–æ–∂–Ω–æ –Ω–µ –æ–±—Ä–∞—â–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏—è –Ω–∞ LD –∏ SD amounts).  
2. **–§–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ** —á–µ—Ä–µ–∑ `_buildMsgAndOptions` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è OFT –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.  
3. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ** —á–µ—Ä–µ–∑ `_lzSend` ‚Äî —ç—Ç–æ –ø–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤ –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ **OApp**. –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —à–∞–≥–∏ –±—ã–ª–∏ –ª–∏—à—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π. `_lzSend` –ø–µ—Ä–µ–¥–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Endpoint –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –µ–º—É —Å—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–º–∏—Å—Å–∏–∏.  

–í–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `send` –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –∏ –¥—Ä—É–≥–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏. –í—Å–µ `internal`-–º–µ—Ç–æ–¥—ã –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –∏–º–µ—é—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä `virtual`, –ø–æ—ç—Ç–æ–º—É –∏—Ö –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤ —Å–≤–æ–µ–º OFT-—Ç–æ–∫–µ–Ω–µ.  

![oft-core-send-diagram](./img/oft-core-send-diagram.png)  
*–ì—Ä–∞—Ñ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `OFTCore::send`*  

–Ø —É—Å–ª–æ–≤–Ω–æ —Ä–∞–∑–¥–µ–ª–∏–ª –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–µ—Ç–∫–∏ ‚Äî —Ç–∞–∫ –ø—Ä–æ—â–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å –ø–æ —à–∞–≥–∞–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è.

##### Local Decimals –∏ Shared Decimals  

–¢–µ–ø–µ—Ä—å —Ä–∞–∑–±–µ—Ä–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤, –Ω–∞—á–∏–Ω–∞—è —Å —Å–ª—É–∂–µ–±–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π `_debitView` –∏ `_removeDust`, –∞ —Ç–∞–∫–∂–µ —Ç–∞–∫–∏—Ö –ø–æ–Ω—è—Ç–∏–π, –∫–∞–∫ **Local Decimals (LD)** –∏ **Shared Decimals (SD)**. –¢–æ –µ—Å—Ç—å –ø–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ **–≤–µ—Ç–∫–µ 1**.  

![oft-core-send-branch-1](./img/oft-core-send-branch-1.png)  
*–°–∂–∏–≥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è `amount`*  

–ó–∞—á–µ–º –Ω—É–∂–Ω—ã LD –∏ SD? –ß—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –±–ª–æ–∫—á–µ–π–Ω–∞–º–∏ (–≤–∫–ª—é—á–∞—è –Ω–µ-EVM —Å–µ—Ç–∏) –∏ –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å, –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–æ–≤ –≤ LayerZero –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `uint64` –∏ `decimals = 6`.  

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π `totalSupply` –º–æ–∂–µ—Ç –±—ã—Ç—å 18,446,744,073,709.551615.  

–§—É–Ω–∫—Ü–∏—é `OFTCore::sharedDecimals` –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —É–º–µ–Ω—å—à–∏–≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—å `sharedDecimals` –¥–æ 4, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –≤–æ–∑—Ä–∞—Å—Ç–µ—Ç –¥–æ 1,844,674,407,370,955.1615, –Ω–æ —Ç–æ—á–Ω–æ—Å—Ç—å —Å–Ω–∏–∑–∏—Ç—Å—è.  

–£–≤–µ–ª–∏—á–∏–≤–∞—Ç—å `sharedDecimals` –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è ‚Äî –∫–æ–º–∞–Ω–¥–∞ LayerZero –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∞ —Ç–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –∏ —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –µ–≥–æ —Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±–ª–æ–∫—á–µ–π–Ω–æ–≤.  

–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç? –ï—Å—Ç—å –¥–≤–∞ –∫–ª—é—á–µ–≤—ã—Ö —ç—Ç–∞–ø–∞:  

1. **–£–¥–∞–ª–µ–Ω–∏–µ "–ø—ã–ª–∏"** —á–µ—Ä–µ–∑ `_removeDust` ‚Äî —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –∑–Ω–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω–æ–≤ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.  
2. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è** –º–µ–∂–¥—É `local decimals` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–µ—Ç–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è) –∏ `shared decimals` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ).  

–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `decimalConversionRate`, –∫–æ—Ç–æ—Ä–∞—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ:  

```solidity
decimalConversionRate = 10 ** (_localDecimals - sharedDecimals());
```

**–ü—Ä–∏–º–µ—Ä:**  

–î–æ–ø—É—Å—Ç–∏–º, –≤ EVM-–±–ª–æ–∫—á–µ–π–Ω–∞—Ö —á–∞—â–µ –≤—Å–µ–≥–æ `decimals = 18`, —Ç–æ–≥–¥–∞:  
```solidity
decimalConversionRate = 10 ** (18 - 6) = 1_000_000_000_000
```

–ù–æ —á—Ç–æ –µ—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ **1 —Ç–æ–∫–µ–Ω**, —Å `decimals = 18`, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–π –æ—Å—Ç–∞—Ç–∫–∏ –∏ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫ `1_123_123_123_123_123_123`.  

1. –£–¥–∞–ª–µ–Ω–∏–µ "–ø—ã–ª–∏" (`_removeDust`). –§—É–Ω–∫—Ü–∏—è `_removeDust` –æ–∫—Ä—É–≥–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤–Ω–∏–∑, —É–¥–∞–ª—è—è "–ø—ã–ª—å":  

    ```solidity
    function _removeDust(uint256 _amountLD) internal view virtual returns (uint256 amountLD) {
        return (_amountLD / decimalConversionRate) * decimalConversionRate;
    }
    ```

    **–î–æ:** `1_123_123_123_123_123_123` (1.123123123123123123)  
    **–ü–æ—Å–ª–µ:** `1_123_123_000_000_000_000` (1.123123000000000000)  

2. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ SD (`_toSD`). –î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ —Å–µ—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ **shared decimals**:  

    ```solidity
    function _toSD(uint256 _amountLD) internal view virtual returns (uint64 amountSD) {
        return uint64(_amountLD / decimalConversionRate);
    }
    ```

    –ú—ã –æ–±—Ä–µ–∑–∞–µ–º 12 –∑–Ω–∞–∫–æ–≤, –ø–æ–ª—É—á–∞—è `1_123_123` (1.123123).  

3. –û–±—Ä–∞—Ç–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è (`_toLD`). –í —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è:  

    ```solidity
    function _toLD(uint64 _amountSD) internal view virtual returns (uint256 amountLD) {
        return _amountSD * decimalConversionRate;
    }
    ```

    –ï—Å–ª–∏ –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è `decimals = 18`, –º—ã —Å–Ω–æ–≤–∞ –ø–æ–ª—É—á–∏–º 1.123123000000000000.  

–ú–æ–∂–µ—Ç–µ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –≤–∑—è—Ç—å ETH –ø–æ —Ç–µ–∫—É—â–∏–º —Ü–µ–Ω–∞–º –∏ –ø–æ—Å—á–∏—Ç–∞—Ç—å –∫–∞–∫–∏–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä–∏ –∏–∑-–∑–∞ —Ç–∞–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏. –Ø –ø–æ—Å—á–∏—Ç–∞–ª –∏ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ "–ø—ã–ª—å".

–ü–æ–º–∏–º–æ `_removeDust`, —Ñ—É–Ω–∫—Ü–∏—è `_debitView` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ "–ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ", –µ—Å–ª–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤–∑–∏–º–∞—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏.  

–ú—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏ –≤—Å—é **–≤–µ—Ç–∫—É 1**. –° —Ñ—É–Ω–∫—Ü–∏–µ–π `ERC20::_burn` –¥—É–º–∞—é –≤—Å–µ –∏ —Ç–∞–∫ –ø–æ–Ω—è—Ç–Ω–æ.

#### –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ–ø—Ü–∏–π –¥–ª—è –µ–≥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏  

–¢–µ–ø–µ—Ä—å —Ä–∞–∑–±–µ—Ä–µ–º **–≤–µ—Ç–∫—É 2** ‚Äî —Ñ—É–Ω–∫—Ü–∏—é `_buildMsgAndOptions`. –ï–µ –º–æ–∂–Ω–æ –ª–æ–≥–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ —Ç—Ä–∏ —ç—Ç–∞–ø–∞:  

1. –ö–æ–¥–∏—Ä–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ü–∏–π
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

![oft-core-send-branch-2](./img/oft-core-send-branch-2.png)  
*–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ–ø—Ü–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏*  

**–®–∞–≥ 1:** –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ [`OFTMsgCodec`](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oft-evm/contracts/libs/OFTMsgCodec.sol). –ï–µ –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–ø–∞–∫–æ–≤–∞—Ç—å –±–∞–π—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏.  

```solidity
function _buildMsgAndOptions(
    SendParam calldata _sendParam, // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–ø—Ä–∞–≤–∫–∏
    uint256 _amountLD // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ —Å local decimals
) internal view virtual returns (bytes memory message, bytes memory options) {
    // 1. –ö–æ–¥–∏—Ä–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    bool hasCompose;
    (message, hasCompose) = OFTMsgCodec.encode(
        _sendParam.to,
        _toSD(_amountLD),
        _sendParam.composeMsg
    );

    // 2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ü–∏–π
    uint16 msgType = hasCompose ? SEND_AND_CALL : SEND;
    options = combineOptions(_sendParam.dstEid, msgType, _sendParam.extraOptions);

    // 3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä
    address inspector = msgInspector;
    if (inspector != address(0)) IOAppMsgInspector(inspector).inspect(message, options);
}
```

**–®–∞–≥ 2:** –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ü–∏–π. –ò–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ—è—Ç –æ–ø—Ü–∏–∏ —è —Ä–∞—Å—Å–∫–∞–∂—É –≤ —Ç—Ä–µ—Ç–µ–π —á–∞—Å—Ç–∏. –ó–¥–µ—Å—å —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫ –æ–Ω–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ [`combineOptions`](https://github.com/LayerZero-Labs/devtools/blob/05443835db976b7a528b883b19ddf02cb7f36d89/packages/oapp-evm/contracts/oapp/libs/OAppOptionsType3.sol#L63).

–î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç–∞–∫—Ç `OAppOptionsType3` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ "–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ" –æ–ø—Ü–∏–∏ (`enforcedOptions`). –¢–∞–∫–∏–µ –æ–ø—Ü–∏–∏ –∑–∞–¥–∞–µ—Ç –≤–ª–∞–¥–µ–ª–µ—Ü OApp, –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –æ–Ω —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç, —á—Ç–æ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –±–ª–æ–∫—á–µ–π–Ω–µ –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `gasLimit` –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π *native drop*.

*–í–∞–∂–Ω–æ!* **native drop** - —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞, –∫–æ—Ç–æ—Ä–æ–µ –º—ã —Ö–æ—Ç–∏–º –ø–µ—Ä–µ–¥–∞—Ç—å –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º. –ù–æ —ç—Ç–∏ —Ç–æ–∫–µ–Ω—ã –Ω–µ –∏–¥—É—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞ –ø–µ—Ä–µ—Å—ã–ª–∫—É.

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–∏—Ç—å –æ–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω—ã–µ (composed), –≤ OFT –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–∞ —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ `enforcedOptions`:  
- **1 - `SEND`** ‚Äî –æ–±—ã—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤–∫–ª—é—á–∞—è –ø–µ—Ä–µ–≤–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤);
- **2 - `SEND_AND_CALL`** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è `compose`-—Å–æ–æ–±—â–µ–Ω–∏–π (–æ—Ç–ø—Ä–∞–≤–∫–∞ + –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è). 

**–ü—Ä–∏–º–µ—Ä**

–î–æ–ø—É—Å—Ç–∏–º, –º—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ —Å Remix, –µ—Å–ª–∏ –≤—ã –≤–µ—Ä–Ω–µ—Ç–µ—Å—å –∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É `Source` –≤ –Ω–µ–º –∑–∞–¥–∞–Ω—ã —Ç–∞–∫–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –æ–ø—Ü–∏–∏:  

```solidity
bytes _options = OptionsBuilder.newOptions().addExecutorLzReceiveOption(50000, 0);
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç `{ gasLimit: 50000, value: 0 }`. –¢–µ–ø–µ—Ä—å –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–≤–æ–∏—Ç—å –ª–∏–º–∏—Ç –≥–∞–∑–∞ –≤ –¥–≤–∞ —Ä–∞–∑–∞ + –¥–æ–±–∞–≤–∏—Ç—å 0.5 ETH native drop. –¢–æ–≥–¥–∞ –≤–ª–∞–¥–µ–ª–µ—Ü OApp –∑–∞–¥–∞–µ—Ç `enforcedOptions`:  

```solidity
{ gasLimit: 100000, value: 0.5 ETH }
```

–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è:  

```solidity
{ gasLimit: 150000, value: 0.5 ETH }
```

–§—É–Ω–∫—Ü–∏—è `combineOptions` –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –æ–ø—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:  

```solidity
function combineOptions(
    uint32 _eid,
    uint16 _msgType,
    bytes calldata _extraOptions
) public view virtual returns (bytes memory) {
    bytes memory enforced = enforcedOptions[_eid][_msgType];

    if (enforced.length == 0) return _extraOptions;
    if (_extraOptions.length == 0) return enforced;

    if (_extraOptions.length >= 2) {
        _assertOptionsType3(_extraOptions);
        return bytes.concat(enforced, _extraOptions[2:]);
    }

    revert InvalidOptions(_extraOptions);
}
```

–ù–∞ —Å—Ö–µ–º–µ —ç—Ç–æ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

![combine-options](./img/combine-options.png)  
*–í—ã–±–æ—Ä –æ–ø—Ü–∏–π –∏ –∏—Ö –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ*  

- –ï—Å–ª–∏ `enforcedOptions` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `extraOptions`.  
- –ï—Å–ª–∏ `extraOptions` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `enforcedOptions`.  
- –ï—Å–ª–∏ –∑–∞–¥–∞–Ω—ã –æ–±–∞ ‚Üí `extraOptions` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º–∏, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å—Å—è.  

**–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ). –ï—Å–ª–∏ –≤ OApp –∑–∞–¥–∞–Ω –∞–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ `msgInspector`, —Ç–æ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏—è –æ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `message` –∏ `options`.  

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –∑–∞–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –¥–∞–Ω–Ω—ã—Ö –≤ –¥—Ä—É–≥–æ–π –±–ª–æ–∫—á–µ–π–Ω.  

–ú—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏ **–≤–µ—Ç–∫—É 2** ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø—Ü–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏.

#### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è  

–ù–∞–∫–æ–Ω–µ—Ü, –¥–æ–±—Ä–∞–ª–∏—Å—å –¥–æ **—Ç—Ä–µ—Ç—å–µ–π –≤–µ—Ç–∫–∏** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ `send`, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ Endpoint.  

![oft-core-send-branch-3](./img/oft-core-send-branch-3.png)  
*–°—Ö–µ–º–∞ –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è*  

–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è `OAppSender::_lzSend`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è:  

1. –í—ã–∑—ã–≤–∞–µ—Ç `_payNative`, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ö–≤–∞—Ç–∞–µ—Ç –ª–∏ `msg.value` –¥–ª—è –æ–ø–ª–∞—Ç—ã `gasLimit` –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è, –ª–∏–±–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Ç–æ–∫–µ–Ω—ã –Ω–∞ Endpoint —á–µ—Ä–µ–∑ `safeTransferFrom`, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –æ–ø—Ü–∏—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ `_lzPayToken`. –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ `_lzPayToken` –º–æ–∂–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ `ZRO`. –ù–æ —è —ç—Ç–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª.
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ `peer`, –∫–æ—Ç–æ—Ä–æ–º—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ (`getPeerOrRevert`).  
3. –í—ã–∑—ã–≤–∞–µ—Ç `Endpoint.send{ value: nativeFee }()`, –æ—Ç–ø—Ä–∞–≤–ª—è—è —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å—Ç–µ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.  

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ Endpoint, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –µ–≥–æ –¥–∞–ª—å–Ω–µ–π—à—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É, –∞ —Ç–∞–∫–∂–µ –æ–ø–ª–∞—Ç—É —É—Å–ª—É–≥ DVNs –∏ Executor.  

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è  

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é [`OAppReceiver::lzReceive`](https://github.com/LayerZero-Labs/devtools/blob/05443835db976b7a528b883b19ddf02cb7f36d89/packages/oapp-evm/contracts/oapp/OAppReceiver.sol#L95) ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –û–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `OAppReceiver::_lzReceive`, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å —É—á–µ—Ç–æ–º –ª–æ–≥–∏–∫–∏ —Ç–æ–∫–µ–Ω–∞ –≤ [`OFTCore`](https://github.com/LayerZero-Labs/devtools/blob/05443835db976b7a528b883b19ddf02cb7f36d89/packages/oft-evm/contracts/OFTCore.sol#L266).  

–í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–≤–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:  

1. –§—É–Ω–∫—Ü–∏—é `lzReceive` –º–æ–≥ –≤—ã–∑–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ** Endpoint.  
2. –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `peer`, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å—Ö–æ–¥–Ω–æ–π —Å–µ—Ç–∏ —á–µ—Ä–µ–∑ `setPeer`.  

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `OFTCore::_lzReceive`.  

![oft-core-lz-receive](./img/oft-core-lz-receive.png)  
*–ì—Ä–∞—Ñ –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è lzReceive*  

–§—É–Ω–∫—Ü–∏—è `OFTCore::_lzReceive` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–≤–∞ –ø—Ä–æ—Å—Ç—ã—Ö —à–∞–≥–∞:  

- –í—ã–∑—ã–≤–∞–µ—Ç `_credit`, —á—Ç–æ–±—ã —Å–º–∏–Ω—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥—Ä—É–≥—É—é –∑–∞–ª–æ–∂–µ–Ω–Ω—É—é –≤ —Ç–æ–∫–µ–Ω–µ –ª–æ–≥–∏–∫—É).  
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `Endpoint::sendCompose`, –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∏—Ö –≤ –æ—á–µ—Ä–µ–¥—å.  

```solidity
function _lzReceive(
    Origin calldata _origin,
    bytes32 _guid,
    bytes calldata _message,
    address /*_executor*/, // @dev –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
    bytes calldata /*_extraData*/ // @dev –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
) internal virtual override {
    // –ü—Ä–∏–≤–æ–¥–∏–º –∞–¥—Ä–µ—Å –∫ EVM-—Ñ–æ—Ä–º–∞—Ç—É
    address toAddress = _message.sendTo().bytes32ToAddress();

    // –í—ã–∑—ã–≤–∞–µ–º OFT::_credit
    uint256 amountReceivedLD = _credit(toAddress, _toLD(_message.amountSD()), _origin.srcEid);

    // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö –≤ –æ—á–µ—Ä–µ–¥—å Endpoint
    if (_message.isComposed()) {
        bytes memory composeMsg = OFTComposeMsgCodec.encode(
            _origin.nonce,
            _origin.srcEid,
            amountReceivedLD,
            _message.composeMsg()
        );
        endpoint.sendCompose(toAddress, _guid, 0 /* –∏–Ω–¥–µ–∫—Å compose-—Å–æ–æ–±—â–µ–Ω–∏—è */, composeMsg);
    }

    emit OFTReceived(_guid, _origin.srcEid, toAddress, amountReceivedLD);
}
```

*–í–∞–∂–Ω–æ!* –ß—Ç–æ–±—ã OApp –º–æ–≥ —Ä–∞–±–æ—Ç–∞—Ç—å —Å `compose`-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, –æ–Ω –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å [`IOAppComposer`](https://github.com/LayerZero-Labs/devtools/blob/05443835db976b7a528b883b19ddf02cb7f36d89/packages/oapp-evm/contracts/oapp/interfaces/IOAppComposer.sol). –í –±–∞–∑–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ—Ç.  

### –û—Ü–µ–Ω–∫–∞ `gasLimit` –∏ –∫–æ–º–∏—Å—Å–∏–∏ —Å—Ç–µ–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  

–î–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:  

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞** (`gasLimit`), –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.  
2. **–°—Ç–æ–∏–º–æ—Å—Ç—å –≥–∞–∑–∞ –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è**, –≤—ã—Ä–∞–∂–µ–Ω–Ω—É—é –≤ —Ç–æ–∫–µ–Ω–∞—Ö –∏—Å—Ö–æ–¥–Ω–æ–π —Å–µ—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–¥–µ—Ç –∏–∑ Ethereum –≤ Polygon, —Ä–∞—Å—á–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤ POL, –Ω–æ –æ–ø–ª–∞—Ç–∏—Ç—å –Ω—É–∂–Ω–æ –≤ ETH).  

–° `gasLimit` –Ω–µ –≤—Å–µ —Ç–∞–∫ –æ—á–µ–≤–∏–¥–Ω–æ. –î–ª—è —Ä–∞–∑–Ω—ã—Ö –±–ª–æ–∫—á–µ–π–Ω–æ–≤ –º–æ–∂–Ω–æ –ª–∏–±–æ –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å –µ–≥–æ **—Å –∑–∞–ø–∞—Å–æ–º**, –ª–∏–±–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —ç–º–ø–∏—Ä–∏—á–µ—Å–∫–∏. –ü–æ–∑–∂–µ –º—ã —Ä–∞–∑–±–µ—Ä–µ–º, –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.  

–î–æ–ø—É—Å—Ç–∏–º, –¥–ª—è **EVM-—Å–µ—Ç–µ–π** –±–µ—Ä–µ–º —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ **80 000 –µ–¥–∏–Ω–∏—Ü –≥–∞–∑–∞**. –¢–æ–≥–¥–∞ –æ–ø—Ü–∏–∏ –≤—ã–≥–ª—è–¥—è—Ç —Ç–∞–∫:  

```solidity
bytes memory options = OptionsBuilder.newOptions().addExecutorLzReceiveOption(80000, 0);
```

–î–∞–ª–µ–µ –Ω—É–∂–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É [`SendParam`](https://github.com/LayerZero-Labs/devtools/blob/05443835db976b7a528b883b19ddf02cb7f36d89/packages/oft-evm/contracts/interfaces/IOFT.sol#L10), –∑–∞–ø–æ–ª–Ω–∏–≤ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è:  

```solidity
SendParam memory sendParam = SendParam(
    40267, // EID
    addressToBytes32(0x32bb35Fc246CB3979c4Df996F18366C6c753c29c), // –ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è OFT-—Ç–æ–∫–µ–Ω–æ–≤ –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
    1e18, // amountLD
    1e18, // minAmountLD
    options,
    "", // composeMsg
    ""  // oftCmd
);
```

–ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é —Å—Ç–µ–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ Executer, –≤—ã–∑—ã–≤–∞–µ–º [`OFTCore::quoteSend`](https://github.com/LayerZero-Labs/devtools/blob/05443835db976b7a528b883b19ddf02cb7f36d89/packages/oft-evm/contracts/OFTCore.sol#L145):  

```solidity
MessagingFee memory fee = OFT.quoteSend(sendParam, false);
```

![oft-core-quote-send](./img/oft-core-quote-send.png)  
*–ì—Ä–∞—Ñ –≤—ã–∑–æ–≤–æ–≤ quoteSend*  

–®–∞–≥–∏ 1 –∏ 2 –∑–¥–µ—Å—å —Å—Ö–æ–∂–∏ —Å `OFTCore::send`, –Ω–æ `_debit` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è. –ù–∞ **—Ç—Ä–µ—Ç—å–µ–º —à–∞–≥–µ** –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—ã–∑–æ–≤ `Endpoint::quote`, –≥–¥–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–º–∏—Å—Å–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–Ω –Ω–∞ –≥–∞–∑ –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.  

–†–∞—Å—á–µ—Ç—ã, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ Endpoint, –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [–∑–¥–µ—Å—å](https://github.com/LayerZero-Labs/LayerZero-v2/blob/a3637f851ab1b987bff9fb3db31bf40a59ac374b/packages/layerzero-v2/evm/protocol/contracts/EndpointV2.sol#L55).  

–ó–Ω–∞—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—É—é –∫–æ–º–∏—Å—Å–∏—é, –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:  

```solidity
OFT.send{ value: fee.nativeFee }(sendParam, fee, refundAddress);
```

–ü—Ä–∏–º–µ—Ä –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö ‚Äî [`test_send_oft`](./contracts/test/foundry/MetaLampOFTv1.t.sol).  

#### –õ–∏–º–∏—Ç `gasLimit`  

–†–∞–Ω–µ–µ –º—ã –æ–±—Å—É–∂–¥–∞–ª–∏ `enforcedOptions`. –ï—Å–ª–∏ —É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≥–∞–∑–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Ç–∏, –µ–≥–æ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —á–µ—Ä–µ–∑ [`OAppOptionsType3::setEnforcedOptions`](https://github.com/LayerZero-Labs/devtools/blob/05443835db976b7a528b883b19ddf02cb7f36d89/packages/oapp-evm/contracts/oapp/libs/OAppOptionsType3.sol#L28).

### –û—Ü–µ–Ω–∫–∞ –ª–∏–º–∏—Ç–æ–≤ —Ç–æ–∫–µ–Ω–∞  

–î–ª—è OFT —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ [`OFTCore::quoteOFT`](https://github.com/LayerZero-Labs/devtools/blob/05443835db976b7a528b883b19ddf02cb7f36d89/packages/oft-evm/contracts/OFTCore.sol#L108). –û–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞.  

```solidity
function quoteOFT(
    SendParam calldata _sendParam
) external view virtual returns (
    OFTLimit memory oftLimit, // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ª–∏–º–∏—Ç—ã. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç 0 –¥–æ totalSupply.
    OFTFeeDetail[] memory oftFeeDetails, // –ö–æ–º–∏—Å—Å–∏–∏ —Ç–æ–∫–µ–Ω–∞, —Ç–æ–∂–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ.
    OFTReceipt memory oftReceipt // amountSentLD –∏ amountReceivedLD
) {}
```

## –ö–∞–∫ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å OFT-—Ç–æ–∫–µ–Ω  

–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç OFT-—Ç–æ–∫–µ–Ω–∞ –±—ã–ª —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ `npx create-lz-oapp@latest`, –≤ –Ω–µ–º —É–∂–µ –µ—Å—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –¥–µ–ø–ª–æ—è. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env` –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω—É–∂–Ω—ã–µ —Å–µ—Ç–∏ –≤ [`hardhat.config.ts`](./contracts/hardhat.config.ts) –¥–ª—è –¥–µ–ø–ª–æ—è –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤ —ç–∫—Å–ø–ª–æ—Ä–µ—Ä–∞—Ö.  

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥—É:  

```bash
npx hardhat lz:deploy
```

–ó–∞—Ç–µ–º —Å–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º, –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–µ–≥–∞ —É–∫–∞–∑–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –µ—Å—Ç—å [–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://docs.layerzero.network/v2/developers/evm/create-lz-oapp/deploying) –∏–ª–∏ –≤ [`README`](./contracts/README.md#layerzero-hardhat-helper-tasks) –ø—Ä–æ–µ–∫—Ç–∞.  

![deploy-contracts](./img/deploy-contracts.png)  
*–î–µ–ø–ª–æ–π —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤ —Ç–µ—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫—á–µ–π–Ω—ã*  

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã, –Ω–æ –∏—Ö –µ—â–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏ —Å–≤—è–∑–∞—Ç—å –º–µ–∂–¥—É —Å–æ–±–æ–π.  

–ü–µ—Ä–≤—ã–º —à–∞–≥–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é. –î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π hardhat-—Å–∫—Ä–∏–ø—Ç:  

```bash
npx hardhat lz:oapp:config:init --contract-name MetaLampOFTv1 --oapp-config layerzero.config.ts
```

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ñ–∞–π–ª [`layerzero.config.ts`](./contracts/layerzero.config.ts), –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–¥–∞—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∞ —Ç–∞–∫–∂–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞–¥—Ä–µ—Å Executor –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π.  

–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫ OApps (–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º —Ç–æ–∫–µ–Ω–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ç—è—Ö) –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º Endpoint.  

```bash
npx hardhat lz:oapp:wire --oapp-config layerzero.config.ts
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –∫–∞–∂–¥–æ–π —Å–µ—Ç–∏. –ü–æ—Å–∫–æ–ª—å–∫—É –∏—Ö –±—É–¥–µ—Ç –º–Ω–æ–≥–æ, —Å—Ç–æ–∏—Ç —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ö–≤–∞—Ç–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –æ–ø–ª–∞—Ç—É –≥–∞–∑–∞.  

–í –ø—Ä–æ—Ü–µ—Å—Å–µ –±—É–¥—É—Ç –≤—ã–∑–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:  

- `OFTToken::setPeer`  
- `OFTToken::setEnforcedOptions` (–µ—Å–ª–∏ –æ–Ω–∏ —É–∫–∞–∑–∞–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)  
- `Endpoint::setConfig`  
- `Endpoint::setSendLibrary`  
- `Endpoint::setReceiveLibrary`  

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫—á–µ–π–Ω–∞ –º–æ–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ –∑–∞–¥–∞—Ç—å `setEnforcedOptions` –∫–æ—Ç–æ—Ä—ã–π –º—ã –æ–±—Å—É–∂–¥–∞–ª–∏ –≤—ã—à–µ.

–ü—Ä–µ–ª–µ—Å—Ç—å –≤ —Ç–æ–º, —á—Ç–æ –µ—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏—Ç–µ –∫–∞–∫–∏–µ-—Ç–æ –æ–ø—Ü–∏–∏, —Ç–æ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–æ–≤—ã—Ö –æ–ø—Ü–∏–π, –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–æ.

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–∂–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å [–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://docs.layerzero.network/v2/developers/evm/protocol-gas-settings/default-config).  

## –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏  

–û—Ç–ø—Ä–∞–≤–∫–∞ –æ–º–Ω–∏—á–µ–π–Ω-—Ç–æ–∫–µ–Ω–æ–≤ ‚Äî –Ω–µ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ—Ü–µ—Å—Å. –ë–µ–∑ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –æ–±–æ–π—Ç–∏—Å—å —Å–ª–æ–∂–Ω–æ, –ø–æ—ç—Ç–æ–º—É —è –Ω–∞–ø–∏—Å–∞–ª Foundry-—Å–∫—Ä–∏–ø—Ç [`SendTokens`](./contracts/scripts/SendTokens.s.sol), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –º–µ–∂–¥—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ `MetaLampOFTv1` –≤ —Å–µ—Ç—è—Ö Ethereum Sepolia –∏ Polygon.  

–ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ç–æ–∫–µ–Ω–æ–≤ –∏—Ö –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞ –±–∞–ª–∞–Ω—Å. –î–ª—è —ç—Ç–æ–≥–æ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `claim`, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞—á–∏—Å–ª—è–µ—Ç 100 MLOFTv1. –ü—Ä–æ—â–µ –≤—Å–µ–≥–æ –≤—ã–∑–≤–∞—Ç—å –µ–µ —á–µ—Ä–µ–∑ –±–ª–æ–∫—á–µ–π–Ω-—ç–∫—Å–ø–ª–æ—Ä–µ—Ä—ã —Å–æ–æ—Ç–≤–µ—Å—Ç–≤—É—é—â–∏—Ö –±–ª–æ–∫—á–µ–π–Ω–æ–≤ (—Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –µ—Å—Ç—å [–∑–¥–µ—Å—å](./contracts/README.md)).  

–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤:  

```bash
pnpm send \
--rpc-url <rpc_url> \
<sender_address> \
<src_oft_oapp_address> \
<dst_recipient_address> \
<amount_LD> \
<dst_eid> \
--broadcast
```

–ü—Ä–∏–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏:  

```bash
pnpm send \
--rpc-url sepolia \
0x32bb35Fc246CB3979c4Df996F18366C6c753c29c \
0xcd5407ae7FA70C6ea1f77eDD7A3dde34BED187F5 \
0x32bb35Fc246CB3979c4Df996F18366C6c753c29c \
1000000000000000000 \
40267 \
--broadcast
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:  

```bash
== Logs ==
  GUID: 
  0x832318c92f1b0abe842f8ec5059d47aad92df8ca8de6a94b4bf8be301b689952
  MessagingReceipt: nonce: 4, fee: 75768729416500
  OFTReceipt: amountSentLD: 1000000000000000000, amountReceivedLD: 1000000000000000000

##### sepolia
‚úÖ  [Success] Hash: 0xb791c8aae098e5bfe449ddf58e012beebbf1ff2c3b81960adddd6abc67a7620e
```

–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–æ–∂–Ω–æ –≤–∑—è—Ç—å —Ö—ç—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–µ —Å—Ç–∞—Ç—É—Å –≤ [LayerZeroScan](https://testnet.layerzeroscan.com/). –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å **"Delivered"**, —Ç–æ —Ç–æ–∫–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ –¥–æ—à–ª–∏ –¥–æ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è. –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ `totalSupply` –≤ –æ–±–µ–∏—Ö —Å–µ—Ç—è—Ö.  

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:* —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥—É **–±–µ–∑ —Ñ–ª–∞–≥–∞** `--broadcast`, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —Å–∫–æ–ª—å–∫–æ **fee** –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –º–Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–ª–∏ –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π `nativeFee` –≤ Polygon Amoy ‚Äî –≤–µ—Ä–æ—è—Ç–Ω–æ, –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å `priceFeed`.

### –ß—Ç–æ –µ—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å?  

–£ –º–µ–Ω—è –±—ã–ª–∞ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ —è –æ—Ç–ø—Ä–∞–≤–∏–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º `gasLimit`, –∏–∑-–∑–∞ —á–µ–≥–æ –æ–Ω–∞ —É–ø–∞–ª–∞ –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ç–æ–∫–µ–Ω—ã –±—ã–ª–∏ **—Å–æ–∂–∂–µ–Ω—ã –≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Å–µ—Ç–∏**, –Ω–æ –Ω–µ –±—ã–ª–∏ –≤—ã–ø—É—â–µ–Ω—ã –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è, –∏ –æ–±—â–∏–π `totalSupply` –Ω–∞—Ä—É—à–∏–ª—Å—è.  

–†–µ—à–µ–Ω–∏–µ –æ–∫–∞–∑–∞–ª–æ—Å—å –ø—Ä–æ—Å—Ç—ã–º: —è –≤—ã–∑–≤–∞–ª `Endpoint::lzReceive` –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è, –ø–µ—Ä–µ–¥–∞–≤ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∑–∞—Å—Ç—Ä—è–≤—à–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø–æ—Å–ª–µ —á–µ–≥–æ –æ–Ω–∞ –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –¢–∞–∫—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å **–ª—é–±–æ–π**, –∫—Ç–æ –æ–ø–ª–∞—Ç–∏—Ç –≥–∞–∑, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ —É–∂–µ –ø—Ä–æ—à–ª–∞ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –∏ –Ω–µ –≤–∞–∂–Ω–æ, –∫—Ç–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç Executor, —ç—Ç–æ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑–æ–≤–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ etherscan).  

–≠—Ç–æ –æ–¥–Ω–æ –∏–∑ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ LayerZero ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ—à–∏–±–∫–∏ –≤—Ä—É—á–Ω—É—é. –û–¥–Ω–∞–∫–æ —ç—Ç–æ –Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫. –ü–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ —Ç—â–∞—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–µ–π—Å—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–∞—à–µ–≥–æ OFT-—Ç–æ–∫–µ–Ω–∞.  

## –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞ `gasLimit`  

–í –ø—Ä–æ–µ–∫—Ç–µ, —Å–æ–∑–¥–∞–Ω–Ω–æ–º —á–µ—Ä–µ–∑ `npx create-lz-oapp@latest`, –µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≥–∞–∑–∞ (`lzReceive` –∏ `lzCompose`). –û–Ω–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç —Ñ–æ—Ä–∫ –Ω—É–∂–Ω–æ–π —Å–µ—Ç–∏, –ø—Ä–æ–≥–æ–Ω—è—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑ –∏ –≤—ã–¥–∞—é—Ç —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è.  

–ù–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ `lzReceive` –≤ —à–∞–±–ª–æ–Ω–µ –±—ã–ª–∞ –æ—à–∏–±–æ—á–Ω–æ–π. –Ø –∏—Å–ø—Ä–∞–≤–∏–ª –µ–µ –≤ [—ç—Ç–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏](./contracts/README.md#estimating-lzreceive-and-lzcompose-gas-usage).  

–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω—é–∞–Ω—Å–æ–≤:  

1. –î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `bytes`.  
2. –ï—Å–ª–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –∏–º–µ–µ—Ç –±–∞–ª–∞–Ω—Å–∞, –æ—Ü–µ–Ω–∫–∞ –≥–∞–∑–∞ –±—É–¥–µ—Ç –≤—ã—à–µ. –ü–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å –≤ —Å–ª–æ—Ç —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –¥–æ—Ä–æ–∂–µ, —á–µ–º –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏.  
3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞ –ø–æ–∫–∞–∑–∞–ª–∏—Å—å –º–Ω–µ –∑–∞–Ω–∏–∂–µ–Ω–Ω—ã–º–∏ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –∑–∞–º–µ—Ä–∞–º–∏ –≤ Gas Profiler –æ—Ç Tenderly.  

–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ `bytes`, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–∞–Ω–¥—É:  

```bash
forge script scripts/SendTokens.s.sol \
--via-ir \
--sig "encode(address,uint256,bytes)" \
<recipient_address> \
<amount_LD> \
<compose_msg>
```

–ü—Ä–∏–º–µ—Ä:  

```bash
forge script scripts/SendTokens.s.sol \
--via-ir \
--sig "encode(address,uint256,bytes)" \
0x4cD6778754ba04F069f8D96BCD7B37Ccae6A145d \
1000000000000000000 \
"0x"
```

–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:  

```bash
== Return ==
_msg: bytes 0x0000000000000000000000004cd6778754ba04f069f8d96bcd7b37ccae6a145d00000000000f4240
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≥–∞–∑–∞:  

```bash
pnpm gas:lzReceive \
<rpcUrl> \
<endpointAddress> \
"(<srcEid>,<sender>,<dstEid>,<receiver>,[<message>],<msg.value>)<numOfRuns>"
```

–ì–¥–µ:  
- `rpcUrl` ‚Äî RPC URL —Å–µ—Ç–∏, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π —Å—á–∏—Ç–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π `gasLimit`.  
- `endpointAddress` ‚Äî –∞–¥—Ä–µ—Å Endpoint –≤ —ç—Ç–æ–π —Å–µ—Ç–∏.  
- `srcEid` ‚Äî EID –∏—Å—Ö–æ–¥–Ω–æ–π —Å–µ—Ç–∏.  
- `sender` ‚Äî –∞–¥—Ä–µ—Å OApp –≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Å–µ—Ç–∏.  
- `dstEid` ‚Äî EID —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.  
- `receiver` ‚Äî –∞–¥—Ä–µ—Å OApp –≤ —Å–µ—Ç–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.  
- `message` ‚Äî –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ `bytes`.  
- `msg.value` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ (–≤ wei).  
- `numOfRuns` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—É—Å–∫–æ–≤.  

–ü—Ä–∏–º–µ—Ä:  

```bash
pnpm gas:lzReceive \
polygonAmoy \
0x6EDCE65403992e310A62460808c4b910D972f10f \
"(40161,0x000000000000000000000000cd5407ae7fa70c6ea1f77edd7a3dde34bed187f5,40267,0x54d412fee228e13a42f38bc760faeffdfe838536,[0x0000000000000000000000004cd6778754ba04f069f8d96bcd7b37ccae6a145d00000000000f4240],0,10)"
```

–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:  

```bash
== Logs ==
  Starting gas profiling for lzReceive on dstEid: 40267
  ---------------------------------------------------------
  Aggregated Gas Metrics Across All Payloads:
  Overall Average Gas Used: 19051
  Overall Minimum Gas Used: 19051
  Overall Maximum Gas Used: 19051
  Estimated options:
  0x00030100110100000000000000000000000000004e23
  ---------------------------------------------------------
  Finished gas profiling for lzReceive on dstEid: 40267
  ---------------------------------------------------------
```

### OFTProfilerExample  

–ú–Ω–µ –±–æ–ª—å—à–µ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è —Å–∫—Ä–∏–ø—Ç [`OFTProfilerExample`](./contracts/scripts/OFTProfilerExample.s.sol).  

–û–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –Ω–æ –≤—ã–¥–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã–µ –∫ —Ä–µ–∞–ª—å–Ω—ã–º. –ï–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å, –∏ –æ–Ω –ª–µ–≥–∫–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:  

```bash
pnpm gas:run 10
```

–ì–¥–µ `10` ‚Äî —á–∏—Å–ª–æ –ø—Ä–æ–≥–æ–Ω–æ–≤. –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —É–±—Ä–∞—Ç—å —Ñ–ª–∞–≥ `--via-ir` –≤ –∫–æ–º–∞–Ω–¥–µ, –æ–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `package.json`.  

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ  

–°—Ç–∞–Ω–¥–∞—Ä—Ç OFT –æ—Å—Ç–∞–≤–∏–ª –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ. –û–Ω –≥–∏–±–∫–∏–π, –¥–∞–µ—Ç —à–∏—Ä–æ–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∞ "–∏–∑ –∫–æ—Ä–æ–±–∫–∏" —É–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–µ—Å—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ ERC20 OFT-—Ç–æ–∫–µ–Ω–∞.  

–û—Ç–¥–µ–ª—å–Ω–æ —Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å —É–¥–æ–±—Å—Ç–≤–æ –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞:  
- –ì–æ—Ç–æ–≤—ã–µ —Ç–µ—Å—Ç—ã;
- –°–∫—Ä–∏–ø—Ç—ã hardhat –∏ foundry –¥–ª—è –¥–µ–ø–ª–æ—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OApps –≤ —Ä–∞–∑–Ω—ã—Ö –±–ª–æ–∫—á–µ–π–Ω–∞—Ö;
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≥–∞–∑–∞.

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö LayerZero, –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ä–∏—Å–∫ –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö –∫–µ–π—Å–æ–≤, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏.  

–ü–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ:  
- –¢—â–∞—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω  
- –ü—Ä–æ–≤–æ–¥–∏—Ç—å –∞—É–¥–∏—Ç –∫–æ–¥–∞  
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ –º–µ–π–Ω–Ω–µ—Ç–µ, —Ç–∞–∫ –∫–∞–∫ –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ—á–µ–π–Ω (DVN, —Å—Ç–µ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, Executor). –í —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–µ—Ç—è—Ö –æ—Ü–µ–Ω–∫–∞ –∫–æ–º–∏—Å—Å–∏–π –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.  

–ü—Ä–∞–∫—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –¥–∞–∂–µ –∫—Ä—É–ø–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ Tether, –Ω–µ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω—ã –æ—Ç –æ—à–∏–±–æ–∫. –ê—É–¥–∏—Ç –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

–í —Ç—Ä–µ—Ç—å–µ–π —á–∞—Å—Ç–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ –∏–∑ —á–µ–≥–æ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –æ–ø—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ –∑–∞—Ç—Ä–æ–Ω–µ–º PreCrime.

## –°—Å—ã–ª–∫–∏  
- [GitHub: LayerZero v2](https://github.com/LayerZero-Labs/LayerZero-v2)  
- [GitHub: LayerZero-Labs/devtools](https://github.com/LayerZero-Labs/devtools/blob/main/packages/oft-evm/contracts)  
- [Docs: LayerZero v2](https://docs.layerzero.network/v2)  
- [Docs: Solidity API](https://docs.layerzero.network/v2/developers/evm/technical-reference/api#endpointv2)  
- [Docs: LayerZero Glossary](https://docs.layerzero.network/v2/home/glossary#lzcompose)  
- [Docs: USDT0](https://docs.usdt0.to/)  
- [Audit: USDT0](https://github.com/Everdawn-Labs/usdt0-audit-reports)  
- [LayerZeroScan](https://layerzeroscan.com/)
