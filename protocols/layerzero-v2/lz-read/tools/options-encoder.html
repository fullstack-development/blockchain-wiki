<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>lzRead Options Encoder</title>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; max-width: 560px; margin: 2rem auto; padding: 0 1rem; }
    h1 { font-size: 1.25rem; margin-bottom: 0.25rem; }
    p { color: #444; font-size: 0.9375rem; margin-bottom: 1.25rem; }
    label { display: block; margin-top: 1rem; font-weight: 500; font-size: 0.875rem; }
    input[type="number"] { width: 100%; padding: 0.5rem 0.75rem; box-sizing: border-box; margin-top: 0.25rem; border: 1px solid #ccc; border-radius: 6px; font-size: 1rem; }
    button { padding: 0.5rem 1rem; cursor: pointer; font-size: 0.9375rem; border-radius: 6px; border: 1px solid #ccc; background: #f8f8f8; }
    button:hover { background: #eee; }
    button:active { background: #e0e0e0; }
    button:disabled { cursor: default; opacity: 0.8; }
    button.primary { background: #333; color: #fff; border-color: #333; }
    button.primary:hover:not(:disabled) { background: #111; }
    button.primary.copied { background: #0a6b0a; border-color: #0a6b0a; }
    .output-section { margin-top: 1.5rem; }
    .output-section label { margin-bottom: 0.375rem; }
    #out { display: block; width: 100%; box-sizing: border-box; margin-top: 0.25rem; padding: 0.75rem; font-family: ui-monospace, "SF Mono", Consolas, monospace; font-size: 0.8125rem; line-height: 1.4; word-break: break-all; overflow-wrap: anywhere; border: 1px solid #ddd; border-radius: 6px; background: #fafafa; color: #111; resize: none; min-height: 3.5rem; }
    #out:focus { outline: none; border-color: #666; }
    .output-actions { display: flex; align-items: center; gap: 0.75rem; margin-top: 0.5rem; }
    .copy-feedback { font-size: 0.875rem; color: #0a6b0a; }
    .copy-feedback.error { color: #c00; }
  </style>
</head>
<body>
  <h1>lzRead enforced options encoder</h1>
  <p>Encodes options for <code>configureFull</code> / <code>setEnforcedOptions</code> (format: TYPE_3, worker 1, option_type 5, gas uint128, calldataSize uint32, value uint128).</p>
  <label>Gas (uint128)</label>
  <input type="number" id="gas" value="50000" min="0" placeholder="50000">
  <label>Response size in bytes (uint32)</label>
  <input type="number" id="size" value="320" min="0" placeholder="320">
  <label>Value (uint128, wei)</label>
  <input type="number" id="value" value="0" min="0" placeholder="0">
  <section class="output-section" aria-label="Output">
    <label for="out">Options bytes</label>
    <textarea id="out" readonly rows="2" aria-label="Encoded options hex">0x</textarea>
    <div class="output-actions">
      <button type="button" id="copyBtn" class="primary" aria-label="Copy hex to clipboard">Copy</button>
      <span id="copyFeedback" class="copy-feedback" aria-live="polite"></span>
    </div>
  </section>

  <script>
    const TYPE_3 = 3;
    const WORKER_ID = 1;
    const OPTION_TYPE_LZ_READ = 5;

    function u16Be(n) {
      const b = new Uint8Array(2);
      b[0] = (n >>> 8) & 0xff;
      b[1] = n & 0xff;
      return b;
    }

    function u32Be(n) {
      const b = new Uint8Array(4);
      b[0] = (n >>> 24) & 0xff;
      b[1] = (n >>> 16) & 0xff;
      b[2] = (n >>> 8) & 0xff;
      b[3] = n & 0xff;
      return b;
    }

    function u128Be(n) {
      const b = new Uint8Array(16);
      for (let i = 15; i >= 0 && n > 0n; i--) {
        b[i] = Number(n & 0xffn);
        n = n >> 8n;
      }
      return b;
    }

    function encodeLzReadOption(gas, calldataSize, value) {
      const parts = [u128Be(gas), u32Be(calldataSize)];
      if (value > 0n) parts.push(u128Be(value));
      const len = parts.reduce((acc, p) => acc + p.length, 0);
      const out = new Uint8Array(len);
      let i = 0;
      for (const p of parts) {
        out.set(p, i);
        i += p.length;
      }
      return out;
    }

    function encode() {
      const gas = BigInt(document.getElementById('gas').value || '0');
      const size = Number(document.getElementById('size').value || '0');
      const value = BigInt(document.getElementById('value').value || '0');
      const option = encodeLzReadOption(gas, size, value);
      const optionSize = option.length + 1; // +1 for option_type byte
      const chunks = [
        u16Be(TYPE_3),
        new Uint8Array([WORKER_ID]),
        u16Be(optionSize),
        new Uint8Array([OPTION_TYPE_LZ_READ]),
        option
      ];
      const totalLen = chunks.reduce((acc, c) => acc + c.length, 0);
      const out = new Uint8Array(totalLen);
      let offset = 0;
      for (const c of chunks) {
        out.set(c, offset);
        offset += c.length;
      }
      const hex = '0x' + Array.from(out).map(b => b.toString(16).padStart(2, '0')).join('');
      document.getElementById('out').value = hex;
    }

    document.getElementById('gas').addEventListener('input', encode);
    document.getElementById('size').addEventListener('input', encode);
    document.getElementById('value').addEventListener('input', encode);

    (function () {
      var copyBtn = document.getElementById('copyBtn');
      var feedback = document.getElementById('copyFeedback');
      var originalLabel = 'Copy';

      copyBtn.addEventListener('click', function () {
        var hex = document.getElementById('out').value;
        if (!hex || hex === '0x') return;

        navigator.clipboard.writeText(hex).then(function () {
          copyBtn.textContent = 'Copied!';
          copyBtn.classList.add('copied');
          copyBtn.disabled = true;
          feedback.textContent = '';
          setTimeout(function () {
            copyBtn.textContent = originalLabel;
            copyBtn.classList.remove('copied');
            copyBtn.disabled = false;
          }, 1800);
        }).catch(function () {
          feedback.textContent = 'Copy failed';
          feedback.classList.add('error');
          setTimeout(function () {
            feedback.textContent = '';
            feedback.classList.remove('error');
          }, 2500);
        });
      });
    })();

    encode();
  </script>
</body>
</html>
