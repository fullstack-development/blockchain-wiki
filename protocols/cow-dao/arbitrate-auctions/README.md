# CoW Protocol: Batch Auctions

**–ê–≤—Ç–æ—Ä:** [–ê–ª–µ–∫—Å–µ–π –ö—É—Ü–µ–Ω–∫–æ](https://github.com/bimkon144) üë®‚Äçüíª

Batch auctions (–ø–∞–∫–µ—Ç–Ω—ã–µ –∞—É–∫—Ü–∏–æ–Ω—ã) - —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º CoW Protocol, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç—É –æ—Ç MEV. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö DEX, –≥–¥–µ –∫–∞–∂–¥–∞—è —Å–¥–µ–ª–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, CoW Protocol –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ intentions –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ø–∞–∫–µ—Ç—ã –∏ –ø—Ä–æ–≤–æ–¥–∏—Ç –∞—É–∫—Ü–∏–æ–Ω –º–µ–∂–¥—É solvers –∑–∞ –ø—Ä–∞–≤–æ –∏—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç—å.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç Batch Auctions

–†–∞–∑–±–µ—Ä–µ–º –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Ä–∞–±–æ—Ç—ã `batch auction`.

```mermaid
sequenceDiagram
    participant User as üë§<br/>User
    participant OrderBook as üìö<br/>Order book
    participant Autopilot as ü§ñ<br/>Autopilot
    participant Solver as ‚ö°<br/>Solver
    
    User->>OrderBook: POST /order
    Autopilot->>OrderBook: Request solvable orders
    OrderBook-->>Autopilot: Response solvable orders
    Autopilot->>Autopilot: Create auction
    Autopilot->>Solver: /solve
    Solver-->>Autopilot: Score
    Autopilot->>Solver: /settle
    Solver->>Solver: Settles transaction on-chain
    Solver-->>Autopilot: Transaction hash
    Solver->>User: User receives tokens
```

–≠—Ç–∏ —Ç—Ä–∏ –≥–ª–∞–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞.

**Order book** - —ç—Ç–æ –æ—Ñ—Ñ-—á–µ–π–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, —á–µ—Ä–µ–∑ API –∫–æ—Ç–æ—Ä–æ–≥–æ —Ä–∞–∑–º–µ—â–∞—é—Ç, –æ—Ç–º–µ–Ω—è—é—Ç –∏ –ø–æ–ª—É—á–∞—é—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Ç—Ä–µ–π–¥–µ—Ä–æ–≤, UI –∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Å CoW Protocol.

**Autopilot** - —ç—Ç–æ –æ—Ñ—Ñ-—á–µ–π–Ω —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ—Ä–¥–µ—Ä–∞ —Å `order book` –∏ –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –∞—É–∫—Ü–∏–æ–Ω. –û–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º solvers –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —ç—Ç–æ–º –∞—É–∫—Ü–∏–æ–Ω–µ. –°–æ–±–∏—Ä–∞–µ—Ç –æ—Ü–µ–Ω–∫–∏ –æ—Ç solvers, –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–µ–≥–æ, –∫–æ—Ç–æ—Ä–æ–º—É –ø–æ—Ä—É—á–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á–∏. –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –∏–∑ solvers –≤–µ–¥–µ—Ç —Å–µ–±—è –Ω–µ—á–µ—Å—Ç–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–≤—ã—à–∞–µ—Ç –æ—Ü–µ–Ω–∫—É, —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –Ω–∞–∫–∞–∑–∞—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ DAO.

**Solver** - –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—Ä–µ–≤–Ω—É—é—Ç—Å—è –∑–∞ –ø—Ä–∞–≤–æ –∏—Å–ø–æ–ª–Ω–∏—Ç—å –ø–∞–∫–µ—Ç –æ—Ä–¥–µ—Ä–æ–≤. –ö–∞–∂–¥—ã–π solver –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç Autopilot –ø–∞–∫–µ—Ç intentions, –∏—â–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –¥–∞—ë—Ç –æ—Ü–µ–Ω–∫—É –¥–ª—è Autopilot.

–î–ª—è –±–æ–ª—å—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ.

## Orderbook

–ü–æ —Å—É—Ç–∏ —ç—Ç–æ –æ—Ñ—Ñ-—á–µ–π–Ω —Å–µ—Ä–≤–∏—Å [CRUD](https://en.wikipedia.org/wiki/Create,_read,_update_and_delete) —Å—Ç–µ–π—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ API –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ö–æ–¥ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [—Ç—É—Ç](https://github.com/cowprotocol/services/tree/main/crates/orderbook).

Orderbook —è–≤–ª—è–µ—Ç—Å—è **–≥–ª–∞–≤–Ω–æ–π —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞** –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª. –ß–µ—Ä–µ–∑ –µ–≥–æ API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, UI –∏ –¥—Ä—É–≥–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç:

- –ü–æ–ª—É—á–∞—Ç—å –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è –æ—Ä–¥–µ—Ä–æ–≤ (`post/quote`)
- –†–∞–∑–º–µ—â–∞—Ç—å –æ—Ä–¥–µ—Ä–∞ (`post/orders`)
- –û—Ç–º–µ–Ω—è—Ç—å –æ—Ä–¥–µ—Ä–∞ (`delete/orders`)
- –ü–æ–ª—É—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º —Ä–µ—à–µ–Ω–Ω–æ–º –∞—É–∫—Ü–∏–æ–Ω–µ
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–≤–æ–∏—Ö –æ—Ä–¥–µ—Ä–æ–≤

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ [API](https://docs.cow.fi/cow-protocol/reference/apis/orderbook).

–°—Ö–µ–º—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è `orderBook` –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∏–∂–µ:

```mermaid
sequenceDiagram
    participant User
    participant Order book
    participant Solver1  
    participant SolverN
    participant Database
    
    User->>Order book: POST /quote
    Order book->>Solver1: quote?
    Order book->>SolverN: quote?
    
    Solver1->>Solver1: compute matching for<br/>single order batch
    SolverN->>SolverN: compute matching for<br/>single order batch
    
    Solver1-->>Order book: result
    SolverN-->>Order book: result
    
    Order book->>Order book: simulate quote
    Order book->>Order book: pick best result
    
    Order book->>Database: store quote
    Order book-->>User: quote
    
    User->>User: sign order
    
    User->>Order book: POST /order
    
    Order book->>Order book: verify order
    
    Order book->>Database: fetch quote
    
    alt if quote not found
        Order book->>Solver1: quote?
        Order book->>SolverN: quote?  
        Solver1-->>Order book: result
        SolverN-->>Order book: result
        Order book->>Order book: simulate & pick
    end
    
    Order book->>Database: insert order
    Order book-->>User: order UID
    
    User->>User: wait for happy moo
    
    User->>Order book: GET /trades
    Order book->>Database: lookup order
    Database-->>Order book: order & trades
    Order book-->>User: trades
```

–ú–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ 3 —ç—Ç–∞–ø–∞: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ (quote), —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ä–¥–µ—Ä–∞.

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—Ç–∏—Ä–æ–≤–∫–∏

1. `User ‚Üí Order book: POST /quote`
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å–¥–µ–ª–∫–∏, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —Å–∫–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω–æ–≤ –æ–Ω –ø–æ–ª—É—á–∏—Ç –ø—Ä–∏ –æ–±–º–µ–Ω–µ.

2. `Order book ‚Üí Solver1/SolverN: quote?`
   Orderbook –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç solvers –¥–ª—è —Ä–µ—à–µ–Ω–∏—è `batch` —Å –æ–¥–Ω–∏–º –æ—Ä–¥–µ—Ä–æ–º, –∏ solvers –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å–≤–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.

3. `Order book ‚Üí Order book: simulate & pick best result`
   Orderbook —Å–∏–º—É–ª–∏—Ä—É–µ—Ç –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à—É—é, –º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É—é—â—É—é output –¥–ª—è —Ç—Ä–µ–π–¥–µ—Ä–∞, –∑–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ—ë –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

4. `Order book ‚Üí User: quote`
   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ç–∏—Ä–æ–≤–∫—É —Ç—Ä–µ–π–¥–µ—Ä—É –¥–ª—è –ø–æ–¥–ø–∏—Å–∏.

### –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞

1. `User ‚Üí Order book: sign & POST /order`
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Ä–¥–µ—Ä –æ—Ñ—Ñ-—á–µ–π–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ Order book –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–∏–π batch.

2. `Order book ‚Üí Order book: verify order & fetch quote`
   Order book –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –æ—Ä–¥–µ—Ä–∞ (—Ñ–æ—Ä–º–∞—Ç, –±–∞–ª–∞–Ω—Å—ã, –ø–æ–¥–ø–∏—Å—å, appData) –∏ –∏—â–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–æ—Ç–∏—Ä–æ–≤–∫—É –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ï—Å–ª–∏ –∫–æ—Ç–∏—Ä–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è.

3. `Order book ‚Üí Database ‚Üí User: insert order & return UID`
   Order book —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ä–¥–µ—Ä –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è autopilot –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ä–¥–µ—Ä–∞

1. `User ‚Üí User: wait for happy moo`
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥–µ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞. –¢–µ–ø–µ—Ä—å –æ—á–µ—Ä–µ–¥—å autopilot –∏ solvers —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç—å –æ—Ä–¥–µ—Ä ("happy moo" = —É—Å–ø–µ—à–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —Å—Ç–∏–ª–µ CoW).

2. `User ‚Üí Order book: GET /trades`
   –ü–æ—Å–ª–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Å–¥–µ–ª–∫–µ.

3. `Order book ‚Üí Database ‚Üí User: lookup & return trades`
   Order book –∏—â–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ä–¥–µ—Ä–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–∞–Ω–Ω—ã–µ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Å–¥–µ–ª–∫–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö solver competition.

## Autopilot

–ö–æ–¥ –æ—Ñ—Ñ-—á–µ–π–Ω —Å–µ—Ä–≤–∏—Å–∞ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [—Ç—É—Ç](https://github.com/cowprotocol/services/tree/main/crates/autopilot)

### –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –∞—É–∫—Ü–∏–æ–Ω—ã

Autopilot —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—ã–π –∞—É–∫—Ü–∏–æ–Ω –≤ —Ç—Ä–µ—Ö —Å–ª—É—á–∞—è—Ö. –ü–µ—Ä–≤—ã–π - –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç, –æ—Ç–º–µ–Ω—è—é—Ç –∏–ª–∏ –º–µ–Ω—è—é—Ç —Å–≤–æ–∏ –æ—Ä–¥–µ—Ä–∞. –í—Ç–æ—Ä–æ–π - –∫–æ–≥–¥–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π –±–ª–æ–∫ –∏ –º–æ–∂–µ—Ç –ø–æ–º–µ–Ω—è—Ç—å—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ç–∏. –¢—Ä–µ—Ç–∏–π - –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 2 —Å–µ–∫—É–Ω–¥ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–ª–æ–∫–∞ –∏ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

–¢–∞–∫–∞—è –ª–æ–≥–∏–∫–∞ –Ω—É–∂–Ω–∞, —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—É—Å—Ç—ã–µ –∞—É–∫—Ü–∏–æ–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ù–∞ –∫–∞–∂–¥—ã–π –∞—É–∫—Ü–∏–æ–Ω solvers –ø–æ–ª—É—á–∞—é—Ç 15 —Å–µ–∫—É–Ω–¥.

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —É solver –µ—Å—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ —Å–µ—Ç—å. –ï—Å–ª–∏ solver –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ —Ç–µ—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, —Ç–æ –æ—Ä–¥–µ—Ä–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏–π –∞—É–∫—Ü–∏–æ–Ω.

### –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç—ã Autopilot

```mermaid
sequenceDiagram
    participant Database as database
    participant Blockchain as blockchain  
    participant Autopilot as autopilot
    participant Solver1 as solver 1
    participant Solver2 as solver 2
    participant Solver3 as solver 3

    par
        Autopilot->>Database: Get order information
        Note right of Database: UIDs, signatures, owners...
    and
        Autopilot->>Blockchain: Get order information
        Note right of Blockchain: On-chain cancellations, ETH flow...
    end

    Autopilot->>Autopilot: Cut auction

    par
        Autopilot->>Solver1: /solve
        Note right of Autopilot: [broadcast current auction]
    and
        Autopilot->>Solver2: /solve
    and  
        Autopilot->>Solver3: /solve
    end

    Solver1-->>Autopilot: Proposed batch
    Solver2-->>Autopilot: Proposed batch
    Solver3-->>Autopilot: Proposed batch

    Autopilot->>Autopilot: Pick winner

    Autopilot->>Solver1: /settle

    Solver1-->>Blockchain: Execute transaction
    Blockchain->>Solver1: Transaction receipt
    Solver1-->>Autopilot: Transaction hash

    Autopilot-->>Database: Store auction data
```

–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã –º–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ 3 —ç—Ç–∞–ø–∞: —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞, —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ solvers –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ.

### –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ–± –æ—Ä–¥–µ—Ä–∞—Ö

1. `Autopilot ‚Üí Database & Blockchain: Get order information`
   Autopilot –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –æ–±—â–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å Orderbook (UIDs, –æ—Ñ—Ñ-—á–µ–π–Ω –ø–æ–¥–ø–∏—Å–∏, –≤–ª–∞–¥–µ–ª—å—Ü—ã) –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –±–ª–æ–∫—á–µ–π–Ω:
   - **Pre-signatures**: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è `PreSignature` –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç –æ—Ä–¥–µ—Ä–∞ on-chain —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `setPreSignature`
   - **–û—Ç–º–µ–Ω—ã –æ—Ä–¥–µ—Ä–æ–≤**: –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç —Å–æ–±—ã—Ç–∏—è `OrderInvalidated` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ `invalidateOrder`
   - **ETH flow**: –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç —Å–æ–±—ã—Ç–∏—è ETH Flow –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ - –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–µ –æ—Ä–¥–µ—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ —Å–µ—Ç–∏.

2. `Autopilot ‚Üí Autopilot: Cut auction`
   Autopilot —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–∞–∫–µ—Ç –∞—É–∫—Ü–∏–æ–Ω–∞ –∏–∑ –≤—Å–µ—Ö —Ç–æ—Ä–≥—É–µ–º—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤. –î–∞–ª–µ–µ —Å–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–∞–µ—Ç —Ü–µ–Ω—ã –Ω–∞ —ç—Ç–∏ —Ç–æ–∫–µ–Ω—ã –≤ ETH –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (solvers, Paraswap, 1inch, Uniswap pools). –≠—Ç–∏ —Ü–µ–Ω—ã –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ –ø–∞–∫–µ—Ç –∞—É–∫—Ü–∏–æ–Ω–∞, —á—Ç–æ–±—ã solvers –∏–º–µ–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Ü–µ–Ω—É —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Ç–∞–∫–∂–µ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ `scores` –ø–æ –µ–¥–∏–Ω—ã–º —Ü–µ–Ω–∞–º –≤ ETH. –ï—Å–ª–∏ —Ü–µ–Ω—É —Ç–æ–∫–µ–Ω–∞ –≤ ETH –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–ª—å–∑—è, –æ—Ä–¥–µ—Ä –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è. –ü–æ —Å—É—Ç–∏ —ç—Ç–æ –∫–∞–∫ —Ü–µ–Ω–æ–≤–æ–π –æ—Ä–∞–∫—É–ª –¥–ª—è –≤—Å–µ—Ö solvers.
   –î–∞–ª–µ–µ, —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –æ—Ä–¥–µ—Ä–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω—ã: –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ, —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º –¥–ª—è fill-or-kill, –±–µ–∑ approve –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Ç—Ä–µ–π–¥, —Å –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏, —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ ERC-1271 –ø–æ–¥–ø–∏—Å—è–º–∏.

### –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ solvers

1. `Autopilot ‚Üí Solver1/2/3: /solve`
   Autopilot —Ä–∞—Å—Å—ã–ª–∞–µ—Ç –ø–∞–∫–µ—Ç –∞—É–∫—Ü–∏–æ–Ω–∞ –≤—Å–µ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º solvers. Solvers –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 15 —Å–µ–∫—É–Ω–¥, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `solve_deadline` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Autopilot) –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∞—É–∫—Ü–∏–æ–Ω–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ä–µ—à–µ–Ω–∏—è. –≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –±—ã—Å—Ç—Ä—ã—Ö —Ü–∏–∫–ª–æ–≤ –∞—É–∫—Ü–∏–æ–Ω–æ–≤.

2. `Solver1/2/3 ‚Üí Autopilot: Proposed batch`
   Solvers –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç –∞—É–∫—Ü–∏–æ–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å–≤–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ `scores`, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ—à–µ–Ω–∏—è.

3. `Autopilot ‚Üí Autopilot: Pick winner`
   –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è Autopilot –¥–µ–ª–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Ä–µ—à–µ–Ω–∏–π –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —á–µ—Å—Ç–Ω–æ—Å—Ç–∏. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–¥–µ–ª "–†–∞—Å—á–µ—Ç Score –∏ –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π".

### –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

1. `Autopilot ‚Üí Winner: /settle`
   Autopilot —É–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ. Solver –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ on-chain.

2. `Winner ‚Üí Blockchain ‚Üí Autopilot: Execute & report`
   Solver –∏—Å–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ –±–ª–æ–∫—á–µ–π–Ω–µ –∏ —Å–æ–æ–±—â–∞–µ—Ç hash —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Autopilot.
3. `Autopilot ‚Üí Database: Store auction data`
   Autopilot —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∞—É–∫—Ü–∏–æ–Ω–∞: –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ—Ç solvers, scores, surplus fees –¥–ª—è limit –æ—Ä–¥–µ—Ä–æ–≤, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã on-chain –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ solver payouts. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ solvers –≤—ã—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞—Å—á–µ—Ç–∞ –≤—ã–ø–ª–∞—Ç.
   
–ü–æ —Å—É—Ç–∏, Autopilot –∏–≥—Ä–∞–µ—Ç —Ä–æ–ª—å —Å—É–¥—å–∏ –≤ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏ –º–µ–∂–¥—É solvers. –û–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞—É–Ω–¥–∞ - –∫–∞–∫–∏–µ –æ—Ä–¥–µ—Ä–∞ —É—á–∞—Å—Ç–≤—É—é—Ç, –ø–æ –∫–∞–∫–∏–º —Ü–µ–Ω–∞–º —Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü—Ä–∏ —ç—Ç–æ–º —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —É–º–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é: solvers –º–æ–≥—É—Ç –±—ã—Å—Ç—Ä–æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç—å—Å—è –∏ –∏—Å–ø–æ–ª–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏—è, –∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Å—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è, –∞ —Ç–∞–∫ –∂–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞. –≠—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è, –≥–¥–µ —Å—É–¥—å—è —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –∞ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–∞–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è –ø–æ–∑–∂–µ. –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—É —Ä–∞–±–æ—Ç–∞—Ç—å —Å –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é, –Ω–µ –∂–µ—Ä—Ç–≤—É—è –ø—Ä–∏ —ç—Ç–æ–º –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é.

## Solvers

Solvers –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑ —Å–µ–±—è off-chain —Å–µ—Ä–≤–∏—Å –∏–∑ –¥–≤—É—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: driver –∏ solver engine.

```mermaid
sequenceDiagram
    participant Autopilot as ü§ñ<br/>autopilot
    participant Driver as üîß<br/>driver
    participant Engine as üß†<br/>solver engine

    Autopilot->>Driver: auction
    Driver->>Driver: pre-process auction
    Driver->>Driver: fetch liquidity
    Driver->>Engine: auction
    Engine-->>Driver: set of solutions
    Driver->>Driver: post-process solutions
    Driver-->>Autopilot: participate with the best solution
    Autopilot->>Driver: request to execute the settlement,<br/>in case this solver won
    Driver->>Driver: execute the settlement
```

**Driver** - –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É solver: –ø–æ–ª—É—á–∞–µ—Ç –∞—É–∫—Ü–∏–æ–Ω –æ—Ç Autopilot, –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è Engine, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è, –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –≤ autopilot –∏ –∏—Å–ø–æ–ª–Ω—è–µ—Ç –∏—Ö –≤ –±–ª–æ–∫—á–µ–π–Ω–µ. –ï—Å—Ç—å [–æ—Ç–∫—Ä—ã—Ç—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥](https://github.com/cowprotocol/services/tree/main/crates/driver).

**Solver Engine** - —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π. –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç Driver, –Ω–∞—Ö–æ–¥–∏—Ç –ª—É—á—à–∏–µ –ø—É—Ç–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ. –†–∞–∑–ª–∏—á–Ω—ã–µ solvers —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º –¥–æ—Å—Ç—É–ø–Ω—ã –≤ [CoW Protocol solvers](https://github.com/cowprotocol/services/tree/main/crates/solvers). –ù–æ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤—ã–∏–≥—Ä–∞—Ç—å –∞—É–∫—Ü–∏–æ–Ω, –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—É–ø–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å –ø—Ä–∏–≤–∞—Ç–Ω–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å—é `solver engine`.

–†–∞–±–æ—Ç—É solver –º–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ 4 —ç—Ç–∞–ø–∞: –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∞–∑–∞, —Ñ–∞–∑–∞ —Ä–µ—à–µ–Ω–∏—è, —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ —É—á–∞—Å—Ç–∏–µ, –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ (–µ—Å–ª–∏ solver –ø–æ–±–µ–¥–∏–ª).

### –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã Solver

#### –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∞–∑–∞

1. `Autopilot ‚Üí Driver: auction`
   Autopilot –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π –∞—É–∫—Ü–∏–æ–Ω –≤—Å–µ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º solvers. Driver –ø–æ–ª—É—á–∞–µ—Ç "—Å—ã—Ä–æ–π" –∞—É–∫—Ü–∏–æ–Ω —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –¥–∞–Ω–Ω—ã—Ö.

2. `Driver ‚Üí Driver: pre-process auction`
   Driver –æ–±–æ–≥–∞—â–∞–µ—Ç –∞—É–∫—Ü–∏–æ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π: –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω–æ–≤ (decimals, symbols), —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –Ω–µ–≤—ã–ø–æ–ª–Ω–∏–º—ã–µ –æ—Ä–¥–µ—Ä–∞ (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã, –∏—Å—Ç–µ–∫—à–∏–µ), –¥–µ–ª–∞–µ—Ç –±–∞–∑–æ–≤—É—é –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—é.

3. `Driver ‚Üí Driver: fetch liquidity`
   Driver —Å–æ–±–∏—Ä–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤: AMM –ø—É–ª—ã (Uniswap, Balancer, Curve), –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä—ã, —á–∞—Å—Ç–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã.

#### –§–∞–∑–∞ —Ä–µ—à–µ–Ω–∏—è

4. `Driver ‚Üí Engine: auction`
   Driver –ø–µ—Ä–µ–¥–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –∞—É–∫—Ü–∏–æ–Ω –≤ Solver Engine —Å–æ –≤—Å–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π.

5. `Engine ‚Üí Driver: set of solutions`
   Solver Engine –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞—É–∫—Ü–∏–æ–Ω —Å–≤–æ–∏–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–±–æ—Ä –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π —Å –∏—Ö –æ—Ü–µ–Ω–∫–∞–º–∏ –∫–∞—á–µ—Å—Ç–≤–∞.

#### –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ —É—á–∞—Å—Ç–∏–µ

6. `Driver ‚Üí Driver: post-process solutions`
   Driver –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π, —Å–∏–º—É–ª–∏—Ä—É–µ—Ç –∏—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ, –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –¥–µ–ª–∞–µ—Ç —Ä–∞—Å—á–µ—Ç score –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —É—á–∞—Å—Ç–∏—è.

7. `Driver ‚Üí Autopilot: submit solution`
   Driver –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ —Å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º score:

   ```rust
   // https://github.com/cowprotocol/services/blob/main/crates/driver/src/infra/api/routes/solve/dto/solve_response.rs
   pub struct Solution {
      solution_id: u64,              // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ä–µ—à–µ–Ω–∏—è
      score: eth::U256,             //  –û—Ü–µ–Ω–∫–∞ —Ä–µ—à–µ–Ω–∏—è –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –∞—É–∫—Ü–∏–æ–Ω–∞
      submission_address: eth::H160, // –ê–¥—Ä–µ—Å solver –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
      orders: HashMap<OrderId, TradedOrder>, // –ò—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏
      clearing_prices: HashMap<eth::H160, eth::U256>, // –¶–µ–Ω—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ solver
   }
   ```

8. `Autopilot ‚Üí Driver: execute settlement (if winner)`
   –ü—Ä–∏ –ø–æ–±–µ–¥–µ –≤ –∞—É–∫—Ü–∏–æ–Ω–µ Driver –∏—Å–ø–æ–ª–Ω—è–µ—Ç —Ä–µ—à–µ–Ω–∏–µ on-chain.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: Driver –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º, Engine —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.

## –†–∞—Å—á–µ—Ç score –∏ –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π

### –†–∞—Å—á–µ—Ç score

–ö–ª—é—á–µ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –º–µ–∂–¥—É solvers —ç—Ç–æ —Ä–∞—Å—á–µ—Ç `score` (–æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞) —Ä–µ—à–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∞—É–∫—Ü–∏–æ–Ω–∞.

–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ Score —Å–æ–≥–ª–∞—Å–Ω–æ [CIP-38](https://forum.cow.fi/t/cip-38-solver-computed-fees-rank-by-surplus/2061) –∏ [CIP-65](https://forum.cow.fi/t/cip-65-updating-score-definition-for-buy-orders/2930)

```
Score = (User Surplus + Protocol Fees) –≤ ETH
```

**–î–ª—è sell –æ—Ä–¥–µ—Ä–∞:**
```
score = (surplus + protocol_fees) √ó native_price_buy_token
# surplus –¥–ª—è sell –æ—Ä–¥–µ—Ä–∞ —É–∂–µ –≤ buy —Ç–æ–∫–µ–Ω–µ
```

**–î–ª—è buy –æ—Ä–¥–µ—Ä–∞:**
```
score = (surplus + protocol_fees) √ó p_limit √ó native_price_buy_token
–≥–¥–µ p_limit = limit_buy_amount / limit_sell_amount
```

> **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:** –î–ª—è buy –æ—Ä–¥–µ—Ä–æ–≤ surplus –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ sell —Ç–æ–∫–µ–Ω–µ, –ø–æ—ç—Ç–æ–º—É —Å–Ω–∞—á–∞–ª–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –µ–≥–æ –≤ buy —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ –ª–∏–º–∏—Ç–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ p_limit, –∞ –∑–∞—Ç–µ–º –≤ ETH —á–µ—Ä–µ–∑ native_price_buy_token.

–ì–¥–µ:
- `surplus` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–≤–µ—Ä—Ö –ª–∏–º–∏—Ç–Ω–æ–π —Ü–µ–Ω—ã
- `protocol_fees` - –∫–æ–º–∏—Å—Å–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- `native_price_buy_token` - —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∞–µ–º–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –≤ ETH (—Ü–µ–Ω–∞ –∏–∑ –∞—É–∫—Ü–∏–æ–Ω–∞)

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è sell –æ—Ä–¥–µ—Ä–∞:**
```
Sell –æ—Ä–¥–µ—Ä: –ø—Ä–æ–¥–∞—Ç—å 1 ETH –∑–∞ USDC
- –õ–∏–º–∏—Ç–Ω–∞—è —Ü–µ–Ω–∞: 1 ETH = 2000 USDC
- –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ: 1 ETH = 2050 USDC
- User surplus: 2050 - 2000 = 50 USDC (surplus –≤ buy —Ç–æ–∫–µ–Ω–µ)
- Protocol fees: 5 USDC
- –¶–µ–Ω–∞ USDC: 0.0004 ETH

Score = (50 + 5) √ó 0.0004 = 0.022 ETH
# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—É USDC, —Ç–∞–∫ –∫–∞–∫ surplus –∏ fees –≤ USDC (buy —Ç–æ–∫–µ–Ω)
```

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è buy –æ—Ä–¥–µ—Ä–∞:**
```
Buy –æ—Ä–¥–µ—Ä: –∫—É–ø–∏—Ç—å 100 USDC –∑–∞ DAI
- limit_buy_amount: 100 USDC
- limit_sell_amount: 102 DAI (–≥–æ—Ç–æ–≤ –∑–∞–ø–ª–∞—Ç–∏—Ç—å –º–∞–∫—Å–∏–º—É–º)
- executed_sell_amount: 98 DAI (–∑–∞–ø–ª–∞—Ç–∏–ª —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏)
- executed_buy_amount: 100 USDC (–ø–æ–ª—É—á–∏–ª)

1. Surplus –≤ sell —Ç–æ–∫–µ–Ω–µ: 102 - 98 = 4 DAI
2. Protocol fees: 0.5 DAI
3. p_limit = 100 USDC / 102 DAI = 0.98 USDC/DAI
4. –¶–µ–Ω–∞ USDC: 0.0004 ETH

Score = (4 + 0.5) √ó 0.98 √ó 0.0004 = 0.001764 ETH
# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—É USDC, —Ç–∞–∫ –∫–∞–∫ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–π surplus –≤ USDC (buy —Ç–æ–∫–µ–Ω)

–ü–æ—à–∞–≥–æ–≤–æ:
- 4.5 DAI surplus –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ buy —Ç–æ–∫–µ–Ω—ã: 4.5 √ó 0.98 = 4.41 USDC
- 4.41 USDC –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ ETH: 4.41 √ó 0.0004 = 0.001764 ETH
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–∞ score:**

```rust
// https://github.com/cowprotocol/services/blob/main/crates/driver/src/domain/competition/solution/scoring.rs
fn score(&self, native_prices: &auction::Prices) -> Result<eth::Ether, Error> {
    let native_price_buy = native_prices
        .get(&self.signed_buy.token)
        .ok_or(Error::MissingPrice(self.signed_buy.token))?;

    let surplus_in_surplus_token = self
        .user_surplus()?
        .0
        .checked_add(self.fees()?.0)
        .ok_or(Error::Math(Math::Overflow))?;

    let score = match self.side {
        // surplus –¥–ª—è sell –æ—Ä–¥–µ—Ä–æ–≤ —É–∂–µ –≤ buy —Ç–æ–∫–µ–Ω–∞—Ö, –ø—Ä–æ—Å—Ç–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ ETH
        Side::Sell => native_price_buy.in_eth(eth::TokenAmount(surplus_in_surplus_token)),
        
        Side::Buy => {
            // surplus –¥–ª—è buy –æ—Ä–¥–µ—Ä–æ–≤ –≤ sell —Ç–æ–∫–µ–Ω–∞—Ö. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ buy —Ç–æ–∫–µ–Ω—ã:
            // buy_amount = surplus * buy_price / sell_price
            let surplus_in_buy_tokens: eth::U256 = surplus_in_surplus_token
                .full_mul(self.signed_buy.amount.0)         // surplus * buy_price  
                .checked_div(self.signed_sell.amount.0.into())  // / sell_price
                .ok_or(Error::Math(Math::DivisionByZero))?
                .try_into()
                .map_err(|_| Error::Math(Math::Overflow))?;

            // –ó–∞—Ç–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º buy —Ç–æ–∫–µ–Ω—ã –≤ ETH
            native_price_buy.in_eth(surplus_in_buy_tokens.into())
        }
    };
    Ok(score)
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏–π –æ—Ç –≤—Å–µ—Ö solvers, Autopilot –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–±–æ—Ä–∞ —Å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π score:

**1. –ü–µ—Ä–µ—Å—á–µ—Ç Score –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏**
Autopilot –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç score –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–µ –∂–µ —Ü–µ–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ –∞—É–∫—Ü–∏–æ–Ω–∞ (–∞ –Ω–µ —Ç–µ–∫—É—â–∏–µ —Ä—ã–Ω–æ—á–Ω—ã–µ —Ü–µ–Ω—ã). –†–µ—à–µ–Ω–∏—è, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ —É–¥–∞–µ—Ç—Å—è –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å score, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è.

**2. EBBO –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Å—Ç–Ω–æ—Å—Ç–∏ (Equal or Better than Best Offer)**
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ —Ü–µ–Ω—ã –≤ —Ä–µ—à–µ–Ω–∏–∏ –Ω–µ —Ö—É–∂–µ –ª—É—á—à–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (Uniswap, Sushiswap, Balancer –∏ –¥—Ä.). –†–µ—à–µ–Ω–∏—è, –Ω–∞—Ä—É—à–∞—é—â–∏–µ EBBO, –æ—Ç–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ "unfair".

**3. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –≤—ã–±–æ—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª—è**
–í—ã–±–∏—Ä–∞–µ—Ç—Å—è —Ä–µ—à–µ–Ω–∏–µ —Å –Ω–∞–∏–≤—ã—Å—à–∏–º –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–Ω—ã–º score.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π:**

```rust
// https://github.com/cowprotocol/services/blob/main/crates/autopilot/src/domain/competition/winner_selection/combinatorial.rs
fn partition_unfair_solutions(&self, mut participants: Vec<Participant<Unranked>>, 
                             auction: &domain::Auction) -> PartitionedSolutions {
    // –ü–ï–†–ï–°–ß–ï–¢ SCORE –≤ autopilot –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏!
    let scores_by_solution = compute_scores_by_solution(&mut participants, auction);
    
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ü–ï–†–ï–°–ß–ò–¢–ê–ù–ù–û–ú–£ score
    participants.sort_by_key(|participant| {
        std::cmp::Reverse(participant.solution().computed_score().expect("computed").get().0)
    });
    
    // Fairness check —Å baseline scores (EBBO)
    let baseline_scores = compute_baseline_scores(&scores_by_solution);
    let (fair, unfair) = participants.into_iter().partition_map(|p| {
        if aggregated_scores.iter().all(|(pair, score)| {
            baseline_scores.get(pair).is_none_or(|baseline| score >= baseline)  // EBBO check
        }) {
            Either::Left(p)   // Fair solution
        } else {
            Either::Right(p)  // Unfair solution - –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
        }
    });
    
    PartitionedSolutions { kept: fair, discarded: unfair }
}
```

–°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —á–µ—Å—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ —Ç—Ä–∏ —É—Ä–æ–≤–Ω—è –ø—Ä–∞–≤–∏–ª: smart contract, off-chain –ø—Ä–æ—Ç–æ–∫–æ–ª (Autopilot) –∏ social consensus (governance —Å–æ —à—Ç—Ä–∞—Ñ–∞–º–∏).

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Batch auctions –≤ CoW Protocol –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π —Å–ª–æ–∂–Ω—É—é, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π. –¢—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Orderbook, Autopilot, Solvers) –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã:
- **–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–µ clearing prices
- **–ó–∞—â–∏—Ç–∞ –æ—Ç MEV** –±–ª–∞–≥–æ–¥–∞—Ä—è –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ
- **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –º–µ–∂–¥—É solvers** –∑–∞ –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ EBBO –ø—Ä–æ–≤–µ—Ä–∫–∏

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–µ–ª–∞–µ—Ç CoW Protocol —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –≤ –º–∏—Ä–µ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏, –≥–¥–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞—â–∏—â–µ–Ω—ã –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã.

## –°—Å—ã–ª–∫–∏

- [CoW Protocol Documentation](https://docs.cow.fi/)
- [Orderbook API Reference](https://docs.cow.fi/cow-protocol/reference/apis/orderbook)
- [Autopilot Source Code](https://github.com/cowprotocol/services/tree/main/crates/autopilot)
- [Driver Source Code](https://github.com/cowprotocol/services/tree/main/crates/driver)
- [CIP-38: Solver Computed Fees](https://forum.cow.fi/t/cip-38-solver-computed-fees-rank-by-surplus/2061)
- [CIP-65: Score Definition Update](https://forum.cow.fi/t/cip-65-updating-score-definition-for-buy-orders/2930)