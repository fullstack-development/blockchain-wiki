# Native Abstract Accounts vs EIP-4337

**–ê–≤—Ç–æ—Ä:** [–†–æ–º–∞–Ω –Ø—Ä–ª—ã–∫–æ–≤](https://github.com/rlkvrv) üßê

–í Ethereum —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤: –≤–Ω–µ—à–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç—ã (Externally Owned Accounts, EOA), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–æ –Ω–µ –æ–±–ª–∞–¥–∞—é—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º–æ–π –ª–æ–≥–∏–∫–æ–π, –∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, –∏–º–µ—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏, –Ω–æ –Ω–µ—Å–ø–æ—Å–æ–±–Ω—ã–µ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.
–≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π –±–ª–æ–∫—á–µ–π–Ω–∞ –∏ –ø–æ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥ –≤—Ö–æ–¥–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

–ü–µ—Ä–≤—ã–º —à–∞–≥–æ–º –∫ —Ä–µ—à–µ–Ω–∏—é —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã —Å—Ç–∞–ª [EIP-4337](https://eips.ethereum.org/EIPS/eip-4337), –∫–æ—Ç–æ—Ä—ã–π –≤–Ω–µ–¥—Ä—è–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é Abstract Accounts (AA) –∏ Smart-contract account. –°–æ–≥–ª–∞—Å–Ω–æ [—Å—Ç–∞–Ω–¥–∞—Ä—Ç—É](https://github.com/fullstack-development/blockchain-wiki/blob/main/EIPs/erc-4337/README.md) –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ EOA –∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

–ù–∞–ø–æ–º–Ω—é –æ—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è EOA –∏ AA.

|                                        | EOAs (–í–Ω–µ—à–Ω–∏–µ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏)                                                                     | –£—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤                                                                                         |
| -------------------------------------- | ------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∞ –≤ EVM                                      | –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º–∞ –≤ —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞                                                 |
| –û–±—Ä–∞—â–µ–Ω–∏–µ —Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏         | –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ —Å–ª–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ–±–µ–∑–æ–ø–∞—Å–∏—Ç—å, –¥–∞–∂–µ –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π                      | –ú–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —Ç–∞–∫–∏–µ –∫–∞–∫ –±–∏–æ–º–µ—Ç—Ä–∏—è –∏–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã              |
| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è             | –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á. –ï—Å–ª–∏ –≤—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –≤–∞—à –ø—Ä–∏–≤–∞—Ç–Ω–∏–∫, –≤—ã —Ç–µ—Ä—è–µ—Ç–µ –≤–∞—à–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ | –ú–µ—Ç–æ–¥—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ü–∏–∞–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–ª—é—á–∏ |

## –í–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –≤ –ø–æ—Ç–æ–∫–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

–î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –¥–≤—É–º—è –ø–æ–¥—Ö–æ–¥–∞–º–∏, –¥–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Å—Ö–µ–º—ã, –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É—é—â–∏–µ –ø—É—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç –µ—ë –Ω–∞—á–∞–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ—à–µ–ª—å–∫–µ –¥–æ –º–æ–º–µ–Ω—Ç–∞ –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –±–ª–æ–∫—á–µ–π–Ω.

### EOA –∏ Smart account —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ Ethereum

EIP-4337 –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–æ—Ç–æ–∫–æ–ª–µ Ethereum, –Ω–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ê–ê –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–Ω–µ–¥—Ä—è—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å - Bundler. –≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–∞–±–æ—Ç—É –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ mempool –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –±–ª–æ–∫—á–µ–π–Ω. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç EntryPoint.sol –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

> **Mempool** - –æ–±–ª–∞—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –æ–∂–∏–¥–∞—é—â–∏—Ö –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –±–ª–æ–∫.

![eip-4337-tx-flow](./img/eip-4337-tx-flow.png)

–û–¥–Ω–∞–∫–æ, —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Paymaster –≤ —Å–≤—è–∑–∫–µ —Å EOA –≤ —Ä–∞–º–∫–∞—Ö EIP-4337.

> **Paymaster** - —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å –æ–ø–ª–∞—Ç—É –≥–∞–∑–∞ –≤ –Ω–∞—Ç–∏–≤–Ω–æ–π –≤–∞–ª—é—Ç–µ –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü—Ä–∏ —ç—Ç–æ–º –æ–Ω –º–æ–∂–µ—Ç –æ–±–ª–∞–¥–∞—Ç—å –ª—é–±–æ–π –ª–æ–≥–∏–∫–æ–π –æ–ø–ª–∞—Ç—ã: —Å–ø–∏—Å—ã–≤–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ERC20, –¥–µ–ª–∞—Ç—å –¥–æ–ø. –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–±–æ –ø—Ä–æ—Å—Ç–æ –º–æ–∂–µ—Ç —Å–ø–æ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –ª—é–±—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ —Ç—Ä–µ–±—É—è –Ω–∏—á–µ–≥–æ –≤–∑–∞–º–µ–Ω.

–≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑–≥–∞–∑–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä [GSN](https://opengsn.org/) (–∫ —Å–ª–æ–≤—É, –Ω–∞ –±–∞–∑–µ –æ–ø—ã—Ç–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—ã–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–∞–Ω–Ω—ã–π EIP).

–ï—â–µ –æ–¥–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ - —ç—Ç–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥–æ–±–Ω—ã—Ö –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ–¥–Ω–æ –∏–∑ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π (–ø—Ä–∏–º. [Alchemy](https://accountkit.alchemy.com/)) –∏ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –∏—Ö API, —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–≤–æ—é –ª–æ–≥–∏–∫—É –∫–æ—à–µ–ª—å–∫–∞. –ö —Ç–æ–º—É –∂–µ —Å–∞–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞ EIP-4337 –¥–∞–ª–µ–∫–æ –Ω–µ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–∞.

### EOA –∏ Smart account —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ zkSync

–¢–µ–ø–µ—Ä—å –ø–æ—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫–æ–π –ø—É—Ç—å –ø—Ä–æ–¥–µ–ª—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ —Ä–µ—à–µ–Ω–∏–∏ –æ—Ç zkSync. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞—Ç–∏–≤–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É Abstract Account –∏ Paymaster –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤. –ó–¥–µ—Å—å –≤—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã —è–≤–ª—è—é—Ç—Å—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ (–¥–∞–∂–µ EOA), —Ç–∞–∫–∂–µ –≤ zkSync –ª—é–±—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã —è–≤–ª—è—é—Ç—Å—è "first-class citizen", —Ç–æ –µ—Å—Ç—å –æ–Ω–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ –µ–¥–∏–Ω—ã–π Mempool –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ.

![native-aa-tx-flow](./img/native-aa-tx-flow.png)

–ü–æ—Å–ª–µ Mempool —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º. –ï—Å–ª–∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å —Å Ethereum, –∑–¥–µ—Å—å –æ–ø–µ—Ä–∞—Ç–æ—Ä –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–æ–ª—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞ –∏ –±–∞–Ω–¥–ª–µ—Ä–∞.
–ü–æ—Å–ª–µ —á–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç `bootloader`.

> bootloader - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç L2 zkSync. –ü–æ —Å—É—Ç–∏ —ç—Ç–æ —è–¥—Ä–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å–≤—è–∑—ã–≤–∞–µ—Ç –∏ –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

–í —Ä–∞–∑—Ä–µ–∑–µ AA, –∫–æ–Ω—Ç—Ä–∞–∫—Ç bootloader —è–≤–ª—è–µ—Ç—Å—è –∞–Ω–∞–ª–æ–≥–æ–º EntryPoint. –ï—Å–ª–∏ –≥—Ä—É–±–æ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–µ - –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –µ—Å—Ç—å –ª–∏ –∫–∞–∫–∞—è-—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è Paymaster.

–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ EIP-4337 –∏ Native AA zkSync:
| | EIP-4337 | Native AA zkSync |
| --------------------------------- | --------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| –°—Ç–µ–ø–µ–Ω—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ | –ù–µ –Ω–∞—Ç–∏–≤–Ω–∞—è. –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Å–µ—Ä–≤–∏—Å—ã | –ù–∞—Ç–∏–≤–Ω–∞—è. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –±–ª–æ–∫—á–µ–π–Ω–µ "–∏–∑ –∫–æ—Ä–æ–±–∫–∏" |
| –£—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∏ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Paymaster —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–º–∞—Ä—Ç-–∞–∫–∫–∞—É–Ω—Ç–æ–≤ | –í—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã, –≤–∫–ª—é—á–∞—è EOA, –≤–µ–¥—É—Ç —Å–µ–±—è –∫–∞–∫ –∞–∫–∫–∞—É–Ω—Ç—ã —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç Paymaster |
| –ü–æ—Ç–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | –î–≤–∞ –ø–æ—Ç–æ–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å —Ä–∞–∑–Ω–æ–π –ª–æ–≥–∏–∫–æ–π, –¥–≤–∞ –º–µ–º–ø—É–ª–∞ | –ï–¥–∏–Ω—ã–π –º–µ–º–ø—É–ª –∏ –ø–æ—Ç–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç—Å—è –ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è EOA –∏–ª–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ |
| –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤ UserOperation –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | –û–±—ã—á–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–æ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ |

–î–∞–ª–µ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞—Ç–∏–≤–Ω—ã—Ö AA –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –∏ –ø–æ –ø–æ—Ä—è–¥–∫—É.

## –ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä –Ω–∞—Ç–∏–≤–Ω—ã—Ö AA

### –°–æ–∑–¥–∞–Ω–∏–µ AA –≤ zkSync

–ö–∞–∫ —è —É–∂–µ –≥–æ–≤–æ—Ä–∏–ª, EOA –≤ zkSync —Ç–∞–∫–∂–µ —è–≤–ª—è—é—Ç—Å—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏. –ü–æ–¥–∫–ª—é—á–∏–≤ —Å–≤–æ–π EOA –∫ —Å–µ—Ç–∏ zkSync era –≤–Ω–µ—à–Ω–µ –Ω–µ –±—É–¥–µ—Ç –Ω–∏–∫–∞–∫–æ–π —Ä–∞–∑–Ω–∏—Ü—ã, –Ω–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º —ç—Ç–æ —Ç–µ–ø–µ—Ä—å –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–æ—à–µ–ª–µ–∫, –∞ –±–∞–∑–æ–≤—ã–π Smart account. –ë–∞–∑–æ–≤—ã–π, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏–∑ –≤—Å–µ—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –∫–æ—Ç–æ—Ä—ã–µ –¥–∞–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ —Å —Ç–∞–∫–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º Paymaster (–∏–∑–º–µ–Ω–∏—Ç—å —Ñ–ª–æ—É –æ–ø–ª–∞—Ç—ã –∑–∞ –≥–∞–∑). –ù–æ –∏ —ç—Ç–æ —É–∂–µ —è–≤–ª—è–µ—Ç—Å—è –±–æ–ª—å—à–∏–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ–º.

![eoas-with-paymaster](./img/eoas-with-paymaster.png)

–ß—Ç–æ–±—ã –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å–µ–º–∏ –ø–ª—é—Å–∞–º–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ - –Ω—É–∂–Ω–æ —Ç–∞–∫–æ–π –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞—Ç—å. –ó–∞ —ç—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç `ContractDeployer` (–∫–æ–¥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [—Ç—É—Ç](https://github.com/matter-labs/era-system-contracts/blob/main/contracts/ContractDeployer.sol)).

–°–∏—Å—Ç–µ–º–Ω—ã–π —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç ContractDeployer –≤ zkSync –∏–≥—Ä–∞–µ—Ç –∫–ª—é—á–µ–≤—É—é —Ä–æ–ª—å –≤ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, –≤–∫–ª—é—á–∞—è AA. –û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ `create`, `create2` –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∏ `createAccount`, `create2Account` –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è AA.

–ú–µ—Ç–æ–¥—ã `create` –∏ `create2` —Ö–æ—Ä–æ—à–æ –∏–∑–≤–µ—Å—Ç–Ω—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –∏ –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –æ–±—ã—á–Ω—ã—Ö —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, –º–µ—Ç–æ–¥ `create2`, –µ—Å–ª–∏ –≥—Ä—É–±–æ –æ–ø–∏—Å–∞—Ç—å –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏—é, –¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –∞–¥—Ä–µ—Å —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –¥–æ –µ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ –¥–∞–∂–µ –ø–æ–¥–æ–±—Ä–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π). –°–ª–µ–¥—É—è —ç—Ç–æ–π –ª–æ–≥–∏–∫–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è AA —Ç–∞–∫–∂–µ —Å–¥–µ–ª–∞–ª–∏ –¥–≤–∞ –º–µ—Ç–æ–¥–∞ (—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–ª–∏ –∏ –±–µ–∑).

![contract-deployer-flow](./img/contract-deployer-flow.png)

–î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–≤–æ–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ AA –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:

-   –Ω–∞–ø–∏—Å–∞—Ç—å —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ [IAccount](https://github.com/matter-labs/era-system-contracts/blob/main/contracts/interfaces/IAccount.sol) –∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç [–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã](https://era.zksync.io/docs/reference/concepts/account-abstraction.html#iaccount-interface)
-   —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏—Å–ø–æ–ª—å–∑—É—è zksolc
-   –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [zkSync SDKs](https://era.zksync.io/docs/api/) –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –¥–µ–ø–ª–æ—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–º–∞—Ä—Ç-–∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–ú–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ç–æ—Ä–∏–∞–ª—ã [—Ç—É—Ç](https://github.com/matter-labs/custom-aa-tutorial) –∏ [—Ç—É—Ç](https://era.zksync.io/docs/dev/tutorials/custom-aa-tutorial.html), –æ–Ω–∏ –ø–æ–∑–≤–æ–ª—è—Ç –ø–æ–Ω—è—Ç—å, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é –≤–µ—Ä—Å–∏—é —Ç–∞–∫–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞, –ø–æ—ç—Ç–æ–º—É –∑–¥–µ—Å—å —è –Ω–µ –±—É–¥—É –≤–¥–∞–≤–∞—Ç—å—Å—è –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –¥–µ–ø–ª–æ—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∞ –æ–±—ä—è—Å–Ω—é —Ç–æ–ª—å–∫–æ —Å—É—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞.

> –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ï—Å–ª–∏ –≤—ã –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤ –ø—Ä–æ–µ–∫—Ç–∞ hardhat –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ zksolc –≤–∫–ª—é—á–∏—Ç —Ñ–ª–∞–≥ `isSystem: true`.

–í–æ–∑–≤—Ä–∞—â–∞—è—Å—å –∫ –º–µ—Ç–æ–¥–∞–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ `ContractDeployer`, –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:

-   —Å–æ–ª—å (–Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è `create2Account`)
-   —Ö—ç—à –±–∞–π—Ç-–∫–æ–¥–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Å –ª–æ–≥–∏–∫–æ–π AA (–≤ zkSync –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ö—ç—à –±–∞–π—Ç-–∫–æ–¥–∞ –∞ –Ω–µ —Å–∞–º –±–∞–π—Ç-–∫–æ–¥)
-   –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –≤–∞—à–µ–≥–æ AA (–∫–∞–∫–∏–µ-–ª–∏–±–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–¥–∞—Ç—å –≤ –º–æ–º–µ–Ω—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è, –ø—Ä–∏–º–µ—Ä: –∞–¥—Ä–µ—Å–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º—É–ª—å—Ç–∏—Å–∏–≥–∞)
-   –≤–µ—Ä—Å–∏—è AA, –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤–µ—Ä—Å–∏—è –æ–¥–Ω–∞ - `Version1` (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å `None`, –Ω–æ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –¥–ª—è –∞–¥—Ä–µ—Å–æ–≤, —Ä–æ–ª—å –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —Å —Ç–∞–∫–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è –Ω–∏—á–µ–≥–æ —Å–¥–µ–ª–∞—Ç—å)

![aa-creation](./img/aa-creation.png)

```solidity
    function createAccount(
        bytes32 /** */,
        bytes32 _bytecodeHash, // –•—ç—à –±–∞–π—Ç-–∫–æ–¥–∞ –Ω–∞—à–µ–π –≤–µ—Ä—Å–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
        bytes calldata _input, // –ó–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
        AccountAbstractionVersion _aaVersion // –í–µ—Ä—Å–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
    ) external payable returns (address newAddress);
```

–ù–∞ –≤—ã—Ö–æ–¥–µ –º—ã –ø–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –Ω–∞—à–µ–≥–æ —Å–º–∞—Ä—Ç-–∞–∫–∫–∞—É–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–º —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–æ–≤–µ—Ä—à–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É—è [API zkSync](https://era.zksync.io/docs/api/)).

### –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏?

–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–∞–±–æ—Ç—ã —Å AA (Abstract Account) –≤ zkSync, –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Externally Owned Accounts (EOA).

–¢—É—Ç –≤—Å–µ –ø—Ä–æ—Å—Ç–æ, `ContractDeployer` —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ö—ç—à –±–∞–π—Ç-–∫–æ–¥–∞ –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–≥–æ –∏–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç `AccountCodeStorage` —Å–∏—Å—Ç–µ–º—ã. –≠—Ç–æ –º–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å –∑–∞–ø–∏—Å—å—é –≤ –º–∞–ø–ø–∏–Ω–≥ (—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ) —Ç–∏–ø–∞ address => bytecodeHash.

> **AccountCodeStorage** - —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç —Ö—ç—à–∏ –±–∞–π—Ç-–∫–æ–¥–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã—Ö —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

![account-code-storage](./img/account-code-storage.png)

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø–æ –∞–¥—Ä–µ—Å—É –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ª–µ–≥–∫–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ —É –Ω–µ–≥–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –∫–æ–¥, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç –∏ –≤—ã–∑—ã–≤–∞—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º, –∑–Ω–∞—á–∏—Ç —ç—Ç–æ EOA (–º–µ—Ç–æ–¥ `isEOA(addr)` –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ `bootloader`).

```solidity
    /// @dev Checks whether an address is an EOA (i.e. has not code deployed on it)
    /// @param addr The address to check
    function isEOA(addr) -> ret { ... } // bootlader code fragment
```

–ö–æ–≥–¥–∞ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ EOA, –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ Ethereum –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç `DefaultAccount`, –µ—Å–ª–∏ –∂–µ —É –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ –µ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –∫–æ–¥ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è AA, –∑–Ω–∞—á–∏—Ç —ç—Ç–æ Smart account.

![is-eoa](./img/is-eoa.png)

–ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –≤ zkSync EOA —Ç–æ–∂–µ —Å—á–∏—Ç–∞—é—Ç—Å—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏, –∑–∞ –ª–æ–≥–∏–∫—É –µ–≥–æ —Ä–∞–±–æ—Ç—ã –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç `DefaultAccount` (–∫–æ–¥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [—Ç—É—Ç](https://github.com/matter-labs/era-system-contracts/blob/main/contracts/DefaultAccount.sol)). –ì–ª–∞–≤–Ω–∞—è –µ–≥–æ –∑–∞–¥–∞—á–∞ –≤–µ—Å—Ç–∏ —Å–µ–±—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–π EOA, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø–ª–∞—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ Paymaster. –ü—Ä–∏ —ç—Ç–æ–º –≤–µ—Ä—Å–∏—è –ê–ê (AccountAbstractionVersion) –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–∫ Smart account —Ç–∞–∫ –∏ Default account (–±–∞–∑–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —É –Ω–∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è, –µ—Å—Ç—å –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã).

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –æ—Ç–Ω–µ—Å—Ç–∏ –≤ –æ–¥–Ω—É –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:

-   **EOA:** –ü—Ä—è–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
-   **Smart account:** –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è AA
-   **Smart contract:** –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π –∫–æ–¥ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
-   **System contract:** –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å–æ —Å–ª—É–∂–µ–±–Ω–æ–π –ª–æ–≥–∏–∫–æ–π, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Å–∏—Å—Ç–µ–º—ã
-   **AccountAbstractionVersion.None:** –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏–∫–∞–∫ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ.

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ –∫—Ç–æ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∞–ª—å–Ω–µ–π—à–∞—è –ª–æ–≥–∏–∫–∞.

### –ü—Ä–æ—Ü–µ—Å—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –≤ zkSync –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö Smart account, –ø—Ä–∏ —ç—Ç–æ–º —É—á—Ç–µ–º, —á—Ç–æ –¥–ª—è EOA –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Ç–æ–≥–æ, —á—Ç–æ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è EOA —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω—ã –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ `DefaultAccount`.

[–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã](https://era.zksync.io/docs/reference/concepts/account-abstraction.html#iaccount-interface) - —ç—Ç–æ `validateTransaction` –∏ `executeTransaction`. –î–ª—è Smart account –º—ã –º–æ–∂–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –Ω–∏—Ö –ª—é–±—É—é –ª–æ–≥–∏–∫—É, –Ω–æ —ç—Ç–æ —Å–æ–≤—Å–µ–º –Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –≤—Å–µ —Ç–∞–∫–∏ –±–∞–∑–æ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞.

–ü—Ä–æ—Ü–µ—Å—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–∏–π:

1. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `nonce` —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è
    > **Nonce** –æ–∑–Ω–∞—á–∞–µ—Ç "number used once" (—á–∏—Å–ª–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ). –≠—Ç–æ —á–∏—Å–ª–æ, –∫–æ—Ç–æ—Ä–æ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ –∞–∫–∫–∞—É–Ω—Ç–∞ `validateTransaction`, –≥–¥–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ—Ç–æ—Ä—É—é –≤—ã –∑–∞–ª–æ–∂–∏—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä –∑–¥–µ—Å—å –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å—å –≤—ã–∑—ã–≤–∞—é—â–µ–π —Å—Ç–æ—Ä–æ–Ω—ã
3. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç —á—Ç–æ –≤—ã –ø–æ–º–µ—Ç–∏–ª–∏ `nonce`, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π
4. (**Paymaster –Ω–µ —É–∫–∞–∑–∞–Ω –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**) –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É `bootloader`

    `4`. (**Paymaster —É–∫–∞–∑–∞–Ω –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**) –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –µ–≥–æ –ª–æ–≥–∏–∫–∏ –∏ –æ–ø–ª–∞—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —á—É—Ç—å –ø–æ–∑–∂–µ)

5. –°–∏—Å—Ç–µ–º–æ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ `bootloader` –ø–æ–ª—É—á–∏–ª –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã –≥–∞–∑–∞ –∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

![tx-validate-flow](./img/tx-validate-flow.png)

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∑–¥–µ—Å—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤—Ç–æ—Ä–æ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ (`executeTransaction`), –ø–æ—Ä—è–¥–æ–∫ —Ç–∞–∫–æ–π:

6. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `executeTransaction`, –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—ã–∑–æ–≤ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –¥–µ–ø–ª–æ—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞) –ª–∏–±–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –≤—ã–∑–æ–≤.
7. (**–¢–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ —É—á–∞—Å—Ç–∏—è Paymaster –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**) –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ `postTransaction` –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ Paymaster. –≠—Ç–æ—Ç —à–∞–≥ –æ–±—ã—á–Ω–æ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –≥–∞–∑.

![tx-execute](./img/tx-execute.png)

#### –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

–î–ª—è –∑–∞—â–∏—Ç—ã —Å–∏—Å—Ç–µ–º—ã –æ—Ç DoS-–∞—Ç–∞–∫ —ç—Ç–∞–ø –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

-   –õ–æ–≥–∏–∫–∞ Smart account –º–æ–∂–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ —Å–ª–æ—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∞–∫–∫–∞—É–Ω—Ç—É. –≠—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Å–ª–æ—Ç—ã, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –∞–∫–∫–∞—É–Ω—Ç–∞, –Ω–æ –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è –¥—Ä—É–≥–∏—Ö —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä –±–∞–ª–∞–Ω—Å —Ç–æ–∫–µ–Ω–æ–≤ ERC20 –∏–ª–∏ —Å—É–º–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–∞—è –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è)

-   –õ–æ–≥–∏–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `block.number`)

-   –¢—Ä–µ–±—É–µ—Ç—Å—è, —á—Ç–æ–±—ã –∞–∫–∫–∞—É–Ω—Ç —É–≤–µ–ª–∏—á–∏–≤–∞–ª `nonce` –Ω–∞ 1. –≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∫ –∫–æ–ª–ª–∏–∑–∏—è–º —Ö—ç—à–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.
    > **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í –±—É–¥—É—â–µ–º —ç—Ç–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç —Å–Ω—è—Ç–æ, —á—Ç–æ–±—ã –ø–æ–∑–≤–æ–ª–∏—Ç—å –±–æ–ª–µ–µ –æ–±—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏).

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Paymaster –∏ –±–µ–∑–≥–∞–∑–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –¥–µ—Ç–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ Paymaster, –¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è, –∫–∞–∫ –≤ zkSync –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

–í—Å–µ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ, –≤–æ –≤—Ä–µ–º—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫ –Ω–µ–π –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–≤–∞ –ø–æ–ª—è:

-   `paymaster` - —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ `uint256`, –µ—Å–ª–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É—á–∞—Å—Ç–≤—É–µ—Ç Paymaster –∏–∑ —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –≤—ã—Ç–∞—â–∏—Ç—å –µ–≥–æ –∞–¥—Ä–µ—Å, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–µ —Ç–∞–º –±—É–¥–µ—Ç 0
-   `paymasterInput` - —ç—Ç–æ –º–∞—Å—Å–∏–≤ —Ç–∏–ø–∞ `bytes`, –≥–¥–µ –≤ –ø–µ—Ä–≤—ã—Ö 4 –±–∞–π—Ç–∞—Ö —É–∫–∞–∑–∞–Ω —Ç–∏–ø Paymaster, –¥–∞–ª—å—à–µ –∏–¥—É—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã –¥–∞–Ω–Ω—ã–µ

**–û –∫–∞–∫–∏—Ö —Ç–∏–ø–∞—Ö –∏–¥–µ—Ç —Ä–µ—á—å?** –°—É—â–µ—Å—Ç–≤—É—é—Ç –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–∞ Paymaster: **ApprovalBased** –∏ **General**.

**ApprovalBased** Paymaster - —ç—Ç–æ –µ—â–µ –æ–¥–Ω–æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –Ω–∞—Ç–∏–≤–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–æ–±–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è, —Å–µ–π—á–∞—Å –≤—Å–µ –æ–±—ä—è—Å–Ω—é.

–û–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç—Ä–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞:

-   –ê–¥—Ä–µ—Å ERC20 —Ç–æ–∫–µ–Ω–∞
-   –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `allowance`, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–≤–æ–¥–æ–º —Å—Ä–µ–¥—Å—Ç–≤
-   –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

```solidity
    function approvalBased(address _token, uint256 _minAllowance, bytes calldata _innerInput) external;
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç?** –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –∑–∞—Ä–∞–Ω–µ–µ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–±—ä–µ–º –≥–∞–∑–∞ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ ERC20 —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –µ—ë –æ–ø–ª–∞—Ç—ã. –ü–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç—Ç–æ–π —Å—É–º–º—ã –º—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `allowance` –¥–ª—è Paymaster, –¥–∞–≤–∞—è —Å–∏—Å—Ç–µ–º–µ –∑–µ–ª—ë–Ω—ã–π —Å–≤–µ—Ç –Ω–∞ –≤—ã–∑–æ–≤ `approve` –∑–∞ –Ω–∞—Å. –≠—Ç–æ –¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å Paymaster'—É –ª–µ–≥–∫–æ —Å–ø–∏—Å–∞—Ç—å –Ω—É–∂–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –æ—Ç –∏–º–µ–Ω–∏ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ü§Ø, –Ω—É —Ä–∞–∑–≤–µ —ç—Ç–æ –Ω–µ –∫—Ä—É—Ç–æ?

**General** Paymaster –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞—Ä–≥—É–º–µ–Ω—Ç (input), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª–∏—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –Ω–µ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. –≠—Ç–æ—Ç —Ç–∏–ø Paymaster –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ª—é–±—É—é –∑–∞–¥–∞–Ω–Ω—É—é –≤–∞–º–∏ –ª–æ–≥–∏–∫—É, –≤–∫–ª—é—á–∞—è —Å—Ü–µ–Ω–∞—Ä–∏–∏, –≥–¥–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —Å–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤.

![paymaster-types](./img/paymaster-types.png)

#### –°–æ–∑–¥–∞–Ω–∏–µ Paymaster

–ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å Paymaster, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ [IPaymaster](https://github.com/matter-labs/era-system-contracts/blob/main/contracts/interfaces/IPaymaster.sol) –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ `validateAndPayForPaymasterTransaction` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) –∏ `postTransaction` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –∏–≥—Ä–∞–µ—Ç –≤–∞–∂–Ω—É—é —Ä–æ–ª—å –≤ –ª–æ–≥–∏–∫–µ –æ–ø–ª–∞—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

–ú–µ—Ç–æ–¥ `validateAndPayForPaymasterTransaction` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å Paymaster –æ–ø–ª–∞—Ç–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. –û–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç—Ä–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞: —Ö—ç—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π EOA —Ö—ç—à, –∏ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ï—Å–ª–∏ Paymaster —Å–æ–≥–ª–∞—Å–µ–Ω —Å –æ–ø–ª–∞—Ç–æ–π, –º–µ—Ç–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –Ω–∞—Ç–∏–≤–Ω—É—é –≤–∞–ª—é—Ç—É, —Ä–∞–≤–Ω—É—é –∏–ª–∏ –ø—Ä–µ–≤—ã—à–∞—é—â—É—é `tx.gasPrice * tx.gasLimit`. –¢–∞–∫–∂–µ –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≤—ã–∑–æ–≤–∞ `postTransaction`.

```solidity
    function validateAndPayForPaymasterTransaction(
        bytes32 _txHash, // –•—ç—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        bytes32 _suggestedSignedHash, // –•—ç—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–π EOA
        Transaction calldata _transaction // –î–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    ) external payable returns (bytes4 magic, bytes memory context);
```

–ú–µ—Ç–æ–¥ `postTransaction` —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç EIP-4337, –µ–≥–æ –≤—ã–∑–æ–≤ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω: –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –≥–∞–∑–∞, –º–µ—Ç–æ–¥ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è.

`postTransaction` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —á–µ—Ç—ã—Ä–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞: –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π `validateAndPayForPaymasterTransaction`, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –µ—ë —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏, –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º –≥–∞–∑–∞, –ø–æ–¥–ª–µ–∂–∞—â–∏–π –≤–æ–∑–≤—Ä–∞—Ç—É Paymaster'—É.

```solidity
    function postTransaction(
        bytes calldata _context, // –ö–æ–Ω—Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∏–∑ –º–µ—Ç–æ–¥–∞ validateAndPayForPaymasterTransaction
        Transaction calldata _transaction, // –î–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        bytes32 _txHash, // –•—ç—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        bytes32 _suggestedSignedHash, –•—ç—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–π EOA
        ExecutionResult _txResult, // –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        uint256 _maxRefundedGas // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É Paymaster
    ) external payable;
```

_–ó–∞–º–µ—Ç–∫–∞:_ –î–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º `bootloader`.

–ü—Ä–∏–º–µ—Ä—ã –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ—Å—Ç—ã—Ö Paymasters –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [—Ç—É—Ç](https://github.com/matter-labs/custom-paymaster-tutorial) –∏ [—Ç—É—Ç](https://era.zksync.io/docs/dev/tutorials/custom-paymaster-tutorial.html).

–î–ª—è –¥–µ–ø–ª–æ—è Paymaster –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏; –æ–Ω —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Paymaster –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —á–µ—Ä–µ–∑ [API zkSync](https://era.zksync.io/docs/api/).

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í –∑–∞–∫–ª—é—á–µ–Ω–∏–∏ —Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –Ω–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Abstract Accounts –≤ zkSync –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–µ –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å EIP-4337. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Smart accounts –≤ —Ç–∞–∫–æ–π –ø–∞—Ä–∞–¥–∏–≥–º–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—â–µ, —Ç–∞–∫–∂–µ —É–ø—Ä–æ—â–∞–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äì –≤—Å—ë, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —ç—Ç–æ —Å—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ zkSync, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ bundler'—ã.

–í–∞–∂–Ω–æ —Ç–∞–∫–∂–µ –∏ —Ç–æ, —á—Ç–æ Paymaster'—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å –æ–±—ã—á–Ω—ã–º–∏ EOA, –ø—Ä–∏—á–µ–º —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∏–∑–±–µ–∂–∞—Ç—å –ª–∏—à–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è —Å–ø–∏—Å–∞–Ω–∏—è ERC20-—Ç–æ–∫–µ–Ω–æ–≤.

–°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Ç–∞–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –∫–∞–∫ –æ–ø–ª–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ ERC20-—Ç–æ–∫–µ–Ω–∞—Ö –∏–ª–∏ `multicall` (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –æ–¥–Ω—É) —ç—Ç–æ —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö—É—à–∫–∞ –∞–π—Å–±–µ—Ä–≥–∞, Smart account –º–æ–∂–µ—Ç –æ–±–ª–∞–¥–∞—Ç—å –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–º –∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º —Ñ—É–Ω–∫—Ü–∏–π. –Ø –¥—É–º–∞—é –º—ã —É–≤–∏–¥–∏–º –µ—â–µ –º–Ω–æ–≥–æ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

## –°—Å—ã–ª–∫–∏

-   [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://era.zksync.io/docs/reference/concepts/account-abstraction.html)
-   [–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏](https://github.com/matter-labs/era-system-contracts/blob/main/contracts/interfaces/IPaymaster.sol)
-   [–ê—É–¥–∏—Ç, –≤–∫–ª—é—á–∞—é—â–∏–π –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤](https://github.com/code-423n4/2023-10-zksync/blob/main/docs/Smart%20contract%20Section/System%20contracts%20bootloader%20description.md)
-   [zkSync era API/SDKs](https://era.zksync.io/docs/api/)
-   [Custom AA tutorial](https://github.com/matter-labs/custom-aa-tutorial)
-   [Custom Paymaster tutorial](https://github.com/matter-labs/custom-paymaster-tutorial)
-   [–ü–æ–ª–µ–∑–Ω—ã–µ —Ç—É—Ç–æ—Ä–∏–∞–ª—ã –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://era.zksync.io/docs/dev/tutorials.html)
-   [–û–±–∑–æ—Ä–Ω–æ–µ –≤–∏–¥–µ–æ AA –≤ zkSync](https://www.youtube.com/watch?v=M8p5ucnOH5E)
