# Gas used part 1: Overview

**–ê–≤—Ç–æ—Ä:** [–†–æ–º–∞–Ω –Ø—Ä–ª—ã–∫–æ–≤](https://github.com/rlkvrv) üßê

## TL;DR

–í –ø–µ—Ä–≤–æ–π —á–∞—Å—Ç–∏ –Ω–∞—à–µ–π —Å—Ç–∞—Ç—å–∏ –æ –º–µ—Ö–∞–Ω–∏–∑–º–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–∞–∑–∞ –≤ Ethereum, –º—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏–º—Å—è –Ω–∞ –æ–±—â–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö —Ä–∞—Å—á–µ—Ç–∞ –≥–∞–∑–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –≠—Ç–æ –¥–∞—Å—Ç –æ—Å–Ω–æ–≤—É –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è, –∫–∞–∫ –≥–∞–∑ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –±–ª–æ–∫—á–µ–π–Ω–µ Ethereum. –í–æ –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏ –º—ã —É–≥–ª—É–±–∏–º—Å—è –≤ –∞—Å–ø–µ–∫—Ç—ã —Ä–∞–±–æ—Ç—ã —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—è –∏—Ö –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–∞—Å—á–µ—Ç–æ–≤ –≥–∞–∑–∞.

## –í–≤–µ–¥–µ–Ω–∏–µ

–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ Ethereum –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –≥–∞–∑–∞: –ø—Ä–∏ –µ—ë –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—ë—Ç—Å—è `gasLimit`, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ. –ù–∞ –æ—Å–Ω–æ–≤–µ `gasLimit` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –≤ ETH, —Å–ø–∏—Å—ã–≤–∞–µ–º–∞—è —Å –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –§–∞–∫—Ç–∏—á–µ—Å–∫–∏, –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã–π –≥–∞–∑ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ `gasUsed`. –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≥–∞–∑–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç `gasLimit`, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

-   –í–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ "out of gas".
-   –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫ –º–æ–º–µ–Ω—Ç—É –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
-   –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ ETH –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ —É–∂–µ –±—ã–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ –≥–∞–∑.

–í –¥–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–µ –º—ã –¥–µ—Ç–∞–ª—å–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ `gasUsed`, –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, —Å–∫–æ–ª—å–∫–æ ETH –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–µ—Ä–Ω—É—Ç—å, –≤ —Å–ª—É—á–∞–µ –µ—Å–ª–∏ `gasLimit` –±—ã–ª –±–æ–ª—å—à–µ, —á–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç—Ä–∞—á–µ–Ω–Ω—ã–π –≥–∞–∑. –¢–∞–∫–∂–µ, —Å —É—á–µ—Ç–æ–º `gasUsed` –ø—Ä–æ—Ç–æ–∫–æ–ª –≤—ã—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞ –≤ –±–ª–æ–∫–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

## –†–æ–ª—å –≥–∞–∑–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ

–î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≥–∞–∑–∞, –≤–∞–∂–Ω–æ –æ—Å–æ–∑–Ω–∞—Ç—å, –ø–æ—á–µ–º—É –æ–Ω –±—ã–ª –≤–≤–µ–¥–µ–Ω. EVM (Ethereum Virtual Machine) –æ–±–ª–∞–¥–∞–µ—Ç –¢—å—é—Ä–∏–Ω–≥-–ø–æ–ª–Ω–æ—Ç–æ–π, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –µ–π –≤—ã–ø–æ–ª–Ω—è—Ç—å –ª—é–±—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, –≤ —Ç–æ–º —á–∏—Å–ª–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã. –≠—Ç–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç –≤ —Å–µ–±—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –º–µ–Ω—è—é—â–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫—á–µ–π–Ω–∞. –î–ª—è –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å–µ—Ç–∏, –∑–∞–Ω—è—Ç—ã—Ö –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –±—ã–ª–∞ –≤–≤–µ–¥–µ–Ω–∞ –∫–æ–º–∏—Å—Å–∏—è –∑–∞ –∏—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ. –ö–æ–º–∏—Å—Å–∏—è —Ç–∞–∫–∂–µ –∏–≥—Ä–∞–µ—Ç —Ä–æ–ª—å —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—â–µ–≥–æ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–ª–æ–∫—á–µ–π–Ω–æ–º.

–†–∞–∑–º–µ—Ä –∫–æ–º–∏—Å—Å–∏–∏ –≤—Å–µ–≥–¥–∞ –∑–∞–¥–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ—à–∞–µ—Ç –µ–º—É —Å–¥–µ–ª–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é —Ä–∞–≤–Ω–æ–π –Ω—É–ª—é, –≤–æ–ø—Ä–æ—Å –≤ —Ç–æ–º, –ø—Ä–∏–º—É—Ç –ª–∏ –¥—Ä—É–≥–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–µ—Ç–∏ —Ç–∞–∫—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

## –ì–∞–∑ –≤ Ethereum

Bitcoin –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∏–∑–º–µ–Ω—è—è –±–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ BTC. –í Ethereum, –ø–æ–º–∏–º–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤ ETH, –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∞–∂–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å –µ—ë –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≥–∞–∑–∞.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫—É—é —Å—Ö–µ–º—É, –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É—é—â—É—é —Ä–∞—Å—Ö–æ–¥ –≥–∞–∑–∞ –≤ Ethereum.
![ethereum-gas-flow](./img/ethereum-gas-flow.png)

–ò–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ö–µ–º—ã –≤–∏–¥–Ω–æ, —á—Ç–æ –∫–∞–∂–¥–∞—è –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–∞–º—è—Ç—å—é –≤ —Å–µ—Ç–∏ Ethereum —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞.

–ß—Ç–æ–±—ã —Ö–æ—Ä–æ—à–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —ç—Ç–æ–º –≤–æ–ø—Ä–æ—Å–µ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è [Ethereum Yellow Paper](https://ethereum.github.io/yellowpaper/paper.pdf), —Ä–∞–∑–¥–µ–ª—ã 6,8 –∏ 9, –∞ —Ç–∞–∫–∂–µ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ Ethereum [Go-Ethereum](https://github.com/ethereum/go-ethereum) (geth), –Ω–∞—Ö–æ–¥—è—â–∏–π—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ [go-ethereum/core/vm/](https://github.com/ethereum/go-ethereum/tree/576681f29b895dd39e559b7ba17fcd89b42e4833/core/vm).

–î–ª—è –Ω–∞—á–∞–ª–∞, –Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å [–ø–µ—Ä–≤–æ–π —á–∞—Å—Ç—å—é](https://leftasexercise.com/2021/09/12/understanding-the-ethereum-virtual-machine-part-i/) —Å–µ—Ä–∏–∏ —Å—Ç–∞—Ç–µ–π –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ EVM, –≥–¥–µ –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑—ä—è—Å–Ω—è–µ—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –≤ EVM –∏ –∫–∞–∫–∏–µ –±–ª–æ–∫–∏ –∫–æ–¥–∞ –ø—Ä–∏ —ç—Ç–æ–º –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω—ã.

–í–∞–∂–Ω–æ! _–í —Å—Ç–∞—Ç—å–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è –∫–ª–∏–µ–Ω—Ç–∞ 1.10.6, –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –∫–æ–¥ –Ω–µ–º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–∏–ª—Å—è, –Ω–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –º–µ—Ç–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å_.

–î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã Ethereum, —Å–ª–µ–¥—É–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∫–ª—é—á–µ–≤—ã–µ –±–ª–æ–∫–∏ –∫–æ–¥–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ geth, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ –¥–∞–Ω–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏:

![contract_execution_1](./img/contract_execution_1.jpg)

-   –í —Ñ–∞–π–ª–µ [evm.go](https://github.com/ethereum/go-ethereum/blob/1010a79c7cbcdb4741e9f30e8cdc19c679ad7377/core/vm/evm.go) —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ EVM, —Ç–∞–∫–∏–µ –∫–∞–∫ BlockContext –∏ TxContext.
-   EVMInterpreter –∏ ScopeContext –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ [interpreter.go](https://github.com/ethereum/go-ethereum/blob/1010a79c7cbcdb4741e9f30e8cdc19c679ad7377/core/vm/interpreter.go)
-   –ö–ª–∞—Å—Å `Contract` —Ä–∞–∑–º–µ—â–µ–Ω –≤ [contract.go](https://github.com/ethereum/go-ethereum/blob/1010a79c7cbcdb4741e9f30e8cdc19c679ad7377/core/vm/contract.go)

–î–∞–ª–µ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ –¥–≤–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ EVM: `Call()` –∏ `Run()`, –ø–æ–ø—É—Ç–Ω–æ —Ä–∞–∑–±–∏—Ä–∞—è—Å—å, –∫–∞–∫ –∑–∞–¥–µ–π—Å—Ç–≤—É–µ—Ç—Å—è –∫–æ–¥, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å —ç—Ç–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏.

### –§—É–Ω–∫—Ü–∏—è Call

–ì–ª–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π, –æ–ø–∏—Å—ã–≤–∞—é—â–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ yellow paper, —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Ç–∞ (Œò), –µ–µ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ 8:

![theta_function](./img/theta_function.png), –≥–¥–µ

-   **–°–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (œÉ')**: –≠—Ç–æ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ–π –±–ª–æ–∫—á–µ–π–Ω-—Å–∏—Å—Ç–µ–º—ã Ethereum, –≤–∫–ª—é—á–∞—è –≤—Å–µ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∏ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è;
-   **–û—Å—Ç–∞–≤—à–∏–π—Å—è –≥–∞–∑ (g')**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞, –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è;
-   **–ù–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –ø–æ–¥—Å–æ—Å—Ç–æ—è–Ω–∏–µ (A')**: –≠—Ç–æ —Å–æ–≤–æ–∫—É–ø–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –±–ª–æ–∫—á–µ–π–Ω–∞, –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–∏—Ö –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –û–Ω–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Ç–∞–∫–∏–µ –≤–µ—â–∏, –∫–∞–∫ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —É—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π, –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤ –∏ —Ç.–¥.;
-   **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (z)**: –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—ã–∑—ã–≤–∞—é—â–∏–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–º –≤—ã–∑–æ–≤–æ–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏;
-   **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞ (o)**: –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ã—á–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π –ª–æ–≥–∏ –∏–ª–∏ —Å–æ–±—ã—Ç–∏—è, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ —Ö–æ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

–í —Ñ—É–Ω–∫—Ü–∏—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:

-   **œÉ,A** - –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ø–æ–¥—Å–æ—Å—Ç–æ—è–Ω–∏–µ
-   **s** (msg.sender) - –ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
-   **o** (tx.origin) - –ê–¥—Ä–µ—Å –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
-   **r** (recipient) - –ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è
-   **c** (contract) - –ê–¥—Ä–µ—Å –∞–∫–∫–∞—É–Ω—Ç–∞, —á–µ–π –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω
-   **g** (gas) - –î–æ—Å—Ç—É–ø–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
-   **p** (price) - –¶–µ–Ω–∞ –≥–∞–∑–∞
-   **v** (value) - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ñ–∏—Ä–∞ –≤ wei, –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –æ—Ç –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∫ –≤—ã–∑–≤–∞–Ω–Ω–æ–º—É —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É
-   **·πΩ** - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ñ–∏—Ä–∞ –≤ wei, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è DELEGATECALL, –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
-   **d** (data) - –ú–∞—Å—Å–∏–≤ –±–∞–π—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤—ã–∑–æ–≤–∞
-   **e** - –ì–ª—É–±–∏–Ω–∞ —Å—Ç–µ–∫–∞ –≤—ã–∑–æ–≤–æ–≤/—Å–æ–∑–¥–∞–Ω–∏—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
-   **w** - –ë—É–ª–µ–≤ —Ñ–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–¥–µ–ª–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –¥–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã BlockContext, TxContext, EVM (—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å—Ö–µ–º–µ –≤—ã—à–µ) –∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π [Call()](https://github.com/ethereum/go-ethereum/blob/576681f29b895dd39e559b7ba17fcd89b42e4833/core/vm/evm.go#L167) –≤ geth.

–§—É–Ω–∫—Ü–∏—è `Call()` —Å–æ–¥–µ—Ä–∂–∏—Ç –º–Ω–æ–≥–æ –ª–æ–≥–∏–∫–∏, –ø–æ—ç—Ç–æ–º—É –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è –º—ã —Ä–∞–∑–æ–±—å–µ–º –µ–µ –Ω–∞ —Ç—Ä–∏ –±–ª–æ–∫–∞, –∞ —Ç–∞–∫–∂–µ —É–±–µ—Ä–µ–º —Å–ª—É–∂–µ–±–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.

#### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.

```go
// Call –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–æ –∞–¥—Ä–µ—Å—É addr, –∏—Å–ø–æ–ª—å–∑—É—è –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
// –§—É–Ω–∫—Ü–∏—è —Ç–∞–∫–∂–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ —Å—Ä–µ–¥—Å—Ç–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –∞ —Ç–∞–∫–∂–µ
// –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤.
func (evm *EVM) Call(caller ContractRef, addr common.Address, input []byte, gas uint64, value *big.Int) (ret []byte, leftOverGas uint64, err error) {
	// –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –µ—Å–ª–∏ –≥–ª—É–±–∏–Ω–∞ –≤—ã–∑–æ–≤–æ–≤ –ø—Ä–µ–≤—ã—à–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç
	if evm.depth > int(params.CallCreateDepth) {
		return nil, gas, ErrDepth
	}
	// –û—Ç–∫–∞–∑, –µ—Å–ª–∏ –ø—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å—É–º–º—É –±–æ–ª—å—à–µ, —á–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ
	if value.Sign() != 0 && !evm.Context.CanTransfer(evm.StateDB, caller.Address(), value) {
		return nil, gas, ErrInsufficientBalance
	}
	snapshot := evm.StateDB.Snapshot()
	p, isPrecompile := evm.precompile(addr)
	debug := evm.Config.Tracer != nil

	if !evm.StateDB.Exist(addr) {
		if !isPrecompile && evm.chainRules.IsEIP158 && value.Sign() == 0 {
			// –ï—Å–ª–∏ –≤—ã–∑—ã–≤–∞–µ–º—ã–π –∞–∫–∫–∞—É–Ω—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —ç—Ç–æ –Ω–µ –ø—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç,
			// —Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º

            // ... –ª–æ–≥–∏–∫–∞ –¥–µ–±–±–∞–≥–µ—Ä–∞

			return nil, gas, nil
		}
		evm.StateDB.CreateAccount(addr)
	}

    // ...
```

**–í —ç—Ç–æ–º –±–ª–æ–∫–µ –∫–æ–¥–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â—É—é –ª–æ–≥–∏–∫—É:**

1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≥–ª—É–±–∏–Ω–∞ —Å—Ç–µ–∫–∞ –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∞ (–Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç 1024);
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç—Ñ–∏—Ä–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞;
3. –î–µ–ª–∞–µ—Ç —Å–Ω–∏–º–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –µ—Å–ª–∏ –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫;
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ï—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –∞–¥—Ä–µ—Å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Ethereum;

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤ ETH, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞

–û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è. –ï—Å–ª–∏ —ç—Ç–æ –≤—ã–∑–æ–≤ –ø—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏ –∫–æ–¥ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è EVM, –≤—ã–∑—ã–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—é `Run()`, –¥–∞–ª–µ–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –æ—Å—Ç–∞–≤—à–∏–π—Å—è –≥–∞–∑ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö.

> **–ü—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã** - —ç—Ç–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã Ethereum, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ —Å–ª–æ–∂–Ω—ã–µ –∏ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –ª–æ–≥–∏–∫–∞ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—Ç–∏–≤–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –∫–æ–¥–µ –∫–ª–∏–µ–Ω—Ç–∞ geth, –∞ –Ω–µ –≤ –∫–æ–¥–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ EVM.

```go
func (evm *EVM) Call(caller ContractRef, addr common.Address, input []byte, gas uint64, value *big.Int) (ret []byte, leftOverGas uint64, err error) {
    // ...

    // –ü–µ—Ä–µ–≤–æ–¥ ETH
    evm.Context.Transfer(evm.StateDB, caller.Address(), addr, value)

	// –õ–æ–≥–∏–∫–∞ –¥–µ–±–±–∞–≥–µ—Ä–∞
	if isPrecompile {
		ret, gas, err = RunPrecompiledContract(p, input, gas)
	} else {
		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–¥–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è EVM.
		// –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å–æ–∑–¥–∞—ë—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ä–µ–¥—É –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
		code := evm.StateDB.GetCode(addr)
		if len(code) == 0 {
			ret, err = nil, nil // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
		} else {
			addrCopy := addr
			// –ï—Å–ª–∏ —É –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–µ—Ç –∫–æ–¥–∞, –ø—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
			// –ì–ª—É–±–∏–Ω–∞ –≤—ã–∑–æ–≤–æ–≤ –∏ –ø—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
			contract := NewContract(caller, AccountRef(addrCopy), value, gas)
			contract.SetCallCode(&addrCopy, evm.StateDB.GetCodeHash(addrCopy), code)
			ret, err = evm.interpreter.Run(contract, input, false)
			gas = contract.Gas
		}
	}

    // ...
}
```

**–®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏–µ:**

5. –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–µ—Ä–µ–≤–æ–¥ —ç—Ñ–∏—Ä–∞ –Ω–∞ –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è;
6. –í—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, –µ—Å–ª–∏ –≤ —ç—Ç–æ–º –µ—Å—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å;
7. –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –µ—Å–ª–∏ –≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–∑–æ–≤–∞. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `Run()` –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞;

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

–ù–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —à–∞–≥–µ —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å.

```go
func (evm *EVM) Call(caller ContractRef, addr common.Address, input []byte, gas uint64, value *big.Int) (ret []byte, leftOverGas uint64, err error) {
    // ...

	// –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–º—É —Å–Ω–∏–º–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –∞–Ω–Ω—É–ª–∏—Ä—É–µ–º –æ—Å—Ç–∞–≤—à–∏–π—Å—è –≥–∞–∑.
	// –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —ç—Ç–æ –æ—à–∏–±–∫–∞ —Ç–∏–ø–∞ "revert", –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –æ—Å—Ç–∞–≤—à–∏–π—Å—è –≥–∞–∑ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è.
	if err != nil {
		evm.StateDB.RevertToSnapshot(snapshot)
		if err != ErrExecutionReverted {
			gas = 0
		}
	}
	return ret, gas, err
}
```

**–û—Å—Ç–∞–≤—à–∏–µ—Å—è –ª–æ–≥–∏–∫–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã–ø–æ–ª–Ω—è–µ—Ç Call():**

8. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Å—Ç–∞–≤—à–∏–π—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥–∞–∑;
9. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏, –≤ —Å–ª—É—á–∞–µ –Ω–∞–ª–∏—á–∏—è —Ç–∞–∫–æ–≤—ã—Ö.

–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç –¥–ª—è –Ω–∞—Å - –≥–∞–∑, –∫–æ—Ç–æ—Ä—ã–π –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `Run()` –∏–∑ `Call()`. –ù–∞–ø–æ–º–Ω—é, —á—Ç–æ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º, —Ñ—É–Ω–∫—Ü–∏—è `Call()` –ø–æ–ª—É—á–∞–µ—Ç –≤–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–π –≥–∞–∑ (`gasLimit`). –ö–∞–∫ —ç—Ç–æ—Ç –≥–∞–∑ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–∞–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `Run()` —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–æ–∑–∂–µ. –õ–æ–≥–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ –≥–∞–∑–∞ –≤ –∫–æ–Ω—Ü–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `Call()` —Å–ª–µ–¥—É—é—â–∞—è:

-   –ï—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `Run()` –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å —É—Å–ø–µ—à–Ω–æ –∏ –Ω–µ –≤—ã–∑–≤–∞–ª–æ –æ—à–∏–±–æ–∫, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ–¥ –æ—à–∏–±–∫–∏ –∏ –æ—Å—Ç–∞–≤—à–∏–π—Å—è –≥–∞–∑;
-   –ï—Å–ª–∏ `Run()` –≤–µ—Ä–Ω—É–ª —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–¥ –æ—à–∏–±–∫–∏, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –æ—Ç–º–µ–Ω—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–ø—Ä–æ–∏–∑–æ—à–µ–ª `revert`), —Ç–æ –º—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–Ω–∏–º–∫–∞;
-   –ï—Å–ª–∏ –∫–æ–¥ –æ—à–∏–±–∫–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π `Run()`, –æ—Ç–ª–∏—á–Ω—ã–π –æ—Ç `revert`, —Ç–æ —Ç–∞–∫–∂–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–Ω–∏–º–∫–∞, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `gas` –≤ 0. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ª—é–±–∞—è –æ—à–∏–±–∫–∞, –∫—Ä–æ–º–µ `revert` –ø–æ—Ç—Ä–µ–±—É–µ—Ç –≤—Å–µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –≥–∞–∑–∞. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫–∏–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –æ—à–∏–±–∫–∏ –º–æ–∂–Ω–æ [—Ç—É—Ç](https://github.com/ethereum/go-ethereum/blob/1010a79c7cbcdb4741e9f30e8cdc19c679ad7377/core/vm/errors.go#L25C1-L25C4).

### –§—É–Ω–∫—Ü–∏—è Run

–¢–æ—á–∫–æ–π –≤—Ö–æ–¥–∞ –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è [Run()](https://github.com/ethereum/go-ethereum/blob/576681f29b895dd39e559b7ba17fcd89b42e4833/core/vm/interpreter.go#L118). –û–Ω–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤—ã–∑–æ–≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `Run()` –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ 9.3 yellow paper:

![xi_function](./img/xi_function.png)

–§—É–Ω–∫—Ü–∏—è Œû (–ö—Å–∏) –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã **(œÉ)**, –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞ **(g)**, –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –ø–æ–¥—Å–æ—Å—Ç–æ—è–Ω–∏–µ **(A)** –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ—Ä—Ç–µ–∂ **(I)**.

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã **(œÉ')** –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞, –æ—Å—Ç–∞–≤—à–∏–π—Å—è –≥–∞–∑ **(g')**, –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –ø–æ–¥—Å–æ—Å—Ç–æ—è–Ω–∏–µ **(A')** –∏ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è **(o)**.

–í –∫–æ—Ä—Ç–µ–∂–µ **I** —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —É–∂–µ –≤–∏–¥–µ–ª–∏ —Ä–∞–Ω–µ–µ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–µ—Ç–∞ –ø–ª—é—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö:

-   **I<sub>a</sub>** - –∞–¥—Ä–µ—Å –∞–∫–∫–∞—É–Ω—Ç–∞, –≤–ª–∞–¥–µ—é—â–∏–π –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–º –∫–æ–¥–æ–º (`address(this)`);
-   **I<sub>o</sub>** - –∞–¥—Ä–µ—Å –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`tx.origin`);
-   **I<sub>p</sub>** - —Ü–µ–Ω–∞ –≥–∞–∑–∞, —É–ø–ª–∞—á–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–æ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`gasPrice`);
-   **I<sub>d</sub>** - –±–∞–π—Ç–æ–≤—ã–π –º–∞—Å—Å–∏–≤, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è (`data`);
-   **I<sub>s</sub>** - –∞–¥—Ä–µ—Å –∞–∫–∫–∞—É–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤—ã–∑–≤–∞–ª —Ç–µ–∫—É—â—É—é —Ñ—É–Ω–∫—Ü–∏—é (`msg.sender`);
-   **I<sub>v</sub>** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ñ–∏—Ä–∞ –≤ wei, –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –æ—Ç –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∫ –≤—ã–∑–≤–∞–Ω–Ω–æ–º—É —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É (`value`);
-   **I<sub>b</sub>** - –±–∞–π—Ç–æ–≤—ã–π –º–∞—Å—Å–∏–≤, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –º–∞—à–∏–Ω–Ω—ã–º –∫–æ–¥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω (`bytes`);
-   **I<sub>H</sub>** - –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–µ–∫—É—â–µ–≥–æ –±–ª–æ–∫–∞;
-   **I<sub>e</sub>** - –≥–ª—É–±–∏–Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–µ–∫–∞ –≤—ã–∑–æ–≤–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (—Ç.–µ. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ `CALL` –∏–ª–∏ `CREATE`, –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è)
-   **I<sub>w</sub>** - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≤–Ω–µ—Å–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (`bool`).

–§—É–Ω–∫—Ü–∏—è `Run` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞ EVM (Ethereum Virtual Machine) —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–µ–≤–æ–π —á–∞—Å—Ç—å—é –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤ Ethereum. –í–æ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã –µ—ë —Ä–∞–±–æ—Ç—ã:

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞:**

    - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≥–ª—É–±–∏–Ω—É –≤—ã–∑–æ–≤–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ 1024) –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –ó–∞ –≥–ª—É–±–∏–Ω—É –≤—ã–∑–æ–≤–æ–≤ –æ—Ç–≤–µ—á–∞–µ—Ç `callStack`, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏, —ç—Ç–æ –µ—â–µ –æ–¥–∏–Ω –≤–∏–¥ –ø–∞–º—è—Ç–∏ –≤ EVM, –æ–Ω–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –¥—Ä—É–≥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–π.
    - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–µ–∂–∏–º "—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è", –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ä–∞–Ω–µ–µ, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.
    - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –≤—ã–∑–æ–≤–æ–º, —Ç–∞–∫ –∫–∞–∫ –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –≤—ã–∑–æ–≤ –≤–µ—Ä–Ω–µ—Ç —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ.

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞:**

    - –ï—Å–ª–∏ –∫–æ–¥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ø—É—Å—Ç, —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –Ω–µ –≤—ã–ø–æ–ª–Ω—è—è –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.

3. **–¶–∏–∫–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

    - –í —Ü–∏–∫–ª–µ, —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é (–æ–ø–µ—Ä–∞—Ü–∏—é) –≤ –∫–æ–¥–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. –¶–∏–∫–ª –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (`STOP`), –≤–æ–∑–≤—Ä–∞—Ç–∞ (`RETURN`) –∏–ª–∏ —Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è (`SELFDESTURCT`), –ø–æ–∫–∞ –Ω–µ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç –æ—à–∏–±–∫–∞ –∏–ª–∏ –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.

4. **–†–∞—Å—á–µ—Ç –≥–∞–∑–∞:**

    - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏ –≤—ã—á–∏—Ç–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≥–∞–∑–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏.
    - –†–∞—Å—à–∏—Ä—è–µ—Ç –ø–∞–º—è—Ç—å –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –≥–∞–∑–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π, —Ç—Ä–µ–±—É—é—â–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏.

5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:**

    - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é) –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ —Å—Ç–µ–∫–µ –¥–ª—è –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞.
    - –í —Ä–µ–∂–∏–º–µ "—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è" —Ñ—É–Ω–∫—Ü–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏–∏, –∏–∑–º–µ–Ω—è—é—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

6. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**

    - –í—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Å—á–µ—Ç—á–∏–∫.
    - –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –æ–±–Ω–æ–≤–ª—è–µ—Ç –±—É—Ñ–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

7. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**

    - –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–º–µ–Ω—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏.
    - –í —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.

8. **–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞:**
    - –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏, —Ñ—É–Ω–∫—Ü–∏—è —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Ü–µ–ª–µ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏.

–î–ª—è –Ω–∞—Å –≤–∞–∂–Ω—ã –ø—É–Ω–∫—Ç—ã —Å 3 –ø–æ 6. –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –∫ –Ω–∏–º –ø–µ—Ä–µ–π—Ç–∏, –æ–±—Ä–∞—Ç–∏–º –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ñ–∞–π–ª [contract.go](https://github.com/ethereum/go-ethereum/blob/1010a79c7cbcdb4741e9f30e8cdc19c679ad7377/core/vm/contract.go). –í –æ–±—ä–µ–∫—Ç–µ `Contract` –µ—Å—Ç—å –ø–æ–ª—è `Code`, `Input` –∏ `Gas`, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –ø–æ–ª—É—á–∞–µ—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è `Run()`

```go
// Contract —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤—ã–∑–æ–≤–∞
type Contract struct {
	// CallerAddress - —ç—Ç–æ –∞–¥—Ä–µ—Å –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª –¥–∞–Ω–Ω—ã–π
	// –∫–æ–Ω—Ç—Ä–∞–∫—Ç. –û–¥–Ω–∞–∫–æ, –∫–æ–≥–¥–∞ –º–µ—Ç–æ–¥ –≤—ã–∑–æ–≤–∞ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç—Å—è, —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ
	// –Ω—É–∂–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å–æ–º —Ç–æ–≥–æ –∫—Ç–æ –≤—ã–∑–≤–∞–ª –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ.
	CallerAddress common.Address
	caller        ContractRef
	self          ContractRef

	jumpdests map[common.Hash]bitvec // –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ JUMPDEST.
	analysis  bitvec                 // –õ–æ–∫–∞–ª—å–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ JUMPDEST.

	Code     []byte          // –ö–æ–¥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
	CodeHash common.Hash     // –•–µ—à –∫–æ–¥–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
	CodeAddr *common.Address // –ê–¥—Ä–µ—Å –∫–æ–¥–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
	Input    []byte          // –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

	Gas   uint64    // –ì–∞–∑ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
	value *big.Int  // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–µ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç.
}
```

#### –¶–∏–∫–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `Run()`, —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∏–∑—É—á–∏—Ç—å –µ—ë –ø–æ–ª–Ω—ã–π –∫–æ–¥ –≤ [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏](https://github.com/ethereum/go-ethereum/blob/576681f29b895dd39e559b7ba17fcd89b42e4833/core/vm/interpreter.go#L118) geth. –ü–µ—Ä–µ–π–¥–µ–º —Å—Ä–∞–∑—É –∫ —Ü–∏–∫–ª—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

–¶–∏–∫–ª –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑ –º–∞—Å—Å–∏–≤–∞ `Code[]`. –≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –ª–∏–±–æ –ø–æ–∫–∞ –Ω–µ –∏—Å—Å—è–∫–Ω–µ—Ç –≥–∞–∑, –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫.

```go
// Run –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Å –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç
// —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∏–¥–µ –º–∞—Å—Å–∏–≤–∞ –±–∞–π—Ç–æ–≤ –∏ –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –≤–æ–∑–Ω–∏–∫–ª–∞.
//
// –í–∞–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ –ª—é–±—ã–µ –æ—à–∏–±–∫–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–æ–º, —Å–ª–µ–¥—É–µ—Ç
// —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–∫ –æ–ø–µ—Ä–∞—Ü–∏—é "–æ—Ç–º–µ–Ω–∏—Ç—å –∏ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –≤–µ—Å—å –≥–∞–∑", –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º
// ErrExecutionReverted, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç "–æ—Ç–º–µ–Ω–∏—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–π—Å—è –≥–∞–∑".
func (in *EVMInterpreter) Run(contract *Contract, input []byte, readOnly bool) (ret []byte, err error) {
    // ...

	// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞
	var (
		op          OpCode        // —Ç–µ–∫—É—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
		mem         = NewMemory() // –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å
		stack       = newstack()  // –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫
		callContext = &ScopeContext{ // –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–∑–æ–≤–∞
			Memory:   mem,
			Stack:    stack,
			Contract: contract,
		}
		// –ò—Å–ø–æ–ª—å–∑—É–µ–º uint64 –∫–∞–∫ —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.
		// –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å 2^64, –Ω–æ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —ç—Ç–æ –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ.
		pc   = uint64(0) // —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
		cost uint64      // —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
		// –∫–æ–ø–∏–∏ –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤—â–∏–∫–∞
		pcCopy  uint64 // –Ω—É–∂–µ–Ω –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤—â–∏–∫–∞
		gasCopy uint64 // –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≥–∞–∑–∞ –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
		logged  bool   // —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤—â–∏–∫ –¥–æ–ª–∂–µ–Ω –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–∂–µ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —à–∞–≥–∏
		res     []byte // —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
	)

	// –°–ª—É–∂–µ–±–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, —É–±—Ä–∞–Ω, —Ç.–∫. –¥–ª—è –Ω–∞—à–µ–≥–æ —Ä–∞–∑–±–æ—Ä–∞ –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è
    // ...

	// –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞. –¶–∏–∫–ª –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–æ —è–≤–Ω–æ–≥–æ STOP,
	// RETURN –∏–ª–∏ SELFDESTRUCT, –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –æ—à–∏–±–∫–∏ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞–≥–∞ done —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.
	steps := 0
	for {
        // ...

		// –ü–æ–ª—É—á–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–µ–∫ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤.
		op = contract.GetOp(pc)
		operation := in.cfg.JumpTable[op]
		if operation == nil {
			return nil, &ErrInvalidOpCode{opcode: op}
		}
		// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–µ–∫–∞
		if sLen := stack.len(); sLen < operation.minStack {
			return nil, &ErrStackUnderflow{stackLen: sLen, required: operation.minStack}
		} else if sLen > operation.maxStack {
			return nil, &ErrStackOverflow{stackLen: sLen, limit: operation.maxStack}
		}
		// –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ø—É—Å—Ç–∏–º–∞, –ø—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∑–∞–ø–∏—Å—å
		if in.readOnly && in.evm.chainRules.IsByzantium {
			// –í —Ä–µ–∂–∏–º–µ readOnly –∑–∞–ø—Ä–µ—â–∞–µ–º –ª—é–±—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∏–∑–º–µ–Ω—è—é—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
			// –ü–µ—Ä–µ–¥–∞—á–∞ –∑–Ω–∞—á–µ–Ω–∏–π –º–µ–∂–¥—É –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ –∏–∑–º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –¥–æ–ª–∂–Ω–∞ –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É.
			if operation.writes || (op == CALL && stack.Back(2).Sign() != 0) {
				return nil, ErrWriteProtection
			}
		}

        // ...
	}
}
```

-   –ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö;
-   –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–∑ [JumpTable](https://github.com/ethereum/go-ethereum/blob/576681f29b895dd39e559b7ba17fcd89b42e4833/core/vm/jump_table.go);
-   –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–µ–∫ –Ω–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ;
-   –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è.

#### –†–∞—Å—á–µ—Ç –≥–∞–∑–∞ –∏ —Ä–∞–±–æ—Ç–∞ —Å memory

–î–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç—Ä–µ–±–ª—è–µ–º–æ–≥–æ –≥–∞–∑–∞, –∞ —Ç–∞–∫–∂–µ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏ (memory). –°—Ç–∞—Ç–∏—á–Ω—É—é –∏ –¥–∏–Ω–∞–º–∏—á–Ω—É—é —á–∞—Å—Ç—å –≥–∞–∑–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –¥–µ—Ç–∞–ª—å–Ω–µ–µ —á—É—Ç—å –ø–æ–∑–∂–µ.

```go
func (in *EVMInterpreter) Run(contract *Contract, input []byte, readOnly bool) (ret []byte, err error) {
    // ...

	// –°—Ç–∞—Ç–∏—á–Ω–∞—è —á–∞—Å—Ç—å –≥–∞–∑–∞
	cost = operation.constantGas // –î–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
	if !contract.UseGas(operation.constantGas) {
		return nil, ErrOutOfGas
	}

	var memorySize uint64
	// –†–∞—Å—á–µ—Ç –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–º—è—Ç–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø–æ–¥ –æ–ø–µ—Ä–∞—Ü–∏—é
	if operation.memorySize != nil {
		memSize, overflow := operation.memorySize(stack)
		if overflow {
			return nil, ErrGasUintOverflow
		}
		if memorySize, overflow = math.SafeMul(toWordSize(memSize), 32); overflow {
			return nil, ErrGasUintOverflow
		}
	}

    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å –≥–∞–∑–∞
	if operation.dynamicGas != nil {
		var dynamicCost uint64
		dynamicCost, err = operation.dynamicGas(in.evm, contract, stack, mem, memorySize)
		cost += dynamicCost // –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
		if err != nil || !contract.UseGas(dynamicCost) {
			return nil, ErrOutOfGas
		}
	}

	if memorySize > 0 {
		mem.Resize(memorySize)
	}

    // ...
}
```

-   –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–Ω–æ–π —á–∞—Å—Ç–∏ –≥–∞–∑–∞;
-   –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–Ω–æ–π —á–∞—Å—Ç–∏ –≥–∞–∑–∞;
-   –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø–æ–¥ –æ–ø–µ—Ä–∞—Ü–∏–∏.

–¢–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ñ—É–Ω–∫—Ü–∏—è `UseGas`, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞—Å—Ö–æ–¥—É–µ—Ç –≥–∞–∑ –∏–∑ –ø–æ–ª—è `Gas` –≤—ã—à–µ—É–ø–æ–º—è–Ω—É—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ `Contract` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±—É–ª–µ–≤—ã–π —Ñ–ª–∞–≥, –µ—Å–ª–∏ –≥–∞–∑ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è - –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å—Å—è.

```go
func (c *Contract) UseGas(gas uint64) (ok bool) {
	if c.Gas < gas {
		return false
	}
	c.Gas -= gas
	return true
}
```

#### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

–ó–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –≤—Å–µ–≥–æ –æ–¥–Ω–∞ —Å—Ç—Ä–æ—á–∫–∞ –∫–æ–¥–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `Run()`.

```go
func (in *EVMInterpreter) Run(contract *Contract, input []byte, readOnly bool) (ret []byte, err error) {
    // ...

    // –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
	res, err = operation.execute(&pc, in, callContext)

    // ...
}
```

–û–±—ä–µ–∫—Ç `operation` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏, —Ç–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ [instructions.go](https://github.com/ethereum/go-ethereum/blob/master/core/vm/instructions.go).

–≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π –æ–ø–∫–æ–¥—ã EVM. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫ –≤—ã–≥–ª—è–¥—è—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —Å–ª–æ–∂–µ–Ω–∏—è –∏ –≤—ã—á–∏—Ç–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ–ø–∫–æ–¥—ã [ADD](https://arc.net/l/quote/msbqghdy) –∏ [SUB](https://arc.net/l/quote/txchdgum):

```go
func opAdd(pc *uint64, interpreter *EVMInterpreter, scope *ScopeContext) ([]byte, error) {
	x, y := scope.Stack.pop(), scope.Stack.peek()
	y.Add(&x, y)
	return nil, nil
}

func opSub(pc *uint64, interpreter *EVMInterpreter, scope *ScopeContext) ([]byte, error) {
	x, y := scope.Stack.pop(), scope.Stack.peek()
	y.Sub(&x, y)
	return nil, nil
}
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–í –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞, –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Ü–∏–∫–ª–∞, –ª–∏–±–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞, –ª–∏–±–æ –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.

```go
func (in *EVMInterpreter) Run(contract *Contract, input []byte, readOnly bool) (ret []byte, err error) {
    // ...
    {
    // ...

	// –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –æ—á–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ),
	// —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–∑–≤—Ä–∞—Ç –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏.
        if operation.returns {
            in.returnData = common.CopyBytes(res)
        }

        switch {
        case err != nil:
            return nil, err
        case operation.reverts:
            return res, ErrExecutionReverted
        case operation.halts:
            return res, nil
        case !operation.jumps:
            pc++
        }
	}
	return nil, nil
}
```

–§—É–Ω–∫—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ä–∞–±–æ—Ç—É —Å–æ —Å—Ç–µ–∫–æ–º –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [—Ç—É—Ç](https://github.com/ethereum/go-ethereum/blob/v1.11.5/core/vm/stack.go).

–î–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `Run()`, —Å—Ç–æ–∏—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å [—ç—Ç—É](https://medium.com/@deliriusz/dissecting-evm-using-go-ethereum-eth-client-implementation-part-iii-bytecode-interpreter-8f144004ed7a) —Å—Ç–∞—Ç—å—é. –ê —Ç–∞–∫–∂–µ [–≤—Ç–æ—Ä—É—é —á–∞—Å—Ç—å](https://leftasexercise.com/2021/09/15/understanding-the-ethereum-virtual-machine-part-ii/) —Å–µ—Ä–∏–∏ —Å—Ç–∞—Ç–µ–π –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ EVM.

### –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≥–∞–∑

–í —Ö–æ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Ñ—É–Ω–∫—Ü–∏–∏ `Run()`, –≥–∞–∑ —Ä–∞—Å—Ö–æ–¥—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ `contract.UseGas()`, —É–º–µ–Ω—å—à–∞—è —Ç–µ–º —Å–∞–º—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `Gas` –≤ –æ–±—ä–µ–∫—Ç–µ `Contract`. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –≥–∞–∑–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ "out of gas".

–†–∞—Å—Ö–æ–¥ –≥–∞–∑–∞, –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ **—Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é** –∏ **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é** —á–∞—Å—Ç–∏. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –≥–∞–∑ –∏–º–µ–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å, –∑–∞–ø–∏—Å–∞–Ω–Ω—É—é –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≥–∞–∑ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∞–∫–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤, –∫–∞–∫ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏.

_–í–∞–∂–Ω–æ!_ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –≥–∞–∑, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–π, –Ω–µ —Å–ª–µ–¥—É–µ—Ç –ø—É—Ç–∞—Ç—å —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –≥–∞–∑–æ–º, —Å–ø–∏—Å—ã–≤–∞–µ–º—ã–º –∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (intrinsic gas). –•–æ—Ç—è –µ–≥–æ —Ç–æ–∂–µ –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º, –æ–Ω –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ.

#### –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –≥–∞–∑

–≠—Ç–æ –≥–∞–∑, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏. –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≥–∞–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `operation.constantGas`.

–í–µ—Ä–Ω–µ–º—Å—è –∫ —Ñ—É–Ω–∫—Ü–∏–∏ `Run()` –≤ [interpreter.go](https://github.com/ethereum/go-ethereum/blob/576681f29b895dd39e559b7ba17fcd89b42e4833/core/vm/interpreter.go#L118):

```go
// —Ñ—É–Ω–∫—Ü–∏—è Run
{
	// –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ—Ä—Ü–∏—è –≥–∞–∑–∞
	cost = operation.constantGas
	if !contract.UseGas(operation.constantGas) {
		return nil, ErrOutOfGas
	}
}
```

–ú—ã —É–∂–µ –æ–±—Ä–∞—â–∞–ª–∏—Å—å –∫ —Ñ–∞–π–ª—É [jump_table.go](https://github.com/ethereum/go-ethereum/blob/master/core/vm/jump_table.go) –∏ –æ–±—ä–µ–∫—Ç—É `operation` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ (–æ–ø–∫–æ–¥–∞), –≤–µ—Ä–Ω–µ–º—Å—è –∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –µ–≥–æ –¥–µ—Ç–∞–ª—å–Ω–µ–µ:

```go
type operation struct {
	execute     executionFunc     // execute - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.
	constantGas uint64            // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –æ–ø–µ—Ä–∞—Ü–∏–µ–π.
	dynamicGas  gasFunc           // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –≥–∞–∑–∞.

    // ...
}
```

–ü–æ–º–∏–º–æ `executionFunc`, —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π –≤—ã—à–µ, –º—ã –≤–∏–¥–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≥–∞–∑–æ–º:

-   `constantGas` - –∫–∞–∫ —Å–ª–µ–¥—É–µ—Ç –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è —ç—Ç–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏;
-   `dynamicGas` - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–æ–π –∏–ª–∏ –∏–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.

–£ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –µ—Å—Ç—å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è constantGas (—Ñ–∞–π–ª [jump_table.go](https://github.com/ethereum/go-ethereum/blob/master/core/vm/jump_table.go)):

```go
    /// ...
	ADD: {
		execute:     opAdd,
		constantGas: GasFastestStep,
		minStack:    minStack(2, 1),
		maxStack:    maxStack(2, 1),
	},
	SUB: {
		execute:     opSub,
		constantGas: GasFastestStep,
		minStack:    minStack(2, 1),
		maxStack:    maxStack(2, 1),
	},
    /// ...
```

–¢–∞–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ [gas.go](https://github.com/ethereum/go-ethereum/blob/master/core/vm/gas.go#L26), –≤–æ—Ç –æ–Ω–∏:

```go
const (
	GasQuickStep   uint64 = 2
	GasFastestStep uint64 = 3
	GasFastStep    uint64 = 5
	GasMidStep     uint64 = 8
	GasSlowStep    uint64 = 10
	GasExtStep     uint64 = 20
)
```

#### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≥–∞–∑

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≥–∞–∑, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ñ—É–Ω–∫—Ü–∏—é, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—â—É—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç—Ä–µ–±–ª—è–µ–º–æ–≥–æ –≥–∞–∑–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ (`memory` –∏–ª–∏ `storage`), —Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞ –∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤.

–í –∫–æ–¥–µ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º ([interpreter.go](https://github.com/ethereum/go-ethereum/blob/576681f29b895dd39e559b7ba17fcd89b42e4833/core/vm/interpreter.go#L118)):

```go
// —Ñ—É–Ω–∫—Ü–∏—è Run
{
    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å –≥–∞–∑–∞
    if operation.dynamicGas != nil {
    	var dynamicCost uint64
    	dynamicCost, err = operation.dynamicGas(in.evm, contract, stack, mem, memorySize)
    	cost += dynamicCost // –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
    	if err != nil || !contract.UseGas(dynamicCost) {
    		return nil, ErrOutOfGas
    	}
    }
}
```

–î–ª—è –Ω–∞—á–∞–ª–∞ –º–æ–∂–µ—Ç–µ —Å–Ω–æ–≤–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ [jump_table.go](https://github.com/ethereum/go-ethereum/blob/830f3c764c21f0d314ae0f7e60d6dd581dc540ce/core/vm/jump_table.go#L198), —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ–∏—Ç `instructionSet`, –≤ –Ω–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `dynamicGas` –¥–ª—è –∫–∞–∂–¥–æ–π –æ—Ç–¥–µ–ª—å–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–µ —É –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –µ—Å—Ç—å —Ç–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è):

```go
instructionSet[RETURNDATACOPY] = &operation{
	execute:     opReturnDataCopy,
	constantGas: GasFastestStep,
	dynamicGas:  gasReturnDataCopy,
	minStack:    minStack(3, 0),
	maxStack:    maxStack(3, 0),
	memorySize:  memoryReturnDataCopy,
}
```

–§—É–Ω–∫—Ü–∏–∏, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≥–∞–∑ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ [gas_table.go](https://github.com/ethereum/go-ethereum/blob/master/core/vm/gas_table.go#L29). –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ–ø–∫–æ–¥–∞ `RETURNDATACOPY` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è ‚Äî `gasReturnDataCopy`. –†–µ–∫–æ–º–µ–Ω–¥—É—é –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å —ç—Ç–∏–º —Ñ–∞–π–ª–æ–º –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ–¥–æ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤ —Ä–∞–±–æ—Ç–µ —Å –ø–∞–º—è—Ç—å—é –∏ –≥–∞–∑–æ–º –≤ EVM:

1. **–°—Ç–µ–∫:** –≠—Ç–æ —Å–∞–º—ã–π —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã–π –≤–∏–¥ –ø–∞–º—è—Ç–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –≤ 1024 —ç–ª–µ–º–µ–Ω—Ç–∞. –≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, —Ö–æ—Ç—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –±–æ–ª—å—à–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤.
2. **–í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å (Memory):** –†–∞—Å—Ö–æ–¥ –≥–∞–∑–∞ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏ –≤ EVM —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –µ—ë —Ä–∞–∑–º–µ—Ä–∞. –ü–æ—ç—Ç–æ–º—É, —á–µ–º –±–æ–ª—å—à–µ –æ–±—ä—ë–º `memory`, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π, —Ç–µ–º –≤—ã—à–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å. –û–¥–Ω–∞–∫–æ —ç—Ç–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–µ—à–µ–≤–ª–µ, —á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `storage`.
3. **–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –ø–∞–º—è—Ç—å (Storage):** –≠—Ç–æ —Å–∞–º—ã–π –¥–æ—Ä–æ–≥–æ–π —Ç–∏–ø –ø–∞–º—è—Ç–∏ –≤ EVM, —Ç–∞–∫ –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ –≤ `storage` –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ StateDB ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –±–ª–æ–∫—á–µ–π–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–æ —É –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å–µ—Ç–∏. –°—É—â–µ—Å—Ç–≤—É—é—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Ä–∞—Å—Ö–æ–¥–µ –≥–∞–∑–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å–æ `storage`, –∏—Ö –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –≤–æ –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏ —Å—Ç–∞—Ç—å–∏.

## Links

-   [Article: Understanding the Ethereum virtual machine ‚Äì part I](https://leftasexercise.com/2021/09/12/understanding-the-ethereum-virtual-machine-part-i/)
-   [Article: Understanding the Ethereum virtual machine ‚Äì part II](https://leftasexercise.com/2021/09/15/understanding-the-ethereum-virtual-machine-part-ii/)
-   [Article: Understanding the Ethereum virtual machine ‚Äì part III](https://leftasexercise.com/2021/09/19/q-understanding-the-ethereum-virtual-machine-part-iii/)
-   [Article: Dissecting EVM using go-ethereum Eth client implementation. Part III ‚Äî bytecode interpreter](https://medium.com/@deliriusz/dissecting-evm-using-go-ethereum-eth-client-implementation-part-iii-bytecode-interpreter-8f144004ed7a)
-   [Doc: Ethereum Yellow Paper](https://ethereum.github.io/yellowpaper/paper.pdf)
-   [Code: Go-Ethereum](https://github.com/ethereum/go-ethereum)
