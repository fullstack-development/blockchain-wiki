# Uniswap TWAP vs oracle

**–ê–≤—Ç–æ—Ä:** [–ù–∞–π–¥–∞–Ω–æ–≤ –ü–∞–≤–µ–ª](https://github.com/PavelNaydanov) üïµÔ∏è‚Äç‚ôÇÔ∏è

**–û—Ä–∞–∫—É–ª** –∏–ª–∏ —Ü–µ–Ω–æ–≤–æ–π –æ—Ä–∞–∫—É–ª - —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–æ–≤. –û—Ä–∞–∫—É–ª –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç **off-chain** –¥–∞–Ω–Ω—ã–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–æ—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä—å –±–ª–æ–∫—á–µ–π–Ω —Å–µ—Ç–∏. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –±–∏—Ä–∂–∏, landing –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∏ –¥—Ä—É–≥–∏–µ DApp. –°–∞–º–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏: —Å—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞, –±–∞–ª–∞–Ω—Å—ã –∞–¥—Ä–µ—Å–æ–≤, –ø—Ä–æ–≥–Ω–æ–∑—ã –∏ —Ç–æ–º—É –ø–æ–¥–æ–±–Ω–æ–µ.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ä–∞–∫—É–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å —Ä–∞–∑–Ω–æ–π —Å—Ç–µ–ø–µ–Ω—å—é –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ù–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å, –æ—Ä–∞–∫—É–ª—ã —è–≤–ª—è—é—Ç—Å—è –æ–¥–Ω–∏–º–∏ –∏–∑ —Å–∞–º—ã—Ö –ø–æ–¥–≤–µ—Ä–∂–µ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –≤–∑–ª–æ–º–∞.

–ü–æ—ç—Ç–æ–º—É **UniswapV2** –ø—Ä–µ–¥–ª–æ–∂–∏–ª —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É –æ—Ä–∞–∫—É–ª–∞–º –≤ –≤–∏–¥–µ **TWAP** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∏ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

_–û–ø—Ä!_ **TWAP**(Time-Weighted Average Price) - —ç—Ç–æ —Å—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏. –°—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø—É—Ç–µ–º —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞—Ö –≤—Ä–µ–º–µ–Ω–∏ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–π —Å—Ä–µ–¥–Ω–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–∞ –±–µ–∑ —É—á–µ—Ç–∞ –æ–±—ä–µ–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–π(–ø—Ä–æ–¥–∞–∂–∏ –∏–ª–∏ –ø–æ–∫—É–ø–∫–∏ –∞–∫—Ç–∏–≤–∞).

_–í–∞–∂–Ω–æ!_ –†–µ—á—å –∏–¥–µ—Ç –∏–º–µ–Ω–Ω–æ –æ **—Å—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–∞**. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–º–µ–Ω–∞ –∏–ª–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–≥–æ –æ–±–º–µ–Ω–∞ –Ω–∞ Uniswap –≤–µ–ª–∏–∫–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞ –≤ –º–æ–º–µ–Ω—Ç–µ –º–æ–∂–µ—Ç —Å–∏–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Å—Ä–µ–¥–Ω–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏. –ü–ª—é—Å —Ç–∞–∫–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–µ–≥–∫–æ –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞—Ç—å. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ—Å—Ç–æ —Å–æ–≤–µ—Ä—à–∏—Ç—å –æ–±–º–µ–Ω –Ω–∞ —Å—É–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤–ª–∏—è—Ç—å –Ω–∞ –ø—É–ª –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏.

## –ö–∞–∫ TWAP —Ä–∞–±–æ—Ç–∞–µ—Ç?

Uniswap —Å—á–∏—Ç–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç **cumulative price** –≤ –∫–æ–Ω—Ü–µ –±–ª–æ–∫–∞. **Cumulative price** - —Å—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞ –≤ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –∑–∞ –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –∂–∏–∑–Ω–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ø–∞—Ä—ã –Ω–∞ Uniswap. –ù–∏–∂–µ –Ω–∞ —Å—Ö–µ–º–µ —Ä–∞–∑–æ–±—Ä–∞–Ω–æ, –∫–∞–∫ –ø–æ—Å—á–∏—Ç–∞—Ç—å **cumulative price**.

![](./images/storing-commulative-price-data-on-chain.png)

**Cumulative price** —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:
> priceCumulative = lastPriceCumulative + currentPrice * timeElapsed

**lastPriceCumulative** - **cumulative price** –ø—Ä–æ—à–ª–æ–≥–æ –±–ª–æ–∫–∞
**currentPrice** - —Å—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞ –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–≥–æ –±–ª–æ–∫–∞
**timeElapsed** - –≤—Ä–µ–º—è –º–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–æ—à–ª–æ–≥–æ –±–ª–æ–∫–∞ –∏ –Ω–∞—á–∞–ª–æ–º —Ç–µ–∫—É—â–µ–≥–æ

–î–∞–ª—å—à–µ, —Ç–∞–∫–æ–π **cumulative price** –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å—Ç–æ—Ä–æ–Ω–Ω–∏–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–æ–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–∞ –∑–∞ –ª—é–±–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª. –ù–∏–∂–µ –Ω–∞ —Å—Ö–µ–º–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–æ, –∫–∞–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–∞–º **TWAP**.

![](./images/time-weighted-average-price.png)

–≠—Ç–æ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ. –û—Ç **cumulative price** –∫–æ–Ω–µ—á–Ω–æ–≥–æ –±–ª–æ–∫–∞ –æ—Ç–Ω–∏–º–∞–µ—Ç—Å—è **cumulative price** –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –±–ª–æ–∫–∞ –∏ –¥–µ–ª–∏—Ç—å—Å—è –Ω–∞ —Ä–∞–∑–Ω–∏—Ü—É **timestamp** —ç—Ç–∏—Ö –±–ª–æ–∫–æ–≤.

–° –ø—Ä–∏–º–µ—Ä–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Uniswap TWAP –º–æ–∂–Ω–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è [—Ç—É—Ç](https://github.com/Uniswap/v2-periphery/blob/master/contracts/examples/ExampleOracleSimple.sol).

## Links

1. [Uniswap docs](https://docs.uniswap.org/contracts/v2/concepts/core-concepts/oracles)
