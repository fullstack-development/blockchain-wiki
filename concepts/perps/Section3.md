# Section 3. Trading

## Payoffs for positions

Payoffs диаграмма - это диаграмма, которая отображает размер прибыли или убытка, который мы получим в зависимости от того, как движется цена.

## Price impact

Целью price impact заключается поддержание баланса пулов между короткими и длинными позициями.

Если действия трейдера увеличивают дисбаланс, то это называется негативным эффектом. Такому трейдеру придется заплатить некоторую комиссию за увеличение дисбаланса.

// TODO: Это важная штука, но по видео я не понимаю, как она работает
https://github.com/Cyfrin/defi-gmx-v2/blob/main/notes/price_impact.md

_Важно!_ Same side в доке означает, что дисбаланс остается на той же стороне.
Cross over означает, что дисбаланс перешел на другую сторону.

Есть такое понятие **imbalance**. Дисбаланс между Long Open Interest и Short Open Interest. Рассчитывается, как, Long Open Interest minus Short Open Interest. Если полученное значение > 0, значит лонги доминируют, иначе доминируют шорты. Нужно это для того, чтобы взимать комиссию при открытие позиции. Лонги всегда оплачивают шорты, и наоборот.

## Virtual inventory

Virtual inventory — это глобальный показатель состояния протокола, используемый для расчета price impact при свопах и позициях, чтобы предотвратить манипуляции путем дробления крупных сделок по разным рынкам.

Немногим отличается для позиций и свопов.

Для позиций:
virtualInventory = sum(longOI) - sum(shortOI) Это вроде как по всем маркетам.

Финальный impact = max(локальный impact, глобальный virtual inventory impact). Если hasVirtualInventory true для market, берется худший (более дороже) вариант. Таким образом GMX защищается от MEV и wash trading.

## Комиссии

**UIFee**
Плата за интерфейс

**Swap fee**
Комиссия за свап делится на
- депозит
- обмен обмен актива
- shift: перемещение в другой актив ликвидности
- снятие ликвидности
- и похоже другие

**Position fee**

Включает в себя:
- разовая плата за открытие и закрытие позиции ???
- network fee
- borrowing fee
- funding fee. В некоторых случаях ты будешь платить комиссию, в некоторых ты получать профит с открытия позиции

**Borrowing fee**

Это комиссия, которая оплачивается трейдером в момент закрытия позиции в пользу поставщика ликвидности. Размер комиссии увеличивается с течением времени.

Цель этой комиссии стимулировать поставщиков предоставлять ликвидность, а трейдеров закрывать свои позиции.


**Funding fee**

Это комиссия, которая взимается при открытии позиции. Если открываемая позиция входит в группу лонга, которых больше, чем шортов, то нужно уплатить комиссию. Если открывается шорт позиция, а лонги доминируют, то комиссии не будет.

Funding fee призван следить за балансом между количество лонгов и шортов. Это стимуляция для трейдера, чтобы баланс между шортами и лонгами сохранялся.

Протоколу необходим funding fee. Чтобы как раз не было перекоса по позициям иначе тогда выплаты выигрывшим позициям придется платить за счет поставщиков ликвидности.

Funding Fee может быть перераспределен в пользу тех, кто балансирует позиции. Для получения нужно отдельно склеймить токены.

Рассчитывается FundingFee аналогично accumulative в BorrowingFee.
