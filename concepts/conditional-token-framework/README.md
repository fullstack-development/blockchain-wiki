# Gnosis conditional token framework (CTF)

**–ê–≤—Ç–æ—Ä:** [–ü–∞–≤–µ–ª –ù–∞–π–¥–∞–Ω–æ–≤](https://github.com/PavelNaydanov) üïµÔ∏è‚Äç‚ôÇÔ∏è

–ö–æ–Ω—Ü–µ–ø—Ç **"Gnosis conditional token framework"** —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–æ–¥–æ–≤—É—é –±–∞–∑—É –¥–ª—è —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∏—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Ä—ã–Ω–∫–∞—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π. –¢–∞–∫–∏–µ —Ä—ã–Ω–∫–∏ —Ç–∞–∫–∂–µ —á–∞—Å—Ç–æ –Ω–∞–∑—ã–≤–∞—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ä—ã–Ω–∫–∞–º–∏, —Ñ—å—é—á–µ—Ä—Å–∞–º–∏ –∏–¥–µ–π, —Ä—ã–Ω–∫–∞–º–∏ —Ä–µ—à–µ–Ω–∏–π –∏–ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ —Ñ–æ–Ω–¥–æ–≤—ã–º–∏ —Ä—ã–Ω–∫–∞–º–∏. –ü–æ —Å—É—Ç–∏ —ç—Ç–æ –≤—Å–µ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏—Ö —Ç–æ, —á—Ç–æ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∏—Ö —Ä—ã–Ω–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–µ–ª–∞—é—Ç —Å—Ç–∞–≤–∫—É –∏–ª–∏ –≥–æ–ª–æ—Å—É—é—Ç –∑–∞ –∏—Å—Ö–æ–¥—ã —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π. –ì–ª–∞–≤–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–æ–≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏—Å—Ö–æ–¥–æ–≤ –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ –≥–æ–ª–æ—Å—É—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏. –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–º–æ–≥–∞–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –¥–∞–∂–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ —É–≥–æ–¥–Ω–æ, –æ—Ç –º–∞–ª–µ–Ω—å–∫–∏—Ö —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –¥–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–∏–Ω—è—Ç–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π.

–ú—ã –±—É–¥–µ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å CTF –≤ —Ä–∞–º–∫–∞—Ö —Ä—ã–Ω–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö.

–ú–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å—Ö–µ–º—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –≤ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–º –≤–∏–¥–µ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –∏–∑ —Å–µ–±—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ä—ã–Ω–æ–∫ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π.

![](./images/ctf-prediction-market.png)

–†—ã–Ω–æ–∫ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –∏–º–µ–µ—Ç —Å–æ–±—ã—Ç–∏–µ *"GPT-5 released in 2024?"*. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ –æ–¥–∏–Ω –∏–∑ –∏—Å—Ö–æ–¥–æ–≤ *"Yes"* –∏–ª–∏ *"No"*. –ü–æ —Å—É—Ç–∏ –¥–µ–ª–∞–µ—Ç —Å—Ç–∞–≤–∫—É. –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º –æ–Ω –±—É–¥–µ—Ç –ø–æ–∫—É–ø–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ **share —Ç–æ–∫–µ–Ω–∞** –∑–∞ –±–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω. Share —Ç–æ–∫–µ–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–∂–¥—ã–π –∏–∑ –∏—Å—Ö–æ–¥–æ–≤. –ï—Å–ª–∏ –µ–≥–æ —Å—Ç–∞–≤–∫–∞ —Å—ã–≥—Ä–∞–µ—Ç, —Ç–æ –æ–Ω –ø–æ–ª—É—á–∏—Ç –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ. –ü–æ —Å—É—Ç–∏ –≤—ã–∏–≥—Ä—ã—à.

–¢–∞–∫ –∫–∞–∫ —Ä—ã–Ω–æ–∫ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π —ç—Ç–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ, —Ç–æ –¥–∞–Ω–Ω—ã–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Å–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –æ—Ä–∞–∫—É–ª–æ–º, –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª, –Ω—É –∏ –º—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ —Ç–æ–∂–µ.

–û—Ç–¥–µ–ª—å–Ω–æ —Å—Ç–æ–∏—Ç —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–≤ –≤–æ –≤–ª–∞–¥–µ–Ω–∏–µ share —Ç–æ–∫–µ–Ω, –º–æ–∂–µ—Ç –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç, –ø–æ–∫–∞ —Å–æ–±—ã—Ç–∏–µ –Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ –∏ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –Ω–µ–º—É, –ø—Ä–æ–¥–∞—Ç—å –∏ –æ–±–º–µ–Ω—è—Ç—å share —Ç–æ–∫–µ–Ω –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Å–≤–æ–π –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤. –ò–∑–±–µ–≥–∞—é –≤ –æ–±–∑–æ—Ä–∞—Ö —ç—Ç–æ–≥–æ —Å–ª–æ–≤–∞, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, —á—Ç–æ —ç—Ç–æ –±–∞–∑–∞ –¥–ª—è —Ç—Ä–µ–π–¥–∏–Ω–≥–∞. –°–∞–º –Ω–∏ —Ç—Ä–µ–π–¥–µ—Ä –∏ –≤–∞—Å –Ω–µ –ø—Ä–∏–∑—ã–≤–∞—é.

## –ë–∞–∑–æ–≤–∞—è –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞

–ü–æ —Å—É—Ç–∏ CTF –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å—Ö–æ–¥–æ–≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è. –î–ª—è —Å–æ–±—ã—Ç–∏—è "GPT-5 released in 2024?", –∫–æ—Ç–æ—Ä–æ–µ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–ª–∏ –≤—ã—à–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –≤—Å–µ–≥–æ –¥–≤–∞ –∏—Å—Ö–æ–¥–∞. –ò—Å—Ö–æ–¥–∞–º –¥–∞–¥–∏–º –∫–æ–¥–æ–≤—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è "Y" –∏ "N".

![](./images/ctf-combinatorial-q1.png)

–û–¥–Ω–∞–∫–æ —Ä—ã–Ω–æ–∫ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–∏–º –∏ —Å–æ–±—ã—Ç–∏–π –≤ –Ω–µ–º —Ç–æ–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ. –ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –µ—â–µ –æ–¥–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ "Will GPT limit requests to 10 per hour until August?". –≠—Ç–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Ç–æ–∂–µ –∏–º–µ–µ—Ç –¥–≤–∞ –∏—Å—Ö–æ–¥–∞. –î–∞–¥–∏–º –∏–º –∫–æ–¥–æ–≤—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è "B" –∏ "A".

![](./images/ctf-combinatorial-q2.png)

–≠—Ç–∏ –¥–≤–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é —Å–≤—è–∑–∞–Ω—ã –º–µ–∂–¥—É —Å–æ–±–æ–π –∏ –º—ã –º–æ–∂–µ–º –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ö–æ–¥—ã –≤ —Ä–∞–º–∫–∞—Ö —É–∂–µ –¥–≤—É—Ö —Å–æ–±—ã—Ç–∏–π.

![](./images/ctf-combinatorial-q1-q2.png)

–¢–∞–∫–∂–µ –Ω–µ —Å—Ç–æ–∏—Ç –∑–∞–±—ã–≤–∞—Ç—å –ø—Ä–æ –æ–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π.

![](./images/ctf-combinatorial-q2-q1.png)

–°—á–∏—Ç–∞–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —É—á–∞—Å—Ç–∏–µ –≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏ —Å—Ä–∞–∑—É –ø–æ –¥–≤—É–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è–º. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –º—ã –∏–º–µ–µ–º –≤–æ—Å–µ–º—å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É—á–µ—Ç–æ–º –ø–æ—Ä—è–¥–∫–∞ –µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–π (—Å–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–≤–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ, –ø–æ—Ç–æ–º –≤—Ç–æ—Ä–æ–µ –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç). –í –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º –ø–æ–¥—Ö–æ–¥–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ä—ã–Ω–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –≤–æ—Å–µ–º—å –≤–∞—Ä–∏–∞—Ü–∏–π.

–í–æ—Ç —Ç–µ–ø–µ—Ä—å –∑–¥–µ—Å—å –º—ã –≤—ã–≤–æ–¥–∏–º –Ω–∞ –ø–µ—Ä–≤—ã–π –ø–ª–∞–Ω CTF, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –¥–æ 4 –∑–∞ —Å—á–µ—Ç —Ç–æ–≥–æ, —á—Ç–æ –≤—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –∏ –≤–∑–∞–∏–º–æ–æ–±—Ä–∞—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≥–ª—É–±–æ–∫–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º, —Ç–æ—á–Ω–µ–µ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è.

![](./images/ctf-combinatorial-ctf.png)

–í —Ä–∞–º–∫–∞—Ö CTF –∫–∞–∂–¥–∞—è –∏–∑ —á–µ—Ç—ã—Ä–µ—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **–ø–æ–∑–∏—Ü–∏–µ–π**. –¢–æ –µ—Å—Ç—å —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–∞—è –ø–æ–∑–∏—Ü–∏—è –º–æ–∂–µ—Ç —è–≤–ª—è—Ç—å—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ä–∞–∑—É –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Å–æ–±—ã—Ç–∏—è–º. –ë–æ–ª–µ–µ —Ç–æ–≥–æ, –ø–æ–¥–æ–±–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–æ—Ä—Ä–µ–ª–∏—Ä—É—é—Ç, –Ω–æ –µ—â–µ –∏ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞. –ù–∞–ø—Ä–∏–º–µ—Ä "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å –±–∏—Ç–∫–æ–∏–Ω, –µ—Å–ª–∏ –Ω–∞ –≤—ã–±–æ—Ä–∞—Ö –ø–æ–±–µ–¥–∏—Ç –¢—Ä–∞–º–ø".

## –í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CTF

–í—Å–µ –æ —á–µ–º –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–ª–∏ –≤—ã—à–µ, –ø–æ–¥–≤–æ–¥–∏—Ç –Ω–∞—Å –∫ –º—ã—Å–ª–∏, —á—Ç–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —É—Å–ª–æ–≤–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä—ã–Ω–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤. –ò –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —ç—Ç–æ —Ç–∞–∫ –∏ –µ—Å—Ç—å. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—Ä–∞–∂–∞–µ—Ç —Å–≤–æ–µ –º–Ω–µ–Ω–∏–µ, –≥–æ–ª–æ—Å—É—è –∞–∫—Ç–∏–≤–æ–º –∏ —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–±—Ä–∞—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –≥—Ä—É–ø–ø–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –≠—Ç–æ—Ç –ø—Ä–æ–≥–Ω–æ–∑ —Å –≤—ã—Å–æ–∫–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –±—É–¥–µ—Ç –ø—Ä–∏–±–ª–∏–∂–µ–Ω –∫ –∏—Å—Ç–∏–Ω–µ.

–û–¥–Ω–∞–∫–æ –Ω–µ —Å—Ä–∞–∑—É –∑–∞–º–µ—Ç–Ω–æ —Ç–æ, —á—Ç–æ —Å–∫—Ä—ã—Ç–æ –∑–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è. –≠—Ç–æ –ø–æ–∫—É–ø–∫–∞ share —Ç–æ–∫–µ–Ω–∞ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä—ã–Ω–æ—á–Ω–æ–π —Ü–µ–Ω–µ. –ë–æ–ª–µ–µ —Ç–æ–≥–æ, —Ä—ã–Ω–∫–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–∫—É–ø–∫—É, –≤–ª–∞–¥–µ–ª—å—Ü—ã share —Ç–æ–∫–µ–Ω–∞ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –º–æ–≥—É—Ç –µ–≥–æ –ø—Ä–æ–¥–∞—Ç—å. –ü—Ä–æ–¥–∞–∂–∞ —Ç–æ–∂–µ –ø–æ —Ä—ã–Ω–æ—á–Ω–æ–π —Ü–µ–Ω–µ. –£–ª–æ–≤–∏–ª —Å–≤—è–∑—å? –û—Å—Ç–∞–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä –ª–∏–º–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ –∏ —É –Ω–∞—Å —É–∂–µ –ø–æ–¥–æ–±–∏–µ –±–∏—Ä–∂–∏ –Ω–∞ –±–∞–∑–µ —Ä—ã–Ω–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π.

–°–∞–º –ø—Ä–æ—Ç–æ–∫–æ–ª —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ CTF –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –æ–¥–Ω–∏–º–∏ —Ä—ã–Ω–∫–∞–º–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –∏ —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω –≤ —Ç–∞–∫–∏—Ö –æ–±–ª–∞—Å—Ç—è—Ö, –∫–∞–∫:
- **gameFI.** –í –∏–≥—Ä–æ–≤–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç–æ–∫–µ–Ω—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–≥—Ä–∞–¥ –∏–ª–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –≤ –∏–≥—Ä–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –∏–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç –ø–æ–ª—É—á–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á –∏–ª–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π –≤ –∏–≥—Ä–µ.
- **–ø–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã**. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–∫–µ–Ω—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–≥–ª–∞—à–µ–Ω–∏–π –æ –ø–æ–∫—É–ø–∫–µ, –≥–¥–µ –ø–ª–∞—Ç–µ–∂–∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞—Ä–∞–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ –¥–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É—Å–ª—É–≥–∏.
- **–æ–ø—Ü–∏–æ–Ω—ã**. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–∫–µ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–ø—Ü–∏–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ —Ü–µ–Ω–∞ –∞–∫—Ç–∏–≤–∞ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.
- –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ –±–µ—Ä–µ–º –ª—é–±—É—é –ø—Ä–µ–¥–º–µ—Ç–Ω—É—é –æ–±–ª–∞—Å—Ç—å, –¥–æ–±–∞–≤–ª—è–µ–º –∫ –Ω–µ–π "—É—Å–ª–æ–≤–∏–µ", –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–∫–µ–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç —É—Å–ª–æ–≤–∏–µ, —Ç–æ–≥–¥–∞ –≤ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ —á—Ç–æ-—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.

–û–¥–Ω–∞–∫–æ —è —Å–∫–µ–ø—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–Ω–æ—à—É—Å—å –∫ –¥—Ä—É–≥–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –æ–Ω–∏ –ø—Ä–∏—Ç—è–Ω—É—Ç—ã –∑–∞ —É—à–∏, –∞ —Å–∞–º–æ–µ —É–¥–∞—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–æ —Ä—ã–Ω–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∫—É–ø–∏—Ç—å share —Ç–æ–∫–µ–Ω –∏–ª–∏ –ø—Ä–æ–¥–∞—Ç—å. –ï—Å–ª–∏ –Ω–µ –≤–µ—Ä–∏—à—å –º–Ω–µ, —Ç–æ [–ø–æ—á–∏—Ç–∞–π](https://docs.gnosis.io/conditionaltokens/use-case), —á—Ç–æ –æ–± —ç—Ç–æ–º –ø–∏—à–µ—Ç —Å–∞–º gnosis –∏ —Å–¥–µ–ª–∞–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥.

## AMM –¥–ª—è —Ä—ã–Ω–∫–æ–≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π

–ü—Ä–∏ —á–µ–º —Ç—É—Ç AMM —Å–ø—Ä–æ—Å–∏—Ç–µ –≤—ã? –í–µ–¥—å —Ä—ã–Ω–æ–∫ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π - —ç—Ç–æ –Ω–µ dex. –û–¥–Ω–∞–∫–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∫—É–ø–∞—Ç—å –∏ –ø—Ä–æ–¥–∞–≤–∞—Ç—å **share** —Ç–æ–∫–µ–Ω, –æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª—è—è —Å–æ —Å–≤–æ–∏–º –ø—Ä–æ–≥–Ω–æ–∑–æ–º, —Å—Ç–∞–≤–∫–æ–π –∏–ª–∏ –ø–æ–∑–∏—Ü–∏–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å share —Ç–æ–∫–µ–Ω–∞.

–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ –Ω–∞ —Ä—ã–Ω–∫–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –µ—Å—Ç—å —Å–æ–±—ã—Ç–∏–µ "–í —ç—Ç–æ–º –≥–æ–¥—É —Å–±–æ—Ä–Ω–∞—è –ü–æ—Ä—Ç—É–≥–∞–ª–∏–∏ –≤—ã–∏–≥—Ä–∞–µ—Ç —á–µ–º–ø–∏–æ–Ω–∞—Ç –º–∏—Ä–∞?" –≠—Ç–æ —Å–æ–±—ã—Ç–∏–µ –∏–º–µ–µ—Ç 100 share —Ç–æ–∫–µ–Ω–æ–≤ "–∑–∞" –∏ 100 share —Ç–æ–∫–µ–Ω–æ–≤ "–ø—Ä–æ—Ç–∏–≤". –Ø –≤ —ç—Ç–æ –Ω–µ –≤–µ—Ä—é, –≥–æ–ª–æ—Å—É—é –ø—Ä–æ—Ç–∏–≤ –∏ –≤—ã–∫—É–ø–∞—é 70 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö share —Ç–æ–∫–µ–Ω–æ–≤. –õ—é–±–æ–π –º–æ–∂–µ—Ç —Ç–æ–∂–µ –ø–æ–¥—É–º–∞—Ç—å, –∫–∞–∫ —è –∏ –≤ –∫–∞–∫–æ–π-—Ç–æ –º–æ–º–µ–Ω—Ç –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è —Å–∏—Ç—É–∞—Ü–∏—è, —á—Ç–æ —Ç–æ–∫–µ–Ω–æ–≤ –±—É–¥–µ—Ç –Ω–µ —Ö–≤–∞—Ç–∞—Ç—å –¥–ª—è –≥–æ–ª–æ—Å–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —ç—Ç—É —Å–∏—Ç—É–∞—Ü–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Automated Market Maker**. –¢–æ—á–Ω–æ —Ç–∞–∫–∞—è –∂–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∏ –¥–ª—è –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –æ–±–º–µ–Ω–Ω–∏–∫–æ–≤ (dex). –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–≤—è–∑–∞–Ω –Ω–∞ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–∑–µ—Ä–≤–æ–≤ –∞–∫—Ç–∏–≤–∞ –≤ –ø—É–ª–µ (–Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ).

–ü–æ —Å—É—Ç–∏ –º–∞—Ä–∫–µ—Ç –º–µ–π–∫–µ—Ä —Å–ª–µ–¥–∏—Ç –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –∑–∞ —Ç–µ–º, —á—Ç–æ–±—ã —Ä–µ–∑–µ—Ä–≤—ã –ø–æ –¥–≤—É–º –∞–∫—Ç–∏–≤–∞–º –≤ –ø—É–ª–µ –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å. –ü–æ—ç—Ç–æ–º—É, –∫–æ–≥–¥–∞ –æ–¥–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–Ω—å—à–µ –≤—Ç–æ—Ä–æ–≥–æ, —Ü–µ–Ω–∞ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö. –≠—Ç–æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ –∏ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –∞–∫—Ç–∏–≤–∞.

Gnosis –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –¥–≤–∞ –º–∞—Ä–∫–µ—Ç-–º–µ–π–∫–µ—Ä–∞:
- **CPMM** (Constant Product Market Maker)
- **LMSR** (Logarithmic Market Scoring Rule)

### CPMM

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º, —á—Ç–æ –∏ –ø—É–ª—ã Uniswap –∏ Balancer. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—á–Ω–æ —Ç–∞–∫—É—é –∂–µ —Ñ–æ—Ä–º—É–ª—É `x * y = k`;

–ì–¥–µ:
**x** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –≤ –ø—É–ª–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
**y** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—Ä—É–≥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –≤ –ø—É–ª–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
**k** - –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –≤–µ–ª–∏—á–∏–Ω–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–≤—É—Ö –∞–∫—Ç–∏–≤–æ–≤ **x** –∏ **y** –≤ –ø—É–ª–µ. –í–µ–ª–∏—á–∏–Ω–∞ k –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–π –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–µ, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–º —ç—Ç–æ–π –º–æ–¥–µ–ª–∏.

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ —ç—Ç–æ–≥–æ –º–∞—Ä–∫–µ—Ç-–º–µ–π–∫–µ—Ä–∞ –≤ —Ç–æ–º, —á—Ç–æ –µ–≥–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–∞—è. –ù–µ—Ç —Å–º—ã—Å–ª–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∞—Ä–∏—Ñ–º—ã.

### LMSR

–í —Ü–µ–ª–æ–º, –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ, LMSR - —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ä—ã–Ω–∫–∞—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∏—Å—Ö–æ–¥–∞. –ß–µ–º –±–æ–ª—å—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≥–æ–ª–æ—Å—É—é—Ç –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∏—Å—Ö–æ–¥, —Ç–µ–º –≤—ã—à–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å (–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, —Å—Ç–æ–∏–º–æ—Å—Ç—å) —ç—Ç–æ–≥–æ –∏—Å—Ö–æ–¥–∞.

![](./images/ctf-lmsr-formule.png)
–ì–¥–µ:
- **C(q)** - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏.
- **q[i]** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞–≤–æ–∫ –Ω–∞ i-–π –∏—Å—Ö–æ–¥ —Å–æ–±—ã—Ç–∏—è
- **b** - –ø–∞—Ä–∞–º–µ—Ç—Ä –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä–æ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ü–µ–Ω—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–±—ä–µ–º–æ–≤ —Å—Ç–∞–≤–æ–∫.

–Ø–≤–ª—è–µ—Ç—Å—è –±–æ–ª–µ–µ –Ω–∞—É—á–Ω—ã–º –∏ –Ω–∞–∏–±–æ–ª–µ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–º –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å CPMM. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ª—É—á—à–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫–∏ –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤ –∑–∞ —Å—á–µ—Ç —Ç–æ–≥–æ, —á—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ **b**.

## Framework

–ü–æ—Å–ª–µ –≤—Å–µ–≥–æ, —á—Ç–æ –º—ã –æ–±—Å—É–¥–∏–ª–∏ –≤—ã—à–µ, –Ω–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –≤—ã–≤–æ–¥, —á—Ç–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –¥–≤–∞ –∫—Ä—É–ø–Ω—ã—Ö –º–æ–¥—É–ª—è:
- [Conditional tokens](https://github.com/gnosis/conditional-tokens-contracts/tree/master). –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ç–æ–∫–µ–Ω —É—Å–ª–æ–≤–∏—è –Ω–∞ –±–∞–∑–µ ERC-1155. –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –ª–æ–≥–∏–∫—É –æ—Ç–≤–µ—á–∞—é—â—É—é –∑–∞ —Ä–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Å–æ–±—ã—Ç–∏—è–º.
- [AMM –¥–ª—è conditional tokens](https://github.com/gnosis/conditional-tokens-market-makers/tree/master). –ü–æ —Å—É—Ç–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç—Ä–µ–π–¥–∏–Ω–≥ —Ç–æ–∫–µ–Ω–∞–º–∏ –ø–æ–∑–∏—Ü–∏–∏, –∏ –∑–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ.

–≠—Ç–∏ –¥–≤–∞ –∫—Ä—É–ø–Ω—ã—Ö –º–æ–¥—É–ª—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö. –ö –Ω–∏–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ –∫–æ—Ç–æ—Ä–æ–º –ª–µ–∂–∞—Ç [utils](https://github.com/gnosis/util-contracts), –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è AMM.

![](./images/ctf-repository-architecture.png)

C **util-contracts** –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è. –≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö —Ñ–∞–±—Ä–∏–∫ –º–∞—Ä–∫–µ—Ç –º–µ–π–∫–µ—Ä–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä –≤ [FixedProductMarketMakerFactory.sol](https://github.com/gnosis/conditional-tokens-market-makers/blob/master/contracts/FixedProductMarketMakerFactory.sol#L6).

```solidity

import { ConstructedCloneFactory } from "@gnosis.pm/util-contracts/contracts/ConstructedCloneFactory.sol";

```

–û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –º—ã –ø–æ–π–¥–µ–º –≤ —Å–∞–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π util-contracts, —Ç–æ –º—ã –Ω–µ –Ω–∞–π–¥–µ–º –≤ –Ω–µ–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ `ConstructedCloneFactory.sol`. –í–∏–¥–∏–º–æ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –∏ –æ–Ω –Ω–µ –ø–µ—Ä–µ–∂–∏–ª –∞–ª—å—Ñ–∞ –≤–µ—Ä—Å–∏—é, –Ω–æ –Ω–∞–π—Ç–∏ –µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ. –ú–æ–∂–Ω–æ –≤—ã—Ç–∞—â–∏—Ç—å –µ–≥–æ –∏–∑ –≤–µ—Ä—Å–∏–π npm. –ü–æ –≤–æ—Ç —ç—Ç–æ–π [—Å—Å—ã–ª–∫–µ](https://www.npmjs.com/package/@gnosis.pm/util-contracts/v/3.0.0-alpha.3?activeTab=code).

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–±–æ—Ä

–ù–∏–∂–µ —Ä–∞–∑–±–µ—Ä–µ–º –∫–æ–¥ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ –ø–æ-–æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏. –†–∞–∑–¥–µ–ª –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ª—é–¥–µ–π –∑–Ω–∞–∫–æ–º—ã—Ö —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π.

### Conditional tokens

**Conditional tokens** –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã —Å share —Ç–æ–∫–µ–Ω–∞–º–∏ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥–ª–∏ –¥–µ–ª–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã. –ü–æ–∑–≤–æ–ª—è—é—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã –æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª—è—è –º–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–õ–æ–≥–∏–∫–∞ **—Åonditional tokens** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —ç—Ç–æ–º [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏](https://github.com/gnosis/conditional-tokens-contracts).

–ü–æ —Å—É—Ç–∏ –≥–ª–∞–≤–Ω—ã–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º —ç—Ç–æ [ConditionalTokens.sol](https://github.com/gnosis/conditional-tokens-contracts/blob/master/contracts/ConditionalTokens.sol). –û–Ω —è–≤–ª—è–µ—Ç—Å—è —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞ —Å –∫–æ—Ç–æ—Ä–æ–π –Ω—É–∂–Ω–æ –Ω–∞—á–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ. –°–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç [ERC1155.sol](https://github.com/gnosis/conditional-tokens-contracts/blob/master/contracts/ERC1155/ERC1155.sol) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –±–∏–±–ª–∏–æ—Ç–µ–∫—É [CTHelpers.sol](https://github.com/gnosis/conditional-tokens-contracts/blob/master/contracts/CTHelpers.sol).

![](./images/ctf-architecture.png)

‚ùóÔ∏è –ß—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—Å—É–¥–∏—Ç—å —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é. –°–µ–π—á–∞—Å –±—É–¥–µ—Ç –Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–æ, –Ω–æ —ç—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏.

**Condition –∏ outcomes**

–í –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –ø—Ä–æ –ø—Ä–æ–≥–Ω–æ–∑, –æ–Ω –∂–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ, —Å–æ–±—ã—Ç–∏–µ, —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –≤–æ–ø—Ä–æ—Å. –ú—ã –±—É–¥–µ–º –≤ –∫–æ–¥–µ –Ω–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–µ - **condition**, –µ–≥–æ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ö–æ–¥—ã - **outcomes**.

–ü–æ —Å—É—Ç–∏, **condition** - —ç—Ç–æ –≤–æ–ø—Ä–æ—Å –∫ –æ—Ä–∞–∫—É–ª—É, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –æ–Ω –¥–æ–ª–∂–µ–Ω –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å. –¢–∞–∫–æ–π **condition** —Ç—Ä–µ–±—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (**conditionId**), –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
- **oracle.** –ê–¥—Ä–µ—Å –æ—Ä–∞–∫—É–ª–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–±—ã—Ç–∏—è.
- **questionId.** –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è condition —Å–Ω–∞—Ä—É–∂–∏. –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö bytes32 –∏ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ —Å–æ–∑–¥–∞—é—â–µ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑ —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å—á–µ—Ç—á–∏–∫–æ–º, –≥–¥–µ –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –ø—Ä–∏–±–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω–∏—Ü—É –∫ —Å—á–µ—Ç—á–∏–∫—É, –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Å—Ö–µ–º–∞ —Å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞ –∏ –¥—Ä—É–≥–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –æ—Ä–∞–∫—É–ª–µ.
- **outcomeSlotCount.** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Ö–æ–¥–æ–≤ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è [getConditionId()](https://github.com/gnosis/conditional-tokens-contracts/blob/master/contracts/ConditionalTokens.sol#L268).

**Index set**

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∏—Å—Ö–æ–¥–∞–º (–∏—Å—Ç–∏–Ω–∞ –∏–ª–∏ –ª–æ–∂—å) –±—É–¥–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ –º–∞—Å—Å–∏–≤–∞ –±–∏—Ç –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º **Index set**. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å—Ç—å —Ç—Ä–∏ –∏—Å—Ö–æ–¥–∞: A, B, C. –¢–æ–≥–¥–∞ –∏—Å—Ç–∏–Ω–Ω–æ—Å—Ç—å A –∏ B –º–æ–∂–Ω–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –±–∏—Ç–∞–º–∏, –Ω–∞—á–∏–Ω–∞—è —Å –º–ª–∞–¥—à–µ–≥–æ –±–∏—Ç–∞ `0xCBA -> 0x011`, –≥–¥–µ –µ–¥–∏–Ω–∏—Ü–∞ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏—Å—Ö–æ–¥ –∏—Å—Ç–∏–Ω–Ω—ã–π, 0 - –ª–æ–∂—å.

**CollectionId**

**Index Set** –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥—ã —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞ —á—Ç–æ –≥–æ–ª–æ—Å—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –£ –∫–∞–∂–¥–æ–≥–æ —Ç–∞–∫–æ–≥–æ –¥–≤–æ–∏—á–Ω–æ–≥–æ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Å—è—Ç–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, `0x011 -> 3`. –ß—Ç–æ–±—ã —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —á–µ—Ç–∫–æ –º–æ–≥ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ —ç—Ç–æ—Ç **index set** –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–æ–±—ã—Ç–∏—é, –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è **collectionId** –Ω–∞ –±–∞–∑–µ:
- `indexSet`, –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–π –¥–µ—Å—è—Ç–∏—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Å—á–∏—Å–ª–µ–Ω–∏—è
- `conditionId`
- `parentConditionId`

–ü–æ —Å—É—Ç–∏ **index set** –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å. –ö–∞–∂–¥–∞—è –∏–∑ —Ç–∞–∫–∏—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –±—É–¥–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º `collectionId`.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏—Å—Ö–æ–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è [getCollectionId()](https://github.com/gnosis/conditional-tokens-contracts/blob/master/contracts/ConditionalTokens.sol#L276C14-L276C29).

**Position**

–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Ä–º–∏–Ω, –∫–æ—Ç–æ—Ä—ã–π –æ—Å—Ç–∞–µ—Ç—Å—è —Ä–∞–∑–æ–±—Ä–∞—Ç—å - —ç—Ç–æ –ø–æ–∑–∏—Ü–∏—è. –≠—Ç–æ –Ω–µ —á—Ç–æ –∏–Ω–æ–µ, –∫–∞–∫ —Å–æ–≤–æ–∫—É–ø–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏—Å—Ö–æ–¥–æ–≤ (–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ index set) –∏ –∞–∫—Ç–∏–≤–∞ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏. –ê–∫—Ç–∏–≤ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è - —ç—Ç–æ –±–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω —Ä—ã–Ω–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø–æ–∫—É–ø–∫–∞ share —Ç–æ–∫–µ–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∏—Å—Ö–æ–¥–∞.

–£ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Ç–∞–∫–∂–µ –µ—Å—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä. –ù–∞–∑—ã–≤–∞–µ—Ç—Å—è `positionId`. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–∫–µ–Ω–∞ (id —Ç–æ–∫–µ–Ω–∞) ERC-1155 –±—É–¥–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å `positionId`. –¢–∞–∫ –∫–∞–∫ —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç ERC-1155, –µ—Å—Ç—å —Ü–µ–ª—ã–π —Ä—è–¥ —Ñ—É–Ω–∫—Ü–∏–π (`safeTransferFrom()`, `setApprovalForAll()`), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–∑–≤–æ–ª—è—Ç—å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å share —Ç–æ–∫–µ–Ω –∏ –≤–º–µ—Å—Ç–µ —Å –Ω–∏–º –ø—Ä–∞–≤–æ –≤–ª–∞–¥–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–µ–π –¥—Ä—É–≥–∏–º –∞–∫–∫–∞—É–Ω—Ç–∞–º.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è [getPositionId()](https://github.com/gnosis/conditional-tokens-contracts/blob/master/contracts/ConditionalTokens.sol#L283).

#### Prepare

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç `ConditionalTokens.sol` —É–∑–Ω–∞–ª –æ –Ω–æ–≤–æ–º condition –Ω—É–∂–Ω–æ –µ–º—É –æ–± —ç—Ç–æ–º —Å–∫–∞–∑–∞—Ç—å. –≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π —Å–æ–±—ã—Ç–∏—è" –∏ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ [prepareCondition()](https://github.com/gnosis/conditional-tokens-contracts/blob/master/contracts/ConditionalTokens.sol#L65).

```solidity
function prepareCondition(address oracle, bytes32 questionId, uint outcomeSlotCount) external {
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏—Å—Ö–æ–¥–æ–≤
    require(outcomeSlotCount <= 256, "too many outcome slots");
    require(outcomeSlotCount > 1, "there should be more than one outcome slot");

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞
    bytes32 conditionId = CTHelpers.getConditionId(oracle, questionId, outcomeSlotCount);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–∞–∫–æ–π –ø—Ä–æ–≥–Ω–æ–∑ –µ—â–µ –Ω–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω
    require(payoutNumerators[conditionId].length == 0, "condition already prepared");

    // –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ —Å–ª–æ—Ç–æ–≤ –¥–ª—è –∏—Å—Ö–æ–¥–æ–≤ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –ø—Ä–æ–≥–Ω–æ–∑–∞
    payoutNumerators[conditionId] = new uint[](outcomeSlotCount);

    emit ConditionPreparation(conditionId, oracle, questionId, outcomeSlotCount);
}
```

–ó–¥–µ—Å—å –Ω–∞–¥–æ –æ—Å–æ–±–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ –∑–∞ —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è conditions. –ó–∞ —ç—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –¥–≤–∞ mappings:

```solidity
mapping(bytes32 => uint[]) public payoutNumerators;
mapping(bytes32 => uint) public payoutDenominator;
```

–í –ø–µ—Ä–≤—ã–π mapping `payoutNumerators` –æ—Ä–∞–∫—É–ª –±—É–¥–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ö–æ–¥–∞. –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å—Ö–æ–¥—É –±—É–¥–µ—Ç –æ–±–æ–∑–Ω–∞—á–∞—Ç—å 0 - –∏—Å—Ö–æ–¥ –ª–æ–∂–Ω—ã–π, 1 - –∏—Å—Ö–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π. –î–ª—è —Ç—Ä–µ—Ö –∏—Å—Ö–æ–¥–æ–≤ –≤–ø–æ–ª–Ω–µ –º–æ–∂–µ—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –¥–≤–∞ –∏–∑ —Ç—Ä–µ—Ö —è–≤–ª—è—é—Ç—Å—è –∏—Å—Ç–∏–Ω–æ–π. –¢–æ–≥–¥–∞ –æ—Ä–∞–∫—É–ª –≤–µ—Ä–Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å—Ö–æ–¥—É –≤ —Å–ª–µ–¥—É—é—â–µ–º –≤–∏–¥–µ [0.5, 0.5, 0].

Solidity –Ω–µ —É–º–µ–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥—Ä–æ–±–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏. –ü–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥, –∫–∞–∫ —Å ERC-20, –≥–¥–µ –≤–≤–æ–¥–∏—Ç—Å—è –ø–æ–Ω—è—Ç–∏–µ decimal. –≠—Ç–æ —Ç–æ, —á–∏—Å–ª–æ –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø–æ–¥–µ–ª–∏—Ç—å —Å–≤–æ–π –±–∞–ª–∞–Ω—Å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∏–¥–µ —Ü–µ–ª–æ–≥–æ –∏ –¥—Ä–æ–±–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –∑–∞ –º–µ—Å—Ç–æ decimal –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Ç–æ—Ä–æ–π mapping `payoutDenominator`, –∫–æ—Ç–æ—Ä—ã—Ö —Ö—Ä–∞–Ω–∏—Ç —á–∏—Å–ª–æ –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ numerator –∏–∑ `payoutNumerators` –±—É–¥–µ—Ç –¥–µ–ª–∏—Ç—å—Å—è.

#### Reporting

–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Å–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏—é –≤—Ä–µ–º–µ–Ω–∏ –æ–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–æ –æ—Ä–∞–∫—É–ª–æ–º. –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–æ–±—ã—Ç–∏–µ –º–æ–≥–ª–æ –±—ã—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–æ —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –æ—Ä–∞–∫—É–ª–æ–º –Ω–∞ —ç—Ç–∞–ø–µ `prepare` –≤ —Å–æ—Å—Ç–∞–≤ `conditionId` –≤—Ö–æ–¥–∏—Ç –∞–¥—Ä–µ—Å –æ—Ä–∞–∫—É–ª–∞. –ù–∞ —ç—Ç–∞–ø–µ –∫–æ–≥–¥–∞ –æ—Ä–∞–∫—É–ª –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [reportPayouts()](https://github.com/gnosis/conditional-tokens-contracts/blob/master/contracts/ConditionalTokens.sol#L78), `conditionId` –±—É–¥–µ—Ç —Å–Ω–æ–≤–∞ —Å–≥–µ–Ω–µ—Ä–µ–Ω, —Ç–æ–ª—å–∫–æ –∑–∞ –º–µ—Å—Ç–æ –∞–¥—Ä–µ—Å–∞ –æ—Ä–∞–∫—É–ª–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `msg.sender`.

```solidity
bytes32 conditionId = CTHelpers.getConditionId(msg.sender, questionId, outcomeSlotCount);
```

–ï—Å–ª–∏ `msg.sender` –±—É–¥–µ—Ç –¥—Ä—É–≥–∏–º –∞–¥—Ä–µ—Å–æ–º, –æ—Ç–ª–∏—á–Ω—ã–º –æ—Ç –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –æ—Ä–∞–∫—É–ª–∞, —Ç–æ `conditionId` –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Ç–æ–∂–µ –Ω–µ–≤–µ—Ä–Ω–æ.

–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ `reportPayouts()` –Ω–∏–∂–µ.

```solidity
// payouts - —Å–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ö–æ–¥–∞
function reportPayouts(bytes32 questionId, uint[] calldata payouts) external {
    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏—Å—Ö–æ–¥–æ–≤
    uint outcomeSlotCount = payouts.length;
    require(outcomeSlotCount > 1, "there should be more than one outcome slot");
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ü–µ–ª–µ–≤—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –ø—Ä–æ–≥–Ω–æ–∑–∞
    bytes32 conditionId = CTHelpers.getConditionId(msg.sender, questionId, outcomeSlotCount);
    require(payoutNumerators[conditionId].length == outcomeSlotCount, "condition not prepared or found");
    require(payoutDenominator[conditionId] == 0, "payout denominator already set");

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç –æ—Ä–∞–∫—É–ª–∞ –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º denominator –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π
    uint den = 0;
    for (uint i = 0; i < outcomeSlotCount; i++) {
        uint num = payouts[i];
        den = den.add(num);

        require(payoutNumerators[conditionId][i] == 0, "payout numerator already set");
        payoutNumerators[conditionId][i] = num;
    }
    require(den > 0, "payout is all zeroes");
    payoutDenominator[conditionId] = den;
    emit ConditionResolution(conditionId, msg.sender, questionId, outcomeSlotCount, payoutNumerators[conditionId]);
}
```

#### Splitting

–ì–¥–µ-—Ç–æ –≤ –ø—Ä–æ–º–µ–∂—É—Ç–∫–µ –º–µ–∂–¥—É –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π —Å–æ–±—ã—Ç–∏—è –∏ –º–æ–º–µ–Ω—Ç–æ–º, –∫–æ–≥–¥–∞ –æ—Ä–∞–∫—É–ª —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏—Å—Ö–æ–¥.

–≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **splitting**, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –∞–∫—Ç–∏–≤–∞ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–∑–∏—Ü–∏—è–º –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–ª–∏ share —Ç–æ–∫–µ–Ω–∞ –≤ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏. –ü—Ä–æ—Ü–µ—Å—Å –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –¥–≤–∞ –≤–∏–¥–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:
1. **Splitting collateral**. –≠—Ç–æ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç share —Ç–æ–∫–µ–Ω—ã, –≥–æ–ª–æ—Å—É–µ—Ç, –ø–µ—Ä–µ–¥–∞–≤–∞—è –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤ –∏ –¥–µ–ª–∞–µ—Ç —Å—Ç–∞–≤–∫—É –Ω–∞ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ö–æ–¥–æ–≤.
2. **Splitting position**. –≠—Ç–æ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–¥–µ–ª—è–µ—Ç —Å–≤–æ—é –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö —ç—Ç—É –ø–æ–∑–∏—Ü–∏—é.

![](./images/ctf-valid-splitting.png)

–° –±–∞–∑–æ–≤—ã–º –∞–∫—Ç–∏–≤–æ–º –≤—Å–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ, –≤–Ω–æ—Å–∏—à—å –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é —Å—É–º–º—É –∏ –æ–Ω–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π.

–° —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ —á—É—Ç–æ—á–∫—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ. –¢—ã –º–æ–∂–µ—à—å —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ –ø–æ–∑–∏—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è —Å–æ—Å—Ç–∞–≤–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤ —Å–µ–±–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ö–æ–¥–æ–≤.

–û–¥–Ω–∞–∫–æ –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã, –∫–æ–≥–¥–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–ª—å–∑—è –¥–µ–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–∞ —Å–æ–±—ã—Ç–∏—è –Ω–∞ –¥–≤–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–∞–∂–¥–æ–º –∏–∑ —Å–æ–±—ã—Ç–∏–π. –ò–ª–∏ –Ω–µ–ª—å–∑—è —Ä–∞–∑–¥–µ–ª–∏—Ç—å –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤ —Ç–∞–∫, —á—Ç–æ–±—ã –ø–æ–∫—Ä—ã—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ö–æ–¥—ã –∏ –ø—Ä–∏ –ª—é–±–æ–º —Ä–∞—Å–∫–ª–∞–¥–µ –ø–æ–ª—É—á–∏—Ç—å –≤—ã–≥–æ–¥—É. –ë–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://docs.gnosis.io/conditionaltokens/docs/devguide05).

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å splitting –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [splitPosition()](https://github.com/gnosis/conditional-tokens-contracts/blob/master/contracts/ConditionalTokens.sol#L105C14-L105C27).

```solidity
function splitPosition(
    IERC20 collateralToken,
    bytes32 parentCollectionId,
    bytes32 conditionId,
    uint[] calldata partition,
    uint amount
) external {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–µ–¥–∞–Ω –º–∞—Å—Å–∏–≤ –ø–æ–∑–∏—Ü–∏–π –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
    require(partition.length > 1, "got empty or singleton partition");
    uint outcomeSlotCount = payoutNumerators[conditionId].length;
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –ø–æ–¥ —Ç–∞–∫–∏–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    require(outcomeSlotCount > 0, "condition not prepared yet");

    // –ì–æ—Ç–æ–≤–∏–º –º–∞—Å–∫—É –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏—Å—Ö–æ–¥–æ–≤. –¥–ª—è 4 –∏—Å—Ö–æ–¥–æ–≤ –±—É–¥–µ—Ç 0x1111, –¥–ª—è –ø—è—Ç–∏ 0x11111
    uint fullIndexSet = (1 << outcomeSlotCount) - 1;
    // –ë—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –ø–æ–∑–∏—Ü–∏—è–º, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    uint freeIndexSet = fullIndexSet;
    uint[] memory positionIds = new uint[](partition.length);
    uint[] memory amounts = new uint[](partition.length);
    for (uint i = 0; i < partition.length; i++) {
        uint indexSet = partition[i];
        // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ indexSet –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –ø–æ —Å–æ–±—ã—Ç–∏—é
        require(indexSet > 0 && indexSet < fullIndexSet, "got invalid index set");
        require((indexSet & freeIndexSet) == indexSet, "partition not disjoint");
        freeIndexSet ^= indexSet;
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è index set
        positionIds[i] = CTHelpers.getPositionId(collateralToken, CTHelpers.getCollectionId(parentCollectionId, conditionId, indexSet));
        amounts[i] = amount;
    }

    if (freeIndexSet == 0) {
        // –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞
        if (parentCollectionId == bytes32(0)) {
            // –ü–µ—Ä–µ–≤–æ–¥–∏–º –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç
            require(collateralToken.transferFrom(msg.sender, address(this), amount), "could not receive collateral tokens");
        } else {
            // –°–∂–∏–≥–∞–µ–º share —Ç–æ–∫–µ–Ω—ã —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
            _burn(
                msg.sender,
                CTHelpers.getPositionId(collateralToken, parentCollectionId),
                amount
            );
        }
    } else {
        // –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
        // –ü–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç —Å–∂–∏–≥–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
        _burn(
            msg.sender,
            CTHelpers.getPositionId(collateralToken,
                CTHelpers.getCollectionId(parentCollectionId, conditionId, fullIndexSet ^ freeIndexSet)),
            amount
        );
    }

    // –ú–∏–Ω—Ç–∏–Ω–≥ share —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π
    _batchMint(
        msg.sender,
        positionIds,
        amounts,
        ""
    );

    emit PositionSplit(msg.sender, collateralToken, parentCollectionId, conditionId, partition, amount);
}
```

#### Merging

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª, —ç—Ç–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ —Ç–µ—Ä–º–∏–Ω—É —Ä–∞–∑–¥–µ–ª–∏–ª –ø–æ–∑–∏—Ü–∏—é –∏–ª–∏ —Ä–∞–∑–¥–µ–ª–∏–ª –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤, –æ–Ω –æ—Ç–¥–∞–ª –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤ –≤ –∫–∞–∫–æ–º-—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É.

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤—ã–π—Ç–∏ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–π, –≤—ã–≤–µ—Å—Ç–∏ –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤ –æ–±—Ä–∞—Ç–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º **merging** (—Å–ª–∏—è–Ω–∏–µ). –û–Ω —Ç–∞–∫–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Å–ª–∏—è–Ω–∏–µ –Ω–µ —Ç–æ–ª—å–∫–æ –¥–æ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞, –Ω–æ –∏ –¥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏.

![](./images/ctf-valid-merging.png)

–ú–æ–∂–Ω–æ —Å–º–µ–ª–æ —É—Ç–≤–µ—Ä–∂–¥–∞—Ç—å, —á—Ç–æ `mergePositions()` - —ç—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫ `splitPosition()`.

–î–ª—è –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ —ç—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [mergePositions()](https://github.com/gnosis/conditional-tokens-contracts/blob/master/contracts/ConditionalTokens.sol#L105C14-L105C27).

```solidity
function mergePositions(
    IERC20 collateralToken,
    bytes32 parentCollectionId,
    bytes32 conditionId,
    uint[] calldata partition,
    uint amount
) external {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–µ–¥–∞–Ω –º–∞—Å—Å–∏–≤ –ø–æ–∑–∏—Ü–∏–π –¥–ª—è —Å–ª–∏—è–Ω–∏—è
    require(partition.length > 1, "got empty or singleton partition");
    uint outcomeSlotCount = payoutNumerators[conditionId].length;
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –ø–æ–¥ —Ç–∞–∫–∏–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    require(outcomeSlotCount > 0, "condition not prepared yet");

    // –ì–æ—Ç–æ–≤–∏–º –º–∞—Å–∫—É –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏—Å—Ö–æ–¥–æ–≤. –¥–ª—è 4 –∏—Å—Ö–æ–¥–æ–≤ –±—É–¥–µ—Ç 0x1111, –¥–ª—è –ø—è—Ç–∏ 0x11111
    uint fullIndexSet = (1 << outcomeSlotCount) - 1;
    uint freeIndexSet = fullIndexSet;
    uint[] memory positionIds = new uint[](partition.length);
    uint[] memory amounts = new uint[](partition.length);
    for (uint i = 0; i < partition.length; i++) {
        uint indexSet = partition[i];
        // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ indexSet –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –ø–æ —Å–æ–±—ã—Ç–∏—é
        require(indexSet > 0 && indexSet < fullIndexSet, "got invalid index set");
        require((indexSet & freeIndexSet) == indexSet, "partition not disjoint");
        freeIndexSet ^= indexSet;
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è index set
        positionIds[i] = CTHelpers.getPositionId(collateralToken, CTHelpers.getCollectionId(parentCollectionId, conditionId, indexSet));
        amounts[i] = amount;
    }
    // –°–∂–∏–≥–∞–µ–º share —Ç–æ–∫–µ–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –ø–æ–∑–∏—Ü–∏—è–º
    _batchBurn(
        msg.sender,
        positionIds,
        amounts
    );

    if (freeIndexSet == 0) {
        // –°–ª–∏—è–Ω–∏–µ –¥–æ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞
        if (parentCollectionId == bytes32(0)) {
            // –û—Ç—Å—ã–ª–∞–µ–º –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            require(collateralToken.transfer(msg.sender, amount), "could not send collateral tokens");
        } else {
            _mint(
                msg.sender,
                CTHelpers.getPositionId(collateralToken, parentCollectionId),
                amount,
                ""
            );
        }
    } else {
        // –°–ª–∏—è–Ω–∏–µ –¥–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
        _mint(
            msg.sender,
            CTHelpers.getPositionId(collateralToken,
                CTHelpers.getCollectionId(parentCollectionId, conditionId, fullIndexSet ^ freeIndexSet)),
            amount,
            ""
        );
    }

    emit PositionsMerge(msg.sender, collateralToken, parentCollectionId, conditionId, partition, amount);
}
```

#### Redeem position

–ü–æ—Å–ª–µ–¥–Ω–µ–µ, —á—Ç–æ —Ç—É—Ç —Å—Ç–æ–∏—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å - —ç—Ç–æ –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—à–ª–æ –∏ –æ—Ä–∞–∫—É–ª –ø—Ä–æ–∏–∑–≤–µ–ª —Ä–∞—Å—á–µ—Ç —Å–æ–±—ã—Ç–∏—è. **Redeem** (–≤—ã–∫—É–ø) –∫–∞–∫–æ–π-—Ç–æ –ø–æ–∑–∏—Ü–∏–∏ –±—É–¥–µ—Ç –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ, –∫–æ–≥–¥–∞ –∏—Å—Ö–æ–¥ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–∑–Ω–∞–Ω –∏—Å—Ç–∏–Ω–Ω—ã–º.

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ –∑–∞–±—Ä–∞—Ç—å (–≤—ã–∫—É–ø–∏—Ç—å) —Å–≤–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [redeemPosition()](https://github.com/gnosis/conditional-tokens-contracts/blob/master/contracts/ConditionalTokens.sol#L218).

```solidity
// –ü–∞—Ä–∞–º–µ—Ç—Ä indexSets –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ partition. –ü–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
function redeemPositions(IERC20 collateralToken, bytes32 parentCollectionId, bytes32 conditionId, uint[] calldata indexSets) external {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –µ—Å—Ç—å –∏ –æ–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ
    // –î–µ–Ω–æ–º–∏–Ω–∞—Ç–æ—Ä –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω –æ—Ä–∞–∫—É–ª–æ–º, –∫–æ–≥–¥–∞ –æ–Ω –≤—ã–∑–æ–≤–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é reportPayouts()
    uint den = payoutDenominator[conditionId];
    require(den > 0, "result for condition not received yet");
    uint outcomeSlotCount = payoutNumerators[conditionId].length;
    require(outcomeSlotCount > 0, "condition not prepared yet");

    uint totalPayout = 0;

    // –ì–æ—Ç–æ–≤–∏–º –º–∞—Å–∫—É –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏—Å—Ö–æ–¥–æ–≤. –¥–ª—è 4 –∏—Å—Ö–æ–¥–æ–≤ –±—É–¥–µ—Ç 0x1111, –¥–ª—è –ø—è—Ç–∏ 0x11111
    uint fullIndexSet = (1 << outcomeSlotCount) - 1;
    // –¶–∏–∫–ª –ø–æ –≤—Å–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –ø–æ–∑–∏—Ü–∏—è–º
    for (uint i = 0; i < indexSets.length; i++) {
        uint indexSet = indexSets[i];
        // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ indexSet –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –ø–æ —Å–æ–±—ã—Ç–∏—é
        require(indexSet > 0 && indexSet < fullIndexSet, "got invalid index set");
        // –ü–æ–ª—É—á–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–∑–∏—Ü–∏–∏
        uint positionId = CTHelpers.getPositionId(collateralToken,
            CTHelpers.getCollectionId(parentCollectionId, conditionId, indexSet));

        uint payoutNumerator = 0;
        for (uint j = 0; j < outcomeSlotCount; j++) {
            if (indexSet & (1 << j) != 0) {
                payoutNumerator = payoutNumerator.add(payoutNumerators[conditionId][j]);
            }
        }

        uint payoutStake = balanceOf(msg.sender, positionId);
        if (payoutStake > 0) {
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
            totalPayout = totalPayout.add(payoutStake.mul(payoutNumerator).div(den));
            // –°–∂–∏–≥–∞–µ–º share —Ç–æ–∫–µ–Ω—ã –ø–æ –ø–æ–∑–∏—Ü–∏–∏
            _burn(msg.sender, positionId, payoutStake);
        }
    }

    // –í—ã–ø–ª–∞—á–∏–≤–∞–µ–º –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –∏–ª–∏ –º–∏–Ω—Ç–∏–º share —Ç–æ–∫–µ–Ω—ã, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è
    if (totalPayout > 0) {
        if (parentCollectionId == bytes32(0)) {
            require(collateralToken.transfer(msg.sender, totalPayout), "could not transfer payout to message sender");
        } else {
            _mint(msg.sender, CTHelpers.getPositionId(collateralToken, parentCollectionId), totalPayout, "");
        }
    }
    emit PayoutRedemption(msg.sender, collateralToken, parentCollectionId, conditionId, indexSets, totalPayout);
}
```

### Market maker

–ü—Ä–æ—Ç–æ–∫–æ–ª —Ä–µ–∞–ª–∏–∑—É–µ—Ç –æ–±–∞ —Ç–∏–ø–∞ –º–∞—Ä–∫–µ—Ç –º–µ–π–∫–µ—Ä–∞ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö. –ò CPMM –∏ LMSR.
–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –∫–æ–¥ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ –∏–∑ –Ω–∏—Ö - CPMM. –û–Ω –ø—Ä–æ—â–µ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è.

–ù–∞–∑–≤–∞–Ω–∏–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç CPMM, [FixedProductMarketMaker.sol](https://github.com/gnosis/conditional-tokens-market-makers/blob/master/contracts/FixedProductMarketMaker.sol). –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ä–∫–µ—Ç –º–µ–π–∫–µ—Ä–∞ –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ñ–∞–±—Ä–∏–∫–∞. –î–ª—è FixedProductMarketMaker, –ª–æ–≥–∏—á–Ω–æ, —á—Ç–æ —Ñ–∞–±—Ä–∏–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è [FixedProductMarketMakerFactory.sol](https://github.com/gnosis/conditional-tokens-market-makers/blob/master/contracts/FixedProductMarketMakerFactory.sol).

–†–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–æ –≤—Å–µ –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º.

![](./images/ctf-market-maker-with-factory.png)

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ, —Ä—ã–Ω–æ–∫ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º CPMM, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [createFixedProductMarketMaker()](https://github.com/gnosis/conditional-tokens-market-makers/blob/master/contracts/FixedProductMarketMakerFactory.sol#L83), –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–±—Ä–∏–∫–∏ **ConstructedCloneFactory.sol** —Å–æ–∑–¥–∞—Å—Ç —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–æ–≤–æ–≥–æ –º–∞—Ä–∫–µ—Ç–∞ –∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –µ–≥–æ.

–ú–∞—Ä–∫–µ—Ç –º–µ–π–∫–µ—Ä –±—É–¥–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–º ERC-1155 —Ç–æ–∫–µ–Ω–∞. –¢–æ–∫–µ–Ω –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. –ß—Ç–æ–±—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∏—Ç—å ERC-1155 —Ç–æ–∫–µ–Ω, `FixedProductMarketMakerFactory.sol` –∏–º–µ–µ—Ç –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏: [onERC1155Received()](https://github.com/gnosis/conditional-tokens-market-makers/blob/master/contracts/FixedProductMarketMaker.sol#L232) –∏ [onERC1155BatchReceived()](https://github.com/gnosis/conditional-tokens-market-makers/blob/master/contracts/FixedProductMarketMaker.sol#L248).

–ü–æ–ª—É—á–∞–µ—Ç—Å—è, —á—Ç–æ –º–∞—Ä–∫–µ—Ç –º–µ–π–∫–µ—Ä —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ—Å–ª–æ–π–∫–æ–π –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ conditionalTokens.

![](./images/ctf-market-maker-call-stack.png)

#### –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å

–¢–∞–∫ –∫–∞–∫ —ç—Ç–æ AMM, —Ç–æ –ø–µ—Ä–≤–æ–µ —Å —á–µ–≥–æ —Å—Ç–æ–∏—Ç –Ω–∞—á–∞—Ç—å - —ç—Ç–æ —Ç–æ, —á—Ç–æ –æ–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø—É–ª, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å. –¢–æ –µ—Å—Ç—å –∑–¥–µ—Å—å –≤—Å—è —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∞—è —ç—Ç–æ–º—É –∏—Å—Ç–æ—Ä–∏—è: –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, LP —Ç–æ–∫–µ–Ω—ã –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞, –ø–µ—Ä–≤–æ–º—É –ø–æ—Å—Ç–∞–≤—â–∏–∫—É. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –∑–∞–¥–∞–µ—Ç—Å—è –Ω–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å, –∞ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏—Å—Ö–æ–¥–æ–≤.

–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –±—É–¥–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ –≤—Å–µ–º —Ç–æ–∫–µ–Ω–∞–º —É—Å–ª–æ–≤–∏—è –Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ, —Å–æ–≥–ª–∞—Å–Ω–æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—é —Ç–æ–∫–µ–Ω–æ–≤ –≤ –∫–∞–∂–¥–æ–º –∏—Å—Ö–æ–¥–µ. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–æ–≥–¥–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫ –≤–Ω–æ—Å–∏—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å, —Ç–æ –¥–ª—è –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∏—Å—Ö–æ–¥–æ–≤ –≤—ã–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫–æ–µ-—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–∞ —É—Å–ª–æ–≤–∏—è.

–î–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–∞–ª–∞–Ω—Å—ã —Ç–æ–∫–µ–Ω–æ–≤ —É—Å–ª–æ–≤–∏—è –∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–æ–ª—É—á–∞–µ—Ç –∏—Ö –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ [getPoolBalances()](https://github.com/gnosis/conditional-tokens-market-makers/blob/master/contracts/FixedProductMarketMaker.sol#L64).

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤–Ω–µ—Å—Ç–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [addFunding()](https://github.com/gnosis/conditional-tokens-market-makers/blob/master/contracts/FixedProductMarketMaker.sol#L148C14-L148C24). –ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –Ω–µ–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ.

```solidity
function addFunding(uint addedFunds, uint[] calldata distributionHint)
    external
{
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É–∫–∞–∑–∞–Ω–∞ —Å—É–º–º–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞
    require(addedFunds > 0, "funding must be non-zero");

    uint[] memory sendBackAmounts = new uint[](positionIds.length);

    uint poolShareSupply = totalSupply();
    uint mintAmount;
    if(poolShareSupply > 0) {
        // –ï—Å–ª–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–µ –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑, —Ç–æ distributionHint –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç—ã–º
        require(distributionHint.length == 0, "cannot use distribution hint after initial funding");
        uint[] memory poolBalances = getPoolBalances();
        uint poolWeight = 0;
        // –í—ã—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—É–ª —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º, –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ —Ç–æ–∫–µ–Ω–∞–º —É—Å–ª–æ–≤–∏—è
        for(uint i = 0; i < poolBalances.length; i++) {
            uint balance = poolBalances[i];
            if(poolWeight < balance)
                poolWeight = balance;
        }

        for(uint i = 0; i < poolBalances.length; i++) {
            uint remaining = addedFunds.mul(poolBalances[i]) / poolWeight;
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—É condition —Ç–æ–∫–µ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∏—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
            sendBackAmounts[i] = addedFunds.sub(remaining);
        }

        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ LP —Ç–æ–∫–µ–Ω–∞, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å
        mintAmount = addedFunds.mul(poolShareSupply) / poolWeight;
    } else {
        // –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑, —Ç–æ distributionHint –±—É–¥–µ—Ç –∑–∞–¥–∞–Ω–æ –ø—Ä–∞–≤–∏–ª–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ –ø—É–ª–∞–º
        if(distributionHint.length > 0) {
            require(distributionHint.length == positionIds.length, "hint length off");
            uint maxHint = 0;
            for(uint i = 0; i < distributionHint.length; i++) {
                uint hint = distributionHint[i];
                if(maxHint < hint)
                    maxHint = hint;
            }

            for(uint i = 0; i < distributionHint.length; i++) {
                uint remaining = addedFunds.mul(distributionHint[i]) / maxHint;
                require(remaining > 0, "must hint a valid distribution");
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—É condition —Ç–æ–∫–µ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∏—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
                sendBackAmounts[i] = addedFunds.sub(remaining);
            }
        }

        mintAmount = addedFunds;
    }

    // –ü–µ—Ä–µ–≤–æ–¥ –∞–∫—Ç–∏–≤–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç
    require(collateralToken.transferFrom(msg.sender, address(this), addedFunds), "funding transfer failed");
    require(collateralToken.approve(address(conditionalTokens), addedFunds), "approval for splits failed");

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
    splitPositionThroughAllConditions(addedFunds);

    // –°–æ–∑–¥–∞–Ω–∏–µ LP —Ç–æ–∫–µ–Ω–∞
    _mint(msg.sender, mintAmount);

    // –ü–µ—Ä–µ–≤–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤ —É—Å–ª–æ–≤–∏—è –≤—ã–∑—ã–≤–∞—é—â–µ–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    conditionalTokens.safeBatchTransferFrom(address(this), msg.sender, positionIds, sendBackAmounts, "");

    for (uint i = 0; i < sendBackAmounts.length; i++) {
        sendBackAmounts[i] = addedFunds.sub(sendBackAmounts[i]);
    }

    emit FPMMFundingAdded(msg.sender, sendBackAmounts, mintAmount);
}
```

–ß—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [removeFunding()](https://github.com/gnosis/conditional-tokens-market-makers/blob/master/contracts/FixedProductMarketMaker.sol#L208C14-L208C27). Lp —Ç–æ–∫–µ–Ω—ã –±—É–¥—É—Ç —Å–æ–∂–∂–µ–Ω—ã, –∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫ –ø–æ–ª—É—á–∏—Ç –æ–±—Ä–∞—Ç–Ω–æ —Å–≤–æ–π –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤.

**–ó–∞—á–µ–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –Ω—É–∂–Ω–∞?**
–ß–µ–º –±–æ–ª—å—à–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –≤ –ø—É–ª–µ, —Ç–µ–º –±–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤ —Ä—ã–Ω–æ–∫ –∫ –±–æ–ª—å—à–∏–º —Å–¥–µ–ª–∫–∞–º –∏ —Ü–µ–Ω–æ–≤—ã–º –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è–º. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –∫–æ–º–∏—Å—Å–∏—è—Ö.

#### Buy –∏ sell

```solidity
function buy(uint investmentAmount, uint outcomeIndex, uint minOutcomeTokensToBuy) external {
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—É –ø–æ–∫—É–ø–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∏—Å—Ö–æ–¥–∞ (share —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∏—Å—Ö–æ–¥—É)
    uint outcomeTokensToBuy = calcBuyAmount(investmentAmount, outcomeIndex);
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–ø—É—Å—Ç–∏–º–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –º—ã —Å–æ–≥–ª–∞—Å–Ω—ã
    require(outcomeTokensToBuy >= minOutcomeTokensToBuy, "minimum buy amount not reached");

    // –ü–µ—Ä–µ–≤–æ–¥–∏–º –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–∞—Ä–∫–µ—Ç –º–µ–π–∫–µ—Ä–∞
    require(collateralToken.transferFrom(msg.sender, address(this), investmentAmount), "cost transfer failed");

    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –≤ –±–∞–∑–æ–≤–æ–º –∞–∫—Ç–∏–≤–µ
    uint feeAmount = investmentAmount.mul(fee) / ONE;
    feePoolWeight = feePoolWeight.add(feeAmount);
    uint investmentAmountMinusFees = investmentAmount.sub(feeAmount);
    require(collateralToken.approve(address(conditionalTokens), investmentAmountMinusFees), "approval for splits failed");

    // –°–ø–ª–∏—Ç–∏–º –Ω–∞ –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
    splitPositionThroughAllConditions(investmentAmountMinusFees);
    // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Ç–æ–∫–µ–Ω—ã –ø–æ–∑–∏—Ü–∏–π —Å–µ–Ω–¥–µ—Ä—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    conditionalTokens.safeTransferFrom(address(this), msg.sender, positionIds[outcomeIndex], outcomeTokensToBuy, "");

    emit FPMMBuy(msg.sender, investmentAmount, feeAmount, outcomeIndex, outcomeTokensToBuy);
}
```

–ó–¥–µ—Å—å –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –≤–æ–ø—Ä–æ—Å, —á—Ç–æ –∑–∞ —Å–ø–ª–∏—Ç–∏–Ω–≥ –Ω–∞ –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ (splitPositionThroughAllConditions). –í—Å–µ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ. –°—Ç–∞–≤–∫–∞ –¥–µ–ª–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ö–æ–¥—ã.

```solidity
function splitPositionThroughAllConditions(uint amount)
    private
{
    for(uint i = conditionIds.length - 1; int(i) >= 0; i--) {
        uint[] memory partition = generateBasicPartition(outcomeSlotCounts[i]);
        for(uint j = 0; j < collectionIds[i].length; j++) {
            conditionalTokens.splitPosition(collateralToken, collectionIds[i][j], conditionIds[i], partition, amount);
        }
    }
}
```

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –≤—ã–∑–æ–≤ –µ—Å—Ç—å –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ conditional tokens. –ó–∞ —ç—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è [sell()](https://github.com/gnosis/conditional-tokens-market-makers/blob/master/contracts/FixedProductMarketMaker.sol#L321). –¢–æ–ª—å–∫–æ –∑–∞ –º–µ—Å—Ç–æ —Å–ø–ª–∏—Ç–∏–Ω–≥–∞ –ø–æ –≤—Å–µ–º –ø–æ–∑–∏—Ü–∏—è–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è [mergePositionsThroughAllConditions()](https://github.com/gnosis/conditional-tokens-market-makers/blob/master/contracts/FixedProductMarketMaker.sol#L94).

```solidity
function sell(uint returnAmount, uint outcomeIndex, uint maxOutcomeTokensToSell) external {
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—É —Ç–æ–∫–µ–Ω–æ–≤ –∏—Å—Ö–æ–¥–æ–≤ –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –Ω–∞ –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤
    uint outcomeTokensToSell = calcSellAmount(returnAmount, outcomeIndex);
    require(outcomeTokensToSell <= maxOutcomeTokensToSell, "maximum sell amount exceeded");

    // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Ç–æ–∫–µ–Ω—ã –∏—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–∞—Ä–∫–µ—Ç –º–µ–π–∫–µ—Ä–∞
    conditionalTokens.safeTransferFrom(msg.sender, address(this), positionIds[outcomeIndex], outcomeTokensToSell, "");

    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
    uint feeAmount = returnAmount.mul(fee) / (ONE.sub(fee));
    feePoolWeight = feePoolWeight.add(feeAmount);
    uint returnAmountPlusFees = returnAmount.add(feeAmount);
    // –ú–µ—Ä–¥–∂–∏–º –ø–æ–∑–∏—Ü–∏–∏ –¥–æ –±–∞–∑–æ–≤–≥–æ –∞–∫—Ç–∏–≤–∞
    mergePositionsThroughAllConditions(returnAmountPlusFees);

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–π –∞–∫—Ç–∏–≤—ã —Å–µ–Ω–¥–µ—Ä—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    require(collateralToken.transfer(msg.sender, returnAmount), "return transfer failed");

    emit FPMMSell(msg.sender, returnAmount, feeAmount, outcomeIndex, outcomeTokensToSell);
}
```

## –í—ã–≤–æ–¥

–ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è —Å–∫–∞–∑–∞—Ç—å, –∫–æ–º—É —ç—Ç–æ –≤—Å–µ –Ω—É–∂–Ω–æ. –ü—Ä–æ—Ç–æ–∫–æ–ª –ø—Ä–∏–≤–æ–¥–∏—Ç –≤ –ø—Ä–∏–º–µ—Ä —Ç—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç CTF:
- [alice](https://alice.si/)
- [flyingcarpet.network](https://www.flyingcarpet.network/)
- [omen](https://omen-eth.ipns.dweb.link/)

–Ø –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞—é –ø—Ä–æ —ç—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã, –Ω–æ –∑–Ω–∞—é –¥—Ä—É–≥–æ–π –ø—Ä–∏–º–µ—Ä - —ç—Ç–æ —Ä—ã–Ω–æ–∫ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π [Polymarket](https://polymarket.com/). –û–Ω —É—Å–ø–µ—à–Ω–æ –≤–Ω–µ–¥—Ä–∏–ª CTF –∏ –Ω–∞–∫—Ä—É—Ç–∏–ª —Å–≤–æ–µ–π –ª–æ–≥–∏–∫–∏ –ø–æ–≤–µ—Ä—Ö, —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å –ª–∏–º–∏—Ç–Ω—ã–º–∏ –æ—Ä–¥–µ—Ä–∞–º–∏. –≠—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫–µ–π—Å, –ø–æ—Ç–æ–º—É —á—Ç–æ polymarket —è–≤–ª—è–µ—Ç—Å—è –æ–¥–Ω–∏–º –∏–∑ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤ –∏ –∏–º–µ–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

–ï—Å–ª–∏ –ø–æ–¥—ã—Ç–æ–∂–∏—Ç—å, —Ç–æ CTF –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∏—Å—Ö–æ–¥–æ–≤ —Å–æ–±—ã—Ç–∏–π –∏ —Ä–∞–∑–ª–∏—á–Ω–æ–≥–æ —Ä–æ–¥–∞ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å –Ω–∏–º–∏. –ü—Ä–∏ —ç—Ç–æ–º –æ–Ω –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ–π –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è. –¢—Ä–µ–±—É–µ—Ç –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è –≤ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫—É, —Ä–∞–±–æ—Ç—É —Å –±–∏—Ç–∞–º–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –ü—Ä–∏ —ç—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è —á—É—Ç—å –ª–∏ –Ω–µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –Ω–∞ –±–∞–∑–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å —Ä—ã–Ω–æ–∫ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π. Gnosis –≤—Å–µ –µ—â–µ –æ—Ç–∫—Ä—ã—Ç –∫ –Ω–æ–≤—ã–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è–º —Å–≤–æ–µ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞, –æ–¥–Ω–∞–∫–æ —Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –Ω–µ —Ç–∞–∫ –º–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞ –≤—Ä–µ–º—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –±—ã–ª–æ –ø—Ä–∏–¥—É–º–∞–Ω–æ.

## Links

1. Gnosis [introduction](https://docs.gnosis.io/conditionaltokens/docs/introduction1)
2. [Conditional Tokens Contracts —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π](https://github.com/gnosis/conditional-tokens-contracts)
3. [Conditional Tokens - Automated Market Makers —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π](https://github.com/gnosis/conditional-tokens-market-makers/tree/master)
