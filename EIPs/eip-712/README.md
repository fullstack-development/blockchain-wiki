# EIP-712: Typed structured data hashing and signing

**–ê–≤—Ç–æ—Ä:** [–ü–∞–≤–µ–ª –ù–∞–π–¥–∞–Ω–æ–≤](https://github.com/PavelNaydanov) üïµÔ∏è‚Äç‚ôÇÔ∏è

EIP-712 - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–¥–ø–∏—Å–∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —É–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞, –ø–æ–∑–≤–æ–ª—è—è –∫–æ—à–µ–ª—å–∫–∞–º –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ  –ø–æ–¥–ø–∏—Å–∏.

–°—Ç–∞–Ω–¥–∞—Ä—Ç —è–≤–ª—è–µ—Ç—Å—è —Ä–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç—å—é [ERC-191](https://eips.ethereum.org/EIPS/eip-191). –°–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –ø–æ–¥–ø–∏—Å—å —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

![](./images/eip-191-signature.png)

`0x19` - –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –ø–æ–¥–ø–∏—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–µ—Ç–∏ Ethereum –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π —Å RLP –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.
`1 byte version` - –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–∏–ø–µ –ø–æ–¥–ø–∏—Å–∏: personal, EIP-712 –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

–î–ª—è EIP-712 –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø–æ–ª—è –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
- `<1 byte version>` = `0x01`. –£–∫–∞–∑—ã–≤–∞–µ—Ç –≤ –ø–æ–¥–ø–∏—Å–∏, —á—Ç–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç EIP-712. –í—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ç–∏–ø—ã –≤–µ—Ä—Å–∏–π –æ–ø–∏—Å–∞–Ω—ã –≤ [—Ç–∞–±–ª–∏—Ü–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ ERC-191](https://eips.ethereum.org/EIPS/eip-191#registry-of-version-bytes).
- `<version specific data>` = `domainSeparator`. –¢–µ—Ä–º–∏–Ω `domainSeparator` –≤–≤–æ–¥–∏—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º EIP-712 –∏ —Å–ª—É–∂–∏—Ç –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–¥–ø–∏—Å–∏.
- `<data to sign>` = `hashStruct(message)`. –≠—Ç–æ —Ö–µ—à –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–∞–Ω–Ω—ã—Ö.

## –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ domainSeparator

**DomainSeparator** —è–≤–ª—è–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–¥–ø–∏—Å–∏ –∏ –∏–º–µ–µ—Ç —Ç—Ä–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ü–µ–ª–∏:
1. **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** ‚Äì –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∏.
2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** ‚Äì –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–ª –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, —Ç–æ –æ–Ω–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∏–ª–∏ —Å–µ—Ç–∏.
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è** ‚Äì domainSeparator –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞—Ä–∞–Ω–µ–µ –≤—ã—á–∏—Å–ª–∏—Ç—å —á–∞—Å—Ç—å —Ö—ç—à–∞ –≤—Å–µ–π –ø–æ–¥–ø–∏—Å–∏, —á—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏.

–û–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è `domainSeparator` —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
```
domainSeparator = hashStruct(eip712Domain)
```

`hashStruct(eip712Domain)` - —ç—Ç–æ —Ö–µ—à —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:

![](./images/eip712Domain.png)

- `string name`. –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ–¥–ø–∏—Å—å
- `string version`. –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∏. –ü–æ–¥–ø–∏—Å–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã. –ü–æ —Å—É—Ç–∏ —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–µ–π.
- `uint256 chainId`. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ü–µ–ø–æ—á–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è EIP-155 –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç *replay attack*. –û—Å–æ–±–µ–Ω–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –∫–æ–≥–¥–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ç—è—Ö.
- `address verifyingContract`. –ê–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–ø–∏—Å—å. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä—è—é—â–∏—Ö –ø–æ–¥–ø–∏—Å—å.
- `bytes32 salt`. –°–æ–ª—å –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞. –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–≤—É—Ö –ø–æ–¥–ø–∏—Å–µ–π —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ domainSeparator.

_–í–∞–∂–Ω–æ!_ –í—Å–µ –ø–æ–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `eip712Domain` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã –∏ –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∞—Ç—å—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ –≤ —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

## –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–∏

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –≤ —Ä–∞–º–∫–∞—Ö EIP-191 –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏, –∫–∞–∫ `<data to sign>`, –∞ –≤ —Ä–∞–º–∫–∞—Ö EIP-712 –∫–∞–∫ `hashStruct(message)`.

–ù–æ –ø—Ä–µ–∂–¥–µ, —á–µ–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å —Ö–µ—à —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–Ω–∏–º–∞—Ç—å –∫–∞–∫–∏–µ –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –º–æ–≥—É—Ç –±—ã—Ç—å.

### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

–í—ã–¥–µ–ª—è—é—Ç –≤—Å–µ–≥–æ —Ç—Ä–∏ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö:
1. **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç–∏–ø—ã**. –≠—Ç–æ `bytes1`, `bytes32`, `uint8`, `uint256`, `int8`, `int256` –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –¢–∞–∫–∂–µ `bool` –∏ `address`. –í–∞–∂–Ω–æ, —á—Ç–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è aliases `int`, `uint`. –¢–∞–∫–∂–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –≤ –±—É–¥—É—â–µ–º.
2. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã**. –°—é–¥–∞ –æ—Ç–Ω–æ—Å—è—Ç—Å—è `bytes` –∏ `string`.
3. **–°—Å—ã–ª–æ—á–Ω—ã–µ —Ç–∏–ø—ã**. –≠—Ç–æ –º–∞—Å—Å–∏–≤—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –ú–∞—Å—Å–∏–≤—ã —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–º–µ—Ä–æ–º –æ–±–æ–∑–Ω–∞—á–∞—é—Ç—Å—è, –∫–∞–∫ `Type[]`, c —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º `Type[n]`. –ù–∞–ø—Ä–∏–º–µ—Ä, `address[]` –∏–ª–∏ `address[5]`.

–í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å –∏ —É—á–∏—Ç—ã–≤–∞—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∏–∑ –Ω–∏—Ö –µ—Å—Ç—å –Ω—é–∞–Ω—Å—ã –ø—Ä–∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö.

### –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–∏

–ü–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –∏–∑ —Å–µ–±—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç `hashStruct(message)`.

> hashStruct(message) = keccak256(typeHash ‚Äñ encodeData(message))

–≠—Ç—É –∑–∞–ø–∏—Å—å –º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å —Ç–∞–∫, —á—Ç–æ —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ keccak256 –¥–≤–∞ –æ–±—ä–µ–∫—Ç–∞: `typeHash` –∏ `encodeData(message)`.

`typeHash` - —ç—Ç–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ö–µ—à —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏–∑ message. –û–ø–∏—Å–∞—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç—Ç–æ –º–æ–∂–Ω–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º `typeHash = keccak256(encodeType(typeOf(message)))`.

`encodeData(message)` - —ç—Ç–æ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö `message`.

–í –∫–æ–¥–µ –º—ã –±—É–¥–µ–º –æ–ø–∏—Å—ã–≤–∞—Ç—å TYPE_HASH —Ö–µ—à–µ–º —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–∏–ø—ã –ø–æ–ª—è `user` –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `Order`:

```solidity
bytes32 private constant TYPE_HASH = keccak256("Order(address user)");
```

–í —Ä–æ–ª–∏ `message` –≤—ã—Å—Ç—É–ø–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ user, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –±—É–¥–µ–º –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å.

**encodeData**

–ú–æ–∂–Ω–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å —ç—Ç–æ, –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä—É–µ—Ç –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `message` –≤ —Ç–æ–º –ø–æ—Ä—è–¥–∫–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω–∏ –æ–±—ä—è–≤–ª–µ–Ω—ã.

_–í–∞–∂–Ω–æ!_ –ö–∞–∂–¥–æ–µ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —á–ª–µ–Ω–∞ –∏–º–µ–µ—Ç –¥–ª–∏–Ω—É —Ä–æ–≤–Ω–æ 32 –±–∞–π—Ç–∞.

–ò –≤–æ—Ç –∑–¥–µ—Å—å –º—ã –ø–æ–¥–æ—à–ª–∏ –∫ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—é –ø–æ–ª–µ–π, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ —Å–∞–º–æ–≥–æ –ø–æ–ª—è.

**–ó–Ω–∞—á–µ–Ω–∏—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ —Ç–∏–ø–∞**

–ö–æ–¥–∏—Ä—É—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ ABI v1 –∏ v2. –¢–æ –µ—Å—Ç—å `bool` –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è, –∫–∞–∫ —á–∏—Å–ª–æ uint256 –≤ –∑–Ω–∞—á–µ–Ω–∏—è—Ö 0 –∏–ª–∏ 1. –ê–¥—Ä–µ—Å–∞ –∫–æ–¥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ uint160. –ò —Ç–∞–∫ –¥–∞–ª–µ–µ. –ë–æ–ª—å—à–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π –≤ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://docs.soliditylang.org/en/latest/abi-spec.html#formal-specification-of-the-encoding) Solidity.

–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö.

**–ó–Ω–∞—á–µ–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ç–∏–ø–∞**
–ö–æ–¥–∏—Ä—É—é—Ç—Å—è, –∫–∞–∫ —Ö–µ—à –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `keccak256()`. `keccak256` - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞–±–æ—Ä –±–∞–π—Ç –∏ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —á—Ç–æ–±—ã —Ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–æ–∫—É –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ `bytes` –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `abi.encodePacked()`.

–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö, –Ω–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ.

```solidity
// string
string memory str = "test";
bytes32 encodedStr = keccak256(abi.encodePacked(str));

// bytes
bytes memory strInBytes = "test";
bytes32 encodedStrInBytes = keccak256(strInBytes);
```

**–ó–Ω–∞—á–µ–Ω–∏—è —Å—Å—ã–ª–æ—á–Ω–æ–≥–æ —Ç–∏–ø–∞**

–ú–∞—Å—Å–∏–≤—ã –∫–æ–¥–∏—Ä—É—é—Ç—Å—è, –∫–∞–∫ —Ö–µ—à –∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –º–∞—Å—Å–∏–≤–∞. –ê —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ, –∫–∞–∫ `hashStruct(message)`. –°–ª–æ–∂–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è, –Ω–æ —ç—Ç–æ —Ç–æ—Ç —Å–ª—É—á–∞–π –∫–æ–≥–¥–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–æ–¥–ø–∏—Å—å –µ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –≤–ª–æ–∂–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ —Ç–µ–º –∂–µ –ø—Ä–∞–≤–∏–ª–∞–º, —á—Ç–æ –∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è.

```solidity
// array[2]
address[] memory addressArray = new address[](2);
addressArray[0] = address(0);
addressArray[1] = address(0);

bytes32 encodedAddressArray = keccak256(abi.encodePacked(addressArray));

// struct
bytes32 encodedStruct = keccak256(abi.encode(
    PARENT_TYPE_HASH,
    // nested structure
    keccak256(abi.encode(
        CHILD_TYPE_HASH,
        // ... nested structure fields
    )),
    // ... parent fields
));
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏

–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø—Ä–∏–º–µ—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.

–î–ª—è —ç—Ç–æ–≥–æ –≤–æ–∑—å–º–µ–º —ç—Ç–∞–ª–æ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OpenZeppelin.

```solidity
// SPDX-License-Identifier: MIT
pragma solidity 0.8.26;

import {EIP712} from "@openzeppelin/contracts/utils/cryptography/EIP712.sol";
import {ECDSA} from "@openzeppelin/contracts/utils/cryptography/ECDSA.sol";

contract SignatureChecker is EIP712 {
    // encode typeHash
    bytes32 private constant TYPE_HASH =
        keccak256("Order(address user)");

    struct Args {
        bytes signature;
    }

    // Inherit by EIP712(name, version)
    constructor() EIP712("EIP-712 based on OZ", "1") {}

    function checkSignature(Args calldata args) public view returns (bool) {
        // encode message
        bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
            TYPE_HASH,
            msg.sender
        )));

        // recover signer and check
        address signer = ECDSA.recover(digest, args.signature);
        if (signer != msg.sender) {
            return false;
        }

        return true;
    }
}
```

–≠—Ç–æ—Ç –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—ã–∑—ã–≤–∞—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏—é `checkSignature()`, –ø–æ–¥–ø–∏—Å–∞–ª —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –∞–∫–∫–∞—É–Ω—Ç–∞, –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏.

–§—É–Ω–∫—Ü–∏—è `_hashTypedDataV4()` —Ö–µ—à–∏—Ä—É–µ—Ç —Å–æ–≥–ª–∞—Å–Ω–æ EIP-712 encodedData (–º—ã —Å–∞–º–∏ –∫–æ–¥–∏—Ä—É–µ–º —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è) –∏ domainSeparator (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ) –≤–º–µ—Å—Ç–µ.

### –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

*–ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –µ–¥–∏–Ω–æ—Ä–∞–∑–æ–≤–æ, —Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ.*

–°–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä –ø–æ–¥–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å–ø–æ—Ä—è–∂–∞—Ç—å—Å—è –∞–∫—Ç–∏–≤–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –æ—Ä–¥–µ—Ä –Ω–∞ –ø–æ–∫—É–ø–∫—É –∞–∫—Ç–∏–≤–∞ –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Å—É–º–º—É, –∫–æ—Ç–æ—Ä—É—é –æ–Ω –≥–æ—Ç–æ–≤ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ –ø–æ–∫—É–ø–∫—É. –ü–æ–¥–ø–∏—Å—å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–æ—Ç–æ–∫–æ–ª—É, –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å—å –∏ —Å–ø–∏—Å–∞—Ç—å —Å—É–º–º—É –æ–ø–ª–∞—Ç—ã –≤ –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –∞–∫—Ç–∏–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

–í –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –Ω–∏–∫—Ç–æ –Ω–µ —Å–º–æ–≥ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Å–ø–∏—Å–∞–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—É–º–º—ã. –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —ç—Ç–æ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤ —Ç–µ–ª–æ –ø–æ–¥–ø–∏—Å–∏ –≤–≤–æ–¥–∏—Ç—Å—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Å—á–µ—Ç—á–∏–∫ `nonce`, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç –ø–æ–¥–ø–∏—Å—å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π. –ü–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ —Å—á–µ—Ç—á–∏–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è.

```solidity
contract SignatureChecker is EIP712 {
    // Add nonce to TYPE_HASH
    bytes32 private constant TYPE_HASH = keccak256("Order(address user,uint256 nonce)");

    struct Args {
        bytes signature;
    }

    mapping (address user => uint256 nonce) public nonces;

    constructor() EIP712("EIP-712 based on OZ", "1") {}

    function checkSignature(Args calldata args) public returns (bool) {
        bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
            TYPE_HASH,
            msg.sender,
            nonces[msg.sender] + 1 // Add next user nonce
        )));

        address signer = ECDSA.recover(digest, args.signature);
        if (signer != msg.sender) {
            return false;
        }

        // increase user nonce
        nonces[msg.sender] += 1;

        return true;
    }
}
```

–°–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤—Å–µ–≥–¥–∞ –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ nonce –≤ –ø–æ–¥–ø–∏—Å–∏ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω —Å–æ–≥–ª–∞—Å–Ω–æ —Å—á–µ—Ç—á–∏–∫—É, –∫–æ—Ç–æ—Ä—ã–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏. –¢–∞–∫–æ–π –Ω–µ—Ö–∏—Ç—Ä—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å—å –∏ –¥–µ–ª–∞–µ—Ç –µ–µ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–π.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ç—è—Ö, –ø—Ä–æ—Ç–æ–∫–æ–ª–∞—Ö, —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö

*–ü–æ–¥–ø–∏—Å—å, –¥–∞–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏, –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ –¥—Ä—É–≥–æ–π.*

*–ü–æ–¥–ø–∏—Å—å, –¥–∞–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ –¥—Ä—É–≥–æ–º.*

–ß–∞—Å—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö EVM —Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Å–µ—Ç—è—Ö. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤. –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å—å –Ω–µ –º–æ–≥–ª–∞ –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ –¥—Ä—É–≥–æ–π —Å–µ—Ç–∏ –≤ —Å–æ—Å—Ç–∞–≤ –ø–æ–ª–µ–π domainSeparator –≤–≤–æ–¥–∏—Ç—Å—è –ø–æ–ª–µ `chainId`.

–ï—Å–ª–∏ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç EIP-712 –æ—Ç OpenZeppelin, —Ç–æ –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å –∑–∞ `chainId`, –µ—Å–ª–∏ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, —Ç–æ –¥–æ–ª–∂–Ω—ã —É—á–∏—Ç—ã–≤–∞—Ç—å —ç—Ç–æ –ø–æ–ª–µ. –ü–æ–º–Ω–∏–º, —á—Ç–æ –ø–æ–ª–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ, –∏ –µ—Å–ª–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏, —Ç–æ –ø–æ–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—É—â–µ–Ω–æ.

–û–¥–Ω–∞–∫–æ —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–ª–µ –≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ—Ç–æ–∫–æ–ª –º–æ–∂–µ—Ç –∑–∞—Ö–æ—Ç–µ—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å—Å—è –≤ –Ω–æ–≤–æ–π —Å–µ—Ç–∏, –∞ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤ —Å—Ç–∞—Ä–æ–π —Å–µ—Ç–∏ –∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `chainId` –Ω–µ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ –≤ —Å–≤—è–∑–∏ —Å –Ω–µ–∏–∑–º–µ–Ω–Ω–æ—Å—Ç—å—é —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

–í —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ [EIP-712](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/cryptography/EIP712.sol#L91) –æ—Ç OpenZeppelin –≤–∏–¥–Ω–æ, —á—Ç–æ –≤ —Å–æ—Å—Ç–∞–≤–µ domain –Ω–∞—Ö–æ–¥–∏—Ç—Å—è chainId –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

```solidity
abstract contract EIP712 is IERC5267 {
    ...

    function _buildDomainSeparator() private view returns (bytes32) {
        return keccak256(abi.encode(TYPE_HASH, _hashedName, _hashedVersion, block.chainid, address(this)));
    }

    ...
}
```

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `chainId` –ø–æ–ª—è `_hashedName` –∏`address(this)` —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –ø—Ä–æ—Ç–æ–∫–æ–ª–µ –∏–ª–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ, –≥–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –æ–¥–Ω–æ–≥–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

*–ü–æ–¥–ø–∏—Å—å, –¥–∞–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ –¥—Ä—É–≥–æ–π, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º, –∫–æ–≥–¥–∞ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.*

–î–ª—è —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏ –≤ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–µ–ª–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ. –ï—Å–ª–∏ –ø–æ–ª—è –¥–∞–Ω–Ω—ã—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ, —Ç–æ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏. –ù–∏–∂–µ –ø—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–≤—É—Ö TYPE_HASH –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π `deposit()` –∏ `withdraw()`.

```solidity
contract SignatureChecker is EIP712 {
    bytes32 private constant DEPOSIT_TYPE_HASH = keccak256("DEPOSIT(address user,uint256 nonce)");
    bytes32 private constant WITHDRAW_TYPE_HASH = keccak256("WITHDRAW(address user,uint256 nonce)");

    ...

    function deposit(Args calldata args) public returns (bool) {
        bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
            DEPOSIT_TYPE_HASH,
            msg.sender,
            nonces[msg.sender] + 1
        )));

        ...

        return true;
    }

    function withdraw(Args calldata args) public returns (bool) {
        bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
            WITHDRAW_TYPE_HASH,
            msg.sender,
            nonces[msg.sender] + 1
        )));

        ...

        return true;
    }
}
```

–ï—Å—Ç—å –µ—â–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç —Ä–µ—à–µ–Ω–∏—è. –í domain –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ –ø–æ–ª–µ salt, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∏.

–û–¥–Ω–∞–∫–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç EIP-712 –æ—Ç OpenZeppelin –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å —ç—Ç–∏–º –ø–æ–ª–µ–º –∏–∑ –∫–æ—Ä–æ–±–∫–∏. –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è salt –∏ OpenZeppelin –≤–º–µ—Å—Ç–µ –ø—Ä–∏–¥–µ—Ç—Å—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ EIP-712 –≤—Ä—É—á–Ω—É—é.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏

*–ü–æ–¥–ø–∏—Å—å, –¥–∞–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ —Ä–∞–º–∫–∞—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ—Ç—Ä–µ–∑–∫–∞.*

–ò–Ω–æ–≥–¥–∞ —Å—Ç–æ–∏—Ç –∑–∞–¥–∞—á–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø–æ–¥–ø–∏—Å–∏, —á—Ç–æ–±—ã –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏—é –≤—Ä–µ–º–µ–Ω–∏ –æ–Ω–∞ –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω–æ–π. –†–µ—à–∞–µ—Ç—Å—è —ç—Ç–æ –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Ç–µ–ª–æ –ø–æ–¥–ø–∏—Å–∏ timestamp, –∫–æ—Ç–æ—Ä—ã–π –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–∏. –ü—Ä–∏ —ç—Ç–æ–º –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ —ç—Ç–æ –≤—Ä–µ–º—è –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—É–ø–∏–ª–æ.

```solidity
contract SignatureChecker is EIP712 {
    // Add expiredTime to TYPE_HASH
    bytes32 private constant TYPE_HASH = keccak256("Order(address user,uint64 expiredTime,uint256 nonce)");

    // Add new field expiredTime
    struct Args {
        bytes signature;
        uint256 expiredTime;
    }

    ...

    // Add error
    error ExpiredTime();

    function checkSignature(Args calldata args) public returns (bool) {
        // Check time
        if (block.timestamp >= args.expiredTime) {
            revert ExpiredTime();
        }

        bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
            TYPE_HASH,
            msg.sender,
            args.expiredTime, // Add expiredTime
            nonces[msg.sender] + 1
        )));

        ...

        return true;
    }
}
```

### –û—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∏

*–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å—å.*

–ß–∞—Å—Ç–æ –ø–æ–¥–ø–∏—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ë–æ–ª–µ–µ —Ç–æ–≥–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –ø–æ–¥–ø–∏—Å—å –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—É. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –æ–Ω –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–º–µ–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ.

–ò—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–µ–≥–∫–æ. –ù–∞ –±–∞–∑–µ `nonce` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–º–µ–Ω—É –ø–æ–¥–ø–∏—Å–∏. –î–ª—è —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `nonce`. –ï—Å–ª–∏ `nonce` –µ—â–µ –Ω–µ—Ç –≤ —Å–æ—Å—Ç–∞–≤–µ –ø–æ–¥–ø–∏—Å–∏, —Ç–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –µ–≥–æ —Ç—É–¥–∞ –¥–æ–±–∞–≤–∏—Ç—å.

```solidity
contract SignatureChecker is EIP712 {
    mapping (address user => uint256 nonce) public nonces;

    ...

    function cancelSignature() external {
        nonces[msg.sender] += 1;

        emit SignatureCanceled(msg.sender);
    }
}
```

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `cancelSignature()`, —á—Ç–æ —É–≤–µ–ª–∏—á–∏—Ç `nonce` –∏ —Å–¥–µ–ª–∞–µ—Ç –≤—ã–¥–∞–Ω–Ω—É—é —Ä–∞–Ω–µ–µ –ø–æ–¥–ø–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–π.

## –¢–æ–ø –æ—à–∏–±–æ–∫ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö

–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ —Ä–∞–∑–±–µ—Ä–µ–º —Ç–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç —É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, —Ä–µ–∞–ª–∏–∑—É—é—â–∏—Ö –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏. –û—à–∏–±–∫–∏ –≤–∑—è—Ç—ã —Å —Ä–µ—Å—É—Ä—Å–∞ [Solodit](https://solodit.cyfrin.io/?i=HIGH%2CMEDIUM).

> –í—Å–µ —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã –≤ —Ö–æ–¥–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Foundry. –¢–∞–∫ –∫–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–µ–π, –∫–∞–∫ –∏ –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã –ø–∏—à—É—Ç—Å—è –Ω–∞ solidity –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –ø–æ–¥–æ–≥–Ω–∞–Ω –ø–æ–¥ –æ—à–∏–±–∫—É.
>
> –í —ç—Ç–æ–º –ø–ª–∞–Ω–µ Hardhat –¥–∞–µ—Ç –±–æ–ª—å—à–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–∞–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞–ø–∏—Å–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã–π –∫ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–¥ –Ω–∞ js.

### –ü—Ä–æ–ø—É—Å–∫ TYPE_HASH

*–ù–µ—Å–æ–±–ª—é–¥–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞.*

–ò–Ω–æ–≥–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–±—ã–≤–∞—é—Ç —É–∫–∞–∑–∞—Ç—å TYPE_HASH –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Å—á–∏—Ç–∞—é—Ç, —á—Ç–æ –æ–Ω –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≤–∞–∂–Ω—ã–º.

```solidity
contract SignatureChecker is EIP712 {
    ...

    function checkSignature(Args calldata args) public returns (bool) {
        if (block.timestamp >= args.expiredTime) {
            revert ExpiredTime();
        }

        // There is no TYPE_HASH in the signature structure
        bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
            msg.sender,
            args.expiredTime, // Added expiredTime field
            nonces[msg.sender] + 1
        )));

        ...

        return true;
    }
```

–ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è TYPE_HASH –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º EIP-712, —á—Ç–æ –≤–ª–µ—á–µ—Ç –∑–∞ —Å–æ–±–æ–π –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏ (metamask sdk –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ). –¢–∞–∫–∂–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.

### –ü—Ä–æ–ø—É—Å–∫ –ø–æ–ª–µ–π –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ TYPE_HASH –ø—Ä–∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏

*–õ—é–±–æ–≥–æ —Ä–æ–¥–∞ –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ TYPE_HASH –∏–ª–∏ –ø–æ–ª–µ–π –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö.*

–í —Ö–æ–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —á–∞—Å—Ç–æ –±—ã–≤–∞–µ—Ç –º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç—Ä–µ–±—É—é—â–∏—Ö –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è. –†–∞–±–æ—Ç–∞ —Å –ø–æ–¥–ø–∏—Å—å—é –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º. –¢–∏–ø–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞, –∫–æ–≥–¥–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ –æ–Ω –∑–∞–±—ã–≤–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–∏—Ç—å TYPE_HASH –¥–ª—è —ç—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

```solidity
contract SignatureChecker is EIP712 {
    // Forgot to correct TYPE_HASH. You need to add expiredTime field
    bytes32 private constant TYPE_HASH = keccak256("Order(address user,uint256 nonce)");

    ...

    function checkSignature(Args calldata args) public returns (bool) {
        ...

        bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
            TYPE_HASH,
            msg.sender,
            args.expiredTime, // Added expiredTime field
            nonces[msg.sender] + 1
        )));

        ...

        return true;
    }
```

–ë—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `expiredTime` –≤ —Ç–µ–ª–æ –ø–æ–¥–ø–∏—Å–∏, –Ω–æ –∑–∞–±—ã–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ TYPE_HASH. –¢–∞–∫–∏–µ –æ—à–∏–±–∫–∏ —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è. –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–∏—Ç—É–∞—Ü–∏—è –Ω–∞–æ–±–æ—Ä–æ—Ç, –∫–æ–≥–¥–∞ TYPE_HASH –æ–±–Ω–æ–≤–ª–µ–Ω, –∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç.

–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É –º–æ–∂–Ω–æ –∏–∑–±–µ–∂–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è—è —Ä–∞–±–æ—Ç—É –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

### –û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ç–∏–ø–æ–≤

*–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã –¥–æ–ª–∂–Ω—ã –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Å–æ–±—ã–º —Å–ø–æ—Å–æ–±–æ–º.*

–ß–∞—Å—Ç–æ –Ω–æ–≤–µ–Ω—å–∫–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ –±—ã–≤–∞–ª—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π —É–ø—É—Å–∫–∞—é—Ç –≤–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ç–∏–ø–æ–≤.

–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã –∫–æ–¥–∏—Ä—É—é—Ç—Å—è, –∫–∞–∫ —Ö–µ—à –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ `keccak256()`.

```solidity
contract SignatureChecker is EIP712 {
    bytes32 private constant TYPE_HASH =
        keccak256("Order(address operator,address token,uint256 amount,uint256 nonce,bytes data,string str)");

    ...

    constructor() EIP712("EIP-712 based on OZ", "1") {}

    function checkSignature(SigArgs calldata args) public view returns (bool) {
        bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
            TYPE_HASH,
            msg.sender, // operator
            args.token,
            args.amount,
            _nonces[args.user] + 1,
            // args.data –∏ args.str - incorrect
            // For encode dynamic types you need use keccak256
            keccak256(args.data),
            keccak256(abi.encodePacked(args.str))
        )));

        ...

        return true;
    }
}
```

`keccak256()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ bytes, –ø–æ—ç—Ç–æ–º—É —Å—Ç—Ä–æ–∫—É —Å–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ bytes –ø—Ä–∏ –ø–æ–º–æ—â–∏ `abi.encodePacked()`.

### –û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–æ—á–Ω—ã—Ö —Ç–∏–ø–æ–≤

*–°—Å—ã–ª–æ—á–Ω—ã–µ —Ç–∏–ø—ã –¥–æ–ª–∂–Ω—ã –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Å–æ–±—ã–º —Å–ø–æ—Å–æ–±–æ–º.*

–≠—Ç–æ –ø–æ–¥–æ–±–Ω–∞—è –æ—à–∏–±–∫–∞, –∫–∞–∫ –∏ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ —Ç–∏–ø–∞–º–∏, —Ç–æ–ª—å–∫–æ –∫–∞—Å–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–≤ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö.

–í –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –º–∞—Å—Å–∏–≤–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á–∞—Å—Ç–æ –∑–∞–±—ã–≤–∞—é—Ç, —á—Ç–æ —ç—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–µ—à –æ—Ç –Ω–∞–±–æ—Ä–∞ –±–∞–π—Ç –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–∞ `keccak256(abi.encodePacked(array))`. –ó–∞–±—ã–≤–∞—é—Ç –∏–ª–∏ `keccak256` –∏–ª–∏ `abi.encodePacked`, –∏–ª–∏ –≤—Å–µ –≤–º–µ—Å—Ç–µ.

```solidity
contract SignatureChecker is EIP712 {
    bytes32 private constant ORDER_TYPE_HASH =
        keccak256("Order(address operator,address[] tokens,uint256[] amounts,uint256 nonce)");

    ...

    function checkSignature(SigArgs calldata args) public view returns (bool) {
        bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
            ORDER_TYPE_HASH,
            msg.sender,
            // Error using args.tokens without keccak256(abi.encodePacked())
            keccak256(abi.encodePacked(args.tokens)),
            keccak256(abi.encodePacked(args.amounts)),
            _nonces[args.user] + 1
        )));

        ...

        return true;
    }
}
```

–î–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä —á–∞—Å—Ç–æ –¥–æ–ø—É—Å–∫–∞—é—Ç –æ—à–∏–±–∫–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ TYPE_HASH. –í –ø—Ä–∏–º–µ—Ä–µ –Ω–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –æ–ø–∏—Å–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä OPERATOR_TYPE_HASH –∏ ORDER_TYPE_HASH.

```solidity
contract SignatureChecker is EIP712 {
    bytes32 private constant OPERATOR_TYPE_HASH =
        keccak256("Operator(address operator,string name)");
    bytes32 private constant ORDER_TYPE_HASH =
        keccak256("Order(Operator operator,address token,uint256 amount,uint256 nonce)Operator(address operator,string name)");

    ...

    function checkSignature(SigArgs calldata args) public view returns (bool) {
        bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
            ORDER_TYPE_HASH,
            keccak256(abi.encode( // We encode separately all fields of the nested Operator structure
                OPERATOR_TYPE_HASH, // Don't forget about TYPE_HASH for the operator structure
                msg.sender,
                keccak256(abi.encodePacked(args.operatorName)) // Don't forget about dynamic types
            )),
            args.token,
            args.amount,
            _nonces[args.user] + 1
        )));

        ...
    }
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ abi.encode –≤–º–µ—Å—Ç–æ abi.encodePacked –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ TYPE_HASH

*–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é –∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ TYPE_HASH.*

–í –ø—Ä–∏–º–µ—Ä–µ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –º–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ OPERATOR_TYPE_HASH –≤–Ω—É—Ç—Ä–∏ ORDER_TYPE_HASH.

–ü–æ—ç—Ç–æ–º—É –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç —Ä–∞—Å—á–µ—Ç TYPE_HASH, –æ—Å–æ–±–µ–Ω–Ω–æ, –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö. –ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –Ω–æ–≤–æ–º –ø—Ä–∏–º–µ—Ä–µ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö.

```solidity
bytes memory itemTypeString = abi.encodePacked(
    "Item(uint8 itemType,address token,uint256 identifier)"
);

bytes memory orderTypeString = abi.encodePacked(
    "Order(Item item,address user)"
);
```

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ TYPE_HASH –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `abi.encode`, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `abi.encodePacked`.

```diff
bytes32 TYPE_HASH = keccak256(
-    abi.encode(itemTypeString, orderTypeString)
+    abi.encodePacked(itemTypeString, orderTypeString)
);
+
```

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `abi.encodePacked`, `abi.encode` –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω—É–ª–µ–≤—ã–µ –±–∞–π—Ç—ã, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ 32-—Ö –±–∞–π—Ç, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–µ —Ö–µ—à–∏ –Ω–µ –±—É–¥—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏.

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —è –Ω–∞–∫–∏–¥–∞–ª –ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ –≤ remix.

```solidity
contract Test {
    function matchTypeHashes() external pure returns (bytes32, bytes32, bytes32) {
        bytes memory itemTypeString = abi.encodePacked(
            "Item(uint8 itemType,address token,uint256 identifier)"
        );

        bytes memory orderTypeString = abi.encodePacked(
            "Order(Item item,address user)"
        );

        return (
            keccak256(abi.encode(itemTypeString, orderTypeString)),
            keccak256(abi.encodePacked(itemTypeString, orderTypeString)),
            keccak256("Item(uint8 itemType,address token,uint256 identifier)Order(Item item,address user)")
        );
    }
}
```

–°—Ä–µ–¥–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Ç—Ä–µ—Ç–∏–π —Ö–µ—à –±—É–¥–µ—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å–æ –≤—Ç–æ—Ä—ã–º, –ø–µ—Ä–≤—ã–π –±—É–¥–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è. –°–æ–≥–ª–∞—Å–Ω–æ EIP-712 –≤—Ç–æ—Ä–æ–π –∏ —Ç—Ä–µ—Ç–∏–π - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.

### –ü–æ–¥–ø–∏—Å—å –Ω–µ –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

*–ó–∞—á–∞—Å—Ç—É—é –ø–æ–¥–ø–∏—Å—å –Ω–µ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–π –ø–æ–≤—Ç–æ—Ä–Ω–æ.*

–ú—ã —É–∂–µ —Ä–∞–∑–±–∏—Ä–∞–ª–∏ —ç—Ç—É –æ—à–∏–±–∫—É –∫–æ—Å–≤–µ–Ω–Ω–æ –≤ —Ä–∞–∑–¥–µ–ª–µ –æ—Ç —á–µ–≥–æ –ø–æ–¥–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω–∞, –Ω–æ –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –Ω–µ—Ä–µ–¥–∫–æ –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è –≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö.

–†–µ—à–∞–µ—Ç—Å—è –≤–≤–µ–¥–µ–Ω–∏–µ–º —Å—á–µ—Ç—á–∏–∫–∞ `nonce` –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–ø–∏—Å–∏ –∏–ª–∏ `deadline` –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É—é—â–µ–≥–æ –≤—Ä–µ–º—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–∏.

### –ü–æ–¥–ø–∏—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –¥—Ä—É–≥–∏–º –∞–¥—Ä–µ—Å–æ–º

*–ù—É–∂–Ω–æ —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –∫—Ç–æ –º–æ–∂–µ—Ç –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ–¥–ø–∏—Å—å—é.*

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–∏ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–µ –∞–∫–∫–∞—É–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –ø–æ–¥–ø–∏—Å—å.

–ê—Ç–∞–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø–æ —Ç–∏–ø—É [front-run](https://quillaudits.medium.com/front-running-and-sandwich-attack-explained-quillaudits-de1e8ff3356d). –°–ª—É—à–∞–µ—Ç—Å—è –º–µ–º–ø—É–ª, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –º–µ–º–ø—É–ª, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –∫–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—Ç —Å–≤–æ–µ–≥–æ –∏–º–µ–Ω–∏.

```solidity
contract SignatureChecker is EIP712 {
    bytes32 private constant TYPE_HASH =
        keccak256("Order(address[] tokens,uint256[] amounts,uint256 nonce)");

    struct SigArgs {
        address user;
        address[] tokens;
        uint256[] amounts;
        bytes signature;
    }

    ...

    function checkSignature(SigArgs calldata args) public view returns (bool) {
        bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
            // There is no msg.sender in the signature structure
            TYPE_HASH,
            keccak256(abi.encodePacked(args.tokens)),
            keccak256(abi.encodePacked(args.amounts)),
            _nonces[args.user] + 1
        )));

        address signer = ECDSA.recover(digest, args.signature);
        if (signer != args.user) {
            return false;
        }

        // send tokens to msg.sender

        return true;
    }
}
```

## –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç

–î–∞–∂–µ —É —Ç–∞–∫–∏—Ö –ø–µ—Ä–µ–¥–æ–≤—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∫–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑ OpenZeppelin, –±—ã–≤–∞—é—Ç —Ñ–∞–∫–∞–ø—ã.

–î–æ –≤–µ—Ä—Å–∏–∏ 4.7.3 –≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö OpenZeppelin –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ [—É—è–∑–≤–∏–º–æ—Å—Ç—å](https://github.com/OpenZeppelin/openzeppelin-contracts/security/advisories/GHSA-4h98-2769-gh6h) —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø–æ–¥–ø–∏—Å–∏.

–§—É–Ω–∫—Ü–∏–∏ `ECDSA.recover()`–∏ `ECDSA.tryRecover()`. –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã –±—ã–ª–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–Ω–∏–º–∞–ª–∏ –Ω–∞–±–æ—Ä `bytes` –∑–∞ –º–µ—Å—Ç–æ `v, r, s` –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –≤–∑—è—Ç—å –ø–æ–¥–ø–∏—Å—å, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ –±—ã–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–µ —Å–Ω–æ–≤–∞ –≤ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–µ –∏ –æ–±–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É.

## –í—ã–≤–æ–¥

EIP-712 –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –∑–∞—â–∏—Ç—ã –æ—Ç –∞—Ç–∞–∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è, –¥–µ–ª–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∏ —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–º–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏. –û–¥–Ω–∞–∫–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç—Ç–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç —Å—Ç—Ä–æ–≥–æ–≥–æ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è.

–û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ domainSeparator —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–µ–π –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö.

- –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö  —Ç—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏ —Å—Å—ã–ª–æ—á–Ω—ã—Ö —Ç–∏–ø–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø–æ–¥–ø–∏—Å–µ–π.

- –í–∫–ª—é—á–µ–Ω–∏–µ nonce –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–µ–π, —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

–û—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—è–∑–≤–∏–º–æ—Å—Ç—è–º, –ø–æ–∑–≤–æ–ª—è—é—â–∏–º –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–ª–∏ –≤ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö.

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ç—â–∞—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é EIP-712 –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, OpenZeppelin).

## Links

1. [EIP-712: Typed structured data hashing and signing](https://eips.ethereum.org/EIPS/eip-712)
2. [ERC-191: Signed Data Standard](https://eips.ethereum.org/EIPS/eip-191)
3. [EIP-155: Simple replay attack protection](https://eips.ethereum.org/EIPS/eip-155)
4. [Solodit](https://solodit.cyfrin.io/?i=HIGH%2CMEDIUM)
