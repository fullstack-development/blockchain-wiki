# ERC-165: Standard Interface Detection

**–ê–≤—Ç–æ—Ä:** [–Ø—Ä–ª—ã–∫–æ–≤ –†–æ–º–∞–Ω](https://github.com/rlkvrv) üßê

–ò–Ω–æ–≥–¥–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö ¬´—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤¬ª, —Ç–∞–∫–∏—Ö –∫–∞–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–æ–∫–µ–Ω–∞ ERC-721, –±—ã–≤–∞–µ—Ç –ø–æ–ª–µ–∑–Ω–æ —É–∑–Ω–∞—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —ç—Ç–æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç, —Ç–æ –∫–∞–∫—É—é –≤–µ—Ä—Å–∏—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –î–ª—è —ç—Ç–æ–≥–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç EIP-165: Standard Interface Detection, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É.

**EIP-165** - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ Ethereum, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤. –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–æ–º—É, —á—Ç–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `supportsInterface(bytes4 interfaceID)`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥  –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±—É–ª–µ–≤–æ –∑–Ω–∞—á–µ–Ω–∏–µ, —É–∫–∞–∑—ã–≤–∞—é—â–µ–µ, —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ª–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–æ—Å—Ç–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º, –ø–æ—Å–∫–æ–ª—å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å, –ø—Ä–µ–∂–¥–µ —á–µ–º –≤—ã–∑–≤–∞—Ç—å –µ–µ.

**–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (ID)** –¥–ª—è ERC-165 - —ç—Ç–æ —á–µ—Ç—ã—Ä–µ—Ö-–±–∞–π—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ —Ö—ç—à keccak-256 –ø–æ–¥–ø–∏—Å–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –ü–æ–¥–ø–∏—Å—å —Ñ—É–Ω–∫—Ü–∏–∏ - —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, —Å–æ—Å—Ç–æ—è—â–∞—è –∏–∑ –∏–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ç–∏–ø–æ–≤ –µ–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

–ù–∞–ø—Ä–∏–º–µ—Ä, —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏ supportsInterface –≤ ERC-165 –∏–º–µ–µ—Ç –≤–∏–¥ `"supportsInterface(bytes4)"`. –ó–∞—Ç–µ–º —ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Ö—ç—à-—Ñ—É–Ω–∫—Ü–∏—é keccak-256, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞–µ—Ç 32-–±–∞–π—Ç–æ–≤–æ–µ —Ö—ç—à-–∑–Ω–∞—á–µ–Ω–∏–µ. –ü–µ—Ä–≤—ã–µ —á–µ—Ç—ã—Ä–µ –±–∞–π—Ç–∞ —ç—Ç–æ–≥–æ —Ö—ç—à-–∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –∑–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

–ü–æ–¥–ø–∏—Å—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ `"functionName(type1, type2, ...)"`. –¢–∏–ø—ã —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –∏—Ö –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ solidity, –Ω–∞–ø—Ä–∏–º–µ—Ä, `address` –≤–º–µ—Å—Ç–æ `address payable` –∏ `bytes32[]` –≤–º–µ—Å—Ç–æ `array`.

–¢–∞–∫–∂–µ –≤–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –æ–¥–∏–Ω–∞–∫–æ–≤ –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Ñ—É–Ω–∫—Ü–∏–∏, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω —É–Ω–∏–∫–∞–ª–µ–Ω –¥–ª—è –≤—Å–µ—Ö —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è.

**–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ interfaceId –¥–ª—è ERC-721:**

–ß—Ç–æ–±—ã –≤—ã—á–∏—Å–ª–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è ERC-721, –Ω—É–∂–Ω–æ –≤–∑—è—Ç—å —Ö—ç—à keccak-256 —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∑–∞—Ç–µ–º –≤–∑—è—Ç—å –ø–µ—Ä–≤—ã–µ 4 –±–∞–π—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

–î–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ö—ç—à–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é `XOR` (–∏—Å–∫–ª—é—á–∞—é—â–µ–µ –ò–õ–ò) - —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ö—ç—à `interfaceId` –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –±—ã–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã —Å–µ–ª–µ–∫—Ç–æ—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ–±—ã –≤—ã—á–∏—Å–ª–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å –ø–æ–º–æ—â—å—é EIP-165, –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –∞ –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é `XOR` –¥–ª—è –∏—Ö –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è.

```js
    bytes4(keccak256('balanceOf(address)')) == 0x70a08231
    bytes4(keccak256('ownerOf(uint256)')) == 0x6352211e
    bytes4(keccak256('approve(address,uint256)')) == 0x095ea7b3
    bytes4(keccak256('getApproved(uint256)')) == 0x081812fc
    bytes4(keccak256('setApprovalForAll(address,bool)')) == 0xa22cb465
    bytes4(keccak256('isApprovedForAll(address,address)')) == 0xe985e9c5
    bytes4(keccak256('transferFrom(address,address,uint256)')) == 0x23b872dd
    bytes4(keccak256('safeTransferFrom(address,address,uint256)')) == 0x42842e0e
    bytes4(keccak256('safeTransferFrom(address,address,uint256,bytes)')) == 0xb88d4fde

    => 0x70a08231 ^ 0x6352211e ^ 0x095ea7b3 ^ 0x081812fc ^ 0xa22cb465 ^ 0xe985e9c ^ 0x23b872dd ^ 0x42842e0e ^ 0xb88d4fde == 0x80ac58cd

    bytes4 private constant _INTERFACE_ID_ERC721 = 0x80ac58cd;
```

–í —è–∑—ã–∫–µ solidity —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª—è—Ç—å `interfaceId` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `type(T).interfaceId`, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ—É–ø–æ–º—è–Ω—É—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

```js
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

interface IERC721 {
	function balanceOf(address _owner) external view returns (uint256);
	function ownerOf(uint256 _tokenId) external view returns (address);
	function safeTransferFrom(address _from, address _to, uint256 _tokenId, bytes memory data) external payable;
	function safeTransferFrom(address _from, address _to, uint256 _tokenId) external payable;
	function transferFrom(address _from, address _to, uint256 _tokenId) external payable;
	function approve(address _approved, uint256 _tokenId) external payable;
	function setApprovalForAll(address _operator, bool _approved) external;
	function getApproved(uint256 _tokenId) external view returns (address);
	function isApprovedForAll(address _owner, address _operator) external view returns (bool);
}

contract Selector {
	function getInterfaceId() external pure returns (bytes4) {
		return type(IERC721).interfaceId; // 0x80ac58cd
	}
}
```

–¢–∞–∫ –∫–∞–∫ `interfaceId` –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π - —Ç—É–¥–∞ –Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã, –ª–∏–±–æ –¥–ª—è –Ω–∏—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö ERC721 —ç—Ç–æ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```js
    bytes4(keccak256('name()')) == 0x06fdde03
    bytes4(keccak256('symbol()')) == 0x95d89b41
    bytes4(keccak256('tokenURI(uint256)')) == 0xc87b56dd

    => 0x06fdde03 ^ 0x95d89b41 ^ 0xc87b56dd == 0x5b5e139f

    bytes4 private constant _INTERFACE_ID_ERC721_METADATA = 0x5b5e139f;
```

–ò—Ç–æ–≥–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ —Ç–æ–∫–µ–Ω–∞ ERC721 –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```js
	function supportsInterface(bytes4 interfaceId) public view virtual override(ERC165, IERC165) returns (bool) {
	return
		interfaceId == type(IERC721).interfaceId ||
		interfaceId == type(IERC721Metadata).interfaceId ||
		super.supportsInterface(interfaceId);
}
```

–í –ø—Ä–æ–≤–µ—Ä—è—é—â–µ–º —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –∑–∞—á–∞—Å—Ç—É—é —É–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–∑—ã–≤–∞–µ–º—ã—Ö —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –≥–∞–∑ –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö.

```js
	bytes4 private constant INTERFACE_ID_ERC721 = 0x80ac58cd;
```

#### –°—Å—ã–ª–∫–∏:
- [EIP-165: Standard Interface Detection](https://eips.ethereum.org/EIPS/eip-165)
- [–ü—Ä–∏–º–µ—Ä —Å ERC721](https://ethereum.stackexchange.com/questions/82822/obtaining-erc721-interface-ids)
- [–î–ª—è —á–µ–≥–æ –Ω—É–∂–µ–Ω interfaceId](https://ethereum.stackexchange.com/questions/71560/erc721-interface-id-registration)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è openzeppelin](https://docs.openzeppelin.com/contracts/4.x/api/utils#introspection)
- [–û–±—ä—è—Å–Ω–µ–Ω–∏–µ EIP165](https://medium.com/@chiqing/ethereum-standard-erc165-explained-63b54ca0d273) - –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ