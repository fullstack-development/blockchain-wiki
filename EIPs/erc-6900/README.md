# ERC-6900: Modular Smart Contract Accounts and Plugins

**–ê–≤—Ç–æ—Ä:** [–†–æ–º–∞–Ω –Ø—Ä–ª—ã–∫–æ–≤](https://github.com/rlkvrv) üßê

ERC-6900 ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç Ethereum, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –º–æ–¥—É–ª—å–Ω—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã (Modular Smart Contract Account ‚Äî MSCA). –û–Ω —Ä–∞—Å—à–∏—Ä—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å [ERC-4337](https://eips.ethereum.org/EIPS/eip-4337) (Account Abstraction), –ø–æ–∑–≤–æ–ª—è—è –≤—ã–Ω–æ—Å–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ –≤–Ω–µ—à–Ω–∏–µ –º–æ–¥—É–ª–∏.

–ö–ª—é—á–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã ERC-6900:

- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ª–æ–≥–∏–∫—É –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã.
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: —É–ø—Ä–æ—â–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∫ –∞–∫–∫–∞—É–Ω—Ç–∞–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞.
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è**: –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∏ –ø–ª–∞–≥–∏–Ω–æ–≤.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ERC-4337**: —Å–æ–≤–º–µ—Å—Ç–∏–º —Å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π Account Abstraction.

*–í–∞–∂–Ω–æ!* –û–±–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ (ERC-4337 –∏ ERC-6900) –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∞, –ø–æ—ç—Ç–æ–º—É –≤–æ–∑–º–æ–∂–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è. –í —Å—Ç–∞—Ç—å–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è AA (ERC-4337) –≤–µ—Ä—Å–∏–∏ v0.6.0 –∏ ERC-6900 (MSCA) –≤–µ—Ä—Å–∏–∏ v0.7.0 (–Ω–∞ –±–∞–∑–µ AA v0.6.0). –ù–∞–ø—Ä–∏–º–µ—Ä, —É–∂–µ –µ—Å—Ç—å –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è AA, –≤ –∫–æ—Ç–æ—Ä–æ–π –∏–∑–º–µ–Ω–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å `validateUserOp`, –Ω–æ MSCA –ø–æ–∫–∞ —ç—Ç–æ–≥–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, ERC-6900 —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω —Å Alchemy, –ø–æ—ç—Ç–æ–º—É —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ —ç—Ç–æ–º—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –±—É–¥—É—Ç –≤ –∏—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–∫–∏–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏. –≠—Ç–æ –æ–¥–∏–Ω –∏–∑ –≥–ª–∞–≤–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ ‚Äî –æ–Ω —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å —É—á–µ—Ç–æ–º –Ω—É–∂–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –∞ –Ω–µ –≤—Å–µ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞.

## MSCA

–°—Ç–∞–Ω–¥–∞—Ä—Ç –≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω [ERC-2535: Diamonds, Multi-Facet Proxy](https://eips.ethereum.org/EIPS/eip-2535) –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π, —Ö–æ—Ç—è –Ω–∞–ø—Ä—è–º—É—é —ç—Ç–æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è. –í—Å–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã —Ö—Ä–∞–Ω–∏—Ç MSCA ‚Äî —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —ç—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ ERC-4337, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏/—É–¥–∞–ª–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤ –∏ –∑–Ω–∞–µ—Ç, –ø–æ –∫–∞–∫–æ–º—É —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∫—É–¥–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤.

–ù–∞ MSCA –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–≤–∞ –≤–∏–¥–∞ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π:
- **User operation** ‚Äî –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ EntryPoint. –§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –≤—ã–∑–æ–≤—ã `validateUserOp` –∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ ERC-4337.
- **Runtime** ‚Äî –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –∞–∫–∫–∞—É–Ω—Ç–∞. –°—é–¥–∞ –≤—Ö–æ–¥—è—Ç —Å–ª—É–∂–µ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `execute`, `executeBatch`, `upgradeToAndCall`, `installPlugin` –∏ —Ç.–¥.).

–î–ª—è –æ—Ö–≤–∞—Ç–∞ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ (–≤–∫–ª—é—á–∞—è –ø—Ä—è–º—ã–µ) —É –ø–ª–∞–≥–∏–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç—Ä–∏ —Ç–∏–ø–∞ callback-—Ñ—É–Ω–∫—Ü–∏–π:
- **Validation** ‚Äî –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `userOp` –∏–ª–∏ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤. –°—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —É—Å–ª–æ–≤–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä—ã—Ö —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –±—É–¥–µ—Ç –æ–¥–æ–±—Ä—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –æ—Ç –µ–µ –∏–º–µ–Ω–∏.
- **Execution** ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
- **Hooks** ‚Äî —Ö—É–∫–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–µ—Å—Ç–∞ –∏—Ö –≤—ã–∑–æ–≤–∞, –ø–æ–∑–≤–æ–ª—è—è –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –¥–æ –∏ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
  - **Pre User Operation Validation Hook** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ —Ñ—É–Ω–∫—Ü–∏–µ–π `userOpValidationFunction`.
  - **Pre Runtime Validation Hook** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ `runtimeValidationFunction`.
  - **Pre Execution Hook** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏, –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ Post Execution Hook.
  - **Post Execution Hook** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ Pre Execution Hook.

![base-msca-flow](./img/base-msca-flow.png)   
*–ò—Å—Ç–æ—á–Ω–∏–∫: –°—Ç–∞–Ω–¥–∞—Ä—Ç ERC-6900*

–ò–¥–µ—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã —Ä–∞–∑–¥–µ–ª–∏—Ç—å –≤—ã–∑–æ–≤—ã –Ω–∞ –¥–≤–∞ —Ç–∏–ø–∞ –∏–∑-–∑–∞ –∏—Ö —Ä–∞–∑–ª–∏—á–∏–π: –≤—ã–∑–æ–≤—ã –æ—Ç EntryPoint –∏ –≤—ã–∑–æ–≤—ã –æ—Ç EOA –∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤. –≠—Ç–æ —Ä–∞–∑–ª–∏—á–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—ã–∑–æ–≤–∞, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è "–æ–±—â–∏–µ" callback-—Ñ—É–Ω–∫—Ü–∏–∏. –ü–æ–ª—É—á–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è —Å—Ö–µ–º–∞:

![msca-call-flow](./img/msca-call-flow.png)   
*–ò—Å—Ç–æ—á–Ω–∏–∫: –°—Ç–∞–Ω–¥–∞—Ä—Ç ERC-6900*

–°—É—â–µ—Å—Ç–≤—É—é—Ç —Ç–∞–∫–∂–µ –≤—ã–∑–æ–≤—ã `executeFromPlugin` –∏ `executeFromPluginExternal`, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏–Ω–∞—á–µ, –Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ –ª—É—á—à–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –ø–µ—Ä–≤—ã–º–∏ –¥–≤—É–º—è —Ç–∏–ø–∞–º–∏ –≤—ã–∑–æ–≤–æ–≤ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø—Ä–æ–±–æ–≤–∞—Ç—å –≤—ã–∑—ã–≤–∞—Ç—å –æ–¥–∏–Ω –ø–ª–∞–≥–∏–Ω –∏–∑ –¥—Ä—É–≥–æ–≥–æ.

### –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MSCA –∏–∑ AA

–ß—Ç–æ–±—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π Account Abstraction (AA) –∫–æ—à–µ–ª–µ–∫ –≤ MSCA, –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è —á–µ—Ç—ã—Ä–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

- [IAccount.sol](https://github.com/eth-infinitism/account-abstraction/blob/releases/v0.6/contracts/interfaces/IAccount.sol) ‚Äî –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö AA (ERC-4337), –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏—é `validateUserOp`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º *EntryPoint*. –í –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ –∑–¥–µ—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∏ –¥—Ä—É–≥–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –í MSCA –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `userOpValidationFunction` –∏ —Ö—É–∫ `preUserOpValidationHook`, –¥–µ–ª–µ–≥–∏—Ä—É—é—â–∏–µ —ç—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –ø–ª–∞–≥–∏–Ω–∞–º.
    ```solidity
    function validateUserOp(
        UserOperation calldata userOp, 
        bytes32 userOpHash, 
        uint256 missingAccountFunds
    ) external returns (uint256 validationData);
    ```
- [IPluginManager.sol](https://github.com/erc6900/reference-implementation/blob/v0.7.x/src/interfaces/IPluginManager.sol) ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–æ–≤ —Å –ø–æ–º–æ—â—å—é –¥–≤—É—Ö —Ñ—É–Ω–∫—Ü–∏–π:
    ```solidity
    function installPlugin(
        address plugin,
        bytes32 manifestHash,
        bytes calldata pluginInstallData,
        FunctionReference[] calldata dependencies
    ) external;

    function uninstallPlugin(
        address plugin,
        bytes calldata config, 
        bytes calldata pluginUninstallData
    ) external;
    ```
- [IStandardExecutor.sol](https://github.com/erc6900/reference-implementation/blob/v0.7.x/src/interfaces/IStandardExecutor.sol) ‚Äî –≤–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã–∑–æ–≤–æ–≤ AA, —á–µ—Ä–µ–∑ –Ω–∏—Ö –∑–∞–ø—Ä–µ—â–µ–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω—ã –Ω–∞–ø—Ä—è–º—É—é.
    ```solidity
    function execute(
        address target, 
        uint256 value, 
        bytes calldata data
    ) external payable returns (bytes memory);

    function executeBatch(
        Call[] calldata calls // Call { target; value; data }
    ) external payable returns (bytes[] memory);
    ```
- [IPluginExecutor.sol](https://github.com/erc6900/reference-implementation/blob/v0.7.x/src/interfaces/IPluginExecutor.sol) - —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–ª–∞–≥–∏–Ω –ê –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω –ë, –Ω–æ –≤—ã–∑–æ–≤ –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω —á–µ—Ä–µ–∑ MSCA. –§—É–Ω–∫—Ü–∏—è `executeFromPluginExternal` –Ω—É–∂–Ω–∞, —á—Ç–æ–±—ã –ø–ª–∞–≥–∏–Ω –º–æ–≥ –≤—ã–∑–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —á–µ—Ä–µ–∑ MSCA.
    ```solidity
    function executeFromPlugin(
        bytes calldata data
    ) external payable returns (bytes memory);

    function executeFromPluginExternal(
        address target, 
        uint256 value, 
        bytes calldata data
    ) external payable returns (bytes memory);
    ```

–ö—Ä–æ–º–µ —ç—Ç–∏—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, —Ç–∞–∫–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç [IAccountLoupe.sol](https://github.com/erc6900/reference-implementation/blob/v0.7.x/src/interfaces/IAccountLoupe.sol), –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–∞—Ö –æ–Ω—á–µ–π–Ω. –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–Ω –≤–∫–ª—é—á–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `getInstalledPlugins`, `getPreValidationHooks` –∏ –¥—Ä—É–≥–∏–µ.

## –ü–ª–∞–≥–∏–Ω—ã

–ü–ª–∞–≥–∏–Ω ‚Äî —ç—Ç–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç-—Å–∏–Ω–≥–ª—Ç–æ–Ω, —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π –≤ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–º —ç–∫–∑–µ–º–ø–ª—è—Ä–µ –¥–ª—è –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –µ–≥–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å. –ü–ª–∞–≥–∏–Ω —Ö—Ä–∞–Ω–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–∂–¥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞. –°–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–ª–∞–≥–∏–Ω–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±–Ω–æ–≤–ª—è–µ–º—ã–º; –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –ø–ª–∞–≥–∏–Ω–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—É—é.

–ü–ª–∞–≥–∏–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å [IPlugin.sol](https://github.com/erc6900/reference-implementation/blob/v0.7.x/src/interfaces/IPlugin.sol) –∏ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —É–¥–∞–ª–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–∞:

```solidity
function onInstall(bytes calldata data) external;

function onUninstall(bytes calldata data) external;
```

–¢–∞–∫–∂–µ –ø–ª–∞–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

```solidity
function pluginManifest() external pure returns (PluginManifest memory);

function pluginMetadata() external pure returns (PluginMetadata memory);
```

–ú–∞–Ω–∏—Ñ–µ—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–∞–≥–∏–Ω–∞. –û–Ω –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Ö—É–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ MSCA –≤–æ –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–∞–≥–∏–Ω–∞. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –º–∞–Ω–∏—Ñ–µ—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º (–≥–¥–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é –º–æ–∂–µ—Ç –≤—ã—Å—Ç—É–ø–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–ª–∞–≥–∏–Ω) –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

–°—Ç–æ–∏—Ç –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞.

### –ú–∞–Ω–∏—Ñ–µ—Å—Ç –ø–ª–∞–≥–∏–Ω–∞

–ú–∞–Ω–∏—Ñ–µ—Å—Ç ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∞—è, –∫–∞–∫ MSCA –¥–æ–ª–∂–µ–Ω –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –ø–ª–∞–≥–∏–Ω–æ–º, –∫–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞ —Å–ª–µ–¥—É–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º –∏ –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–ª–∞–≥–∏–Ω–æ–≤.

```solidity
struct PluginManifest {
    // –°–ø–∏—Å–æ–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ ERC-165 –∫–æ—Ç–æ—Ä—ã–π —Å–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –∫ –∞–∫–∫–∞—É–Ω—Ç—É MSCA.
    // –ù–µ –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IPlugin
    bytes4[] interfaceIds;
    // –ï—Å–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –¥—Ä—É–≥–∏–µ –ø–ª–∞–≥–∏–Ω—ã,
    // —Ç–æ –∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —ç—Ç–æ—Ç –º–∞—Å—Å–∏–≤
    bytes4[] dependencyInterfaceIds;
    // –≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞, –∫–æ—Ç–æ—Ä—ã–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –Ω–∞ MSCA
    // –∏ —Ä–∞—Å—à–∏—Ä—è—é—Ç –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
    bytes4[] executionFunctions;
    // –§—É–Ω–∫—Ü–∏–∏, —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ MSCA, –∫ –∫–æ—Ç–æ—Ä—ã–º –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø —É —ç—Ç–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞
    bytes4[] permittedExecutionSelectors;
    // –§–ª–∞–≥ –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –º–æ–∂–µ—Ç –ª–∏ –ø–ª–∞–≥–∏–Ω –≤—ã–∑—ã–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
    bool permitAnyExternalAddress;
    // –§–ª–∞–≥ –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –º–æ–∂–µ—Ç –ª–∏ –ø–ª–∞–≥–∏–Ω —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞—Ç–∏–≤–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —Å–µ—Ç–∏
    bool canSpendNativeToken;
    // –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π
    ManifestExternalCallPermission[] permittedExternalCalls;
    ManifestAssociatedFunction[] userOpValidationFunctions;
    ManifestAssociatedFunction[] runtimeValidationFunctions;
    ManifestAssociatedFunction[] preUserOpValidationHooks;
    ManifestAssociatedFunction[] preRuntimeValidationHooks;
    ManifestExecutionHook[] executionHooks;
}
```

**interfaceIds**

–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å ERC721 –∏ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å NFT, –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `onERC721Received`, –∞ –≤ `interfaceIds` —É–∫–∞–∑–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `IERC721Receiver`. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ `supportInterface` –∞–∫–∫–∞—É–Ω—Ç–∞ MSCA –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `true` –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —ç—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

**dependencyInterfaceIds** 

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑—ã–≤–∞—Ç—å, –∫–æ–≥–¥–∞ —Ü–µ–ª–µ–≤–æ–π –ø–ª–∞–≥–∏–Ω –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ –¥—Ä—É–≥–æ–º –ø–ª–∞–≥–∏–Ω–µ.
–ù–∞–ø—Ä–∏–º–µ—Ä –≤–æ–∑—å–º–µ–º [–ø–ª–∞–≥–∏–Ω](./contracts/src/TokenWhitelistPlugin.sol), –∫–æ—Ç–æ—Ä—ã–π —è –Ω–∞–ø–∏—Å–∞–ª –¥–ª—è —Ç–µ—Å—Ç–æ–≤. –ï–≥–æ –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –µ—Å—Ç—å –ª–∏ —Ç–æ–∫–µ–Ω ERC20 –≤ –≤–∞–π—Ç–ª–∏—Å—Ç–µ –ø—Ä–∏ –≤—ã–∑–æ–≤–∞—Ö —Ñ—É–Ω–∫—Ü–∏–π `transfer` –∏ `approve`. –£ –Ω–µ–≥–æ –µ—Å—Ç—å —Å–ª—É–∂–µ–±–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `updateTokens`, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–±–∞–≤–ª—è–µ—Ç –∏ —É–¥–∞–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –∏–∑ –≤–∞–π—Ç–ª–∏—Å—Ç–∞. –õ–æ–≥–∏—á–Ω–æ, —á—Ç–æ –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω, –Ω–æ –ø–ª–∞–≥–∏–Ω –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∏ –æ—Ç–¥–∞–≤–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–π—Ç–ª–∏—Å—Ç–æ–º –∫–∞–∫–æ–º—É-—Ç–æ –æ–¥–Ω–æ–º—É –∫–æ—à–µ–ª—å–∫—É-–∞–¥–º–∏–Ω—É –Ω–µ—Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ. –í —Å–≤—è–∑–∏ —Å —ç—Ç–∏–º –∫–∞–∂–¥—ã–π –∞–∫–∫–∞—É–Ω—Ç MSCA —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ø–∏—Å–∫–æ–º —Ç–æ–∫–µ–Ω–æ–≤ —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –æ–Ω –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –ß—Ç–æ–±—ã –¥–æ—Å—Ç—É–ø –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é –≤–∞–π—Ç–ª–∏—Å—Ç–∞ –±—ã–ª —Ç–æ–ª—å–∫–æ —É MSCA - –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ –≤–∏–¥–µ –ø–ª–∞–≥–∏–Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–∞. –í –º–æ–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ [MultiOwnerPlugin](https://github.com/alchemyplatform/modular-account/blob/v1.0.1/src/plugins/owner/MultiOwnerPlugin.sol). –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–∞–ª–µ–µ.

```solidity
function pluginManifest() external pure override returns (PluginManifest memory) {
    PluginManifest memory manifest;
    // dependency
    manifest.dependencyInterfaceIds = new bytes4[](1);
    manifest.dependencyInterfaceIds[0] = type(IMultiOwnerPlugin).interfaceId;

    // ...
}
```

**executionFunctions**

–≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –Ω–∞ MSCA –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–ª–∞–≥–∏–Ω–∞, —Ç–µ–º —Å–∞–º—ã–º —Ä–∞—Å—à–∏—Ä—è—è –µ–≥–æ. –í –º–æ–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ `updateTokens`, `isAllowedToken` –∏ `getTokens`. –†–∞—Å—à–∏—Ä—è—é—Ç, –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω–∏, –∫–∞–∫ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞, –±—É–¥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ "–Ω–∞–ø—Ä—è–º—É—é", –Ω–∞–ø—Ä–∏–º–µ—Ä —Ç–∞–∫ - `account.updateTokens()`. –¢.–∫. —Ñ—É–Ω–∫—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞ –±—É–¥—É—Ç –≤—ã–∑–≤–∞–Ω—ã —á–µ—Ä–µ–∑ `fallback` —Ñ—É–Ω–∫—Ü–∏—é –∞–∫–∫–∞—É–Ω—Ç–∞, —Ç–æ –µ—Å–ª–∏ –º—ã –Ω–µ –¥–æ–±–∞–≤–∏–º –∏—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ `executionFunctions`, —Ç–∞–∫–æ–π –≤—ã–∑–æ–≤ –±—É–¥–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–æ–º –æ—Ç–∫–ª–æ–Ω–µ–Ω.

**permittedExecutionSelectors**

–í —ç—Ç–æ—Ç –º–∞—Å—Å–∏–≤ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Å–µ–ª–µ–∫—Ç–æ—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω—ã –ø–ª–∞–≥–∏–Ω–æ–º –Ω–∞ MSCA —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `executeFromPlugin`.

**permitAnyExternalAddress**

–§–ª–∞–≥, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∏–ª–∏ –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ `executeFromPluginExternal`.

**canSpendNativeToken**

–§–ª–∞–≥, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ø–ª–∞–≥–∏–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Ç–∏–≤–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —Å–µ—Ç–∏.

### –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–∞–≥–∏–Ω

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –ø–ª–∞–≥–∏–Ω –±—É–¥–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏ —Ö—É–∫–∞–º–∏ –≤ MSCA.

**permittedExternalCalls**

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –≤—ã–∑–æ–≤—ã –≤–Ω–µ—à–Ω–∏—Ö –∞–¥—Ä–µ—Å–æ–≤. –ò–º–µ–µ—Ç –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: –ª–∏–±–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—ã–∑–æ–≤—ã –ª—é–±–æ–≥–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞, –ª–∏–±–æ –ø–µ—Ä–µ–¥–∞—Ç—å –º–∞—Å—Å–∏–≤ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤.

```solidity
struct ManifestExternalCallPermission {
    address externalAddress;
    bool permitAnySelector;
    bytes4[] selectors;
}
```

**userOpValidationFunctions, runtimeValidationFunctions**

–ï—Å–ª–∏ –≤–∞—à –ø–ª–∞–≥–∏–Ω –¥–æ–ª–∂–µ–Ω –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–∑–æ–≤–∞ `userOpValidationFunction` –∏–ª–∏ `runtimeValidationFunctions`, —Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–∏—Å–∞—Ç—å, –¥–ª—è –∫–∞–∫–∏—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ —ç—Ç–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –í–∞–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ (`userOpValidationFunctions` –∏ `runtimeValidationFunctions`) –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ –æ–¥–Ω–æ–π –Ω–∞ –Ω–∞ –∫–∞–∂–¥—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä –∞–∫–∫–∞—É–Ω—Ç–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤.

–ö –ø—Ä–∏–º–µ—Ä—É –ø–ª–∞–≥–∏–Ω [MultiOwnerPlugin](https://github.com/alchemyplatform/modular-account/blob/v1.0.1/src/plugins/owner/MultiOwnerPlugin.sol) –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –∞–∫–∫–∞—É–Ω—Ç–∞. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω *MultiOwnerPlugin*, —Ç–æ —Ç–æ–ª—å–∫–æ –æ–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ `IStandardExecutor.execute.selector` –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö `userOpValidationFunctions` –∏ `runtimeValidationFunctions`. –ü–æ—ç—Ç–æ–º—É –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ `execute` –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è —ç—Ç–∏–º–∏ –∂–µ —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ –≤—Ä–æ–¥–µ —ç—Ç–æ–π `UserOpValidationFunctionAlreadySet(0xb61d27f6,0xc7183455a4c133ae270771860664b6b7ec320bb100)`.

–†–µ—à–µ–Ω–∏–µ –≤ —Ç–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ - –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –≤ —Ö—É–∫ `preUserOpValidationHooks` –∏–ª–∏ `preRuntimeValidationHooks`, –∞ –Ω–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é.

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º–æ–≥–æ –≤ MSCA, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ *MultiOwnerPlugin*, –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `ManifestAssociatedFunction` –∏ `ManifestFunction`.

–†–∞–∑–±–µ—Ä–µ–º –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –º–æ–µ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ `TokenWhitelistPlugin` –∏ —Ñ—É–Ω–∫—Ü–∏–∏ `updateTokens`, –∫–æ—Ç–æ—Ä—É—é —è —Ö–æ—á—É –¥–æ–±–∞–≤–∏—Ç—å –∫ MSCA. –†–∞–Ω–µ–µ –º—ã —É–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ `IMultiOwnerPlugin` –≤ `dependencyInterfaceIds`, —ç—Ç–æ –±—ã–ª —à–∞–≥ –Ω–æ–º–µ—Ä 1. –¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä –≤ `executionFunctions`. 

```solidity
function pluginManifest() external pure override returns (PluginManifest memory) {
    PluginManifest memory manifest;
    // dependency
    manifest.dependencyInterfaceIds = new bytes4[](1);
    manifest.dependencyInterfaceIds[0] = type(IMultiOwnerPlugin).interfaceId;

    // runtime execution functions
    manifest.executionFunctions = new bytes4[](1);
    manifest.executionFunctions[0] = this.updateTokens.selector;
    // ...
}
```
–î–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞ –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ runtime, –ø–æ—Ç–æ–º—É —á—Ç–æ –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω —á–µ—Ä–µ–∑ `userOp`, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—ã–∑–æ–≤ –±—É–¥–µ–º —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é. –î–ª—è –Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ `ManifestAssociatedFunction` –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ç—É–¥–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏:

```solidity
struct ManifestAssociatedFunction {
    bytes4 executionSelector; // —Å–µ–ª–µ–∫—Ç–æ—Ä –∞–∫–∫–∞—É–Ω—Ç–∞ (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –æ–Ω –¥–æ–±–∞–≤–ª–µ–Ω —Å –ø–ª–∞–≥–∏–Ω–∞)
    ManifestFunction associatedFunction; // —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–≤–µ—á–∞—é—â–∞—è –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É
}

manifest.runtimeValidationFunctions = new ManifestAssociatedFunction[](1);
manifest.runtimeValidationFunctions[0] = ManifestAssociatedFunction({
    executionSelector: this.updateTokens.selector,
    associatedFunction: // ...
});
```

–î–∞–ª–µ–µ –≤ `associatedFunction` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `ManifestFunction` —á—Ç–æ–±—ã –æ–ø–∏—Å–∞—Ç—å —á—Ç–æ –ø–ª–∞–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Å —ç—Ç–∏–º —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º:

```solidity
struct ManifestFunction {
    ManifestAssociatedFunctionType functionType; // –≠—Ç–æ enum –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º erc-6900
    uint8 functionId; // –≠—Ç–æ enum –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ –ø–ª–∞–≥–∏–Ω–µ –∏ –ø–æ–º–æ–≥–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
    uint256 dependencyIndex; // –ò–Ω–¥–µ–∫—Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –º–∞—Å—Å–∏–≤–µ dependencyInterfaceIds
}
```

–ü–µ—Ä–≤–æ–µ, —Å —á–µ–º –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è - —ç—Ç–æ `functionType`, —Ñ–ª–∞–≥, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –∞–∫–∫–∞—É–Ω—Ç –ø–æ–π–º–µ—Ç –∫—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —ç—Ç–æ–≥–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞:

```solidity
enum ManifestAssociatedFunctionType {
    // –§—É–Ω–∫—Ü–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
    NONE,
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —ç—Ç–æ–º—É –ø–ª–∞–≥–∏–Ω—É
    SELF,
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –≤–Ω–µ—à–Ω–µ–º—É –ø–ª–∞–≥–∏–Ω—É, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ–º—É
    // –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–ª–∞–≥–∏–Ω–∞.
    // –ü–ª–∞–≥–∏–Ω—ã –ú–û–ì–£–¢ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏.
    // –û–Ω –ù–ï –î–û–õ–ñ–ï–ù –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Ö—É–∫–æ–≤, –∏–Ω–∞—á–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—É–¥–µ—Ç –Ω–µ—É–¥–∞—á–Ω–æ–π.
    DEPENDENCY,
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–∞–≥–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
    // –≤ —Ä–µ–∂–∏–º–µ runtime –¥–ª—è –¥–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
    // –¢–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–∂–∏–º–∞ runtime, –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–ª—è validationFunction,
    // —ç—Ç–æ –±—É–¥–µ—Ç –≤–ø—É—Å—Ç—É—é –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã–π –≥–∞–∑. 
    // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å —Ö—É–∫–æ–º, —Ä–∞–≤–Ω–æ—Å–∏–ª—å–Ω–æ —Ç–æ–º—É —á—Ç–æ —Ö—É–∫ –Ω–µ –∑–∞–¥–∞–Ω.
    RUNTIME_VALIDATION_ALWAYS_ALLOW,
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–∞–≥–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å —Å–±–æ–π –≤ —Ö—É–∫–µ –¥–ª—è –¥–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
    // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å —Ö—É–∫–∞–º–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. 
    // –ù–æ –Ω–µ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ - 
    // —Ä–∞–≤–Ω–æ—Å–∏–ª—å–Ω–æ —Ç–æ–º—É, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
    // –ï–≥–æ –Ω–µ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ post-exec —Ö—É–∫–∞—Ö, –ø–æ—Ç–æ–º—É —á—Ç–æ –µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ,
    // —á—Ç–æ —Ö—É–∫ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è, —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–Ω—å—à–µ, 
    // —á—Ç–æ–±—ã —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –≥–∞–∑.
    PRE_HOOK_ALWAYS_DENY
}
```

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥ `DEPENDENCY`. –ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `functionId` –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è, —Ç.–∫. –µ–≥–æ –Ω–∞–∑–Ω–∞—á–∏—Ç —Å–∞–º–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, `dependencyIndex` –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `dependencyInterfaceIds`:

```solidity
manifest.runtimeValidationFunctions = new ManifestAssociatedFunction[](1);
manifest.runtimeValidationFunctions[0] = ManifestAssociatedFunction({
    executionSelector: this.updateTokens.selector,
    associatedFunction: ManifestFunction({
        functionType: ManifestAssociatedFunctionType.DEPENDENCY,
        functionId: 0, // –≤ —Å–ª—É—á–∞–µ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é –Ω–∏ –Ω–∞ —á—Ç–æ –Ω–µ –≤–ª–∏—è–µ—Ç
        dependencyIndex: 0 // –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ 0, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ —ç—Ç–æ–º—É –∏–Ω–¥–µ–∫—Å—É –ª–µ–∂–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IMultiOwnerPlugin
    })
});
```

–ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ. –ß—Ç–æ–±—ã –≤—Å–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ –Ω—É–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω `TokenWhitelistPlugin` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ç–æ–≥–æ, –∫–∞–∫–∞—è –±—É–¥–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏ –∫–∞–∫ –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `bytes21`, –≥–¥–µ –ø–µ—Ä–≤—ã–µ 20 –±–∞–π—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç –∞–¥—Ä–µ—Å –ø–ª–∞–≥–∏–Ω–∞-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∞–π—Ç —É–∫–∞–∑—ã–≤–∞–µ—Ç `functionId` –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

```solidity
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–∏–ø –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –ø–ª–∞–≥–∏–Ω–µ
type FunctionReference is bytes21;

FunctionReference[] memory dependencies = new FunctionReference[](1);
// –∑–¥–µ—Å—å —É–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ functionId
dependencies[0] = FunctionReferenceLib.pack(
    address(multiOwnerPlugin),
    uint8(IMultiOwnerPlugin.FunctionId.RUNTIME_VALIDATION_OWNER_OR_SELF)
);

vm.prank(owner);
account1.installPlugin({
    plugin: address(tokenWhitelistPlugin),
    manifestHash: manifestHash,
    pluginInstallData: tokenWhitelistPluginInstallData,
    dependencies: dependencies // —Å—é–¥–∞ –ø–µ—Ä–µ–¥–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
});
```

–ì–æ—Ç–æ–≤–æ. –ï—Å–ª–∏ –≤—Å–µ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —Ç–æ —Ç–µ–ø–µ—Ä—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ `updateTokens` –∞–∫–∫–∞—É–Ω—Ç –±—É–¥–µ—Ç –≤–∏–¥–µ—Ç—å, —á—Ç–æ —ç—Ç–æ—Ç —Å–µ–ª–µ–∫—Ç–æ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `MultiOwnerPlugin`, –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–µ–¥–∞—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –µ–º—É –≤ —Ñ—É–Ω–∫—Ü–∏—é `runtimeValidationFunction`, –≥–¥–µ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω `functionId` —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤–º–µ—Å—Ç–µ —Å –ø–ª–∞–≥–∏–Ω–æ–º:

```solidity
function runtimeValidationFunction(
    uint8 functionId, 
    address sender, 
    uint256, 
    bytes calldata
) external view override {
    if (functionId == uint8(FunctionId.RUNTIME_VALIDATION_OWNER_OR_SELF)) {
        // Validate that the sender is an owner of the account, or self.
        if (sender != msg.sender && !isOwnerOf(msg.sender, sender)) {
            revert NotAuthorized();
        }
        return;
    }
    revert NotImplemented(msg.sig, functionId);
}
```

*–í–∞–∂–Ω–æ!* –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è —É–∫–∞–∑–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π —Ö—É–∫, —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω—é—é —Ñ—É–Ω–∫—Ü–∏—é.

**preUserOpValidationHooks**, **preRuntimeValidationHooks**

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–∞–∫–∂–µ —á–µ—Ä–µ–∑ *ManifestAssociatedFunction*. –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏. –•—É–∫–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞ –æ–¥–∏–Ω —Å–µ–ª–µ–∫—Ç–æ—Ä –≤ –æ–¥–Ω–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ MSCA. –ù–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.

**executionHooks**

–•—É–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–¥–µ–∏—Å—Ç–≤—É–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º –±—ã–ª —Å–¥–µ–ª–∞–Ω –≤—ã–∑–æ–≤ - —á–µ—Ä–µ–∑ userOp –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é. –ù–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è –ø–ª–∞–≥–∏–Ω–∞ `TokenWhitelistPlugin` —ç—Ç–æ —Ö–æ—Ä–æ—à–µ–µ –º–µ—Å—Ç–æ —á—Ç–æ–±—ã –æ—Ö–≤–∞—Ç–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å—Ç—å –ª–∏ —Ç–æ–∫–µ–Ω –≤ –≤–∞–π—Ç–ª–∏—Å—Ç–µ.

–¢.–∫ –µ—Å—Ç—å –¥–≤–∞ —Ö—É–∫–∞ –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: pre- –∏ postExecHook, —Ç–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ö—É–∫–æ–≤ –Ω–µ–º–Ω–æ–≥–æ –¥—Ä—É–≥–∞—è - `ManifestExecutionHook`:

```solidity
struct ManifestExecutionHook {
    bytes4 selector; // —Å–µ–ª–µ–∫—Ç–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–π –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
    ManifestFunction preExecHook; // —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
    ManifestFunction postExecHook; // —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç-–ø—Ä–æ–≤–µ—Ä–∫–∏
}
```

–î–∞–ª—å—à–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ —Ç–∞ –∂–µ `ManifestFunction`, –Ω–∞–ø—Ä–∏–º–µ—Ä –º–Ω–µ –Ω–∞ –ø–ª–∞–≥–∏–Ω–µ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ MSCA `execute` –∏–ª–∏ `executeBatch`.

- –¢–∏–ø —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥–µ—Ç `SELF`, –ø–æ—Ç–æ–º—É –≤—ã–∑–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –∂–µ –ø–ª–∞–≥–∏–Ω–µ. 
- `functionId` —É–∫–∞–∑—ã–≤–∞–µ–º –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–ª–∞–≥–∏–Ω –ø–æ–Ω–∏–º–∞–ª —Å –∫–∞–∫–∏–º —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤—ã–∑–æ–≤.
- `dependencyIndex` –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ–º, –ø–æ—Ç–æ–º—É —á—Ç–æ —É —Ö—É–∫–æ–≤ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

```solidity
    manifest.executionHooks = new ManifestExecutionHook[](2);
    manifest.executionHooks[0] = ManifestExecutionHook({
        executionSelector: IStandardExecutor.execute.selector,
        preExecHook: ManifestFunction({
            functionType: ManifestAssociatedFunctionType.SELF,
            functionId: uint8(FunctionId.EXECUTE_FUNCTION),
            dependencyIndex: 0
        }),
        postExecHook: none
    });
    manifest.executionHooks[1] = ManifestExecutionHook({
        executionSelector: IStandardExecutor.executeBatch.selector,
        preExecHook: ManifestFunction({
            functionType: ManifestAssociatedFunctionType.SELF,
            functionId: uint8(FunctionId.EXECUTE_BATCH_FUNCTION),
            dependencyIndex: 0
        }),
        postExecHook: none
    });
```

–ú–∞–Ω–∏—Ñ–µ—Å—Ç –≥–æ—Ç–æ–≤. –î–∞–ª–µ–µ –≤ –ø–ª–∞–≥–∏–Ω–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `preExecutionHook`, –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–∞–∫–∏—Ö –≤—ã–∑–æ–≤–æ–≤. –†–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [–∑–¥–µ—Å—å](./contracts/src/TokenWhitelistPlugin.sol).

```solidity
function preExecutionHook(
    uint8 functionId, 
    address sender, 
    uint256 value, 
    bytes calldata data
) external view override returns (bytes memory) {}
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞–≥–∏–Ω–∞

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å –ø–ª–∞–≥–∏–Ω, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —Å –∫–∞–∫–∏–º–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º–∏ –æ–Ω –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –≥–¥–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏. –ü—Ä–∏–º–µ—Ä–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π —è —Å–æ—Å—Ç–∞–≤–∏–ª –¥–ª—è —Å–µ–±—è, –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫ (–µ—Å—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å, —á—Ç–æ —è —á—Ç–æ-—Ç–æ —É–ø—É—Å—Ç–∏–ª):

- [ ] –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–ª–∞–≥–∏–Ω? –ö–∞–∫–æ–≤–∞ –µ–≥–æ –≥–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞?
- [ ] –ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç—É?
- [ ] –ü–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ `userOp` –∏–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–∞?
- [ ] –ë—É–¥–µ—Ç –ª–∏ –ø–ª–∞–≥–∏–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å?
- [ ] –ù–µ—Ç –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ —Å –¥—Ä—É–≥–∏–º–∏ –ø–ª–∞–≥–∏–Ω–∞–º–∏?
- [ ] –ì–¥–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–Ω—å—à–µ? –ò–º–µ–µ—Ç—Å—è –≤ –≤–∏–¥—É –ø–æ—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã–∑–æ–≤–∞ –∏ –≤—ã–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ —Ö—É–∫–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —ç—Ç–∏–º –ø–æ—Ç–æ–∫–æ–º.
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è/—Ö—É–∫ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤—ã–∑–æ–≤—ã –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ?

–î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –≤–æ–∑—å–º–µ–º –¥—Ä—É–≥–æ–π –ø–ª–∞–≥–∏–Ω ‚Äî [TransferLimitPlugin](./contracts/src/TransferLimitPlugin.sol) –∏ –ø—Ä–æ–π–¥–µ–º –ø–æ —ç—Ç–æ–º—É —Å–ø–∏—Å–∫—É.

1. –ü–ª–∞–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ª–∏–º–∏—Ç—ã –Ω–µ—Å–Ω–∏–∂–∞–µ–º–æ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ ERC20 –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ MSCA. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –±–æ–∏—Ç–µ—Å—å –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –ø–æ –æ—à–∏–±–∫–µ –±–æ–ª—å—à—É—é —Å—É–º–º—É USDT, –ø–æ—ç—Ç–æ–º—É —Å—Ç–∞–≤–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ –ª–∏–º–∏—Ç. –ö –ø—Ä–∏–º–µ—Ä—É, –Ω–∞ –∫–æ—à–µ–ª—å–∫–µ –ª–µ–∂–∏—Ç 5500 USDT, —Å—Ç–∞–≤–∏–º –ª–∏–º–∏—Ç –Ω–∞ 5000, –∞ 500 –º–æ–∂–µ–º —Å–ø–æ–∫–æ–π–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å, –∑–∞–æ–¥–Ω–æ –ø–ª–∞–≥–∏–Ω –æ–≥—Ä–∞–¥–∏—Ç –≤–∞—Å –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –∞–ø—Ä—É–≤–æ–≤.
2. –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–∞–∫–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤, —Ç–∞–∫ –µ–µ –∏ –Ω–∞–∑–æ–≤–µ–º ‚Äî `updateLimit`. –≠—Ç—É —Ñ—É–Ω–∫—Ü–∏—é —Å–º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ—Ç, –∫—Ç–æ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ MSCA. –ü–æ–º–∏–º–æ —ç—Ç–æ–≥–æ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ view-—Ñ—É–Ω–∫—Ü–∏–∏, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ `getCurrentLimit` –∏ `getTokensForAccount`.
3. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –Ω–µ –≤–∞–∂–Ω–æ, –∫–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º –±—ã–ª —Å–¥–µ–ª–∞–Ω –≤—ã–∑–æ–≤, –≤–∞–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ª—é–±—ã–µ –≤—ã–∑–æ–≤—ã MSCA ‚Äî userOp –∏ runtime.
4. –í—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫, —á—Ç–æ –Ω–µ—Ç –Ω—É–∂–¥—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.
5. –¢–∞–∫ –∫–∞–∫ –º—ã –Ω–µ —Å–æ–±–∏—Ä–∞–µ–º—Å—è –¥–µ–ª–∞—Ç—å —ç—Ç–æ—Ç –ø–ª–∞–≥–∏–Ω –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö—É–∫–∏, –∞ –∑–Ω–∞—á–∏—Ç, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å –æ–Ω–∏ –Ω–µ –±—É–¥—É—Ç.
6. –†–∞–Ω—å—à–µ –≤—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–∫—É –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ —Ö—É–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (preUserOpValidationHooks –∏–ª–∏ preRuntimeValidationHooks), –Ω–æ –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –ø—Ä–∏–¥–µ—Ç—Å—è –Ω–∞ –ø–ª–∞–≥–∏–Ω–µ –ø–∏—Å–∞—Ç—å –¥–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –¥–∞ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ userOp –Ω–∞–º –Ω–∏—á–µ–º –Ω–µ –ø–æ–º–æ–∂–µ—Ç.
7. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã —Ç–æ–∫–µ–Ω–æ–≤, –ø–æ—ç—Ç–æ–º—É –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –≤ `preExecutionHook`.

–î–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ —è —Ç–∞–∫–∂–µ –Ω–∞–∫–∏–¥–∞–ª —Å—Ö–µ–º–∫—É, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –ø—Ä–æ—â–µ –≤—ã–±—Ä–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ —Ö—É–∫–∏ –¥–ª—è –ø–ª–∞–≥–∏–Ω–∞.

![function-selection-scheme](./img/function-selection-scheme.png)

–î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–ø–∏—Å–∞—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏, –æ –∫–æ—Ç–æ—Ä—ã—Ö —è —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª –≤—ã—à–µ (–æ–Ω –±—É–¥–µ—Ç –ø–æ—Ö–æ–∂ –Ω–∞ –º–∞–Ω–∏—Ñ–µ—Å—Ç –ø–ª–∞–≥–∏–Ω–∞ `TokenWhitelistPlugin`) –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–∏.

### –§—É–Ω–∫—Ü–∏–∏ view –∏ pure

–§—É–Ω–∫—Ü–∏–∏ –Ω–∞ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–∏—Ç—å –≤ `executionFunctions` –∏ –æ—Ç–Ω–µ—Å—Ç–∏ –∏—Ö –∫ —Ç–∏–ø—É `RUNTIME_VALIDATION_ALWAYS_ALLOW`, —á—Ç–æ–±—ã –æ–Ω–∏ —Ç–∞–∫–∂–µ —Å—Ç–∞–ª–∏ —á–∞—Å—Ç—å—é MSCA, —Ö–æ—Ç—è –≤–æ–∑–º–æ–∂–Ω–æ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö –ø—Ä–æ—â–µ –±—É–¥–µ—Ç –∏—Ö –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ –ø–ª–∞–≥–∏–Ω–µ.

```solidity
function pluginManifest() external pure override returns (PluginManifest memory) {
    // ...

    // runtime execution functions
    manifest.executionFunctions = new bytes4[](3);
    manifest.executionFunctions[0] = this.updateLimit.selector;
    manifest.executionFunctions[1] = this.getTokensForAccount.selector;
    manifest.executionFunctions[2] = this.getCurrentLimit.selector;

    ManifestFunction memory runtimeAlwaysAllow = ManifestFunction({
        functionType: ManifestAssociatedFunctionType.RUNTIME_VALIDATION_ALWAYS_ALLOW,
        functionId: 0,
        dependencyIndex: 0
    });

    manifest.runtimeValidationFunctions = new ManifestAssociatedFunction[](3);
    manifest.runtimeValidationFunctions[0] = ManifestAssociatedFunction({
        executionSelector: this.updateLimit.selector,
        // ...
    });
    manifest.runtimeValidationFunctions[1] = ManifestAssociatedFunction({
        executionSelector: this.getTokensForAccount.selector,
        associatedFunction: runtimeAlwaysAllow
    });
    manifest.runtimeValidationFunctions[2] = ManifestAssociatedFunction({
        executionSelector: this.getCurrentLimit.selector,
        associatedFunction: runtimeAlwaysAllow
    });
```

–ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [–∑–¥–µ—Å—å](./contracts/src/TransferLimitPlugin.sol).

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞

–ß—Ç–æ–±—ã –ø–ª–∞–≥–∏–Ω –º–æ–∂–Ω–æ –±—ã–ª–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ MSCA, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ `onInstall` –∏ `onUninstall`. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ —Å–ª—É—á–∞–µ —Å –ø–ª–∞–≥–∏–Ω–æ–º *TransferLimitPlugin* –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –∑–∞–¥–∞—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ª–∏–º–∏—Ç—ã, –∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ ‚Äî –∏—Ö –æ—á–∏—Å—Ç–∏—Ç—å:

```solidity
    function onInstall(bytes calldata data) external override {
        (ERC20SpendLimit[] memory spendLimits) = abi.decode(data, (ERC20SpendLimit[]));

        uint256 length = spendLimits.length;
        for (uint8 i = 0; i < length; i++) {
            _tokenList.tryAdd(msg.sender, SetValue.wrap(bytes30(bytes20(spendLimits[i].token))));
            _limits[msg.sender][spendLimits[i].token] = spendLimits[i].limit;
        }
    }

    function onUninstall(bytes calldata data) external override {
        (address[] memory tokens) = abi.decode(data, (address[]));

        uint256 length = tokens.length;
        for (uint8 i = 0; i < length; i++) {
            delete _limits[msg.sender][tokens[i]];
        }
        _tokenList.clear(msg.sender);
    }
```

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–∞–≥–∏–Ω–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:
- –ê–¥—Ä–µ—Å –ø–ª–∞–≥–∏–Ω–∞.
- –•–µ—à `keccak256` –æ—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –ø–ª–∞–≥–∏–Ω–∞.
- –î–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏—é `onInstall` (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –∞–¥—Ä–µ—Å–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –∏—Ö –ª–∏–º–∏—Ç—ã).
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä MultiOwnerPlugin.

```solidity
function _installTransferLimitPlugin() private {
    // –ü–æ–ª—É—á–∞–µ–º —Ö–µ—à –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞
    bytes32 transferLimitManifestHash = keccak256(abi.encode(transferLimitPlugin.pluginManifest()));

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏
    TransferLimitPlugin.ERC20SpendLimit[] memory spendLimits = new TransferLimitPlugin.ERC20SpendLimit[](1);
    spendLimits[0] = TransferLimitPlugin.ERC20SpendLimit({token: address(token), limit: TRANSFER_LIMIT});
    bytes memory transferLimitPluginInstallData = abi.encode(spendLimits);

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    FunctionReference[] memory dependencies = new FunctionReference[](1);
    dependencies[0] = FunctionReferenceLib.pack(
        address(multiOwnerPlugin), uint8(IMultiOwnerPlugin.FunctionId.RUNTIME_VALIDATION_OWNER_OR_SELF)
    );

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞–≥–∏–Ω –Ω–∞ MSCA
    vm.prank(owner);
    account1.installPlugin(
        address(transferLimitPlugin),
        transferLimitManifestHash,
        transferLimitPluginInstallData,
        dependencies
    );
}
```

–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `UninstallPluginConfig`:

```solidity
struct UninstallPluginConfig {
    // –ú–∞–Ω–∏—Ñ–µ—Å—Ç –ø–ª–∞–≥–∏–Ω–∞
    bytes serializedManifest;
    // –§–ª–∞–≥ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–∞.
    // –£–¥–∞–ª—è–µ—Ç –ø–ª–∞–≥–∏–Ω, –¥–∞–∂–µ –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è onUninstall –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    bool forceUninstall;
    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞, –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –¥–µ–∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏
    // (`onUninstall`), –∏–ª–∏ –Ω–æ–ª—å, —á—Ç–æ–±—ã –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
    // –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å `forceUninstall` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ
    // –ø—Ä–µ–ø—è—Ç—Å—Ç–≤—É—é—Ç –¥–µ–∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏, –ø–æ—Ç—Ä–µ–±–ª—è—è –≤–µ—Å—å –æ—Å—Ç–∞–≤—à–∏–π—Å—è –≥–∞–∑.
    uint256 callbackGasLimit;
}
```

–ü—Ä–∏–º–µ—Ä —É–¥–∞–ª–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–∞:

```solidity
function test_uninstallPlugin() external {
    // –ü–æ–ª—É—á–∞–µ–º –º–∞–Ω–∏—Ñ–µ—Å—Ç
    bytes memory serializedManifest = abi.encode(transferLimitPlugin.pluginManifest());

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
    bytes memory config = abi.encode(
        UpgradeableModularAccount.UninstallPluginConfig({
            serializedManifest: serializedManifest,
            forceUninstall: false,
            callbackGasLimit: 0
        })
    );

    // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ onUninstall
    address[] memory tokens = new address[](1);
    tokens[0] = address(token1);
    bytes memory uninstallData = abi.encode(tokens);

    // –£–¥–∞–ª—è–µ–º –ø–ª–∞–≥–∏–Ω
    vm.prank(owner);
    account1.uninstallPlugin({
        plugin: address(transferLimitPlugin),
        config: config,
        pluginUninstallData: uninstallData
    });
}
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–ª–∞–≥–∏–Ω–æ–≤

**–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤ –Ω–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–∞—Ö**

–ö –ø—Ä–∏–º–µ—Ä—É, —É –≤–∞—Å –µ—Å—Ç—å –¥–≤–∞ –ø–ª–∞–≥–∏–Ω–∞: –ê –∏ –ë. –û–±–∞ –ø–ª–∞–≥–∏–Ω–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —á–µ—Ä–µ–∑ —Ö—É–∫–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä `execute`. –í –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –æ–Ω–∏ –±—É–¥—É—Ç –≤—ã–∑–≤–∞–Ω—ã?

–õ–æ–≥–∏—á–Ω–æ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å, —á—Ç–æ –ø–ª–∞–≥–∏–Ω—ã –±—É–¥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ MSCA, –æ—Ç —Å–∞–º–æ–≥–æ "—Å—Ç–∞—Ä–æ–≥–æ" –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ. –ù–∞ –¥–µ–ª–µ –≤—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞–æ–±–æ—Ä–æ—Ç.

–ü—Ä–∏–º–µ—Ä: –º—ã –¥–æ–±–∞–≤–∏–ª–∏ –ø–ª–∞–≥–∏–Ω –ê, –∑–∞—Ç–µ–º –ë, –∑–∞—Ç–µ–º –í.
–•—É–∫–∏ –±—É–¥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ –í -> –ë -> –ê.
–í—Å–µ —Ö—É–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–≤—è–∑–Ω–æ–º —Å–ø–∏—Å–∫–µ, –∏ –∏–∑-–∑–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è —Å –∫–æ–Ω—Ü–∞. –ü—Ä–∏ —ç—Ç–æ–º, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ö—É–∫ –ø–ª–∞–≥–∏–Ω–∞ –í —Ä–µ–≤–µ—Ä—Ç–Ω–µ—Ç –≤—ã–∑–æ–≤, —Ç–æ –¥–∞–ª—å—à–µ —Ö—É–∫–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–µ –±—É–¥—É—Ç. –¢–∞–∫–æ–µ –∂–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—É–¥–µ—Ç –∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `AccountLoupe::getInstalledPlugins`, –∫–æ—Ç–æ—Ä–∞—è –≤–µ—Ä–Ω—ë—Ç –º–∞—Å—Å–∏–≤ –ø–ª–∞–≥–∏–Ω–æ–≤ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –∏—Ö —É—Å—Ç–∞–Ω–æ–≤–∫–∏.

**–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**

–û—Å–Ω–æ–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∫—Ä–æ–µ—Ç—Å—è –Ω–µ –≤ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π –∏ —Ö—É–∫–æ–≤ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—ã–∑–æ–≤–æ–≤, –∞ –≤ —Ç–æ–º, —á—Ç–æ –ø–ª–∞–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Ö–æ—Ä–æ—à–æ –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è –≤ MSCA, –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—è —Å –¥—Ä—É–≥–∏–º–∏ –ø–ª–∞–≥–∏–Ω–∞–º–∏, –∞ –∏–Ω–æ–≥–¥–∞ –µ—â—ë –∏ –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å –Ω–∏–º–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –∏ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Å–≤—è–∑–∫–µ.

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –ø–æ–¥–æ–π–¥—ë—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π [plugin-template](https://github.com/erc6900/plugin-template). –¢–∞–º —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å EntryPoint.

## –í—ã–≤–æ–¥

–ù–∞ –º–æ–π –≤–∑–≥–ª—è–¥, —Å—Ç–∞–Ω–¥–∞—Ä—Ç –ø–æ–ª—É—á–∏–ª—Å—è –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–º. –° –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –æ–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–µ–ø–ª–æ—Ö–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞. –° –¥—Ä—É–≥–æ–π ‚Äî –µ—Å—Ç—å —á—É–≤—Å—Ç–≤–æ, —á—Ç–æ –æ–Ω —Å–ø–æ—Ç—ã–∫–∞–µ—Ç—Å—è —Å–∞–º –æ —Å–µ–±—è, –∏–Ω–æ–≥–¥–∞ –¥–∞–≤–∞—è —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∏—Ö –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å. –í–æ–∑–º–æ–∂–Ω–æ, –±—ã–ª–æ –±—ã –ª—É—á—à–µ, –µ—Å–ª–∏ –±—ã —ç—Ç–æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç –±—ã–ª –±–æ–ª–µ–µ "–ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–º". –ü–ª–æ—Ö–æ —Ç–∞–∫–∂–µ –∏ —Ç–æ, —á—Ç–æ –Ω–∞ –Ω–µ–≥–æ –æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–æ–ª—å—à–æ–µ –≤–ª–∏—è–Ω–∏–µ Alchemy –∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–∞. –ù–æ –±–µ—Å—Å–ø–æ—Ä–Ω–æ, —ç—Ç–æ –µ—â—ë –æ–¥–∏–Ω —à–∞–≥ –∫ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º –∞–∫–∫–∞—É–Ω—Ç–∞–º –∑–¥–æ—Ä–æ–≤–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞.

## –°—Å—ã–ª–∫–∏

- [EIP: ERC-6900: Modular Smart Contract Accounts and Plugins](https://eips.ethereum.org/EIPS/eip-6900)
- [EIP: ERC-4337](https://eips.ethereum.org/EIPS/eip-4337)
- [Article: How to write an ERC-6900 Plugin](https://dev.collab.land/blog/how-to-write-an-erc-6900-plugin/)
- [Github: erc6900](https://github.com/erc6900)
- [Github: modular-account (Alchemy)](https://github.com/alchemyplatform/modular-account)
- [Resources: Build a Plugin](https://www.erc6900.io/build-a-plugin)

