# ERC-4626: Tokenized Vaults

**–ê–≤—Ç–æ—Ä:** [–ü–∞–≤–µ–ª –ù–∞–π–¥–∞–Ω–æ–≤](https://github.com/PavelNaydanov) üïµÔ∏è‚Äç‚ôÇÔ∏è

_–û–ø—Ä!_ **Vault** - —ç—Ç–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç "—Ö—Ä–∞–Ω–∏–ª–∏—â–µ", –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –º–∞–∫—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–±—ã–ª—å —Å –∞–∫—Ç–∏–≤–æ–≤, –∫–æ—Ç–æ—Ä—ã–º–∏ –æ–Ω–∏ –≤–ª–∞–¥–µ—é—Ç. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–µ—Ä–µ–¥–∞—é—Ç —Å–≤–æ–∏ –∞–∫—Ç–∏–≤—ã —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ —Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –∏ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏.

–í –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∞–∫—Ç–∏–≤–æ–≤ –≤ **vault**, –≤–∑–∞–º–µ–Ω –≤—ã–¥–∞—é—Ç—Å—è –¥—Ä—É–≥–∏–µ —Ç–æ–∫–µ–Ω—ã(share), –ø—Ä–∏–Ω–æ—Å—è—â–∏–µ –¥–æ—Ö–æ–¥. –≠—Ç–∏ —Ç–æ–∫–µ–Ω—ã —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º —Ä–∞—Å—Ç—É—Ç –≤ —Ü–µ–Ω–µ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π —á–∞—Å—Ç–∏—á–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∞–∫—Ç–∏–≤–æ–≤ –≤ vault. –ò—Ö —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞—Å—Ç–µ—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ä–æ—Å—Ç—É —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–æ–≤ –≤ –ø—É–ª–µ **vault**.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ **vault** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ETH(–Ω–∞—Ç–∏–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞ —Å–µ—Ç–∏ Ethereum) –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞–∫—Ç–∏–≤–∞ –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏. –Ø –º–æ–≥—É –ø–µ—Ä–µ–¥–∞—Ç—å ETH —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É vault –∏ –≤–∑–∞–º–µ–Ω –ø–æ–ª—É—á—É share —Ç–æ–∫–µ–Ω vETH. Share —Ç–æ–∫–µ–Ω - —ç—Ç–æ —Å–≤–æ–µ–≥–æ —Ä–æ–¥–∞ –¥–æ–ª–≥–æ–≤–∞—è —Ä–∞—Å–ø–∏—Å–∫–∞ vault, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –º–æ–π ETH –æ–±—Ä–∞—Ç–Ω–æ.

–ü–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –º–Ω–æ–π ETH, –≤–Ω—É—Ç—Ä–∏ **vault**, –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å ETH –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–∞—Ö –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏. **Vault** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –ø–æ —Ä–∞–∑–Ω—ã–º –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥–∞–µ—Ç –∏–ª–∏ —Å–Ω–∏–º–∞–µ—Ç –∞–∫—Ç–∏–≤—ã. –≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –∞–∫—Ç–∏–≤–æ–≤ –≤ –ø—É–ª–µ, –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –±–æ–ª–µ–µ –≤—ã–≥–æ–¥–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏. –†–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ - —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è –∞–∫—Ç–∏–≤–æ–≤ –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –∏–ª–∏ –¥–∞–∂–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ —Å —Ü–µ–ª—å—é –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏.

> –ù–∞–ø—Ä–∏–º–µ—Ä!
> –ï—Å–ª–∏ MakerDao –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π –¥–æ—Ö–æ–¥ –æ—Ç –≤–ª–æ–∂–µ–Ω–∏—è ETH –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, —á–µ–º Compound, —Ç–æ vault –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ –æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –≤—Å–µ–≥–æ ETH –∏–ª–∏ —á–∞—Å—Ç–∏ –∏–∑ Compound –≤ MakerDao. [MakerDao](https://makerdao.com/en/) –∏ [Compound](https://compound.finance/) - —ç—Ç–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ lending –ø—Ä–æ—Ç–æ–∫–æ–ª—ã.

![](./images/vault-explaining.png)

## –°—Ç–∞–Ω–¥–∞—Ä—Ç ERC-4626

–°—Ç–∞–Ω–¥–∞—Ä—Ç [ERC-4626](https://eips.ethereum.org/EIPS/eip-4626) –±—ã–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é Ethereum. –û–Ω –±—ã–ª —Å–æ–∑–¥–∞–Ω –≤ —Å–æ–∞–≤—Ç–æ—Ä—Å—Ç–≤–µ —Å –î–∂–æ—É–∏ –°–∞–Ω—Ç–æ—Ä–æ, –æ—Å–Ω–æ–≤–∞—Ç–µ–ª–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ [Fei](https://fei.money/).

–î–æ –º–æ–º–µ–Ω—Ç–∞ –ø–æ—è–≤–ª–µ–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ —Å—Ä–µ–¥–∏ **vaults** –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π. –í —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, —ç—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–ª–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤, —Ä–µ–∞–ª–∏–∑—É—é—â–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–≤–µ—Ä—Ö vault.

–°–∞–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ ERC-20 –∏ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É–µ—Ç:
- –í–≤–æ–¥ –∏ –≤—ã–≤–æ–¥ –∞–∫—Ç–∏–≤–æ–≤
- –†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –≤–≤–æ–¥–∞ –∏ –≤—ã–≤–æ–¥–∞ –∞–∫—Ç–∏–≤–æ–≤
- –ë–∞–ª–∞–Ω—Å—ã –∞–∫—Ç–∏–≤–æ–≤
- –û—Ç–ø—Ä–∞–≤–∫—É —Å–æ–±—ã—Ç–∏–π

–ü–æ—è–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ —Å–Ω–∏–∑–∏–ª–æ –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∏ –ø–æ–≤—ã—Å–∏–ª–æ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π.

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ERC-20 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∏–Ω—Ç–∏—Ç—å –∏ —Å–∂–∏–≥–∞—Ç—å **share**(–¥–æ–ª–µ–≤—ã–µ) —Ç–æ–∫–µ–Ω—ã –≤ –æ–±–º–µ–Ω –Ω–∞ **assets**(underlying –∏–ª–∏ –±–∞–∑–æ–≤—ã–µ) —Ç–æ–∫–µ–Ω—ã. –î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ vault –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: `deposit()`, `mint()`, `redeem()`, `burn()`.

_–í–∞–∂–Ω–æ!_ –°—Ç–∞–Ω–¥–∞—Ä—Ç –º–æ–∂–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–ª—è **vault** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥—Ä—É–≥–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä [ERC-2612: Permit Extension for EIP-20 Signed Approvals](https://eips.ethereum.org/EIPS/eip-2612).

![](./images/vault-inheritance.png)

–í —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ ERC-4626 –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:
- `convertToShares(uint256 assets)`. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ share —Ç–æ–∫–µ–Ω–∞, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∑–∞ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞.
- `convertToAssets(uint256 shares)`. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∑–∞ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ share —Ç–æ–∫–µ–Ω–∞.

### Deposit

–ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç vault. –í –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–µ—Ä–µ–¥–∞—á–∏, —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ share —Ç–æ–∫–µ–Ω–æ–≤, —Å–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω, —Å–º–∏–Ω—Ç–∏—Ç—å share —Ç–æ–∫–µ–Ω –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å solidity —Å–æ–±—ã—Ç–∏–µ.

–§—É–Ω–∫—Ü–∏—è `deposit()` –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø–æ–¥–æ–±–Ω–æ.

```solidity
function deposit(uint256 assets, address receiver) public virtual returns (uint256 shares) {
    /// –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ share —Ç–æ–∫–µ–Ω–∞
    /// –¥–ª—è –≤–Ω–µ—Å–µ–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞(assets)
    /// –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è convertToShares(uint256 assets)
    shares = previewDeposit(assets);

    if (shares == 0) {
        /// –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ share —Ç–æ–∫–µ–Ω–∞ —Ä–∞–≤–Ω–æ –Ω—É–ª—é, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞
        revert ZeroShares();
    }

    /// –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç vault
    asset.safeTransferFrom(msg.sender, address(this), assets);

    /// –ú–∏–Ω—Ç–∏–Ω–≥ –≤–∑–∞–º–µ–Ω–∞ share —Ç–æ–∫–µ–Ω–∞
    _mint(receiver, shares);

    /// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–µ–µ –¥–µ–ø–æ–∑–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    emit Deposit(msg.sender, receiver, assets, shares);
}
```

### Redeem

–ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–¥–∞—á–∏ share —Ç–æ–∫–µ–Ω–æ–≤ c —Ü–µ–ª—å—é –∏–∑—ä—è—Ç–∏—è –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –≤–ª–æ–∂–µ–Ω —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `deposit()`. –°–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—è—Ç—å share —Ç–æ–∫–µ–Ω, —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –∏ —Å–∂–µ—á—å –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ share —Ç–æ–∫–µ–Ω–∞.

–§—É–Ω–∫—Ü–∏—è `redeem()` –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø–æ–¥–æ–±–Ω–æ.

```solidity
function redeem(
    uint256 shares,
    address receiver,
    address owner
) public virtual returns (uint256 assets) {
    /// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –≤–Ω–æ—Å–∏–ª –±–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
    /// –∏–ª–∏ –¥–∞–≤–∞–ª –ª–∏ –æ–Ω —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏–º –¥–µ–ø–æ–∑–∏—Ç–æ–º –≤—ã–∑—ã–≤–∞—é—â–µ–º—É —Ñ—É–Ω–∫—Ü–∏—é
    if (msg.sender != owner) {
        uint256 allowed = allowance[owner][msg.sender];

        if (allowed != type(uint256).max) allowance[owner][msg.sender] = allowed - shares;
    }

    /// –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞(assets)
    /// –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ share —Ç–æ–∫–µ–Ω–∞
    /// –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è convertToAssets(uint256 assets)
    assets = previewRedeem(shares);

    if (assets == 0) {
        /// –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ —Ä–∞–≤–Ω–æ –Ω—É–ª—é, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞
        revert ZeroAssets();
    }

    /// –°–∂–∏–≥–∞–Ω–∏–µ share —Ç–æ–∫–µ–Ω–∞
    _burn(owner, shares);

    /// –û—Ç–ø—Ä–∞–≤–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –¥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
    asset.safeTransfer(receiver, assets);

    /// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–Ω—è—Ç–∏—è –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞
    /// –°–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É —É –Ω–∞—Å –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–µ Withdraw()
    emit Withdraw(msg.sender, receiver, owner, assets, shares);
}
```

### Mint

–§—É–Ω–∫—Ü–∏—è `mint()` —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É vault. –û—Ç–ª–∏—á–∞–µ—Ç—Å—è —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç `deposit()` —Ç–µ–º, —á—Ç–æ –∑–¥–µ—Å—å –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö —Ñ—É–Ω–∫—Ü–∏–∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞, –∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ share —Ç–æ–∫–µ–Ω–∞, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏.

–§—É–Ω–∫—Ü–∏—è `mint()` –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø–æ–¥–æ–±–Ω–æ.

```solidity
function mint(uint256 shares, address receiver) public virtual returns (uint256 assets) {
        /// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
        assets = previewMint(shares);

        /// –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞ –æ—Ç –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ –¥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
        asset.safeTransferFrom(msg.sender, address(this), assets);

        /// –ú–∏–Ω—Ç–∏–Ω–≥ share —Ç–æ–∫–µ–Ω–æ–≤
        _mint(receiver, shares);

        /// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞
        /// –°–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É —É –Ω–∞—Å –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–µ Deposit
        emit Deposit(msg.sender, receiver, assets, shares);
    }
```

### Withdraw

–§—É–Ω–∫—Ü–∏—è `withdraw()` —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∏–∑—ä—è—Ç–∏—è –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ vault. –û—Ç–ª–∏—á–∞–µ—Ç—Å—è —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç `redeem()` —Ç–µ–º, —á—Ç–æ –∑–¥–µ—Å—å –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö —Ñ—É–Ω–∫—Ü–∏–∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ share —Ç–æ–∫–µ–Ω–∞, –∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞(assets), –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏.

–§—É–Ω–∫—Ü–∏—è `withdraw()` –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø–æ–¥–æ–±–Ω–æ.

```solidity
function withdraw(
    uint256 assets,
    address receiver,
    address owner
) public virtual returns (uint256 shares) {
    /// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ share —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
    shares = previewWithdraw(assets);

    /// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –≤–Ω–æ—Å–∏–ª –±–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
    /// –∏–ª–∏ –¥–∞–≤–∞–ª –ª–∏ –æ–Ω —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏–º –¥–µ–ø–æ–∑–∏—Ç–æ–º –≤—ã–∑—ã–≤–∞—é—â–µ–º—É —Ñ—É–Ω–∫—Ü–∏—é
    if (msg.sender != owner) {
        uint256 allowed = allowance[owner][msg.sender];

        if (allowed != type(uint256).max) allowance[owner][msg.sender] = allowed - shares;
    }

    /// –°–∂–∏–≥–∞–Ω–∏–µ share —Ç–æ–∫–µ–Ω–∞
    _burn(owner, shares);

    /// –û—Ç–ø—Ä–∞–≤–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –¥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
    asset.safeTransfer(receiver, assets);

    /// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–Ω—è—Ç–∏—è –±–∞–∑–æ–≤–æ–≥–æ –∞–∫—Ç–∏–≤–∞
    emit Withdraw(msg.sender, receiver, owner, assets, shares);
}
```

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏

–°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ vault. –ú–æ–∂–Ω–æ –±—Ä–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç –Ω–∏—Ö –∏ –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç **vault**.

1. [–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è](https://github.com/transmissions11/solmate/blob/main/src/mixins/ERC4626.sol) vault –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ solmate.
2. [–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v5.0.0/contracts/token/ERC20/extensions/ERC4626.sol) vault –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ openZeppelin.

_–í–∞–∂–Ω–æ!_ –°—Ç–∞–Ω–¥–∞—Ä—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º ERC-20.

### –ü–æ—Å–ª–æ–∂–Ω–µ–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

1. [Aave vault](https://github.com/aave/Aave-Vault/blob/main/src/ATokenVault.sol#L525)
2. Minimal ERC4626-style tokenized Vault [implementation](https://github.com/z0r0z/MultiVault/blob/main/src/MultiVault.sol) with ERC1155 accounting
3. [Rari-Capital vault](https://github.com/Rari-Capital/vaults/blob/main/src/Vault.sol)
4. –ü—Ä–æ—Ç–æ–∫–æ–ª Fuji V2 Himalaya. –ö–æ–Ω—Ç—Ä–∞–∫—Ç [YieldVault](https://github.com/Fujicracy/fuji-v2/blob/f32394f00a0a6cf6c12309ae92bc1602dc27c535/packages/protocol/src/vaults/yields/YieldVault.sol). –≠—Ç–æ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç [BaseVault](https://github.com/Fujicracy/fuji-v2/blob/f32394f00a0a6cf6c12309ae92bc1602dc27c535/packages/protocol/src/abstracts/BaseVault.sol).

## Links

1. [ERC-4626: Tokenized Vaults](https://eips.ethereum.org/EIPS/eip-4626)
2. [ERC-2612: Permit Extension for EIP-20 Signed Approvals](https://eips.ethereum.org/EIPS/eip-2612)
3. [ERC-20: Token Standard ](https://eips.ethereum.org/EIPS/eip-20)
4. [–ü—Ä–æ ERC-4626 –Ω–∞ ethereum.org](https://ethereum.org/en/developers/docs/standards/tokens/erc-4626/)
5. –ü—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä vault –Ω–∞ [solidity-by-example](https://solidity-by-example.org/defi/vault/).