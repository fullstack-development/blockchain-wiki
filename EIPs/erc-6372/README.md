# ERC-6372: Contract clock

**–ê–≤—Ç–æ—Ä:** [–ù–∞–π–¥–∞–Ω–æ–≤ –ü–∞–≤–µ–ª](https://github.com/PavelNaydanov) üïµÔ∏è‚Äç‚ôÇÔ∏è

_–í–∞–∂–Ω–æ!_ –ù–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏, —Å—Ç–∞–Ω–¥–∞—Ä—Ç –Ω–∞—Ö–æ–¥–∏–ª—Å—è –Ω–∞ —Å—Ç–∞–¥–∏–∏ "**Review**".

–≠—Ç–æ—Ç EIP –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å "**—á–∞—Å—ã**" –≤–Ω—É—Ç—Ä–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. **–ü–æ–¥ —á–∞—Å–∞–º–∏** –ø–æ–Ω–∏–º–∞–µ—Ç—Å—è –ª—é–±–∞—è –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –∑–∞–≤—è–∑–∞–Ω–Ω–∞—è –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ä–µ–º–µ–Ω–∏.

–û–±—ã—á–Ω–æ, –≤–Ω—É—Ç—Ä–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º, –≤ –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è [—Å–≤–æ–π—Å—Ç–≤–∞ –±–ª–æ–∫–∞](https://docs.soliditylang.org/en/latest/units-and-global-variables.html#block-and-transaction-properties): `block.timestamp`- –≤—Ä–µ–º—è —Ç–µ–∫—É—â–µ–≥–æ –±–ª–æ–∫–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –∏–ª–∏ `block.number` - –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –±–ª–æ–∫–∞. –°—Ç–∞–Ω–¥–∞—Ä—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –æ–ø—ã—Ç.

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ —Å–≤–æ–µ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ–≥–æ –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏: `clock()` –∏ `CLOCK_MODE()`.

```solidity
interface IERC6372 {
  function clock() external view returns (uint48);
  function CLOCK_MODE() external view returns (string);
}
```

### CLOCK_MODE()

–§—É–Ω–∫—Ü–∏—è `CLOCK_MODE()` –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å **—Ä–µ–∂–∏–º**. –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è  –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ. –õ–æ–≥–∏–∫–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–≤—è–∑–∞–Ω–∞ –Ω–∞ `block.timestamp`, `block.number` –∏–ª–∏ –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–≤—è–∑–∫–∏ –∫–æ –≤—Ä–µ–º–µ–Ω–∏.

**–ü—Ä–∏–º–µ—Ä—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è:**

- –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–º–µ—Ä –±–ª–æ–∫–∞
  > –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–º–µ—Ä –±–ª–æ–∫–∞ –Ω–∞ –±–∞–∑–µ –∫–æ–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ EVM "NUMBER" ([0x43](https://www.evm.codes/#43?fork=shanghai)) => **mode=blocknumber&from=default**
  > –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–º–µ—Ä –±–ª–æ–∫–∞ –Ω–∞ –±–∞–∑–µ –¥—Ä—É–≥–æ–≥–æ –±–ª–æ–∫—á–µ–π–Ω–∞ => **mode=blocknumber&from=[CAIP-2-ID]**, –≥–¥–µ [CAIP-2-ID] ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫—á–µ–π–Ω–∞ [CAIP-2](https://github.com/ChainAgnostic/CAIPs/blob/main/CAIPs/caip-2.md), –Ω–∞–ø—Ä–∏–º–µ—Ä eip155:1
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç timestamp
  > **mode=timestamp**
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–æ–π —Ä–µ–∂–∏–º
  > **mode=[–õ—é–±–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞]**

### clock()

–§—É–Ω–∫—Ü–∏—è `clock()` –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ **—Ä–µ–∂–∏–º–∞** (CLOCK_MODE). –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–µ —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–æ–º–µ—Ä –±–ª–æ–∫–∞, timestamp –∏ —Ç–æ–º—É –ø–æ–¥–æ–±–Ω–æ–µ.

_–í–∞–∂–Ω–æ!_ –§—É–Ω–∫—Ü–∏—è `clock` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `uint48`.

–ê–≤—Ç–æ—Ä—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ —Å—á–∏—Ç–∞—é—Ç, —á—Ç–æ –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–∏–ø–∞ `uint48`. –û–Ω–∏ –ø—Ä–∏–≤–æ–¥—è—Ç —Ä–∞—Å—á–µ—Ç—ã –¥–ª—è —Ä–µ–∂–∏–º–∞ **timestamp**. –ü—Ä–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–∏—è 10 000 –±–ª–æ–∫–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É, —Ä–∞–∑–º–µ—Ä–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ 2861 –≥–æ–¥–∞. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –º–µ–Ω—å—à–µ, —á–µ–º `uint256` –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∫—Ä–∞—â–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –∏ —á—Ç–µ–Ω–∏—è –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç–∫–æ–Ω–æ–º–∏—Ç—å –Ω–∞ –≥–∞–∑–µ.

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

–ê–≤—Ç–æ—Ä–∞–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ —è–≤–ª—è—é—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä—É–¥—è—Ç—Å—è –Ω–∞–¥ –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π [OpenZeppelin](https://www.openzeppelin.com/). –ü–æ—ç—Ç–æ–º—É –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç, –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å, –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è **governance** —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ 4.9.0. –ù–∞–π—Ç–∏ –º–æ–∂–Ω–æ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ [GovernorVotes](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v4.9.0/contracts/governance/extensions/GovernorVotes.sol) –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ Governor.

```solidity
function clock() public view virtual override returns (uint48) {
    try token.clock() returns (uint48 timepoint) {
        return timepoint;
    } catch {
        return SafeCast.toUint48(block.number);
    }
}
```
–≠—Ç–æ—Ç –∫—É—Å–æ—á–µ–∫ –∫–æ–¥–∞ –∑–∞–≤—è–∑–∞–Ω –Ω–∞ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `clock()` –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Ç–æ–∫–µ–Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è. –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —á—Ç–æ –∏–∑ —Å–µ–±—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `timepoint`, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ [ERC20Votes](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v4.9.0/contracts/token/ERC20/extensions/ERC20Votes.sol) –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ ERC-20.–≠—Ç–æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–µ–ª–∞–µ—Ç –∏–∑ –æ–±—ã—á–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ - —Ç–æ–∫–µ–Ω –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ERC-6372. –¢–æ, —Ä–∞–¥–∏ —á–µ–≥–æ –º—ã —Ç—É—Ç –∏ —Å–æ–±—Ä–∞–ª–∏—Å—å. üòÖ

```solidity
/**
  * @dev Clock used for flagging checkpoints.
  * Can be overridden to implement timestamp based checkpoints (and voting).
  */
function clock() public view virtual override returns (uint48) {
    /// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –Ω–æ–º–µ—Ä –±–ª–æ–∫–∞
    return SafeCast.toUint48(block.number);
}

/**
  * @dev Description of the clock
  */
function CLOCK_MODE() public view virtual override returns (string memory) {
    /// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–∞–∫ –æ–∂–∏–¥–∞–ª–æ—Å—å
    require(clock() == block.number, "ERC20Votes: broken clock mode");

    /// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è —á–∞—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É —Å –Ω–æ–º–µ—Ä–æ–º –±–ª–æ–∫–∞
    return "mode=blocknumber&from=default";
}
```

–í –≥–ª–æ–±–∞–ª—å–Ω–æ–º –∫–æ–Ω—Ü–µ–ø—Ç–µ **governance**, —Ñ—É–Ω–∫—Ü–∏–∏ "—á–∞—Å–æ–≤" —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞ **snapshot**. –ú–µ—Ö–∞–Ω–∏–∑–º –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ —Ç–µ–∫—É—â–µ–º—É –Ω–æ–º–µ—Ä—É –±–ª–æ–∫–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ –Ω–æ–≤—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ **governance**, –≥–¥–µ —Å–Ω–∞—á–∞–ª–∞ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å—Ç–∞—Ä—Ç–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è.


## Links

1. [ERC-6372: Contract clock](https://eips.ethereum.org/EIPS/eip-6372)
2. [ERC20 Votes: ERC5805 and ERC6372](https://www.rareskills.io/post/erc20-votes-erc5805-and-erc6372)