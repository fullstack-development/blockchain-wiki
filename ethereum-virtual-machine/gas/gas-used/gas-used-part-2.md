# Gas used part 2: Storage gas calculation

**–ê–≤—Ç–æ—Ä:** [–†–æ–º–∞–Ω –Ø—Ä–ª—ã–∫–æ–≤](https://github.com/rlkvrv) üßê

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤ –ø–µ—Ä–≤–æ–π —á–∞—Å—Ç–∏ —Å—Ç–∞—Ç—å–∏ –º—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–ª–∏ –æ–±—â—É—é –º–µ—Ö–∞–Ω–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞ –≥–∞–∑–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –≤ —ç—Ç–æ–π —á–∞—Å—Ç–∏ –Ω–∞—à–µ–≥–æ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è –≤ –º–∏—Ä Ethereum –º—ã –±—É–¥–µ–º —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º (`storage`). –ü—Ä–æ–π–¥–µ–º—Å—è –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Ä–∞—Å—á–µ—Ç–æ–º –≥–∞–∑–∞ –≤ Ethereum, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –ø–æ –∫–∞–∫–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –ø—Ä–∏–Ω–∏–º–∞–ª–æ —Ä–µ—à–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ "–ø—Ä–∞–≤–∏–ª–∞—Ö –∏–≥—Ä—ã" –∏ –∫–∞–∫ —Å–µ–≥–æ–¥–Ω—è, –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–∏, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–∞—Å—á–µ—Ç—ã –≥–∞–∑–∞.

## –†–∞—Å—á–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –≥–∞–∑–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ SSTORE

–°—É—â–µ—Å—Ç–≤—É—é—Ç —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å `SSTORE`, –ø–æ–Ω—è—Ç—å –∏ –∑–∞–ø–æ–º–Ω–∏—Ç—å –∫–æ—Ç–æ—Ä—ã–µ —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞ –±—ã–≤–∞–µ—Ç –Ω–µ–ø—Ä–æ—Å—Ç–æ. –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª - —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å –≤ —Å–ª–æ—Ç (–∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å 0 –Ω–∞ –Ω–µ–Ω—É–ª–µ–≤–æ–µ) –±–æ–ª–µ–µ –∑–∞—Ç—Ä–∞—Ç–Ω–æ–π –ø–æ –≥–∞–∑—É, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –ø–µ—Ä–µ–∑–∞–ø–∏—Å–µ–π, —Ç–∞–∫ –∫–∞–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —ç—Ç–æ—Ç —Å–ª–æ—Ç —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤–∞–∂–Ω–æ —Å—Ç–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ—á–∏—â–µ–Ω–∏–µ –±–ª–æ–∫—á–µ–π–Ω–∞ –æ—Ç –Ω–µ–Ω—É–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ü–æ—ç—Ç–æ–º—É, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–ª–æ—Ç–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ 0, –∑–∞ —Ç–∞–∫—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω –≤–æ–∑–≤—Ä–∞—Ç –≥–∞–∑–∞.

### –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞—Å—á–µ—Ç–∞

–í –Ω–∞—á–∞–ª—å–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞ Ethereum —Ä–∞—Å—á—ë—Ç –≥–∞–∑–∞ –¥–ª—è `SSTORE` –≤—ã–≥–ª—è–¥–µ–ª —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

-   20,000 –≥–∞–∑–∞ –∑–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–æ—Ç–∞ —Å 0 –Ω–∞ –Ω–µ–Ω—É–ª–µ–≤–æ–µ;
-   5,000 –≥–∞–∑–∞ –∑–∞ –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–æ—Ç–∞;
-   –í–æ–∑–≤—Ä–∞—Ç 10,000 –≥–∞–∑–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–æ—Ç–∞ —Å –Ω–µ–Ω—É–ª–µ–≤–æ–≥–æ –Ω–∞ 0. –í–æ–∑–≤—Ä–∞—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

### EIP-1087: –£—á–µ—Ç –≥–∞–∑–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π SSTORE

–≠—Ç–∏ –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞, –∑–∞–ª–æ–∂–µ–Ω–Ω—ã–µ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞, –ø—Ä–∏–≤–µ–ª–∏ –∫ —Ä—è–¥—É –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞–µ–≤, –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–¥–µ–ª–µ "–º–æ—Ç–∏–≤–∞—Ü–∏—è" [EIP-1087](https://eips.ethereum.org/EIPS/eip-1087), –∫–æ–≥–¥–∞ —Ä–∞—Å—Ö–æ–¥ –≥–∞–∑–∞ –æ–∫–∞–∑—ã–≤–∞–ª—Å—è –Ω–µ—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –∏ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–º:

-   –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å –ø—É—Å—Ç—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∏–π –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ—Ç–∞ —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ 1, –∞ –∑–∞—Ç–µ–º –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ 0, —Ç—Ä–∞—Ç–∏—Ç `20,000 + 5,000 - 10,000 = 15,000` –≥–∞–∑–∞, —Ö–æ—Ç—è —Ç–∞–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫. –≠—Ç–æ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –º–µ—Ö–∞–Ω–∏–∑–º–∞—Ö –∑–∞—â–∏—Ç—ã –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞.
-   –ö–æ–Ω—Ç—Ä–∞–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ—Ç–∞ 0 –ø—è—Ç—å —Ä–∞–∑, —Ç—Ä–∞—Ç–∏—Ç `20,000 + 5 * 5,000 = 45,000` –≥–∞–∑–∞, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ —Ç–∞–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π —Ç—Ä–µ–±—É–µ—Ç —Å—Ç–æ–ª—å–∫–æ –∂–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–∏—Å–∫–∞, —Å–∫–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å, —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –≤ 20,000 –≥–∞–∑–∞.
-   –ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ —Å –∞–∫–∫–∞—É–Ω—Ç–∞ A –Ω–∞ B, –∞ –∑–∞—Ç–µ–º —Å B –Ω–∞ C, –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –≤—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã –∏–º–µ—é—Ç –Ω–µ–Ω—É–ª–µ–≤—ã–µ –Ω–∞—á–∞–ª—å–Ω—ã–µ –∏ –∫–æ–Ω–µ—á–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã, –æ–±—Ö–æ–¥–∏—Ç—Å—è –≤ `5,000 * 4 = 20,000` –≥–∞–∑–∞.

#### Dirty map

–í –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ—à–µ–Ω–∏—è –±—ã–ª–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **"dirty map"**, –∫–æ—Ç–æ—Ä–æ–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É –≤ —Ö–æ–¥–µ —Ç–µ–∫—É—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

> Dirty map ‚Äî —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–∏–ø–∞ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ, –∑–∞–ø–∏—Å—ã–≤–∞—é—â–∞—è –≤—Å–µ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ –≤—Å–µ—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö –∑–∞ –≤—Ä–µ–º—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

–î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–µ—Ä–µ–∑–∞–ø–∏—Å–µ–π –ø—Ä–µ–¥–ª–∞–≥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ 200 –µ–¥–∏–Ω–∏—Ü –≥–∞–∑–∞, –∞ —Ç–∞–∫–∂–µ –≤–≤–µ—Å—Ç–∏ —Å—á–µ—Ç—á–∏–∫ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≥–∞–∑–∞.

–ö—Ä–∞–π–Ω–∏–µ —Å–ª—É—á–∞–∏, –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤—ã—à–µ, –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è EIP-1087 —Å—Ç–∞–ª–∏ –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

-   –ï—Å–ª–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å –ø—É—Å—Ç—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–ª–æ—Ç 0 –≤ 1, –∞ –∑–∞—Ç–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ 0, —Å –Ω–µ–≥–æ –±—É–¥–µ—Ç –≤–∑–∏–º–∞—Ç—å—Å—è `20,000 + 200 - 19,800 = 400` –≥–∞–∑–∞, —á—Ç–æ –º–µ–Ω—å—à–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å 15,000.
-   –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å –ø—É—Å—Ç—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º, –∫–æ—Ç–æ—Ä—ã–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–ª–æ—Ç 0 –ø—è—Ç—å —Ä–∞–∑, –±—É–¥–µ—Ç –æ–±–ª–∞–≥–∞—Ç—å—Å—è `20,000 + 5 * 200 = 21,000` –≥–∞–∑–∞, —á—Ç–æ –º–µ–Ω—å—à–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å 45,000.
-   –ü–µ—Ä–µ–≤–æ–¥ –±–∞–ª–∞–Ω—Å–∞ —Å –∞–∫–∫–∞—É–Ω—Ç–∞ A –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç B, –∑–∞ –∫–æ—Ç–æ—Ä—ã–º —Å–ª–µ–¥—É–µ—Ç –ø–µ—Ä–µ–≤–æ–¥ —Å B –Ω–∞ C, –ø—Ä–∏ –≤—Å–µ—Ö –Ω–µ–Ω—É–ª–µ–≤—ã—Ö –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∏ –∫–æ–Ω–µ—á–Ω—ã—Ö –±–∞–ª–∞–Ω—Å–∞—Ö, –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å `5,000 * 3 + 200 = 15,200` –≥–∞–∑–∞, —á—Ç–æ –º–µ–Ω—å—à–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å 20,000.

–í—Å–µ —É—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –≤ [—Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ª—É—á–∞—è—Ö](https://eips.ethereum.org/EIPS/eip-1087#test-cases) EIP-1087, –≤—Å–µ–≥–æ –∏—Ö 12.

### EIP-1283: –£—á–µ—Ç –≥–∞–∑–∞ –¥–ª—è SSTORE –±–µ–∑ dirty map

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ "dirty map" –æ–∫–∞–∑–∞–ª–∞—Å—å —Å–ª–æ–∂–Ω–æ–π, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ [EIP-1283](https://eips.ethereum.org/EIPS/eip-1283), –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞ EIP-1087. –í EIP-1283 –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≥–∞–∑–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º. –ó–Ω–∞—á–µ–Ω–∏—è, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–µ –≤ `storage`, –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

-   **–ò—Å—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ—Ç–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (original value):** –ó–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ—Ç–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—Ç–∫–∞—Ç –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
-   **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ—Ç–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (current value):** –ó–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ—Ç–∞ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏ SSTORE.
-   **–ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ—Ç–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (new value):** –ó–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ—Ç–∞ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ SSTORE.

–í–æ–∑—å–º–µ–º –Ω–µ–±–æ–ª—å—à–æ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –±–µ—Ä–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ `ChangeNumberTwice` –∏–∑ —Å–ª–æ—Ç–∞ 0 –∏ –¥–≤–∞–∂–¥—ã –µ–≥–æ –º–µ–Ω—è–µ—Ç –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑–æ–≤–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `set()`:

```js
contract ChangeNumberTwice {
    uint256 public amount; // –¥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ä–∞–≤–Ω–æ 0

    function set() external {
        amount = 1; // –¥–æ SSTORE: original = 0; current = 0; new = 1;
        amount = 2; // –¥–æ SSTORE: original = 0; current = 1; new = 2;
    }
}

```

–¢–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –Ω–∞ —Å—Ö–µ–º–µ:

![slot-original-current-new-state](./img/slot-original-current-new-state.png)

–ü–æ–º–∏–º–æ —ç—Ç–æ–≥–æ –≤–º–µ—Å—Ç–æ "dirty map" –≤–≤–æ–¥—è—Ç—Å—è —Ç—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

-   **–ë–µ–∑–¥–µ–π—Å—Ç–≤–∏–µ (No-op):** –û–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ `current` == `new`.
-   **–°–≤–µ–∂–µ–µ (Fresh):** –°–ª–æ—Ç –Ω–µ –∏–∑–º–µ–Ω—è–ª—Å—è –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â—ë–Ω –∫ `original` –∑–Ω–∞—á–µ–Ω–∏—é. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ `current` != `new`, –Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `original`.
-   **–ì—Ä—è–∑–Ω–æ–µ (Dirty):** –°–ª–æ—Ç —É–∂–µ –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ `current` –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `new` –∏ `original`.

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç EIP-1087, —Ç–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –≤–Ω–µ–¥—Ä–∏—Ç—å –ª–µ–≥—á–µ, –∫ —Ç–æ–º—É –∂–µ –æ–Ω –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –µ—â–µ –±–æ–ª—å—à–µ [–∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞–µ–≤](https://eips.ethereum.org/EIPS/eip-1283#test-cases) (17).

–ï—Å–ª–∏ –º—ã –≤–µ—Ä–Ω–µ–º—Å—è –∫ –∫–æ–¥—É –∫–ª–∏–µ–Ω—Ç–∞ geth, —Ç–æ —É–≤–∏–¥–∏–º —á—Ç–æ –¥–ª—è `dynamicGas` –æ–ø–∫–æ–¥–∞ `SSTORE` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `gasSStore`.

```go
SSTORE: {
    execute:    opSstore,
    dynamicGas: gasSStore,
    minStack:   minStack(2, 0),
    maxStack:   maxStack(2, 0),
},
```

–í –∫–æ–¥–µ —Ñ—É–Ω–∫—Ü–∏–∏ [gasSStore](https://github.com/ethereum/go-ethereum/blob/ae4ea047e35bb35828231f1b93f2f65a964abdc9/core/vm/gas_table.go#L98) –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:

```go
// –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –º–µ—Ö–∞–Ω–∏–∑–º —É—á—ë—Ç–∞ –≥–∞–∑–∞, —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
// –ü—Ä–∞–≤–∏–ª–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ —Ä–µ–∂–∏–º–∞ –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è, –µ—Å–ª–∏ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ Petersburg
// (–∫–æ–≥–¥–∞ –±—ã–ª –æ—Ç–º–µ–Ω–µ–Ω EIP-1283) –ò–õ–ò –µ—Å–ª–∏ Constantinople –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω.
if evm.chainRules.IsPetersburg || !evm.chainRules.IsConstantinople {
    // ...
    // –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –≥–∞–∑–∞ –¥–ª—è —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–∞ St.Petersburg –∏ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
    // –∫—Ä–æ–º–µ —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–∞ Constantinople
}
```

–ö–æ—Ç–æ—Ä—ã–µ –≤—ã–∑—ã–≤–∞—é—Ç —Ä—è–¥ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–æ–≤ Petersburg –∏ Constantinople, –∞ —Ç–∞–∫–∂–µ EIP-1283, –¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è:

1. **–•–∞—Ä–¥-—Ñ–æ—Ä–∫ Petersburg:** –•–æ—Ç—è –æ–Ω –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –≤ [–∏—Å—Ç–æ—Ä–∏–∏](https://ethereum.org/en/history) —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–æ–≤ Ethereum, Petersburg —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–∞ Constantinople. –û–Ω –±—ã–ª –≤–≤–µ–¥–µ–Ω –¥–ª—è –æ—Ç–º–µ–Ω—ã EIP-1283 –∏–∑-–∑–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–π —É—è–∑–≤–∏–º–æ—Å—Ç–∏.
2. **EIP-1283 –∏ Constantinople:** EIP-1283 –±—ã–ª –≤–∫–ª—é—á–µ–Ω –≤ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–∞ Constantinople, –Ω–æ –∏–∑-–∑–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–π —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∫ –∞—Ç–∞–∫–µ "–ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞", –µ–≥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±—ã–ª–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞.
3. **–†–∞–±–æ—Ç–∞ Constantinople —Å EIP-1283:** –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ EIP-1283 –±—ã–ª –æ—Ç–º–µ–Ω–µ–Ω, –µ–≥–æ –∫–æ–¥ –æ—Å—Ç–∞–ª—Å—è –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö –∏ –∫–ª–∏–µ–Ω—Ç–∞—Ö –¥–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ª–∏–∑–∞ Constantinople.
4. **–û—Ç–º–µ–Ω–∞ EIP-1283:** EIP-1283 –±—ã–ª –æ—Ç–º–µ–Ω–µ–Ω –∏–∑-–∑–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —É—è–∑–≤–∏–º–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–ª–∞ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞—Ç–∞–∫—É "–ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞". –≠—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —Å–æ–∑–¥–∞–Ω–∏—é —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–∞ Petersburg –≤–º–µ—Å—Ç–µ —Å Constantinople –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã.

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ, –≤ –º–µ–π–Ω–Ω–µ—Ç–µ Ethereum –ø—Ä–æ–¥–æ–ª–∂–∏–ª —Ä–∞–±–æ—Ç–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –º–µ—Ö–∞–Ω–∏–∑–º —É—á—ë—Ç–∞ –≥–∞–∑–∞, –æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤ –Ω–∞—á–∞–ª–µ —Å—Ç–∞—Ç—å–∏, –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–π –≤ EIP-1283.

### EIP-2200: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è —É—á–µ—Ç–∞ –≥–∞–∑–∞

–ü–æ–ª—É—á–∞–µ—Ç—Å—è –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ —Ç—É —Ç–æ—á–∫—É, —Å –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∞–ª–∏, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫—É - [Istanbul](https://ethereum.org/en/history#istanbul), –∫–æ—Ç–æ—Ä—ã–π –≤–≤–æ–¥–∏—Ç 2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –≥–∞–∑—É: [EIP-2200](https://eips.ethereum.org/EIPS/eip-2200) –∏ [EIP-1884](https://eips.ethereum.org/EIPS/eip-1884) (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏—Ö 3, –Ω–æ EIP-1108 —Å–≤—è–∑–∞–Ω —Å –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π).

–û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏–µ:

-   **EIP-2200:** –ë–µ—Ä–µ—Ç –∑–∞ –æ—Å–Ω–æ–≤—É EIP-1283 –∏ [EIP-1706](https://eips.ethereum.org/EIPS/eip-1706), –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç—å EIP-1283. –¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –æ—Å—Ç–∞–≤—à–∏–π—Å—è –≥–∞–∑ (`gasleft`) –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–µ–Ω —Å—Ç–∏–ø–µ–Ω–¥–∏–∏ –∑–∞ –ø–µ—Ä–µ–≤–æ–¥ —ç—Ñ–∏—Ä–∞ (2300 –≥–∞–∑–∞), —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π `out of gas`.
-   **–Ø–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥–∞–∑–∞:** –í–≤–µ–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ `SSTORE_SET_GAS` –≤ EIP-2200, –¥–ª—è —è–≤–Ω–æ–≥–æ —É—á–µ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≥–∞–∑–∞.
-   **–°—Ç–æ–∏–º–æ—Å—Ç—å –≥—Ä—è–∑–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:** –í EIP-2200 —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ "–≥—Ä—è–∑–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É" —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `SLOAD_GAS` –∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 800 –µ–¥–∏–Ω–∏—Ü –≥–∞–∑–∞.
-   **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ `SLOAD`:** –í EIP-1884 —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ `SLOAD` —É–≤–µ–ª–∏—á–µ–Ω–∞ —Å 200 –¥–æ 800 –µ–¥–∏–Ω–∏—Ü –≥–∞–∑–∞.
-   **–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ EIP-2200:** –í–Ω–µ—Å–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é EIP-1283, —É–ª—É—á—à–∞—é—â–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∏—Å–ø—Ä–∞–≤–ª—è—é—â–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏.

#### EIPs in geth

–í —Ñ–∞–π–ª–µ [eips.go](https://github.com/ethereum/go-ethereum/blob/master/core/vm/eips.go) –∫–ª–∏–µ–Ω—Ç–∞ geth –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å EIPs, –≤–∫–ª—é—á–∞—è EIP-2200, –≤–Ω–µ–¥—Ä–µ–Ω–Ω—ã–π –ø–æ—Å–ª–µ —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–∞ Istanbul. –í–æ—Ç —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–≤–µ—á–∞—é—â–∞—è –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```go
    func enable2200(jt *JumpTable) {
        jt[SLOAD].constantGas = params.SloadGasEIP2200
        jt[SSTORE].dynamicGas = gasSStoreEIP2200
    }
```

–≠—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ –æ—Ç—Ä–∞–∂–∞—é—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

-   **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ `SLOAD`:** –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≥–∞–∑–∞ –¥–ª—è `SLOAD` –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ 800 –µ–¥–∏–Ω–∏—Ü, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–æ–≤—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –≤ EIP-2200. –°–∞–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≥–∞–∑–æ–º, –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ [protocol_params.go](https://github.com/ethereum/go-ethereum/blob/master/params/protocol_params.go#L108).
-   **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –≥–∞–∑–∞ –¥–ª—è `SSTORE`:** –í–≤–µ–¥–µ–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `gasSStoreEIP2200`, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–º–µ–Ω—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à—É—é —Ñ—É–Ω–∫—Ü–∏—é `gasSStore`. –≠—Ç–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≤–Ω–µ—Å–µ–Ω–Ω—ã–µ EIP-2200, –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≥–∞–∑–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π `SSTORE`. –ö–æ–¥ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ [gas_table.go](https://github.com/ethereum/go-ethereum/blob/7596db5f485e29dbbb66add8fcad6e25368bf96b/core/vm/gas_table.go#L183).

#### –¢–µ—Å—Ç-–∫–µ–π—Å—ã

EIP-2200 –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç [—Ç–∞–±–ª–∏—Ü—É](https://arc.net/l/quote/kskrsgme) —Å —Ç–µ—Å—Ç-–∫–µ–π—Å–∞–º–∏. –ü–æ–∫–∞–∂—É –∫–∞–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ä–∞—Å—á–µ—Ç –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –¥–≤—É—Ö —Å–ª—É—á–∞–µ–≤ —Å refund –∏ –±–µ–∑:

| Code                   | Used Gas | Refund | Original | Current | New |
| ---------------------- | -------- | ------ | -------- | ------- | --- |
| 0x60006000556000600055 | 1612     | 0      | 0        | 0       | 0   |
| 0x60006000556000600055 | 5812     | 15000  | 1        | 0       | 0   |

–í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –ø–∞—Ä—É –º–æ–º–µ–Ω—Ç–æ–≤:

1. –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π `current` –∏ `new`, —Ç.–∫. `original` —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ–º —á—Ç–æ –æ–Ω–æ —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ —Å–ª–æ—Ç –∑–∞—Ä–∞–Ω–µ–µ).
2. –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ —ç—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫–æ–¥, –Ω–æ —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∑–¥–µ—Å—å –Ω–µ—Ç –æ—à–∏–±–∫–∏.

##### –¢–µ—Å—Ç-–∫–µ–π—Å 1

| Code                   | Used Gas | Refund | Original | 1st | 2nd |
| ---------------------- | -------- | ------ | -------- | --- | --- |
| 0x60006000556000600055 | 1612     | 0      | 0        | 0   | 0   |

–†–∞–∑–ª–æ–∂–∏–º –∫–æ–¥ –Ω–∞ –æ–ø–∫–æ–¥—ã –∏ –∑–∞–ø–∏—à–µ–º —Å–∫–æ–ª—å–∫–æ –≥–∞–∑–∞ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –∫–∞–∂–¥—ã–π –æ–ø–∫–æ–¥, –∑–∞—Ç–µ–º –ø–æ—Å—á–∏—Ç–∞–µ–º —Å–∫–æ–ª—å–∫–æ –≥–∞–∑–∞ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∏ —Å–∫–æ–ª—å–∫–æ –Ω–∞–∫–æ–ø–∏–ª–æ—Å—å –≤ —Å—á–µ—Ç—á–∏–∫–µ **refund**.

| –û–ø–µ—Ä–∞—Ü–∏—è   | –ó–Ω–∞—á–µ–Ω–∏—è                           | –ì–∞–∑  | –£—Å–ª–æ–≤–∏–µ                        |
| ---------- | ---------------------------------- | ---- | ------------------------------ |
| PUSH1 0x00 | -                                  | 3    | -                              |
| PUSH1 0x00 | -                                  | 3    | -                              |
| SSTORE     | original = 0; current = 0; new = 0 | 800  | **current** == **new** (No-op) |
| PUSH1 0x00 | -                                  | 3    | -                              |
| PUSH1 0x00 | -                                  | 3    | -                              |
| SSTORE     | original = 0; current = 0; new = 0 | 800  | **current** == **new** (No-op) |
| **–ò—Ç–æ–≥**   | 3 + 3 + 800 + 3 + 3 + 800          | 1612 | -                              |
| **Refund** | -                                  | 0    | -                              |

–í –¥–∞–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –≤ –æ–±–æ–∏—Ö `sstore` —Å—Ä–∞–±–æ—Ç–∞–ª–æ –ø—Ä–∞–≤–∏–ª–æ:

-   If current value equals new value (this is a no-op), `SLOAD_GAS` is deducted.

–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ SLOAD_GAS = 800.

##### –¢–µ—Å—Ç-–∫–µ–π—Å 2

| Code                   | Used Gas | Refund | Original | Current | New |
| ---------------------- | -------- | ------ | -------- | ------- | --- |
| 0x60006000556000600055 | 5812     | 15000  | 1        | 0       | 0   |

–§–ª–æ—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–∏–π:

| –ö–æ–¥        | –û–ø–∏—Å–∞–Ω–∏–µ                           | –ì–∞–∑   | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                                               |
| ---------- | ---------------------------------- | ----- | ------------------------------------------------------------------------- |
| PUSH1 0x00 | -                                  | 3     | -                                                                         |
| PUSH1 0x00 | -                                  | 3     | -                                                                         |
| SSTORE     | original = 1; current = 1; new = 0 | 5000  | **current** != **new**, **original** != **current** (Dirty, refund 15000) |
| PUSH1 0x00 | -                                  | 3     | -                                                                         |
| PUSH1 0x00 | -                                  | 3     | -                                                                         |
| SSTORE     | original = 1; current = 0; new = 0 | 800   | **current** == **new** (No-op)                                            |
| **–ò—Ç–æ–≥**   | 3 + 3 + 5000 + 3 + 3 + 800         | 5812  | -                                                                         |
| **Refund** | -                                  | 15000 | -                                                                         |

–í –ø–µ—Ä–≤–æ–º `sstore` –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞:

-   **If current value does not equal new value**
    -   **If original value equals current value (this storage slot has not been changed by the current execution context)**
        -   If original value is 0, SSTORE_SET_GAS is deducted.
        -   **Otherwise, SSTORE_RESET_GAS gas is deducted. If new value is 0, add SSTORE_CLEARS_SCHEDULE gas to refund counter.**

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è SSTORE_RESET_GAS = 5000, SSTORE_CLEARS_SCHEDULE = 15000.

–≠—Ç–∏ –¥–≤–∞ –ø—Ä–∏–º–µ—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–±—â—É—é –ª–æ–≥–∏–∫—É, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ–¥–µ–ª–∞—Ç—å –ø–æ–¥–æ–±–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å —Å–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –∑–Ω–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏–π EIP-2200 –µ—â–µ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è.

## –¢–µ–ø–ª—ã–π –∏ —Ö–æ–ª–æ–¥–Ω—ã–π –¥–æ—Å—Ç—É–ø

–ü–æ—Å–ª–µ —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–∞ Istanbul, —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫ [Berlin](https://ethereum.org/en/history#berlin) –≤–Ω–µ—Å –≤–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≥–∞–∑–æ–º, –≤ Ethereum. –û–¥–Ω–æ –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π ‚Äî [EIP-2929: Gas cost increases for state access opcodes](https://eips.ethereum.org/EIPS/eip-2929). –≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–ª–∏—è–ª–∏ –Ω–∞ —Ä–∞—Å—á–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏ –≥–∞–∑–∞ –¥–ª—è `SSTORE`.

–í EIP-2929 –≤–≤–µ–¥–µ–Ω—ã —Ç—Ä–∏ –Ω–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–Ω–æ—Å—è—Ç –ø–æ–Ω—è—Ç–∏—è "—Ç–µ–ø–ª–æ–≥–æ" –∏ "—Ö–æ–ª–æ–¥–Ω–æ–≥–æ" –¥–æ—Å—Ç—É–ø–∞, –ø—Ä–∏–º–µ–Ω—è–µ–º—ã–µ –Ω–µ —Ç–æ–ª—å–∫–æ –∫ –æ–ø–µ—Ä–∞—Ü–∏—è–º —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º, –Ω–æ –∏ –∫ –¥—Ä—É–≥–∏–º –æ–ø–∫–æ–¥–∞–º, —Ä–∞–±–æ—Ç–∞—é—â–∏–º —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –±–ª–æ–∫—á–µ–π–Ω–∞, —Ç–∞–∫–∏–º –∫–∞–∫ `SLOAD`, —Å–µ–º–µ–π—Å—Ç–≤–æ `*CALL`, `BALANCE`, —Å–µ–º–µ–π—Å—Ç–≤–æ `EXT*` –∏ `SELFDESTRUCT`.

| Constant                 | Value |
| ------------------------ | ----- |
| COLD_SLOAD_COST          | 2100  |
| COLD_ACCOUNT_ACCESS_COST | 2600  |
| WARM_STORAGE_READ_COST   | 100   |

> –•–æ–ª–æ–¥–Ω—ã–π –¥–æ—Å—Ç—É–ø - –µ—Å–ª–∏ –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–ª–æ—Ç—É –≤ `storage` –∞–∫–∫–∞—É–Ω—Ç–∞ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –≤–ø–µ—Ä–≤—ã–µ (–≤—ã–ø–æ–ª–Ω—è—é—Ç –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö).
> –¢–µ–ø–ª—ã–π –¥–æ—Å—Ç—É–ø - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Å–ª—É—á–∞–µ —Å —Ç–µ–ø–ª—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∏–º–µ–µ—Ç—Å—è –≤ –≤–∏–¥—É, —á—Ç–æ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫ —ç—Ç–æ–º—É —Å–ª–æ—Ç—É —É–∂–µ –æ–±—Ä–∞—â–∞–ª–∏—Å—å (—Å–ª–æ—Ç –ø—Ä–æ–≥—Ä–µ—Ç).

–ù–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å–µ—Ç–∏ –∏ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.

–¢–∞–∫–∂–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

| Parameter        | Old value | New value                     |
| ---------------- | --------- | ----------------------------- |
| SLOAD            | 800       | 2100                          |
| SLOAD_GAS        | 800       | 100 (=WARM_STORAGE_READ_COST) |
| SSTORE_RESET_GAS | 5000      | 2900 (5000 - COLD_SLOAD_COST) |

_–í–∞–∂–Ω–æ!_ EIP-2929 –Ω–µ –æ—Ç–º–µ–Ω—è–µ—Ç –ø–æ–Ω—è—Ç–∏—è "Fresh" –∏ "Dirty" —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –∞ —Ç–∞–∫–∂–µ –≥—Ä–∞–¥–∞—Ü–∏—é –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ original/current/new –∏–∑ EIP-2200 (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É). –ö–æ –≤—Å–µ–º—É —ç—Ç–æ–º—É –µ—â–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏–π –¥–æ—Å—Ç—É–ø—ã (—Ö–æ–ª–æ–¥–Ω—ã–π –∏ —Ç–µ–ø–ª—ã–π) –∫ —Å–ª–æ—Ç–∞–º.

_–í–∞–∂–Ω–æ!_ –î–æ—Å—Ç—É–ø—ã —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –Ω–∞ –¥—Ä—É–≥–∏–µ –æ–ø–∫–æ–¥—ã, –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å `SLOAD` –∏ `SSTORE`. –≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç –≤ –ø–æ–Ω–∏–º–∞–Ω–∏–∏ –¥–∞–Ω–Ω–æ–≥–æ EIP.

–ï—Å–ª–∏ –≤–∑—è—Ç—å –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–µ–π—Å –∏–∑ EIP-2200, —Ç–æ–≥–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏–µ:

–ë—ã–ª–æ:
| Code | Used Gas | Refund | Original | 1st | 2nd | 3rd |
| -------------------- | -------- | ------ | -------- | --- | --- | --- |
| 0x600060055600600055 | 1612 | 0 | 0 | 0 | 0 | 0 |

```
    PUSH1 + PUSH1 + SSTORE + PUSH1 + PUSH1 + SSTORE
    3 + 3 + 800 + 3 + 3 + 800 = 1612
```

–°—Ç–∞–ª–æ:
| Code | Used Gas | Refund | Original | 1st | 2nd | 3rd |
| -------------------- | -------- | ------ | -------- | --- | --- | --- |
| 0x600060055600600055 | 2312 | 0 | 0 | 0 | 0 | 0 |

```
    PUSH1 + PUSH1 + SSTORE + PUSH1 + PUSH1 + SSTORE
    3 + 3 + (2100 + 100) + 3 + 3 + 100 = 2300
```

–¢–æ –µ—Å—Ç—å, —Ä–∞–Ω—å—à–µ –∫–∞–∂–¥–∞—è –ø–æ—Å–ª–µ–¥—É—é—â–∞—è –∑–∞–ø–∏—Å—å –≤ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–ª–æ—Ç (–≤ —Å–ª—É—á–∞–µ –∫–æ–≥–¥–∞ **current** == **original**) —Å—Ç–æ–∏–ª–æ –±—ã 800 –µ–¥. –≥–∞–∑–∞. –ü–æ—Å–ª–µ EIP-2929, —Å–∞–º–æ–µ –ø–µ—Ä–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥–µ—Ç –¥–æ—Ä–æ–∂–µ (2200), –Ω–æ –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –±—É–¥—É—Ç —Å–∏–ª—å–Ω–æ –¥–µ—à–µ–≤–ª–µ (100).

–¢–∞–∫–∂–µ –ø–æ–º–µ–Ω—è–ª–∞—Å—å –ª–æ–≥–∏–∫–∞ –∏ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º –≥–∞–∑–∞ –≤ —Å–≤—è–∑–∏ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º `SSTORE_RESET_GAS`.

### –°–ø–∏—Å–∫–∏ –¥–æ—Å—Ç—É–ø–∞

–í—Ç–æ—Ä–æ–µ –∫–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –≤–Ω–µ—Å–µ–Ω–Ω–æ–µ —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–æ–º Berlin, –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ [EIP-2930: Optional access lists](https://eips.ethereum.org/EIPS/eip-2930), –∫–æ—Ç–æ—Ä—ã–π –≤–≤–æ–¥–∏—Ç —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã–µ —Å–ø–∏—Å–∫–∏ –¥–æ—Å—Ç—É–ø–∞. –≠—Ç–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è —Å–º—è–≥—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π, –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö EIP-2929, –∏ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –Ω–æ–≤—ã–π —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (—Ç–∏–ø 1) —Å –≤–∫–ª—é—á–µ–Ω–∏–µ–º —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –¢–∞–∫–∂–µ –≤–≤–æ–¥—è—Ç—Å—è –Ω–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:

| Constant                     | Value |
| ---------------------------- | ----- |
| ACCESS_LIST_STORAGE_KEY_COST | 1900  |
| ACCESS_LIST_ADDRESS_COST     | 2400  |

–°–ø–∏—Å–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –≤ —ç—Ç–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö —Ç–∏–ø–∞ 1 –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–∞—Ä–∞–Ω–µ–µ —É–∫–∞–∑—ã–≤–∞—Ç—å, –∫ –∫–∞–∫–∏–º –∞–¥—Ä–µ—Å–∞–º –∏ –∫–ª—é—á–∞–º —Ö—Ä–∞–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –¥–æ—Å—Ç—É–ø –≤ —Ö–æ–¥–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –≠—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≥–∞–∑–∞ –¥–ª—è "—Ö–æ–ª–æ–¥–Ω—ã—Ö" –¥–æ—Å—Ç—É–ø–æ–≤, –µ—Å–ª–∏ –æ–Ω–∏ –∑–∞—Ä–∞–Ω–µ–µ —É–∫–∞–∑–∞–Ω—ã –≤ —Å–ø–∏—Å–∫–µ –¥–æ—Å—Ç—É–ø–∞, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º —Å–º—è–≥—á–∞—è –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≥–∞–∑–∞ –¥–ª—è "—Ö–æ–ª–æ–¥–Ω—ã—Ö" —á—Ç–µ–Ω–∏–π, –≤–≤–µ–¥–µ–Ω–Ω–æ–π –≤ EIP-2929.

–°–º—ã—Å–ª —Ç–∞–∫–æ–π. –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å —ç—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–µ–º–Ω–æ–≥–æ –¥–µ—à–µ–≤–ª–µ –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–≤–∞ —É—Å–ª–æ–≤–∏—è:

-   –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –ê, –∫–æ—Ç–æ—Ä—ã–π –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –≤—ã–∑—ã–≤–∞–µ—Ç —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –ë, –í –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ `ACCESS_LIST_ADDRESS_COST` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤—ã–∑—ã–≤–∞–µ–º—ã—Ö –∏–∑ –ê - —Ç.–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –ë, –í –∏ —Ç.–¥
-   –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç –∞–¥—Ä–µ—Å–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, –≤—ã–∑—ã–≤–∞–µ–º—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º –ê, –∏ —Å–ª–æ—Ç—ã –ø–∞–º—è—Ç–∏, –∫ –∫–æ—Ç–æ—Ä—ã–º —ç—Ç–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –æ–±—Ä–∞—â–∞—é—Ç—Å—è.

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —ç—Ç–∏—Ö —É—Å–ª–æ–≤–∏–π, —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–≤–æ–≥–æ (—Ö–æ–ª–æ–¥–Ω–æ–≥–æ) –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–ø–∫–æ–¥–∞–º `CALL` –∏ `SLOAD` –¥–ª—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ë —Å–Ω–∏–∂–∞–µ—Ç—Å—è:

| Constant                     | –°–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç | CALL | SLOAD |
| ---------------------------- | -------------- | ---- | ----- |
| ACCESS_LIST_STORAGE_KEY_COST | –ê              | 2600 | 2400  |
| ACCESS_LIST_ADDRESS_COST     | –ë              | 2100 | 1900  |

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ –∫–ª–∏–µ–Ω—Ç–µ geth

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ EIP-2929 —Å "—Ç–µ–ø–ª—ã–º" –∏ "—Ö–æ–ª–æ–¥–Ω—ã–º" –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É –≤ [–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ StateDB](https://github.com/ethereum/go-ethereum/blob/f55a10b64d511b27beb02ff4978a6ed66d604cd8/core/vm/interface.go#L66), –∞ –∏–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–≤—É—Ö –ø–æ–ª–µ–π: `AddressInAccessList` –∏ `SlotInAccessList`. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—á–∏—Ç—ã–≤–∞–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (—Ç.–µ. "—Ö–æ–ª–æ–¥–Ω–æ–º" –¥–æ—Å—Ç—É–ø–µ), –æ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ `SlotInAccessList`. –í—Ç–æ—Ä–æ–µ –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (—Ç.–µ. "—Ç–µ–ø–ª—ã–µ" –¥–æ—Å—Ç—É–ø—ã) –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç –º–µ–Ω—å—à–µ –≥–∞–∑–∞.

–î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è, –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ñ—É–Ω–∫—Ü–∏–∏ [enable2929](https://github.com/ethereum/go-ethereum/blob/18e154eaa24d5f7a8b3c48983ad591e6c10963ca/core/vm/eips.go#L120), –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –∫ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –≥–∞–∑–∞ –¥–ª—è –æ–ø–∫–æ–¥–∞ `SLOAD` - `gasSLoadEIP2929`:

```go
func enable2929(jt *JumpTable) {
    jt[SSTORE].dynamicGas = gasSStoreEIP2929

    jt[SLOAD].constantGas = 0
    jt[SLOAD].dynamicGas = gasSLoadEIP2929

    // ...
}
```

–°–∞–º–∞ —Ñ—É–Ω–∫—Ü–∏—è [gasSLoadEIP2929](https://github.com/ethereum/go-ethereum/blob/f55a10b64d511b27beb02ff4978a6ed66d604cd8/core/vm/operations_acl.go#L103) –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```go
// –î–ª—è SLOAD, –µ—Å–ª–∏ –ø–∞—Ä–∞ (–∞–¥—Ä–µ—Å, –∫–ª—é—á_—Ö—Ä–∞–Ω–µ–Ω–∏—è) (–≥–¥–µ –∞–¥—Ä–µ—Å - —ç—Ç–æ –∞–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞,
// —á—å–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è) –µ—â–µ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ accessed_storage_keys,
// –≤–∑–∏–º–∞–µ—Ç—Å—è 2100 –≥–∞–∑–∞ –∏ –ø–∞—Ä–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ accessed_storage_keys.
// –ï—Å–ª–∏ –ø–∞—Ä–∞ —É–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ accessed_storage_keys, –≤–∑–∏–º–∞–µ—Ç—Å—è 100 –≥–∞–∑–∞.
func gasSLoadEIP2929(evm *EVM, contract *Contract, stack *Stack, mem *Memory, memorySize uint64) (uint64, error) {
	loc := stack.peek()
	slot := common.Hash(loc.Bytes32())
	// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–ª–æ—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ –¥–æ—Å—Ç—É–ø–∞
	if _, slotPresent := evm.StateDB.SlotInAccessList(contract.Address(), slot); !slotPresent {
		// –ï—Å–ª–∏ –≤—ã–∑—ã–≤–∞—é—â–∏–π –Ω–µ –º–æ–∂–µ—Ç –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–µ–Ω–æ
		// –ï—Å–ª–∏ –æ–Ω –º–æ–∂–µ—Ç –ø–æ–∑–≤–æ–ª–∏—Ç—å, –º—ã –º–æ–∂–µ–º –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–≥–æ –∂–µ —Å–∞–º–æ–≥–æ –ø–æ–∑–∂–µ, –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
		evm.StateDB.AddSlotToAccessList(contract.Address(), slot)
		return params.ColdSloadCostEIP2929, nil
	}
	return params.WarmStorageReadCostEIP2929, nil
}
```

_–í–∞–∂–Ω–æ!_ –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —Å–ø–∏—Å–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –º–æ–∂–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å –≤ [—ç—Ç–æ–π](https://www.rareskills.io/post/eip-2930-optional-access-list-ethereum) —Å—Ç–∞—Ç—å–µ.

### –í–æ–∑–≤—Ä–∞—Ç –≥–∞–∑–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –º–µ—Ö–∞–Ω–∏–∑–º –≤–æ–∑–≤—Ä–∞—Ç–∞ –≥–∞–∑–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤ Ethereum, –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É, –∫–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –≤ EIP-1283. –≠—Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞, –º–µ–Ω—è–≤—à–∞—è—Å—è —Å –∫–∞–∂–¥—ã–º —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–æ–º, –Ω–∞—á–∞–ª–∞—Å—å —Å –≤–æ–∑–º–µ—â–µ–Ω–∏—è 10,000 –µ–¥–∏–Ω–∏—Ü –≥–∞–∑–∞ –∑–∞ –æ—á–∏—Å—Ç–∫—É —Å–ª–æ—Ç–∞. –ü—Ä–∞–≤–∏–ª–∞ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –≤ EIP-1283 –∏ –±—ã–ª–∏ –¥–æ–ø–æ–ª–Ω–µ–Ω—ã –≤ EIP-2200:

1. –ü—Ä–∏ –∑–∞–º–µ–Ω–µ –Ω–µ–Ω—É–ª–µ–≤–æ–≥–æ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (original) –Ω–∞ –Ω–æ–ª—å, –≤–æ–∑–≤—Ä–∞—Ç —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç `SSTORE_CLEARS_SCHEDULE` (15,000 –≥–∞–∑–∞).
2. –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ `original` –±—ã–ª–æ –Ω—É–ª–µ–≤—ã–º, `current` - –Ω–µ–Ω—É–ª–µ–≤—ã–º, –∏ `new` - –Ω—É–ª–µ–≤—ã–º, –≤–æ–∑–≤—Ä–∞—Ç —Ä–∞–≤–µ–Ω `SSTORE_SET_GAS` - `SLOAD_GAS` (19,900 –≥–∞–∑–∞).
3. –ü—Ä–∏ –∑–∞–º–µ–Ω–µ –Ω–µ–Ω—É–ª–µ–≤–æ–≥–æ `original` –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–æ–µ –Ω–µ–Ω—É–ª–µ–≤–æ–µ, –∞ –∑–∞—Ç–µ–º –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ `original`, –≤–æ–∑–≤—Ä–∞—Ç —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç `SSTORE_RESET_GAS` - `SLOAD_GAS` (4,900 –≥–∞–∑–∞).

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞–µ–≤ –∏–∑—É—á–∏—Ç—å –≤ [—Ç–µ—Å—Ç–æ–≤—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö](https://arc.net/l/quote/bfzggnpq) EIP-2200.

#### EIP-3529: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–µ—Ö–∞–Ω–∏–∑–º–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≥–∞–∑–∞

EIP-2929 –Ω–µ –≤–Ω–æ—Å–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –º–µ—Ö–∞–Ω–∏–∑–º –≤–æ–∑–≤—Ä–∞—Ç–∞ –≥–∞–∑–∞, –Ω–æ —Ç–∞–∫–æ–≤—ã–µ –ø–æ—è–≤–∏–ª–∏—Å—å –≤ —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–µ [London](https://ethereum.org/en/history#london) —Å [EIP-3529](https://eips.ethereum.org/EIPS/eip-3529). –≠—Ç–æ—Ç EIP –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≥–∞–∑–∞ –∑–∞ `SSTORE` –∏ `SELFDESTRUCT`. –†–∞–Ω–µ–µ, —ç—Ç–∏ –≤–æ–∑–º–µ—â–µ–Ω–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–∞–ª–∏—Å—å –¥–ª—è —Å—Ç–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫ "—Ö–æ—Ä–æ—à–µ–π –≥–∏–≥–∏–µ–Ω–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π", —Ç–æ –µ—Å—Ç—å –∫ –æ—á–∏—Å—Ç–∫–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤. –û–¥–Ω–∞–∫–æ, –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —ç—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø—Ä–æ–±–ª–µ–º–∞–º:

1. **–ü—Ä–æ–±–ª–µ–º–∞ GasToken**: GasToken –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç–∫–æ–Ω–æ–º–∏—Ç—å –≥–∞–∑ –≤ –ø–µ—Ä–∏–æ–¥—ã –Ω–∏–∑–∫–∏—Ö –∫–æ–º–∏—Å—Å–∏–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ –ø–µ—Ä–∏–æ–¥—ã –≤—ã—Å–æ–∫–∏—Ö —Ü–µ–Ω, –Ω–æ —ç—Ç–æ —Ç–∞–∫–∂–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —É–≤–µ–ª–∏—á–µ–Ω–∏—é —Ä–∞–∑–º–µ—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ç–∏ (–ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–æ—Ç—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –∫–∞–∫ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª–∏ –≥–∞–∑–∞) –∏ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–µ—Ç—å. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø—Ä–∞–≤–∏–ª–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–∞–≤–∞–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞—Ç—å –≥–∞–∑–æ–º, –≤–ª–∏—è—è –Ω–∞ —Ä–∞–±–æ—Ç—É –≤—Å–µ–≥–æ –±–ª–æ–∫—á–µ–π–Ω–∞.

    > GasToken - —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤ —Å–µ—Ç–∏ Ethereum, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ–∫—É–ø–∞—Ç—å –∏ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –≥–∞–∑ –Ω–∞–ø—Ä—è–º—É—é, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π "–±–∞–Ω–∫–∏–Ω–≥" –≥–∞–∑–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –∑–∞—â–∏—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç —Ä–æ—Å—Ç–∞ —Ü–µ–Ω –Ω–∞ –≥–∞–∑.

2. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—Ä–∞ –±–ª–æ–∫–∞**: –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞, –ø–æ—Ç—Ä–µ–±–ª—è–µ–º–æ–µ –≤ –±–ª–æ–∫–µ, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—á—Ç–∏ –≤–¥–≤–æ–µ –±–æ–ª—å—à–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ –≥–∞–∑–∞ –∏–∑-–∑–∞ –≤–æ–∑–º–µ—â–µ–Ω–∏–π. –≠—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–µ–±–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –±–ª–æ–∫–æ–≤ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≥–∞–∑–∞ –Ω–∞ –±–æ–ª–µ–µ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥, —á—Ç–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç —Ü–µ–ª—è–º [EIP-1559](https://eips.ethereum.org/EIPS/eip-1559).

EIP-3529 –≤–Ω–µ—Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–º–µ–Ω—å—à–µ–Ω–∏—é –≤–æ–∑–º–µ—â–µ–Ω–∏–π –∑–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏, —á—Ç–æ–±—ã –ø–æ–≤—ã—Å–∏—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —ç–∫–æ–Ω–æ–º–∏–∫–∏ –≥–∞–∑–∞. –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. –£–¥–∞–ª–∏—Ç—å –≤–æ–∑–º–µ—â–µ–Ω–∏–µ –≥–∞–∑–∞ –∑–∞ `SELFDESTRUCT`.
2. –ó–∞–º–µ–Ω–∏—Ç—å `SSTORE_CLEARS_SCHEDULE` (–∫–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –≤ EIP-2200) –Ω–∞ `SSTORE_RESET_GAS` + `ACCESS_LIST_STORAGE_KEY_COST` (4,800 –≥–∞–∑–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –Ω–∞ EIP-2929 + EIP-2930).
3. –£–º–µ–Ω—å—à–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞, –≤–æ–∑–º–µ—â–∞–µ–º–æ–≥–æ –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –¥–æ `gas_used` // `MAX_REFUND_QUOTIENT`.
    - –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –†–∞–Ω–µ–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–º–µ—â–∞–µ–º–æ–≥–æ –≥–∞–∑–∞ –æ–ø—Ä–µ–¥–µ–ª—è–ª–æ—Å—å –∫–∞–∫ `gas_used` // 2. –í EIP –∫–æ–Ω—Å—Ç–∞–Ω—Ç–µ 2 –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ `MAX_REFUND_QUOTIENT`, –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ 5.

##### –ò–∑–º–µ–Ω–µ–Ω–∏—è EIP-3529 –≤ –∫–ª–∏–µ–Ω—Ç–µ geth

–ü—Ä–æ—Å–ª–µ–¥–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è EIP-3529 –≤ –∫–æ–¥–µ geth. –î–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ñ–∞–π–ª [eips.go](https://github.com/ethereum/go-ethereum/blob/master/core/vm/eips.go), –Ω–∞—Ö–æ–¥–∏–º —Ñ—É–Ω–∫—Ü–∏—é [enable3529](https://github.com/ethereum/go-ethereum/blob/566754c74a74c8175ec2f1ee5cc10a8caced6015/core/vm/eips.go#L160C8-L160C8):

```go
// enable3529 –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç "EIP-3529: –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –≤–æ–∑–º–µ—â–µ–Ω–∏–π":
// - –£–¥–∞–ª—è–µ—Ç –≤–æ–∑–º–µ—â–µ–Ω–∏—è –∑–∞ selfdestruct
// - –£–º–µ–Ω—å—à–∞–µ—Ç –≤–æ–∑–º–µ—â–µ–Ω–∏—è –∑–∞ SSTORE
// - –£–º–µ–Ω—å—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–µ—â–µ–Ω–∏—è –¥–æ 20% –æ—Ç –≥–∞–∑–∞
func enable3529(jt *JumpTable) {
    jt[SSTORE].dynamicGas = gasSStoreEIP3529
    jt[SELFDESTRUCT].dynamicGas = gasSelfdestructEIP3529
}
```

–§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è `dynamicGas` –≤ –æ—á–µ—Ä–µ–¥–Ω–æ–π —Ä–∞–∑ –∏–∑–º–µ–Ω–µ–Ω–∞, —Ç–µ–ø–µ—Ä—å —ç—Ç–æ `gasSStoreEIP3529`:

```go
// gasSStoreEIP3529 —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≥–∞–∑–∞ –¥–ª—è SSTORE –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å EIP-3529
// –ó–∞–º–µ–Ω—è–µ—Ç SSTORE_CLEARS_SCHEDULE –Ω–∞ SSTORE_RESET_GAS + ACCESS_LIST_STORAGE_KEY_COST (4,800)
gasSStoreEIP3529 = makeGasSStoreFunc(params.SstoreClearsScheduleRefundEIP3529)
```

–ï—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–∑ —á–µ–≥–æ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è `SstoreClearsScheduleRefundEIP3529`, –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ–∑–≤—Ä–∞—Ç–æ–≤:

```go
// –í EIP-2200: SstoreResetGas –±—ã–ª 5000.
// –í EIP-2929: SstoreResetGas –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ '5000 - COLD_SLOAD_COST'.
// –í EIP-3529: SSTORE_CLEARS_SCHEDULE –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ SSTORE_RESET_GAS + ACCESS_LIST_STORAGE_KEY_COST
// –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–æ–≤–Ω—è–µ—Ç—Å—è: 5000 - 2100 + 1900 = 4800
SstoreClearsScheduleRefundEIP3529 uint64 = SstoreResetGasEIP2200 - ColdSloadCostEIP2929 + TxAccessListStorageKeyGas
```

–í —Ñ–∞–π–ª–µ —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏ —Ç–∞–∫–∂–µ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:

```go
SstoreClearsScheduleRefundEIP2200 uint64 = 15000
```

##### –¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏ EIP-3529 –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–∞ –≥–∞–∑–∞

[–¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏](https://eips.ethereum.org/EIPS/eip-3529#test-cases) EIP-3529 –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–æ–∑–≤—Ä–∞—Ç–∞—Ö –≥–∞–∑–∞ –¥–æ –∏ –ø–æ—Å–ª–µ –µ–≥–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏. –û–Ω–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ –≤–∏–¥–µ –¥–≤—É—Ö —Ç–∞–±–ª–∏—Ü, –≥–¥–µ –∑–∞–º–µ—Ç–Ω–æ, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç—ã, —Ä–∞–Ω–µ–µ —Å–æ—Å—Ç–∞–≤–ª—è–≤—à–∏–µ 15,000 –µ–¥–∏–Ω–∏—Ü –≥–∞–∑–∞, —Ç–µ–ø–µ—Ä—å —Å–æ–∫—Ä–∞—â–µ–Ω—ã –¥–æ 4,800 –µ–¥–∏–Ω–∏—Ü.

_–í–∞–∂–Ω–æ!_ –≠—Ç–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ–¥–µ–Ω—ã —Å –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º, —á—Ç–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —É–∂–µ "–ø—Ä–æ–≥—Ä–µ—Ç–æ".

–ù–∞ —Å–∞–π—Ç–µ evm.codes –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–∞ –¥–ª—è –æ–ø–∫–æ–¥–∞ [SSTORE](https://arc.net/l/quote/yxdehesj), –ø–æ–∑–≤–æ–ª—è—é—â–∏–π —É–∫–∞–∑–∞—Ç—å —Ç—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏—è (original, current, new) –∏ —Ç–∏–ø —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (warm –∏–ª–∏ cold), —á—Ç–æ–±—ã —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç –≥–∞–∑–∞. –¢–∞–º –∂–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Ä–∞—Å—á–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å–ª–æ–≤–∏–π.

–≠—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –≥–∞–∑–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏, –∫–æ–≥–¥–∞ Ethereum –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ö–∞—Ä–¥-—Ñ–æ—Ä–∫–µ [Shanghai](https://ethereum.org/en/history#shanghai).

–°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –≤ –±—É–¥—É—â–µ–º –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –≥–∞–∑–∞ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è. –û–¥–Ω–∞–∫–æ —Ç–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ, –≥–¥–µ –∏—Å–∫–∞—Ç—å —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∫–∞–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å. –í Ethereum, –ø–æ–¥–æ–±–Ω–æ –∑–∞–∫–æ–Ω–∞–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –º–∏—Ä–µ, –ø—Ä–∞–≤–∏–ª–∞ –º–æ–≥—É—Ç —É—Å—Ç–∞—Ä–µ–≤–∞—Ç—å, –º–µ–Ω—è—Ç—å—Å—è –∏–ª–∏ –ø—Ä–µ—Ç–µ—Ä–ø–µ–≤–∞—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏, —Ö–æ—Ç—è –º–µ—Ö–∞–Ω–∏–∑–º—ã —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

## –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≥–∞–∑

–ú—ã —É–∂–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–ª–∏ —Ä–∞—Å—á–µ—Ç –∏ —Å–ø–∏—Å–∞–Ω–∏–µ –≥–∞–∑–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ª–æ–≥–∏–∫–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–∞–∫–∂–µ –ø–æ–Ω—è—Ç–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –≥–∞–∑–∞ (intrinsic gas), –≤–∑–∏–º–∞–µ–º–æ–≥–æ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º —ç—Ç–æ–π –ª–æ–≥–∏–∫–∏. –í–∞–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö –≤—ã–∑–æ–≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å.

–î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –≥–∞–∑–∞, —Å–ª–µ–¥—É–µ—Ç –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ä–∞–∑–¥–µ–ª—É 6 Yellow paper Ethereum. –†–∞—Å—á–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –≥–∞–∑–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º—É–ª–æ–π g<sub>0</sub>:

![formula-67](./img/formula-67.png)

–î–ª—è –∑–Ω–∞—á–µ–Ω–∏–π G, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º—É–ª–µ, –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ "Appendix G. Fee Schedule" –Ω–∞ 27 —Å—Ç—Ä–∞–Ω–∏—Ü–µ Yellow paper. –§–æ—Ä–º—É–ª–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –≥–∞–∑–∞ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∞, –∏ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ –ø–æ—à–∞–≥–æ–≤–æ:

1. **–†–∞—Å—á–µ—Ç –≥–∞–∑–∞ –∑–∞ `calldata`:** –í —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–Ω –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—É–º–º–µ G<sub>txdatazero</sub> –∏ G<sub>txdatanonzero</sub>. –ó–∞ –∫–∞–∂–¥—ã–π –Ω–µ–Ω—É–ª–µ–≤–æ–π –±–∞–π—Ç `calldata` –≤–∑–∏–º–∞–µ—Ç—Å—è G<sub>txdatanonzero</sub> (16 –µ–¥. –≥–∞–∑–∞), –∞ –∑–∞ –∫–∞–∂–¥—ã–π –Ω—É–ª–µ–≤–æ–π –±–∞–π—Ç ‚Äî G<sub>txdatazero</sub> (4 –µ–¥. –≥–∞–∑–∞). –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `store(uint256 num)` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º num = 1:

```
    0x6057361d0000000000000000000000000000000000000000000000000000000000000001
```

-   –ü–µ—Ä–≤—ã–µ 4 –±–∞–π—Ç–∞ ‚Äî —ç—Ç–æ –Ω–µ–Ω—É–ª–µ–≤–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ –æ–±—Ö–æ–¥–∏—Ç—Å—è –≤ 4 \* 16 = 64 –µ–¥–∏–Ω–∏—Ü—ã –≥–∞–∑–∞.
-   –ó–∞—Ç–µ–º —Å–ª–µ–¥—É–µ—Ç 31 –Ω—É–ª–µ–≤–æ–π –±–∞–π—Ç, —á—Ç–æ —Ä–∞–≤–Ω–æ 31 \* 4 = 124 –µ–¥–∏–Ω–∏—Ü–∞–º –≥–∞–∑–∞.
-   –ù–µ–Ω—É–ª–µ–≤–æ–π –±–∞–π—Ç, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π `num = 1`, –≤–∑–∏–º–∞–µ—Ç 1 \* 16 = 16 –µ–¥–∏–Ω–∏—Ü –≥–∞–∑–∞.
-   –ò—Ç–æ–≥–æ, –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 64 + 124 + 16 = 204 –µ–¥–∏–Ω–∏—Ü—ã –≥–∞–∑–∞.

2. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞**: –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (–ø–æ–ª–µ `to` —Ä–∞–≤–Ω–æ –Ω—É–ª–µ–≤–æ–º—É –∞–¥—Ä–µ—Å—É), –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –≥–∞–∑—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è G<sub>txcreate</sub>, —Ä–∞–≤–Ω—ã–π 32,000 –µ–¥–∏–Ω–∏—Ü –≥–∞–∑–∞.

3. **–ë–∞–∑–æ–≤—ã–π –≥–∞–∑ –∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞, —Ç—Ä–µ–±—É–µ–º–æ–µ –¥–ª—è –ª—é–±–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç G<sub>transaction</sub> ‚Äî 21,000 –µ–¥–∏–Ω–∏—Ü –≥–∞–∑–∞. –≠—Ç–æ –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫ –ø—Ä–æ—Å—Ç—ã–º –ø–µ—Ä–µ–≤–æ–¥–∞–º —ç—Ñ–∏—Ä–∞, –≥–¥–µ –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, —Ç—Ä–µ–±—É—é—â–∏—Ö —É–≤–µ–ª–∏—á–µ–Ω–∏—è –≥–∞–∑–∞.

4. **–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–ø–∏—Å–∫—É**: –°–æ–≥–ª–∞—Å–Ω–æ [EIP-2930](https://eips.ethereum.org/EIPS/eip-2930), –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≥–∞–∑ —Ç–∞–∫–∂–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç G<sub>accesslistaddress</sub> (2,400 –µ–¥–∏–Ω–∏—Ü –≥–∞–∑–∞) –∏ G<sub>accessliststorage</sub> (1,900 –µ–¥–∏–Ω–∏—Ü –≥–∞–∑–∞). –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∑–∞ –∫–∞–∂–¥—ã–π –∞–¥—Ä–µ—Å –∏ —Å–ª–æ—Ç, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ —Å–ø–∏—Å–∫–µ –¥–æ—Å—Ç—É–ø–∞, –µ—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—É –∑–∞ "–ø—Ä–æ–≥—Ä–µ–≤".

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∫–∞–∫ –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å, —Ä–∞—Å—á–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –≥–∞–∑–∞ –≤ Ethereum –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç. –î–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏–∑—É—á–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é [IntrinsicGas](https://github.com/ethereum/go-ethereum/blob/c66ca8bf7a8c63ae54e44f4566e206cd1a4fa204/core/state_transition.go#L69), –Ω–∞—Ö–æ–¥—è—â—É—é—Å—è –≤ —Ñ–∞–π–ª–µ [state_transition.go](https://github.com/ethereum/go-ethereum/blob/master/core/state_transition.go) –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ go-ethereum.

## –û–±—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å—á–µ—Ç–∞ –≥–∞–∑–∞ –≤ Ethereum

–î–∞–≤–∞–π—Ç–µ —Å–æ–±–µ—Ä–µ–º –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤–º–µ—Å—Ç–µ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞—Å—á–µ—Ç–∞ –≥–∞–∑–∞ –≤ Ethereum. –í—Å–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –±–ª–æ–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è —Å—É–º–º–∞—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –≥–∞–∑–∞ –ø–æ –≤—Å–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º (`gasUsed`). –ö–∞–∂–¥–∞—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ –±–ª–æ–∫–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ—É–Ω–∫—Ü–∏–µ–π [applyTransaction](https://github.com/ethereum/go-ethereum/blob/566754c74a74c8175ec2f1ee5cc10a8caced6015/core/state_processor.go#L107), –≤ —Ö–æ–¥–µ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ –≥–∞–∑–∞**: –ü–µ—Ä–≤—ã–π —Å—á–µ—Ç—á–∏–∫ (`st.gas`) –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–∑–∞ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –µ–µ –ª–∏–º–∏—Ç–æ–º –≥–∞–∑–∞ (`gasLimit`). –í—Ç–æ—Ä–æ–π —Å—á–µ—Ç—á–∏–∫ —Å–ª–µ–¥–∏—Ç –∑–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–º –≥–∞–∑–æ–º.

2. **–ê–≤–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂**: –° –±–∞–ª–∞–Ω—Å–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∞–≤–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂, —Ä–∞–≤–Ω—ã–π –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é —Ü–µ–Ω—ã –≥–∞–∑–∞ (`gasPrice`) –Ω–∞ –ª–∏–º–∏—Ç –≥–∞–∑–∞ (`gasLimit`).

3. **–£–º–µ–Ω—å—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –≥–∞–∑–∞ –±–ª–æ–∫–∞**: –û–±—â–∏–π –ª–∏–º–∏—Ç –≥–∞–∑–∞ –±–ª–æ–∫–∞ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ –≤–µ–ª–∏—á–∏–Ω—É –ª–∏–º–∏—Ç–∞ –≥–∞–∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
4. **–†–∞—Å—á–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –≥–∞–∑–∞**: –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≥–∞–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –∫–∞–∂–¥—ã–π –±–∞–π—Ç `calldata`.
5. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**: –§—É–Ω–∫—Ü–∏—è `Call()` –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ - –∏ –ª–æ–≥–∏–∫—É —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —á–µ—Ä–µ–∑ `Run()`.
6. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç –≥–∞–∑–∞**: –°—á–µ—Ç—á–∏–∫ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≥–∞–∑–∞ (`st.gas`) –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç `Call()`. –ù–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –≥–∞–∑, —É–º–Ω–æ–∂–µ–Ω–Ω—ã–π –Ω–∞ —Ü–µ–Ω—É –≥–∞–∑–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é –≤ ETH. –û—Å—Ç–∞—Ç–æ–∫ –≥–∞–∑–∞ —Ç–∞–∫–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ–±—â–∏–π –ø—É–ª –≥–∞–∑–∞ –±–ª–æ–∫–∞.

–ù–∞ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–π —Å—Ö–µ–º–µ –Ω–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–∞–∑–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∫–∞–∫ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —Ç–∞–∫ –∏ –¥–ª—è –≤—Å–µ–≥–æ –±–ª–æ–∫–∞. –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –æ–± —ç—Ç–æ–º –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å [–∑–¥–µ—Å—å](https://arc.net/l/quote/wdbuajzw).

![gas-flow](./img/gas-flow.png)

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≥–∞–∑–∞ –∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –¥–≤–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ:

1. **–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≥–∞–∑–∞**: –û–Ω–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≥–∞–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –≤–∫–ª—é—á–∞—é—â–∏–π —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (`calldata`) –∏ –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã.
2. **–°—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞**: –≠—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –≥–∞–∑–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ª–æ–≥–∏–∫–æ–π –∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

–í–∞–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –±–∞–ª–∞–Ω—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –≥–∞–∑–∞. –¢–∞–∫–∂–µ –∫—Ä–∏—Ç–∏—á–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ª–∏–º–∏—Ç –≥–∞–∑–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –æ–±—â–∏–π –ª–∏–º–∏—Ç –≥–∞–∑–∞ –±–ª–æ–∫–∞, —á—Ç–æ–±—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –º–æ–≥–ª–∞ –±—ã—Ç—å —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤ —Ä–∞–º–∫–∞—Ö –±–ª–æ–∫–∞.

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –≠—Ç–æ –±—ã–ª–æ –¥–æ–ª–≥–∏–π –∏ —Å–ª–æ–∂–Ω—ã–π –ø—É—Ç—å, –Ω–æ —Ç–µ–ø–µ—Ä—å –≤ —Ä–∞—Å—á–µ—Ç–µ –≥–∞–∑–∞ —Å—Ç–∞–ª–æ –º–µ–Ω—å—à–µ –º–∞–≥–∏–∏. –í–æ—Ç —Ç—É—Ç –µ—Å—Ç—å –∫—Ä–∞—Ç–∫–∞—è [—à–ø–∞—Ä–≥–∞–ª–∫–∞](https://www.evm.codes/about) –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –º–æ–º–µ–Ω—Ç–∞–º.

## Links

-   [Article: EIP-2930 - Ethereum access list](https://www.rareskills.io/post/eip-2930-optional-access-list-ethereum)
-   [Doc: Ethereum Yellow Paper](https://ethereum.github.io/yellowpaper/paper.pdf)
-   [Code: Go-Ethereum](https://github.com/ethereum/go-ethereum)
